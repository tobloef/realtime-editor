var Id=Object.defineProperty,Ld=Object.defineProperties;var Pd=Object.getOwnPropertyDescriptors;var xi=Object.getOwnPropertySymbols;var Dl=Object.prototype.hasOwnProperty,Nl=Object.prototype.propertyIsEnumerable;var Al=(e,t,n)=>t in e?Id(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,z=(e,t)=>{for(var n in t||(t={}))Dl.call(t,n)&&Al(e,n,t[n]);if(xi)for(var n of xi(t))Nl.call(t,n)&&Al(e,n,t[n]);return e},Dt=(e,t)=>Ld(e,Pd(t));var Rl=(e,t)=>{var n={};for(var r in e)Dl.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&xi)for(var r of xi(e))t.indexOf(r)<0&&Nl.call(e,r)&&(n[r]=e[r]);return n};const Bd=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};Bd();function Yi(){}function mu(e){return e()}function Il(){return Object.create(null)}function yi(e){e.forEach(mu)}function Fd(e){return typeof e=="function"}function zd(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Vd(e){return Object.keys(e).length===0}function Ai(e,t){e.appendChild(t)}function jt(e,t,n){e.insertBefore(t,n||null)}function Nt(e){e.parentNode.removeChild(e)}function pe(e){return document.createElement(e)}function Ud(e){return document.createTextNode(e)}function fn(){return Ud(" ")}function Dn(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function Gt(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function jd(e){return Array.from(e.childNodes)}function Qo(e,t,n,r){n===null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function ee(e,t,n){e.classList[n?"add":"remove"](t)}let Gr;function Ur(e){Gr=e}function yu(){if(!Gr)throw new Error("Function called outside component initialization");return Gr}function Hd(e){yu().$$.on_mount.push(e)}function qd(e){yu().$$.on_destroy.push(e)}const Fr=[],zs=[],Vi=[],Ll=[],Wd=Promise.resolve();let Vs=!1;function Jd(){Vs||(Vs=!0,Wd.then(vu))}function Us(e){Vi.push(e)}const ts=new Set;let Di=0;function vu(){const e=Gr;do{for(;Di<Fr.length;){const t=Fr[Di];Di++,Ur(t),$d(t.$$)}for(Ur(null),Fr.length=0,Di=0;zs.length;)zs.pop()();for(let t=0;t<Vi.length;t+=1){const n=Vi[t];ts.has(n)||(ts.add(n),n())}Vi.length=0}while(Fr.length);for(;Ll.length;)Ll.pop()();Vs=!1,ts.clear(),Ur(e)}function $d(e){if(e.fragment!==null){e.update(),yi(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Us)}}const Kd=new Set;function Gd(e,t){e&&e.i&&(Kd.delete(e),e.i(t))}function Yd(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:s,after_update:a}=e.$$;i&&i.m(t,n),r||Us(()=>{const l=o.map(mu).filter(Fd);s?s.push(...l):yi(l),e.$$.on_mount=[]}),a.forEach(Us)}function Xd(e,t){const n=e.$$;n.fragment!==null&&(yi(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Zd(e,t){e.$$.dirty[0]===-1&&(Fr.push(e),Jd(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Qd(e,t,n,r,i,o,s,a=[-1]){const l=Gr;Ur(e);const c=e.$$={fragment:null,ctx:null,props:o,update:Yi,not_equal:i,bound:Il(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Il(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};s&&s(c.root);let f=!1;if(c.ctx=n?n(e,t.props||{},(u,d,...p)=>{const g=p.length?p[0]:d;return c.ctx&&i(c.ctx[u],c.ctx[u]=g)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](g),f&&Zd(e,u)),d}):[],c.update(),f=!0,yi(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const u=jd(t.target);c.fragment&&c.fragment.l(u),u.forEach(Nt)}else c.fragment&&c.fragment.c();t.intro&&Gd(e.$$.fragment),Yd(e,t.target,t.anchor,t.customElement),vu()}Ur(l)}class tp{$destroy(){Xd(this,1),this.$destroy=Yi}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!Vd(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Ht(e){this.content=e}Ht.prototype={constructor:Ht,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?void 0:this.content[t+1]},update:function(e,t,n){var r=n&&n!=e?this.remove(n):this,i=r.find(e),o=r.content.slice();return i==-1?o.push(n||e,t):(o[i+1]=t,n&&(o[i]=n)),new Ht(o)},remove:function(e){var t=this.find(e);if(t==-1)return this;var n=this.content.slice();return n.splice(t,2),new Ht(n)},addToStart:function(e,t){return new Ht([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new Ht(n)},addBefore:function(e,t,n){var r=this.remove(t),i=r.content.slice(),o=r.find(e);return i.splice(o==-1?i.length:o,0,t,n),new Ht(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return e=Ht.from(e),e.size?new Ht(e.content.concat(this.subtract(e).content)):this},append:function(e){return e=Ht.from(e),e.size?new Ht(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=Ht.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},get size(){return this.content.length>>1}};Ht.from=function(e){if(e instanceof Ht)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new Ht(t)};var Pl=Ht;function bu(e,t,n){for(var r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;var i=e.child(r),o=t.child(r);if(i==o){n+=i.nodeSize;continue}if(!i.sameMarkup(o))return n;if(i.isText&&i.text!=o.text){for(var s=0;i.text[s]==o.text[s];s++)n++;return n}if(i.content.size||o.content.size){var a=bu(i.content,o.content,n+1);if(a!=null)return a}n+=i.nodeSize}}function wu(e,t,n,r){for(var i=e.childCount,o=t.childCount;;){if(i==0||o==0)return i==o?null:{a:n,b:r};var s=e.child(--i),a=t.child(--o),l=s.nodeSize;if(s==a){n-=l,r-=l;continue}if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){for(var c=0,f=Math.min(s.text.length,a.text.length);c<f&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var u=wu(s.content,a.content,n-1,r-1);if(u)return u}n-=l,r-=l}}var B=function(t,n){if(this.content=t,this.size=n||0,n==null)for(var r=0;r<t.length;r++)this.size+=t[r].nodeSize},Mo={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};B.prototype.nodesBetween=function(t,n,r,i,o){i===void 0&&(i=0);for(var s=0,a=0;a<n;s++){var l=this.content[s],c=a+l.nodeSize;if(c>t&&r(l,i+a,o,s)!==!1&&l.content.size){var f=a+1;l.nodesBetween(Math.max(0,t-f),Math.min(l.content.size,n-f),r,i+f)}a=c}};B.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)};B.prototype.textBetween=function(t,n,r,i){var o="",s=!0;return this.nodesBetween(t,n,function(a,l){a.isText?(o+=a.text.slice(Math.max(t,l)-l,n-l),s=!r):a.isLeaf&&i?(o+=typeof i=="function"?i(a):i,s=!r):!s&&a.isBlock&&(o+=r,s=!0)},0),o};B.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var n=this.lastChild,r=t.firstChild,i=this.content.slice(),o=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),o=1);o<t.content.length;o++)i.push(t.content[o]);return new B(i,this.size+t.size)};B.prototype.cut=function(t,n){if(n==null&&(n=this.size),t==0&&n==this.size)return this;var r=[],i=0;if(n>t)for(var o=0,s=0;s<n;o++){var a=this.content[o],l=s+a.nodeSize;l>t&&((s<t||l>n)&&(a.isText?a=a.cut(Math.max(0,t-s),Math.min(a.text.length,n-s)):a=a.cut(Math.max(0,t-s-1),Math.min(a.content.size,n-s-1))),r.push(a),i+=a.nodeSize),s=l}return new B(r,i)};B.prototype.cutByIndex=function(t,n){return t==n?B.empty:t==0&&n==this.content.length?this:new B(this.content.slice(t,n))};B.prototype.replaceChild=function(t,n){var r=this.content[t];if(r==n)return this;var i=this.content.slice(),o=this.size+n.nodeSize-r.nodeSize;return i[t]=n,new B(i,o)};B.prototype.addToStart=function(t){return new B([t].concat(this.content),this.size+t.nodeSize)};B.prototype.addToEnd=function(t){return new B(this.content.concat(t),this.size+t.nodeSize)};B.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var n=0;n<this.content.length;n++)if(!this.content[n].eq(t.content[n]))return!1;return!0};Mo.firstChild.get=function(){return this.content.length?this.content[0]:null};Mo.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};Mo.childCount.get=function(){return this.content.length};B.prototype.child=function(t){var n=this.content[t];if(!n)throw new RangeError("Index "+t+" out of range for "+this);return n};B.prototype.maybeChild=function(t){return this.content[t]};B.prototype.forEach=function(t){for(var n=0,r=0;n<this.content.length;n++){var i=this.content[n];t(i,r,n),r+=i.nodeSize}};B.prototype.findDiffStart=function(t,n){return n===void 0&&(n=0),bu(this,t,n)};B.prototype.findDiffEnd=function(t,n,r){return n===void 0&&(n=this.size),r===void 0&&(r=t.size),wu(this,t,n,r)};B.prototype.findIndex=function(t,n){if(n===void 0&&(n=-1),t==0)return Ni(0,t);if(t==this.size)return Ni(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var r=0,i=0;;r++){var o=this.child(r),s=i+o.nodeSize;if(s>=t)return s==t||n>0?Ni(r+1,s):Ni(r,i);i=s}};B.prototype.toString=function(){return"<"+this.toStringInner()+">"};B.prototype.toStringInner=function(){return this.content.join(", ")};B.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null};B.fromJSON=function(t,n){if(!n)return B.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new B(n.map(t.nodeFromJSON))};B.fromArray=function(t){if(!t.length)return B.empty;for(var n,r=0,i=0;i<t.length;i++){var o=t[i];r+=o.nodeSize,i&&o.isText&&t[i-1].sameMarkup(o)?(n||(n=t.slice(0,i)),n[n.length-1]=o.withText(n[n.length-1].text+o.text)):n&&n.push(o)}return new B(n||t,r)};B.from=function(t){if(!t)return B.empty;if(t instanceof B)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new B([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(B.prototype,Mo);var es={index:0,offset:0};function Ni(e,t){return es.index=e,es.offset=t,es}B.empty=new B([],0);function Xi(e,t){if(e===t)return!0;if(!(e&&typeof e=="object")||!(t&&typeof t=="object"))return!1;var n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(!Xi(e[r],t[r]))return!1}else{for(var i in e)if(!(i in t)||!Xi(e[i],t[i]))return!1;for(var o in t)if(!(o in e))return!1}return!0}var at=function(t,n){this.type=t,this.attrs=n};at.prototype.addToSet=function(t){for(var n,r=!1,i=0;i<t.length;i++){var o=t[i];if(this.eq(o))return t;if(this.type.excludes(o.type))n||(n=t.slice(0,i));else{if(o.type.excludes(this.type))return t;!r&&o.type.rank>this.type.rank&&(n||(n=t.slice(0,i)),n.push(this),r=!0),n&&n.push(o)}}return n||(n=t.slice()),r||n.push(this),n};at.prototype.removeFromSet=function(t){for(var n=0;n<t.length;n++)if(this.eq(t[n]))return t.slice(0,n).concat(t.slice(n+1));return t};at.prototype.isInSet=function(t){for(var n=0;n<t.length;n++)if(this.eq(t[n]))return!0;return!1};at.prototype.eq=function(t){return this==t||this.type==t.type&&Xi(this.attrs,t.attrs)};at.prototype.toJSON=function(){var t={type:this.type.name};for(var n in this.attrs){t.attrs=this.attrs;break}return t};at.fromJSON=function(t,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");var r=t.marks[n.type];if(!r)throw new RangeError("There is no mark type "+n.type+" in this schema");return r.create(n.attrs)};at.sameSet=function(t,n){if(t==n)return!0;if(t.length!=n.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].eq(n[r]))return!1;return!0};at.setFrom=function(t){if(!t||t.length==0)return at.none;if(t instanceof at)return[t];var n=t.slice();return n.sort(function(r,i){return r.type.rank-i.type.rank}),n};at.none=[];function Ue(e){var t=Error.call(this,e);return t.__proto__=Ue.prototype,t}Ue.prototype=Object.create(Error.prototype);Ue.prototype.constructor=Ue;Ue.prototype.name="ReplaceError";var H=function(t,n,r){this.content=t,this.openStart=n,this.openEnd=r},ku={size:{configurable:!0}};ku.size.get=function(){return this.content.size-this.openStart-this.openEnd};H.prototype.insertAt=function(t,n){var r=Su(this.content,t+this.openStart,n,null);return r&&new H(r,this.openStart,this.openEnd)};H.prototype.removeBetween=function(t,n){return new H(_u(this.content,t+this.openStart,n+this.openStart),this.openStart,this.openEnd)};H.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};H.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};H.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t};H.fromJSON=function(t,n){if(!n)return H.empty;var r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new H(B.fromJSON(t,n.content),r,i)};H.maxOpen=function(t,n){n===void 0&&(n=!0);for(var r=0,i=0,o=t.firstChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.firstChild)r++;for(var s=t.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new H(t,r,i)};Object.defineProperties(H.prototype,ku);function _u(e,t,n){var r=e.findIndex(t),i=r.index,o=r.offset,s=e.maybeChild(i),a=e.findIndex(n),l=a.index,c=a.offset;if(o==t||s.isText){if(c!=n&&!e.child(l).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(i!=l)throw new RangeError("Removing non-flat range");return e.replaceChild(i,s.copy(_u(s.content,t-o-1,n-o-1)))}function Su(e,t,n,r){var i=e.findIndex(t),o=i.index,s=i.offset,a=e.maybeChild(o);if(s==t||a.isText)return r&&!r.canReplace(o,o,n)?null:e.cut(0,t).append(n).append(e.cut(t));var l=Su(a.content,t-s-1,n);return l&&e.replaceChild(o,a.copy(l))}H.empty=new H(B.empty,0,0);function ep(e,t,n){if(n.openStart>e.depth)throw new Ue("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new Ue("Inconsistent open depths");return Cu(e,t,n,0)}function Cu(e,t,n,r){var i=e.index(r),o=e.node(r);if(i==t.index(r)&&r<e.depth-n.openStart){var s=Cu(e,t,n,r+1);return o.copy(o.content.replaceChild(i,s))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&e.depth==r&&t.depth==r){var a=e.parent,l=a.content;return Pn(a,l.cut(0,e.parentOffset).append(n.content).append(l.cut(t.parentOffset)))}else{var c=np(n,e),f=c.start,u=c.end;return Pn(o,Mu(e,f,u,t,r))}else return Pn(o,Zi(e,t,r))}function Eu(e,t){if(!t.type.compatibleContent(e.type))throw new Ue("Cannot join "+t.type.name+" onto "+e.type.name)}function js(e,t,n){var r=e.node(n);return Eu(r,t.node(n)),r}function Ln(e,t){var n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function jr(e,t,n,r){var i=(t||e).node(n),o=0,s=t?t.index(n):i.childCount;e&&(o=e.index(n),e.depth>n?o++:e.textOffset&&(Ln(e.nodeAfter,r),o++));for(var a=o;a<s;a++)Ln(i.child(a),r);t&&t.depth==n&&t.textOffset&&Ln(t.nodeBefore,r)}function Pn(e,t){if(!e.type.validContent(t))throw new Ue("Invalid content for node "+e.type.name);return e.copy(t)}function Mu(e,t,n,r,i){var o=e.depth>i&&js(e,t,i+1),s=r.depth>i&&js(n,r,i+1),a=[];return jr(null,e,i,a),o&&s&&t.index(i)==n.index(i)?(Eu(o,s),Ln(Pn(o,Mu(e,t,n,r,i+1)),a)):(o&&Ln(Pn(o,Zi(e,t,i+1)),a),jr(t,n,i,a),s&&Ln(Pn(s,Zi(n,r,i+1)),a)),jr(r,null,i,a),new B(a)}function Zi(e,t,n){var r=[];if(jr(null,e,n,r),e.depth>n){var i=js(e,t,n+1);Ln(Pn(i,Zi(e,t,n+1)),r)}return jr(t,null,n,r),new B(r)}function np(e,t){for(var n=t.depth-e.openStart,r=t.node(n),i=r.copy(e.content),o=n-1;o>=0;o--)i=t.node(o).copy(B.from(i));return{start:i.resolveNoCache(e.openStart+n),end:i.resolveNoCache(i.content.size-e.openEnd-n)}}var mt=function(t,n,r){this.pos=t,this.path=n,this.depth=n.length/3-1,this.parentOffset=r},Er={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};mt.prototype.resolveDepth=function(t){return t==null?this.depth:t<0?this.depth+t:t};Er.parent.get=function(){return this.node(this.depth)};Er.doc.get=function(){return this.node(0)};mt.prototype.node=function(t){return this.path[this.resolveDepth(t)*3]};mt.prototype.index=function(t){return this.path[this.resolveDepth(t)*3+1]};mt.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)};mt.prototype.start=function(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1};mt.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size};mt.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]};mt.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};Er.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};Er.nodeAfter.get=function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r};Er.nodeBefore.get=function(){var e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)};mt.prototype.posAtIndex=function(t,n){n=this.resolveDepth(n);for(var r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1,o=0;o<t;o++)i+=r.child(o).nodeSize;return i};mt.prototype.marks=function(){var t=this.parent,n=this.index();if(t.content.size==0)return at.none;if(this.textOffset)return t.child(n).marks;var r=t.maybeChild(n-1),i=t.maybeChild(n);if(!r){var o=r;r=i,i=o}for(var s=r.marks,a=0;a<s.length;a++)s[a].type.spec.inclusive===!1&&(!i||!s[a].isInSet(i.marks))&&(s=s[a--].removeFromSet(s));return s};mt.prototype.marksAcross=function(t){var n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;for(var r=n.marks,i=t.parent.maybeChild(t.index()),o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r};mt.prototype.sharedDepth=function(t){for(var n=this.depth;n>0;n--)if(this.start(n)<=t&&this.end(n)>=t)return n;return 0};mt.prototype.blockRange=function(t,n){if(t===void 0&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var r=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);r>=0;r--)if(t.pos<=this.end(r)&&(!n||n(this.node(r))))return new Yr(this,t,r)};mt.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};mt.prototype.max=function(t){return t.pos>this.pos?t:this};mt.prototype.min=function(t){return t.pos<this.pos?t:this};mt.prototype.toString=function(){for(var t="",n=1;n<=this.depth;n++)t+=(t?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return t+":"+this.parentOffset};mt.resolve=function(t,n){if(!(n>=0&&n<=t.content.size))throw new RangeError("Position "+n+" out of range");for(var r=[],i=0,o=n,s=t;;){var a=s.content.findIndex(o),l=a.index,c=a.offset,f=o-c;if(r.push(s,l,i+c),!f||(s=s.child(l),s.isText))break;o=f-1,i+=c+1}return new mt(n,r,o)};mt.resolveCached=function(t,n){for(var r=0;r<ns.length;r++){var i=ns[r];if(i.pos==n&&i.doc==t)return i}var o=ns[rs]=mt.resolve(t,n);return rs=(rs+1)%rp,o};Object.defineProperties(mt.prototype,Er);var ns=[],rs=0,rp=12,Yr=function(t,n,r){this.$from=t,this.$to=n,this.depth=r},Mr={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Mr.start.get=function(){return this.$from.before(this.depth+1)};Mr.end.get=function(){return this.$to.after(this.depth+1)};Mr.parent.get=function(){return this.$from.node(this.depth)};Mr.startIndex.get=function(){return this.$from.index(this.depth)};Mr.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(Yr.prototype,Mr);var ip=Object.create(null),lt=function(t,n,r,i){this.type=t,this.attrs=n,this.content=r||B.empty,this.marks=i||at.none},fe={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};fe.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};fe.childCount.get=function(){return this.content.childCount};lt.prototype.child=function(t){return this.content.child(t)};lt.prototype.maybeChild=function(t){return this.content.maybeChild(t)};lt.prototype.forEach=function(t){this.content.forEach(t)};lt.prototype.nodesBetween=function(t,n,r,i){i===void 0&&(i=0),this.content.nodesBetween(t,n,r,i,this)};lt.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)};fe.textContent.get=function(){return this.textBetween(0,this.content.size,"")};lt.prototype.textBetween=function(t,n,r,i){return this.content.textBetween(t,n,r,i)};fe.firstChild.get=function(){return this.content.firstChild};fe.lastChild.get=function(){return this.content.lastChild};lt.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};lt.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)};lt.prototype.hasMarkup=function(t,n,r){return this.type==t&&Xi(this.attrs,n||t.defaultAttrs||ip)&&at.sameSet(this.marks,r||at.none)};lt.prototype.copy=function(t){return t===void 0&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)};lt.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};lt.prototype.cut=function(t,n){return t==0&&n==this.content.size?this:this.copy(this.content.cut(t,n))};lt.prototype.slice=function(t,n,r){if(n===void 0&&(n=this.content.size),r===void 0&&(r=!1),t==n)return H.empty;var i=this.resolve(t),o=this.resolve(n),s=r?0:i.sharedDepth(n),a=i.start(s),l=i.node(s),c=l.content.cut(i.pos-a,o.pos-a);return new H(c,i.depth-s,o.depth-s)};lt.prototype.replace=function(t,n,r){return ep(this.resolve(t),this.resolve(n),r)};lt.prototype.nodeAt=function(t){for(var n=this;;){var r=n.content.findIndex(t),i=r.index,o=r.offset;if(n=n.maybeChild(i),!n)return null;if(o==t||n.isText)return n;t-=o+1}};lt.prototype.childAfter=function(t){var n=this.content.findIndex(t),r=n.index,i=n.offset;return{node:this.content.maybeChild(r),index:r,offset:i}};lt.prototype.childBefore=function(t){if(t==0)return{node:null,index:0,offset:0};var n=this.content.findIndex(t),r=n.index,i=n.offset;if(i<t)return{node:this.content.child(r),index:r,offset:i};var o=this.content.child(r-1);return{node:o,index:r-1,offset:i-o.nodeSize}};lt.prototype.resolve=function(t){return mt.resolveCached(this,t)};lt.prototype.resolveNoCache=function(t){return mt.resolve(this,t)};lt.prototype.rangeHasMark=function(t,n,r){var i=!1;return n>t&&this.nodesBetween(t,n,function(o){return r.isInSet(o.marks)&&(i=!0),!i}),i};fe.isBlock.get=function(){return this.type.isBlock};fe.isTextblock.get=function(){return this.type.isTextblock};fe.inlineContent.get=function(){return this.type.inlineContent};fe.isInline.get=function(){return this.type.isInline};fe.isText.get=function(){return this.type.isText};fe.isLeaf.get=function(){return this.type.isLeaf};fe.isAtom.get=function(){return this.type.isAtom};lt.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Tu(this.marks,t)};lt.prototype.contentMatchAt=function(t){var n=this.type.contentMatch.matchFragment(this.content,0,t);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n};lt.prototype.canReplace=function(t,n,r,i,o){r===void 0&&(r=B.empty),i===void 0&&(i=0),o===void 0&&(o=r.childCount);var s=this.contentMatchAt(t).matchFragment(r,i,o),a=s&&s.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(var l=i;l<o;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0};lt.prototype.canReplaceWith=function(t,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;var o=this.contentMatchAt(t).matchType(r),s=o&&o.matchFragment(this.content,n);return s?s.validEnd:!1};lt.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)};lt.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=at.none,n=0;n<this.marks.length;n++)t=this.marks[n].addToSet(t);if(!at.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(r){return r.type.name}));this.content.forEach(function(r){return r.check()})};lt.prototype.toJSON=function(){var t={type:this.type.name};for(var n in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(r){return r.toJSON()})),t};lt.fromJSON=function(t,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");var r=null;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(t.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(n.text,r)}var i=B.fromJSON(t,n.content);return t.nodeType(n.type).create(n.attrs,i,r)};Object.defineProperties(lt.prototype,fe);var op=function(e){function t(r,i,o,s){if(e.call(this,r,i,null,s),!o)throw new RangeError("Empty text nodes are not allowed");this.text=o}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={textContent:{configurable:!0},nodeSize:{configurable:!0}};return t.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Tu(this.marks,JSON.stringify(this.text))},n.textContent.get=function(){return this.text},t.prototype.textBetween=function(i,o){return this.text.slice(i,o)},n.nodeSize.get=function(){return this.text.length},t.prototype.mark=function(i){return i==this.marks?this:new t(this.type,this.attrs,this.text,i)},t.prototype.withText=function(i){return i==this.text?this:new t(this.type,this.attrs,i,this.marks)},t.prototype.cut=function(i,o){return i===void 0&&(i=0),o===void 0&&(o=this.text.length),i==0&&o==this.text.length?this:this.withText(this.text.slice(i,o))},t.prototype.eq=function(i){return this.sameMarkup(i)&&this.text==i.text},t.prototype.toJSON=function(){var i=e.prototype.toJSON.call(this);return i.text=this.text,i},Object.defineProperties(t.prototype,n),t}(lt);function Tu(e,t){for(var n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}var qt=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},To={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};qt.parse=function(t,n){var r=new Oo(t,n);if(r.next==null)return qt.empty;var i=xu(r);r.next&&r.err("Unexpected trailing text");var o=hp(fp(i));return dp(o,r),o};qt.prototype.matchType=function(t){for(var n=0;n<this.next.length;n+=2)if(this.next[n]==t)return this.next[n+1];return null};qt.prototype.matchFragment=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=t.childCount);for(var i=this,o=n;i&&o<r;o++)i=i.matchType(t.child(o).type);return i};To.inlineContent.get=function(){var e=this.next[0];return e?e.isInline:!1};To.defaultType.get=function(){for(var e=0;e<this.next.length;e+=2){var t=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}};qt.prototype.compatible=function(t){for(var n=0;n<this.next.length;n+=2)for(var r=0;r<t.next.length;r+=2)if(this.next[n]==t.next[r])return!0;return!1};qt.prototype.fillBefore=function(t,n,r){n===void 0&&(n=!1),r===void 0&&(r=0);var i=[this];function o(s,a){var l=s.matchFragment(t,r);if(l&&(!n||l.validEnd))return B.from(a.map(function(p){return p.createAndFill()}));for(var c=0;c<s.next.length;c+=2){var f=s.next[c],u=s.next[c+1];if(!(f.isText||f.hasRequiredAttrs())&&i.indexOf(u)==-1){i.push(u);var d=o(u,a.concat(f));if(d)return d}}}return o(this,[])};qt.prototype.findWrapping=function(t){for(var n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];var r=this.computeWrapping(t);return this.wrapCache.push(t,r),r};qt.prototype.computeWrapping=function(t){for(var n=Object.create(null),r=[{match:this,type:null,via:null}];r.length;){var i=r.shift(),o=i.match;if(o.matchType(t)){for(var s=[],a=i;a.type;a=a.via)s.push(a.type);return s.reverse()}for(var l=0;l<o.next.length;l+=2){var c=o.next[l];!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in n)&&(!i.type||o.next[l+1].validEnd)&&(r.push({match:c.contentMatch,type:c,via:i}),n[c.name]=!0)}}};To.edgeCount.get=function(){return this.next.length>>1};qt.prototype.edge=function(t){var n=t<<1;if(n>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[n],next:this.next[n+1]}};qt.prototype.toString=function(){var t=[];function n(r){t.push(r);for(var i=1;i<r.next.length;i+=2)t.indexOf(r.next[i])==-1&&n(r.next[i])}return n(this),t.map(function(r,i){for(var o=i+(r.validEnd?"*":" ")+" ",s=0;s<r.next.length;s+=2)o+=(s?", ":"")+r.next[s].name+"->"+t.indexOf(r.next[s+1]);return o}).join(`
`)};Object.defineProperties(qt.prototype,To);qt.empty=new qt(!0);var Oo=function(t,n){this.string=t,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},Ou={next:{configurable:!0}};Ou.next.get=function(){return this.tokens[this.pos]};Oo.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)};Oo.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(Oo.prototype,Ou);function xu(e){var t=[];do t.push(sp(e));while(e.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function sp(e){var t=[];do t.push(ap(e));while(e.next&&e.next!=")"&&e.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function ap(e){for(var t=up(e);;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else if(e.eat("{"))t=lp(e,t);else break;return t}function Bl(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");var t=Number(e.next);return e.pos++,t}function lp(e,t){var n=Bl(e),r=n;return e.eat(",")&&(e.next!="}"?r=Bl(e):r=-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:t}}function cp(e,t){var n=e.nodeTypes,r=n[t];if(r)return[r];var i=[];for(var o in n){var s=n[o];s.groups.indexOf(t)>-1&&i.push(s)}return i.length==0&&e.err("No node type or group '"+t+"' found"),i}function up(e){if(e.eat("(")){var t=xu(e);return e.eat(")")||e.err("Missing closing paren"),t}else if(/\W/.test(e.next))e.err("Unexpected token '"+e.next+"'");else{var n=cp(e,e.next).map(function(r){return e.inline==null?e.inline=r.isInline:e.inline!=r.isInline&&e.err("Mixing inline and block content"),{type:"name",value:r}});return e.pos++,n.length==1?n[0]:{type:"choice",exprs:n}}}function fp(e){var t=[[]];return i(o(e,0),n()),t;function n(){return t.push([])-1}function r(s,a,l){var c={term:l,to:a};return t[s].push(c),c}function i(s,a){s.forEach(function(l){return l.to=a})}function o(s,a){if(s.type=="choice")return s.exprs.reduce(function(E,_){return E.concat(o(_,a))},[]);if(s.type=="seq")for(var l=0;;l++){var c=o(s.exprs[l],a);if(l==s.exprs.length-1)return c;i(c,a=n())}else if(s.type=="star"){var f=n();return r(a,f),i(o(s.expr,f),f),[r(f)]}else if(s.type=="plus"){var u=n();return i(o(s.expr,a),u),i(o(s.expr,u),u),[r(u)]}else{if(s.type=="opt")return[r(a)].concat(o(s.expr,a));if(s.type=="range"){for(var d=a,p=0;p<s.min;p++){var g=n();i(o(s.expr,d),g),d=g}if(s.max==-1)i(o(s.expr,d),d);else for(var y=s.min;y<s.max;y++){var w=n();r(d,w),i(o(s.expr,d),w),d=w}return[r(d)]}else if(s.type=="name")return[r(a,null,s.value)]}}}function Au(e,t){return t-e}function Fl(e,t){var n=[];return r(t),n.sort(Au);function r(i){var o=e[i];if(o.length==1&&!o[0].term)return r(o[0].to);n.push(i);for(var s=0;s<o.length;s++){var a=o[s],l=a.term,c=a.to;!l&&n.indexOf(c)==-1&&r(c)}}}function hp(e){var t=Object.create(null);return n(Fl(e,0));function n(r){var i=[];r.forEach(function(l){e[l].forEach(function(c){var f=c.term,u=c.to;if(!!f){var d=i.indexOf(f),p=d>-1&&i[d+1];Fl(e,u).forEach(function(g){p||i.push(f,p=[]),p.indexOf(g)==-1&&p.push(g)})}})});for(var o=t[r.join(",")]=new qt(r.indexOf(e.length-1)>-1),s=0;s<i.length;s+=2){var a=i[s+1].sort(Au);o.next.push(i[s],t[a.join(",")]||n(a))}return o}}function dp(e,t){for(var n=0,r=[e];n<r.length;n++){for(var i=r[n],o=!i.validEnd,s=[],a=0;a<i.next.length;a+=2){var l=i.next[a],c=i.next[a+1];s.push(l.name),o&&!(l.isText||l.hasRequiredAttrs())&&(o=!1),r.indexOf(c)==-1&&r.push(c)}o&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Du(e){var t=Object.create(null);for(var n in e){var r=e[n];if(!r.hasDefault)return null;t[n]=r.default}return t}function Nu(e,t){var n=Object.create(null);for(var r in e){var i=t&&t[r];if(i===void 0){var o=e[r];if(o.hasDefault)i=o.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function Ru(e){var t=Object.create(null);if(e)for(var n in e)t[n]=new Iu(e[n]);return t}var Xt=function(t,n,r){this.name=t,this.schema=n,this.spec=r,this.groups=r.group?r.group.split(" "):[],this.attrs=Ru(r.attrs),this.defaultAttrs=Du(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(r.inline||t=="text"),this.isText=t=="text"},Tr={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};Tr.isInline.get=function(){return!this.isBlock};Tr.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Tr.isLeaf.get=function(){return this.contentMatch==qt.empty};Tr.isAtom.get=function(){return this.isLeaf||this.spec.atom};Tr.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};Xt.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1};Xt.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)};Xt.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:Nu(this.attrs,t)};Xt.prototype.create=function(t,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new lt(this,this.computeAttrs(t),B.from(n),at.setFrom(r))};Xt.prototype.createChecked=function(t,n,r){if(n=B.from(n),!this.validContent(n))throw new RangeError("Invalid content for node "+this.name);return new lt(this,this.computeAttrs(t),n,at.setFrom(r))};Xt.prototype.createAndFill=function(t,n,r){if(t=this.computeAttrs(t),n=B.from(n),n.size){var i=this.contentMatch.fillBefore(n);if(!i)return null;n=i.append(n)}var o=this.contentMatch.matchFragment(n).fillBefore(B.empty,!0);return o?new lt(this,t,n.append(o),at.setFrom(r)):null};Xt.prototype.validContent=function(t){var n=this.contentMatch.matchFragment(t);if(!n||!n.validEnd)return!1;for(var r=0;r<t.childCount;r++)if(!this.allowsMarks(t.child(r).marks))return!1;return!0};Xt.prototype.allowsMarkType=function(t){return this.markSet==null||this.markSet.indexOf(t)>-1};Xt.prototype.allowsMarks=function(t){if(this.markSet==null)return!0;for(var n=0;n<t.length;n++)if(!this.allowsMarkType(t[n].type))return!1;return!0};Xt.prototype.allowedMarks=function(t){if(this.markSet==null)return t;for(var n,r=0;r<t.length;r++)this.allowsMarkType(t[r].type)?n&&n.push(t[r]):n||(n=t.slice(0,r));return n?n.length?n:at.empty:t};Xt.compile=function(t,n){var r=Object.create(null);t.forEach(function(s,a){return r[s]=new Xt(s,n,a)});var i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r};Object.defineProperties(Xt.prototype,Tr);var Iu=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},Lu={isRequired:{configurable:!0}};Lu.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(Iu.prototype,Lu);var wn=function(t,n,r,i){this.name=t,this.schema=r,this.spec=i,this.attrs=Ru(i.attrs),this.rank=n,this.excluded=null;var o=Du(this.attrs);this.instance=o&&new at(this,o)};wn.prototype.create=function(t){return!t&&this.instance?this.instance:new at(this,Nu(this.attrs,t))};wn.compile=function(t,n){var r=Object.create(null),i=0;return t.forEach(function(o,s){return r[o]=new wn(o,i++,n,s)}),r};wn.prototype.removeFromSet=function(t){for(var n=0;n<t.length;n++)t[n].type==this&&(t=t.slice(0,n).concat(t.slice(n+1)),n--);return t};wn.prototype.isInSet=function(t){for(var n=0;n<t.length;n++)if(t[n].type==this)return t[n]};wn.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var Kn=function(t){this.spec={};for(var n in t)this.spec[n]=t[n];this.spec.nodes=Pl.from(t.nodes),this.spec.marks=Pl.from(t.marks),this.nodes=Xt.compile(this.spec.nodes,this),this.marks=wn.compile(this.spec.marks,this);var r=Object.create(null);for(var i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");var o=this.nodes[i],s=o.spec.content||"",a=o.spec.marks;o.contentMatch=r[s]||(r[s]=qt.parse(s,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet=a=="_"?null:a?zl(this,a.split(" ")):a==""||!o.inlineContent?[]:null}for(var l in this.marks){var c=this.marks[l],f=c.spec.excludes;c.excluded=f==null?[c]:f==""?[]:zl(this,f.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};Kn.prototype.node=function(t,n,r,i){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof Xt){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(n,r,i)};Kn.prototype.text=function(t,n){var r=this.nodes.text;return new op(r,r.defaultAttrs,t,at.setFrom(n))};Kn.prototype.mark=function(t,n){return typeof t=="string"&&(t=this.marks[t]),t.create(n)};Kn.prototype.nodeFromJSON=function(t){return lt.fromJSON(this,t)};Kn.prototype.markFromJSON=function(t){return at.fromJSON(this,t)};Kn.prototype.nodeType=function(t){var n=this.nodes[t];if(!n)throw new RangeError("Unknown node type: "+t);return n};function zl(e,t){for(var n=[],r=0;r<t.length;r++){var i=t[r],o=e.marks[i],s=o;if(o)n.push(o);else for(var a in e.marks){var l=e.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[r]+"'")}return n}var Oe=function(t,n){var r=this;this.schema=t,this.rules=n,this.tags=[],this.styles=[],n.forEach(function(i){i.tag?r.tags.push(i):i.style&&r.styles.push(i)}),this.normalizeLists=!this.tags.some(function(i){if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;var o=t.nodes[i.node];return o.contentMatch.matchType(o)})};Oe.prototype.parse=function(t,n){n===void 0&&(n={});var r=new pt(this,n,!1);return r.addAll(t,null,n.from,n.to),r.finish()};Oe.prototype.parseSlice=function(t,n){n===void 0&&(n={});var r=new pt(this,n,!0);return r.addAll(t,null,n.from,n.to),H.maxOpen(r.finish())};Oe.prototype.matchTag=function(t,n,r){for(var i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){var o=this.tags[i];if(mp(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||n.matchesContext(o.context))){if(o.getAttrs){var s=o.getAttrs(t);if(s===!1)continue;o.attrs=s}return o}}};Oe.prototype.matchStyle=function(t,n,r,i){for(var o=i?this.styles.indexOf(i)+1:0;o<this.styles.length;o++){var s=this.styles[o];if(!(s.style.indexOf(t)!=0||s.context&&!r.matchesContext(s.context)||s.style.length>t.length&&(s.style.charCodeAt(t.length)!=61||s.style.slice(t.length+1)!=n))){if(s.getAttrs){var a=s.getAttrs(n);if(a===!1)continue;s.attrs=a}return s}}};Oe.schemaRules=function(t){var n=[];function r(l){for(var c=l.priority==null?50:l.priority,f=0;f<n.length;f++){var u=n[f],d=u.priority==null?50:u.priority;if(d<c)break}n.splice(f,0,l)}var i=function(l){var c=t.marks[l].spec.parseDOM;c&&c.forEach(function(f){r(f=Vl(f)),f.mark=l})};for(var o in t.marks)i(o);var s=function(l){var c=t.nodes[a].spec.parseDOM;c&&c.forEach(function(f){r(f=Vl(f)),f.node=a})};for(var a in t.nodes)s();return n};Oe.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new Oe(t,Oe.schemaRules(t)))};var va={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},pp={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Pu={ol:!0,ul:!0},Qi=1,to=2,Xr=4;function Bu(e,t,n){return t!=null?(t?Qi:0)|(t==="full"?to:0):e&&e.whitespace=="pre"?Qi|to:n&~Xr}var Ge=function(t,n,r,i,o,s,a){this.type=t,this.attrs=n,this.solid=o,this.match=s||(a&Xr?null:t.contentMatch),this.options=a,this.content=[],this.marks=r,this.activeMarks=at.none,this.pendingMarks=i,this.stashMarks=[]};Ge.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var n=this.type.contentMatch.fillBefore(B.from(t));if(n)this.match=this.type.contentMatch.matchFragment(n);else{var r=this.type.contentMatch,i;return(i=r.findWrapping(t.type))?(this.match=r,i):null}}return this.match.findWrapping(t.type)};Ge.prototype.finish=function(t){if(!(this.options&Qi)){var n=this.content[this.content.length-1],r;n&&n.isText&&(r=/[ \t\r\n\u000c]+$/.exec(n.text))&&(n.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-r[0].length)))}var i=B.from(this.content);return!t&&this.match&&(i=i.append(this.match.fillBefore(B.empty,!0))),this.type?this.type.create(this.attrs,i,this.marks):i};Ge.prototype.popFromStashMark=function(t){for(var n=this.stashMarks.length-1;n>=0;n--)if(t.eq(this.stashMarks[n]))return this.stashMarks.splice(n,1)[0]};Ge.prototype.applyPending=function(t){for(var n=0,r=this.pendingMarks;n<r.length;n++){var i=r[n];(this.type?this.type.allowsMarkType(i.type):vp(i.type,t))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}};Ge.prototype.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!va.hasOwnProperty(t.parentNode.nodeName.toLowerCase())};var pt=function(t,n,r){this.parser=t,this.options=n,this.isOpen=r;var i=n.topNode,o,s=Bu(null,n.preserveWhitespace,0)|(r?Xr:0);i?o=new Ge(i.type,i.attrs,at.none,at.none,!0,n.topMatch||i.type.contentMatch,s):r?o=new Ge(null,null,at.none,at.none,!0,null,s):o=new Ge(t.schema.topNodeType,null,at.none,at.none,!0,null,s),this.nodes=[o],this.open=0,this.find=n.findPositions,this.needsBlock=!1},ba={top:{configurable:!0},currentPos:{configurable:!0}};ba.top.get=function(){return this.nodes[this.open]};pt.prototype.addDOM=function(t){if(t.nodeType==3)this.addTextNode(t);else if(t.nodeType==1){var n=t.getAttribute("style"),r=n?this.readStyles(yp(n)):null,i=this.top;if(r!=null)for(var o=0;o<r.length;o++)this.addPendingMark(r[o]);if(this.addElement(t),r!=null)for(var s=0;s<r.length;s++)this.removePendingMark(r[s],i)}};pt.prototype.addTextNode=function(t){var n=t.nodeValue,r=this.top;if(r.options&to||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(r.options&Qi)r.options&to?n=n.replace(/\r\n?/g,`
`):n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){var i=r.content[r.content.length-1],o=t.previousSibling;(!i||o&&o.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n)),this.findInText(t)}else this.findInside(t)};pt.prototype.addElement=function(t,n){var r=t.nodeName.toLowerCase(),i;Pu.hasOwnProperty(r)&&this.parser.normalizeLists&&gp(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,n));if(o?o.ignore:pp.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var s,a=this.top,l=this.needsBlock;if(va.hasOwnProperty(r))s=!0,a.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t),s&&this.sync(a),this.needsBlock=l}else this.addElementByRule(t,o,o.consuming===!1?i:null)};pt.prototype.leafFallback=function(t){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`))};pt.prototype.ignoreFallback=function(t){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};pt.prototype.readStyles=function(t){var n=at.none;t:for(var r=0;r<t.length;r+=2)for(var i=null;;){var o=this.parser.matchStyle(t[r],t[r+1],this,i);if(!o)continue t;if(o.ignore)return null;if(n=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(n),o.consuming===!1)i=o;else break}return n};pt.prototype.addElementByRule=function(t,n,r){var i=this,o,s,a,l;n.node?(s=this.parser.schema.nodes[n.node],s.isLeaf?this.insertNode(s.create(n.attrs))||this.leafFallback(t):o=this.enter(s,n.attrs,n.preserveWhitespace)):(a=this.parser.schema.marks[n.mark],l=a.create(n.attrs),this.addPendingMark(l));var c=this.top;if(s&&s.isLeaf)this.findInside(t);else if(r)this.addElement(t,r);else if(n.getContent)this.findInside(t),n.getContent(t,this.parser.schema).forEach(function(u){return i.insertNode(u)});else{var f=n.contentElement;typeof f=="string"?f=t.querySelector(f):typeof f=="function"&&(f=f(t)),f||(f=t),this.findAround(t,f,!0),this.addAll(f,o)}o&&(this.sync(c),this.open--),l&&this.removePendingMark(l,c)};pt.prototype.addAll=function(t,n,r,i){for(var o=r||0,s=r?t.childNodes[r]:t.firstChild,a=i==null?null:t.childNodes[i];s!=a;s=s.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(s),n&&va.hasOwnProperty(s.nodeName.toLowerCase())&&this.sync(n);this.findAtPoint(t,o)};pt.prototype.findPlace=function(t){for(var n,r,i=this.open;i>=0;i--){var o=this.nodes[i],s=o.findWrapping(t);if(s&&(!n||n.length>s.length)&&(n=s,r=o,!s.length)||o.solid)break}if(!n)return!1;this.sync(r);for(var a=0;a<n.length;a++)this.enterInner(n[a],null,!1);return!0};pt.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var n=this.textblockFromContext();n&&this.enterInner(n)}if(this.findPlace(t)){this.closeExtra();var r=this.top;r.applyPending(t.type),r.match&&(r.match=r.match.matchType(t.type));for(var i=r.activeMarks,o=0;o<t.marks.length;o++)(!r.type||r.type.allowsMarkType(t.marks[o].type))&&(i=t.marks[o].addToSet(i));return r.content.push(t.mark(i)),!0}return!1};pt.prototype.enter=function(t,n,r){var i=this.findPlace(t.create(n));return i&&this.enterInner(t,n,!0,r),i};pt.prototype.enterInner=function(t,n,r,i){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,n);var s=Bu(t,i,o.options);o.options&Xr&&o.content.length==0&&(s|=Xr),this.nodes.push(new Ge(t,n,o.activeMarks,o.pendingMarks,r,null,s)),this.open++};pt.prototype.closeExtra=function(t){var n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(t));this.nodes.length=this.open+1}};pt.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};pt.prototype.sync=function(t){for(var n=this.open;n>=0;n--)if(this.nodes[n]==t){this.open=n;return}};ba.currentPos.get=function(){this.closeExtra();for(var e=0,t=this.open;t>=0;t--){for(var n=this.nodes[t].content,r=n.length-1;r>=0;r--)e+=n[r].nodeSize;t&&e++}return e};pt.prototype.findAtPoint=function(t,n){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==t&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)};pt.prototype.findInside=function(t){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].pos==null&&t.nodeType==1&&t.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)};pt.prototype.findAround=function(t,n,r){if(t!=n&&this.find){for(var i=0;i<this.find.length;i++)if(this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)){var o=n.compareDocumentPosition(this.find[i].node);o&(r?2:4)&&(this.find[i].pos=this.currentPos)}}};pt.prototype.findInText=function(t){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&(this.find[n].pos=this.currentPos-(t.nodeValue.length-this.find[n].offset))};pt.prototype.matchesContext=function(t){var n=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var r=t.split("/"),i=this.options.context,o=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),s=-(i?i.depth+1:0)+(o?0:1),a=function(l,c){for(;l>=0;l--){var f=r[l];if(f==""){if(l==r.length-1||l==0)continue;for(;c>=s;c--)if(a(l-1,c))return!0;return!1}else{var u=c>0||c==0&&o?n.nodes[c].type:i&&c>=s?i.node(c-s).type:null;if(!u||u.name!=f&&u.groups.indexOf(f)==-1)return!1;c--}}return!0};return a(r.length-1,this.open)};pt.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var n=t.depth;n>=0;n--){var r=t.node(n).contentMatchAt(t.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(var i in this.parser.schema.nodes){var o=this.parser.schema.nodes[i];if(o.isTextblock&&o.defaultAttrs)return o}};pt.prototype.addPendingMark=function(t){var n=bp(t,this.top.pendingMarks);n&&this.top.stashMarks.push(n),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};pt.prototype.removePendingMark=function(t,n){for(var r=this.open;r>=0;r--){var i=this.nodes[r],o=i.pendingMarks.lastIndexOf(t);if(o>-1)i.pendingMarks=t.removeFromSet(i.pendingMarks);else{i.activeMarks=t.removeFromSet(i.activeMarks);var s=i.popFromStashMark(t);s&&i.type&&i.type.allowsMarkType(s.type)&&(i.activeMarks=s.addToSet(i.activeMarks))}if(i==n)break}};Object.defineProperties(pt.prototype,ba);function gp(e){for(var t=e.firstChild,n=null;t;t=t.nextSibling){var r=t.nodeType==1?t.nodeName.toLowerCase():null;r&&Pu.hasOwnProperty(r)&&n?(n.appendChild(t),t=n):r=="li"?n=t:r&&(n=null)}}function mp(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function yp(e){for(var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,n,r=[];n=t.exec(e);)r.push(n[1],n[2].trim());return r}function Vl(e){var t={};for(var n in e)t[n]=e[n];return t}function vp(e,t){var n=t.schema.nodes,r=function(s){var a=n[s];if(!!a.allowsMarkType(e)){var l=[],c=function(f){l.push(f);for(var u=0;u<f.edgeCount;u++){var d=f.edge(u),p=d.type,g=d.next;if(p==t||l.indexOf(g)<0&&c(g))return!0}};if(c(a.contentMatch))return{v:!0}}};for(var i in n){var o=r(i);if(o)return o.v}}function bp(e,t){for(var n=0;n<t.length;n++)if(e.eq(t[n]))return t[n]}var zt=function(t,n){this.nodes=t||{},this.marks=n||{}};zt.prototype.serializeFragment=function(t,n,r){var i=this;n===void 0&&(n={}),r||(r=wa(n).createDocumentFragment());var o=r,s=null;return t.forEach(function(a){if(s||a.marks.length){s||(s=[]);for(var l=0,c=0;l<s.length&&c<a.marks.length;){var f=a.marks[c];if(!i.marks[f.type.name]){c++;continue}if(!f.eq(s[l])||f.type.spec.spanning===!1)break;l+=2,c++}for(;l<s.length;)o=s.pop(),s.pop();for(;c<a.marks.length;){var u=a.marks[c++],d=i.serializeMark(u,a.isInline,n);d&&(s.push(u,o),o.appendChild(d.dom),o=d.contentDOM||d.dom)}}o.appendChild(i.serializeNodeInner(a,n))}),r};zt.prototype.serializeNodeInner=function(t,n){n===void 0&&(n={});var r=zt.renderSpec(wa(n),this.nodes[t.type.name](t)),i=r.dom,o=r.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");n.onContent?n.onContent(t,o,n):this.serializeFragment(t.content,n,o)}return i};zt.prototype.serializeNode=function(t,n){n===void 0&&(n={});for(var r=this.serializeNodeInner(t,n),i=t.marks.length-1;i>=0;i--){var o=this.serializeMark(t.marks[i],t.isInline,n);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r};zt.prototype.serializeMark=function(t,n,r){r===void 0&&(r={});var i=this.marks[t.type.name];return i&&zt.renderSpec(wa(r),i(t,n))};zt.renderSpec=function(t,n,r){if(r===void 0&&(r=null),typeof n=="string")return{dom:t.createTextNode(n)};if(n.nodeType!=null)return{dom:n};if(n.dom&&n.dom.nodeType!=null)return n;var i=n[0],o=i.indexOf(" ");o>0&&(r=i.slice(0,o),i=i.slice(o+1));var s=null,a=r?t.createElementNS(r,i):t.createElement(i),l=n[1],c=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){c=2;for(var f in l)if(l[f]!=null){var u=f.indexOf(" ");u>0?a.setAttributeNS(f.slice(0,u),f.slice(u+1),l[f]):a.setAttribute(f,l[f])}}for(var d=c;d<n.length;d++){var p=n[d];if(p===0){if(d<n.length-1||d>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{var g=zt.renderSpec(t,p,r),y=g.dom,w=g.contentDOM;if(a.appendChild(y),w){if(s)throw new RangeError("Multiple content holes");s=w}}}return{dom:a,contentDOM:s}};zt.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new zt(this.nodesFromSchema(t),this.marksFromSchema(t)))};zt.nodesFromSchema=function(t){var n=Fu(t.nodes);return n.text||(n.text=function(r){return r.text}),n};zt.marksFromSchema=function(t){return Fu(t.marks)};function Fu(e){var t={};for(var n in e){var r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function wa(e){return e.document||window.document}var zu=65535,Vu=Math.pow(2,16);function wp(e,t){return e+t*Vu}function Uu(e){return e&zu}function kp(e){return(e-(e&zu))/Vu}var Hs=function(t,n,r){n===void 0&&(n=!1),r===void 0&&(r=null),this.pos=t,this.deleted=n,this.recover=r},Pt=function e(t,n){if(n===void 0&&(n=!1),!t.length&&e.empty)return e.empty;this.ranges=t,this.inverted=n};Pt.prototype.recover=function(t){var n=0,r=Uu(t);if(!this.inverted)for(var i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+kp(t)};Pt.prototype.mapResult=function(t,n){return n===void 0&&(n=1),this._map(t,n,!1)};Pt.prototype.map=function(t,n){return n===void 0&&(n=1),this._map(t,n,!0)};Pt.prototype._map=function(t,n,r){for(var i=0,o=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var l=this.ranges[a]-(this.inverted?i:0);if(l>t)break;var c=this.ranges[a+o],f=this.ranges[a+s],u=l+c;if(t<=u){var d=c?t==l?-1:t==u?1:n:n,p=l+i+(d<0?0:f);if(r)return p;var g=t==(n<0?l:u)?null:wp(a/3,t-l);return new Hs(p,n<0?t!=l:t!=u,g)}i+=f-c}return r?t+i:new Hs(t+i)};Pt.prototype.touches=function(t,n){for(var r=0,i=Uu(n),o=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var l=this.ranges[a]-(this.inverted?r:0);if(l>t)break;var c=this.ranges[a+o],f=l+c;if(t<=f&&a==i*3)return!0;r+=this.ranges[a+s]-c}return!1};Pt.prototype.forEach=function(t){for(var n=this.inverted?2:1,r=this.inverted?1:2,i=0,o=0;i<this.ranges.length;i+=3){var s=this.ranges[i],a=s-(this.inverted?o:0),l=s+(this.inverted?0:o),c=this.ranges[i+n],f=this.ranges[i+r];t(a,a+c,l,l+f),o+=f-c}};Pt.prototype.invert=function(){return new Pt(this.ranges,!this.inverted)};Pt.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};Pt.offset=function(t){return t==0?Pt.empty:new Pt(t<0?[0,-t,0]:[0,0,t])};Pt.empty=new Pt([]);var Wt=function(t,n,r,i){this.maps=t||[],this.from=r||0,this.to=i==null?this.maps.length:i,this.mirror=n};Wt.prototype.slice=function(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.maps.length),new Wt(this.maps,this.mirror,t,n)};Wt.prototype.copy=function(){return new Wt(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Wt.prototype.appendMap=function(t,n){this.to=this.maps.push(t),n!=null&&this.setMirror(this.maps.length-1,n)};Wt.prototype.appendMapping=function(t){for(var n=0,r=this.maps.length;n<t.maps.length;n++){var i=t.getMirror(n);this.appendMap(t.maps[n],i!=null&&i<n?r+i:null)}};Wt.prototype.getMirror=function(t){if(this.mirror){for(var n=0;n<this.mirror.length;n++)if(this.mirror[n]==t)return this.mirror[n+(n%2?-1:1)]}};Wt.prototype.setMirror=function(t,n){this.mirror||(this.mirror=[]),this.mirror.push(t,n)};Wt.prototype.appendMappingInverted=function(t){for(var n=t.maps.length-1,r=this.maps.length+t.maps.length;n>=0;n--){var i=t.getMirror(n);this.appendMap(t.maps[n].invert(),i!=null&&i>n?r-i-1:null)}};Wt.prototype.invert=function(){var t=new Wt;return t.appendMappingInverted(this),t};Wt.prototype.map=function(t,n){if(n===void 0&&(n=1),this.mirror)return this._map(t,n,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,n);return t};Wt.prototype.mapResult=function(t,n){return n===void 0&&(n=1),this._map(t,n,!1)};Wt.prototype._map=function(t,n,r){for(var i=!1,o=this.from;o<this.to;o++){var s=this.maps[o],a=s.mapResult(t,n);if(a.recover!=null){var l=this.getMirror(o);if(l!=null&&l>o&&l<this.to){o=l,t=this.maps[l].recover(a.recover);continue}}a.deleted&&(i=!0),t=a.pos}return r?t:new Hs(t,i)};function pr(e){var t=Error.call(this,e);return t.__proto__=pr.prototype,t}pr.prototype=Object.create(Error.prototype);pr.prototype.constructor=pr;pr.prototype.name="TransformError";var St=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Wt},ka={before:{configurable:!0},docChanged:{configurable:!0}};ka.before.get=function(){return this.docs.length?this.docs[0]:this.doc};St.prototype.step=function(t){var n=this.maybeStep(t);if(n.failed)throw new pr(n.failed);return this};St.prototype.maybeStep=function(t){var n=t.apply(this.doc);return n.failed||this.addStep(t,n.doc),n};ka.docChanged.get=function(){return this.steps.length>0};St.prototype.addStep=function(t,n){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=n};Object.defineProperties(St.prototype,ka);function xo(){throw new Error("Override me")}var qs=Object.create(null),$t=function(){};$t.prototype.apply=function(t){return xo()};$t.prototype.getMap=function(){return Pt.empty};$t.prototype.invert=function(t){return xo()};$t.prototype.map=function(t){return xo()};$t.prototype.merge=function(t){return null};$t.prototype.toJSON=function(){return xo()};$t.fromJSON=function(t,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=qs[n.stepType];if(!r)throw new RangeError("No step type "+n.stepType+" defined");return r.fromJSON(t,n)};$t.jsonID=function(t,n){if(t in qs)throw new RangeError("Duplicate use of step JSON ID "+t);return qs[t]=n,n.prototype.jsonID=t,n};var Yt=function(t,n){this.doc=t,this.failed=n};Yt.ok=function(t){return new Yt(t,null)};Yt.fail=function(t){return new Yt(null,t)};Yt.fromReplace=function(t,n,r,i){try{return Yt.ok(t.replace(n,r,i))}catch(o){if(o instanceof Ue)return Yt.fail(o.message);throw o}};var nn=function(e){function t(n,r,i,o){e.call(this),this.from=n,this.to=r,this.slice=i,this.structure=!!o}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){return this.structure&&Ws(r,this.from,this.to)?Yt.fail("Structure replace would overwrite content"):Yt.fromReplace(r,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new Pt([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted?null:new t(i.pos,Math.max(i.pos,o.pos),this.slice)},t.prototype.merge=function(r){if(!(r instanceof t)||r.structure||this.structure)return null;if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var i=this.slice.size+r.slice.size==0?H.empty:new H(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),i,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var o=this.slice.size+r.slice.size==0?H.empty:new H(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}else return null},t.prototype.toJSON=function(){var r={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(i.from,i.to,H.fromJSON(r,i.slice),!!i.structure)},t}($t);$t.jsonID("replace",nn);var ie=function(e){function t(n,r,i,o,s,a,l){e.call(this),this.from=n,this.to=r,this.gapFrom=i,this.gapTo=o,this.slice=s,this.insert=a,this.structure=!!l}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){if(this.structure&&(Ws(r,this.from,this.gapFrom)||Ws(r,this.gapTo,this.to)))return Yt.fail("Structure gap-replace would overwrite content");var i=r.slice(this.gapFrom,this.gapTo);if(i.openStart||i.openEnd)return Yt.fail("Gap is not a flat range");var o=this.slice.insertAt(this.insert,i.content);return o?Yt.fromReplace(r,this.from,this.to,o):Yt.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new Pt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(r){var i=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+i,this.from+this.insert,this.from+this.insert+i,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1),s=r.map(this.gapFrom,-1),a=r.map(this.gapTo,1);return i.deleted&&o.deleted||s<i.pos||a>o.pos?null:new t(i.pos,o.pos,s,a,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number"||typeof i.gapFrom!="number"||typeof i.gapTo!="number"||typeof i.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(i.from,i.to,i.gapFrom,i.gapTo,H.fromJSON(r,i.slice),i.insert,!!i.structure)},t}($t);$t.jsonID("replaceAround",ie);function Ws(e,t,n){for(var r=e.resolve(t),i=n-t,o=r.depth;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0)for(var s=r.node(o).maybeChild(r.indexAfter(o));i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}return!1}function _p(e,t,n){return(t==0||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function Or(e){for(var t=e.parent,n=t.content.cutByIndex(e.startIndex,e.endIndex),r=e.depth;;--r){var i=e.$from.node(r),o=e.$from.index(r),s=e.$to.indexAfter(r);if(r<e.depth&&i.canReplace(o,s,n))return r;if(r==0||i.type.spec.isolating||!_p(i,o,s))break}}St.prototype.lift=function(e,t){for(var n=e.$from,r=e.$to,i=e.depth,o=n.before(i+1),s=r.after(i+1),a=o,l=s,c=B.empty,f=0,u=i,d=!1;u>t;u--)d||n.index(u)>0?(d=!0,c=B.from(n.node(u).copy(c)),f++):a--;for(var p=B.empty,g=0,y=i,w=!1;y>t;y--)w||r.after(y+1)<r.end(y)?(w=!0,p=B.from(r.node(y).copy(p)),g++):l++;return this.step(new ie(a,l,o,s,new H(c.append(p),f,g),c.size-f,!0))};function _a(e,t,n,r){r===void 0&&(r=e);var i=Sp(e,t),o=i&&Cp(r,t);return o?i.map(Ul).concat({type:t,attrs:n}).concat(o.map(Ul)):null}function Ul(e){return{type:e,attrs:null}}function Sp(e,t){var n=e.parent,r=e.startIndex,i=e.endIndex,o=n.contentMatchAt(r).findWrapping(t);if(!o)return null;var s=o.length?o[0]:t;return n.canReplaceWith(r,i,s)?o:null}function Cp(e,t){var n=e.parent,r=e.startIndex,i=e.endIndex,o=n.child(r),s=t.contentMatch.findWrapping(o.type);if(!s)return null;for(var a=s.length?s[s.length-1]:t,l=a.contentMatch,c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:s}St.prototype.wrap=function(e,t){for(var n=B.empty,r=t.length-1;r>=0;r--){if(n.size){var i=t[r].type.contentMatch.matchFragment(n);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=B.from(t[r].type.create(t[r].attrs,n))}var o=e.start,s=e.end;return this.step(new ie(o,s,o,s,new H(n,0,0),t.length,!0))};St.prototype.setBlockType=function(e,t,n,r){var i=this;if(t===void 0&&(t=e),!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var o=this.steps.length;return this.doc.nodesBetween(e,t,function(s,a){if(s.isTextblock&&!s.hasMarkup(n,r)&&Ep(i.doc,i.mapping.slice(o).map(a),n)){i.clearIncompatible(i.mapping.slice(o).map(a,1),n);var l=i.mapping.slice(o),c=l.map(a,1),f=l.map(a+s.nodeSize,1);return i.step(new ie(c,f,c+1,f-1,new H(B.from(n.create(r,null,s.marks)),0,0),1,!0)),!1}}),this};function Ep(e,t,n){var r=e.resolve(t),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}St.prototype.setNodeMarkup=function(e,t,n,r){var i=this.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);var o=t.create(n,null,r||i.marks);if(i.isLeaf)return this.replaceWith(e,e+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new ie(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new H(B.from(o),0,0),1,!0))};function Ye(e,t,n,r){n===void 0&&(n=1);var i=e.resolve(t),o=i.depth-n,s=r&&r[r.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(var a=i.depth-1,l=n-2;a>o;a--,l--){var c=i.node(a),f=i.index(a);if(c.type.spec.isolating)return!1;var u=c.content.cutByIndex(f,c.childCount),d=r&&r[l]||c;if(d!=c&&(u=u.replaceChild(0,d.type.create(d.attrs))),!c.canReplace(f+1,c.childCount)||!d.type.validContent(u))return!1}var p=i.indexAfter(o),g=r&&r[0];return i.node(o).canReplaceWith(p,p,g?g.type:i.node(o+1).type)}St.prototype.split=function(e,t,n){t===void 0&&(t=1);for(var r=this.doc.resolve(e),i=B.empty,o=B.empty,s=r.depth,a=r.depth-t,l=t-1;s>a;s--,l--){i=B.from(r.node(s).copy(i));var c=n&&n[l];o=B.from(c?c.type.create(c.attrs,o):r.node(s).copy(o))}return this.step(new nn(e,e,new H(i.append(o),t,t),!0))};function vi(e,t){var n=e.resolve(t),r=n.index();return Mp(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Mp(e,t){return e&&t&&!e.isLeaf&&e.canAppend(t)}St.prototype.join=function(e,t){t===void 0&&(t=1);var n=new nn(e-t,e+t,H.empty,!0);return this.step(n)};function Tp(e,t,n){var r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),n))return t;if(r.parentOffset==0)for(var i=r.depth-1;i>=0;i--){var o=r.index(i);if(r.node(i).canReplaceWith(o,o,n))return r.before(i+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}}function ju(e,t,n){var r=e.resolve(t);if(!n.content.size)return t;for(var i=n.content,o=0;o<n.openStart;o++)i=i.firstChild.content;for(var s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(var a=r.depth;a>=0;a--){var l=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,c=r.index(a)+(l>0?1:0),f=r.node(a),u=!1;if(s==1)u=f.canReplace(c,c,i);else{var d=f.contentMatchAt(c).findWrapping(i.firstChild.type);u=d&&f.canReplaceWith(c,c,d[0])}if(u)return l==0?r.pos:l<0?r.before(a+1):r.after(a+1)}return null}function Sa(e,t,n){for(var r=[],i=0;i<e.childCount;i++){var o=e.child(i);o.content.size&&(o=o.copy(Sa(o.content,t,o))),o.isInline&&(o=t(o,n,i)),r.push(o)}return B.fromArray(r)}var Ca=function(e){function t(n,r,i){e.call(this),this.from=n,this.to=r,this.mark=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){var i=this,o=r.slice(this.from,this.to),s=r.resolve(this.from),a=s.node(s.sharedDepth(this.to)),l=new H(Sa(o.content,function(c,f){return!c.isAtom||!f.type.allowsMarkType(i.mark.type)?c:c.mark(i.mark.addToSet(c.marks))},a),o.openStart,o.openEnd);return Yt.fromReplace(r,this.from,this.to,l)},t.prototype.invert=function(){return new bi(this.from,this.to,this.mark)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(i.from,i.to,r.markFromJSON(i.mark))},t}($t);$t.jsonID("addMark",Ca);var bi=function(e){function t(n,r,i){e.call(this),this.from=n,this.to=r,this.mark=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){var i=this,o=r.slice(this.from,this.to),s=new H(Sa(o.content,function(a){return a.mark(i.mark.removeFromSet(a.marks))}),o.openStart,o.openEnd);return Yt.fromReplace(r,this.from,this.to,s)},t.prototype.invert=function(){return new Ca(this.from,this.to,this.mark)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(i.from,i.to,r.markFromJSON(i.mark))},t}($t);$t.jsonID("removeMark",bi);St.prototype.addMark=function(e,t,n){var r=this,i=[],o=[],s=null,a=null;return this.doc.nodesBetween(e,t,function(l,c,f){if(!!l.isInline){var u=l.marks;if(!n.isInSet(u)&&f.type.allowsMarkType(n.type)){for(var d=Math.max(c,e),p=Math.min(c+l.nodeSize,t),g=n.addToSet(u),y=0;y<u.length;y++)u[y].isInSet(g)||(s&&s.to==d&&s.mark.eq(u[y])?s.to=p:i.push(s=new bi(d,p,u[y])));a&&a.to==d?a.to=p:o.push(a=new Ca(d,p,n))}}}),i.forEach(function(l){return r.step(l)}),o.forEach(function(l){return r.step(l)}),this};St.prototype.removeMark=function(e,t,n){var r=this;n===void 0&&(n=null);var i=[],o=0;return this.doc.nodesBetween(e,t,function(s,a){if(!!s.isInline){o++;var l=null;if(n instanceof wn)for(var c=s.marks,f;f=n.isInSet(c);)(l||(l=[])).push(f),c=f.removeFromSet(c);else n?n.isInSet(s.marks)&&(l=[n]):l=s.marks;if(l&&l.length)for(var u=Math.min(a+s.nodeSize,t),d=0;d<l.length;d++){for(var p=l[d],g=void 0,y=0;y<i.length;y++){var w=i[y];w.step==o-1&&p.eq(i[y].style)&&(g=w)}g?(g.to=u,g.step=o):i.push({style:p,from:Math.max(a,e),to:u,step:o})}}}),i.forEach(function(s){return r.step(new bi(s.from,s.to,s.style))}),this};St.prototype.clearIncompatible=function(e,t,n){n===void 0&&(n=t.contentMatch);for(var r=this.doc.nodeAt(e),i=[],o=e+1,s=0;s<r.childCount;s++){var a=r.child(s),l=o+a.nodeSize,c=n.matchType(a.type,a.attrs);if(!c)i.push(new nn(o,l,H.empty));else{n=c;for(var f=0;f<a.marks.length;f++)t.allowsMarkType(a.marks[f].type)||this.step(new bi(o,l,a.marks[f]))}o=l}if(!n.validEnd){var u=n.fillBefore(B.empty,!0);this.replace(o,o,new H(u,0,0))}for(var d=i.length-1;d>=0;d--)this.step(i[d]);return this};function Ea(e,t,n,r){if(n===void 0&&(n=t),r===void 0&&(r=H.empty),t==n&&!r.size)return null;var i=e.resolve(t),o=e.resolve(n);return Hu(i,o,r)?new nn(t,n,r):new ke(i,o,r).fit()}St.prototype.replace=function(e,t,n){t===void 0&&(t=e),n===void 0&&(n=H.empty);var r=Ea(this.doc,e,t,n);return r&&this.step(r),this};St.prototype.replaceWith=function(e,t,n){return this.replace(e,t,new H(B.from(n),0,0))};St.prototype.delete=function(e,t){return this.replace(e,t,H.empty)};St.prototype.insert=function(e,t){return this.replaceWith(e,e,t)};function Hu(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}var ke=function(t,n,r){this.$to=n,this.$from=t,this.unplaced=r,this.frontier=[];for(var i=0;i<=t.depth;i++){var o=t.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(i))})}this.placed=B.empty;for(var s=t.depth;s>0;s--)this.placed=B.from(t.node(s).copy(this.placed))},qu={depth:{configurable:!0}};qu.depth.get=function(){return this.frontier.length-1};ke.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var n=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,i=this.$from,o=this.close(n<0?this.$to:i.doc.resolve(n));if(!o)return null;for(var s=this.placed,a=i.depth,l=o.depth;a&&l&&s.childCount==1;)s=s.firstChild.content,a--,l--;var c=new H(s,a,l);if(n>-1)return new ie(i.pos,n,this.$to.pos,this.$to.end(),c,r);if(c.size||i.pos!=this.$to.pos)return new nn(i.pos,o.pos,c)};ke.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var n=this.unplaced.openStart;n>=0;n--){var r=void 0,i=void 0;n?(i=Ma(this.unplaced.content,n-1).firstChild,r=i.content):r=this.unplaced.content;for(var o=r.firstChild,s=this.depth;s>=0;s--){var a=this.frontier[s],l=a.type,c=a.match,f=void 0,u=void 0;if(t==1&&(o?c.matchType(o.type)||(u=c.fillBefore(B.from(o),!1)):l.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:s,parent:i,inject:u};if(t==2&&o&&(f=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:s,parent:i,wrap:f};if(i&&c.matchType(i.type))break}}};ke.prototype.openMore=function(){var t=this.unplaced,n=t.content,r=t.openStart,i=t.openEnd,o=Ma(n,r);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new H(n,r+1,Math.max(i,o.size+r>=n.size-i?r+1:0)),!0)};ke.prototype.dropNode=function(){var t=this.unplaced,n=t.content,r=t.openStart,i=t.openEnd,o=Ma(n,r);if(o.childCount<=1&&r>0){var s=n.size-r<=r+o.size;this.unplaced=new H(Zr(n,r-1,1),r-1,s?r-1:i)}else this.unplaced=new H(Zr(n,r,1),r,i)};ke.prototype.placeNodes=function(t){for(var n=t.sliceDepth,r=t.frontierDepth,i=t.parent,o=t.inject,s=t.wrap;this.depth>r;)this.closeFrontierNode();if(s)for(var a=0;a<s.length;a++)this.openFrontierNode(s[a]);var l=this.unplaced,c=i?i.content:l.content,f=l.openStart-n,u=0,d=[],p=this.frontier[r],g=p.match,y=p.type;if(o){for(var w=0;w<o.childCount;w++)d.push(o.child(w));g=g.matchFragment(o)}for(var E=c.size+n-(l.content.size-l.openEnd);u<c.childCount;){var _=c.child(u),b=g.matchType(_.type);if(!b)break;u++,(u>1||f==0||_.content.size)&&(g=b,d.push(Wu(_.mark(y.allowedMarks(_.marks)),u==1?f:0,u==c.childCount?E:-1)))}var k=u==c.childCount;k||(E=-1),this.placed=wi(this.placed,r,B.from(d)),this.frontier[r].match=g,k&&E<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var S=0,x=c;S<E;S++){var M=x.lastChild;this.frontier.push({type:M.type,match:M.contentMatchAt(M.childCount)}),x=M.content}this.unplaced=k?n==0?H.empty:new H(Zr(l.content,n-1,1),n-1,E<0?l.openEnd:n-1):new H(Zr(l.content,n,u),l.openStart,l.openEnd)};ke.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var t=this.frontier[this.depth],n;if(!t.type.isTextblock||!Js(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;for(var r=this.$to,i=r.depth,o=this.$to.after(i);i>1&&o==this.$to.end(--i);)++o;return o};ke.prototype.findCloseLevel=function(t){t:for(var n=Math.min(this.depth,t.depth);n>=0;n--){var r=this.frontier[n],i=r.match,o=r.type,s=n<t.depth&&t.end(n+1)==t.pos+(t.depth-(n+1)),a=Js(t,n,o,i,s);if(!!a){for(var l=n-1;l>=0;l--){var c=this.frontier[l],f=c.match,u=c.type,d=Js(t,l,u,f,!0);if(!d||d.childCount)continue t}return{depth:n,fit:a,move:s?t.doc.resolve(t.after(n+1)):t}}}};ke.prototype.close=function(t){var n=this.findCloseLevel(t);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=wi(this.placed,n.depth,n.fit)),t=n.move;for(var r=n.depth+1;r<=t.depth;r++){var i=t.node(r),o=i.type.contentMatch.fillBefore(i.content,!0,t.index(r));this.openFrontierNode(i.type,i.attrs,o)}return t};ke.prototype.openFrontierNode=function(t,n,r){var i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=wi(this.placed,this.depth,B.from(t.create(n,r))),this.frontier.push({type:t,match:t.contentMatch})};ke.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),n=t.match.fillBefore(B.empty,!0);n.childCount&&(this.placed=wi(this.placed,this.frontier.length,n))};Object.defineProperties(ke.prototype,qu);function Zr(e,t,n){return t==0?e.cutByIndex(n):e.replaceChild(0,e.firstChild.copy(Zr(e.firstChild.content,t-1,n)))}function wi(e,t,n){return t==0?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(wi(e.lastChild.content,t-1,n)))}function Ma(e,t){for(var n=0;n<t;n++)e=e.firstChild.content;return e}function Wu(e,t,n){if(t<=0)return e;var r=e.content;return t>1&&(r=r.replaceChild(0,Wu(r.firstChild,t-1,r.childCount==1?n-1:0))),t>0&&(r=e.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(e.type.contentMatch.matchFragment(r).fillBefore(B.empty,!0)))),e.copy(r)}function Js(e,t,n,r,i){var o=e.node(t),s=i?e.indexAfter(t):e.index(t);if(s==o.childCount&&!n.compatibleContent(o.type))return null;var a=r.fillBefore(o.content,!0,s);return a&&!Op(n,o.content,s)?a:null}function Op(e,t,n){for(var r=n;r<t.childCount;r++)if(!e.allowsMarks(t.child(r).marks))return!0;return!1}function xp(e){return e.spec.defining||e.spec.definingForContent}St.prototype.replaceRange=function(e,t,n){if(!n.size)return this.deleteRange(e,t);var r=this.doc.resolve(e),i=this.doc.resolve(t);if(Hu(r,i,n))return this.step(new nn(e,t,n));var o=$u(r,this.doc.resolve(t));o[o.length-1]==0&&o.pop();var s=-(r.depth+1);o.unshift(s);for(var a=r.depth,l=r.pos-1;a>0;a--,l--){var c=r.node(a).type.spec;if(c.defining||c.definingAsContext||c.isolating)break;o.indexOf(a)>-1?s=a:r.before(a)==l&&o.splice(1,0,-a)}for(var f=o.indexOf(s),u=[],d=n.openStart,p=n.content,g=0;;g++){var y=p.firstChild;if(u.push(y),g==n.openStart)break;p=y.content}for(var w=d-1;w>=0;w--){var E=u[w].type,_=xp(E);if(_&&r.node(f).type!=E)d=w;else if(_||!E.isTextblock)break}for(var b=n.openStart;b>=0;b--){var k=(b+d+1)%(n.openStart+1),S=u[k];if(!!S)for(var x=0;x<o.length;x++){var M=o[(x+f)%o.length],A=!0;M<0&&(A=!1,M=-M);var P=r.node(M-1),O=r.index(M-1);if(P.canReplaceWith(O,O,S.type,S.marks))return this.replace(r.before(M),A?i.after(M):t,new H(Ju(n.content,0,n.openStart,k),k,n.openEnd))}}for(var D=this.steps.length,F=o.length-1;F>=0&&(this.replace(e,t,n),!(this.steps.length>D));F--){var j=o[F];j<0||(e=r.before(j),t=i.after(j))}return this};function Ju(e,t,n,r,i){if(t<n){var o=e.firstChild;e=e.replaceChild(0,o.copy(Ju(o.content,t+1,n,r,o)))}if(t>r){var s=i.contentMatchAt(0),a=s.fillBefore(e).append(e);e=a.append(s.matchFragment(a).fillBefore(B.empty,!0))}return e}St.prototype.replaceRangeWith=function(e,t,n){if(!n.isInline&&e==t&&this.doc.resolve(e).parent.content.size){var r=Tp(this.doc,e,n.type);r!=null&&(e=t=r)}return this.replaceRange(e,t,new H(B.from(n),0,0))};St.prototype.deleteRange=function(e,t){for(var n=this.doc.resolve(e),r=this.doc.resolve(t),i=$u(n,r),o=0;o<i.length;o++){var s=i[o],a=o==i.length-1;if(a&&s==0||n.node(s).type.contentMatch.validEnd)return this.delete(n.start(s),r.end(s));if(s>0&&(a||n.node(s-1).canReplace(n.index(s-1),r.indexAfter(s-1))))return this.delete(n.before(s),r.after(s))}for(var l=1;l<=n.depth&&l<=r.depth;l++)if(e-n.start(l)==n.depth-l&&t>n.end(l)&&r.end(l)-t!=r.depth-l)return this.delete(n.before(l),t);return this.delete(e,t)};function $u(e,t){for(var n=[],r=Math.min(e.depth,t.depth),i=r;i>=0;i--){var o=e.start(i);if(o<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(o==t.start(i)||i==e.depth&&i==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==o-1)&&n.push(i)}return n}var $s=Object.create(null),tt=function(t,n,r){this.ranges=r||[new Ap(t.min(n),t.max(n))],this.$anchor=t,this.$head=n},Cn={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Cn.anchor.get=function(){return this.$anchor.pos};Cn.head.get=function(){return this.$head.pos};Cn.from.get=function(){return this.$from.pos};Cn.to.get=function(){return this.$to.pos};Cn.$from.get=function(){return this.ranges[0].$from};Cn.$to.get=function(){return this.ranges[0].$to};Cn.empty.get=function(){for(var e=this.ranges,t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0};tt.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};tt.prototype.replace=function(t,n){n===void 0&&(n=H.empty);for(var r=n.content.lastChild,i=null,o=0;o<n.openEnd;o++)i=r,r=r.lastChild;for(var s=t.steps.length,a=this.ranges,l=0;l<a.length;l++){var c=a[l],f=c.$from,u=c.$to,d=t.mapping.slice(s);t.replaceRange(d.map(f.pos),d.map(u.pos),l?H.empty:n),l==0&&Ku(t,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}};tt.prototype.replaceWith=function(t,n){for(var r=t.steps.length,i=this.ranges,o=0;o<i.length;o++){var s=i[o],a=s.$from,l=s.$to,c=t.mapping.slice(r),f=c.map(a.pos),u=c.map(l.pos);o?t.deleteRange(f,u):(t.replaceRangeWith(f,u,n),Ku(t,r,n.isInline?-1:1))}};tt.findFrom=function(t,n,r){var i=t.parent.inlineContent?new rt(t):cr(t.node(0),t.parent,t.pos,t.index(),n,r);if(i)return i;for(var o=t.depth-1;o>=0;o--){var s=n<0?cr(t.node(0),t.node(o),t.before(o+1),t.index(o),n,r):cr(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,n,r);if(s)return s}};tt.near=function(t,n){return n===void 0&&(n=1),this.findFrom(t,n)||this.findFrom(t,-n)||new rn(t.node(0))};tt.atStart=function(t){return cr(t,t,0,0,1)||new rn(t)};tt.atEnd=function(t){return cr(t,t,t.content.size,t.childCount,-1)||new rn(t)};tt.fromJSON=function(t,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");var r=$s[n.type];if(!r)throw new RangeError("No selection type "+n.type+" defined");return r.fromJSON(t,n)};tt.jsonID=function(t,n){if(t in $s)throw new RangeError("Duplicate use of selection JSON ID "+t);return $s[t]=n,n.prototype.jsonID=t,n};tt.prototype.getBookmark=function(){return rt.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(tt.prototype,Cn);tt.prototype.visible=!0;var Ap=function(t,n){this.$from=t,this.$to=n},rt=function(e){function t(r,i){i===void 0&&(i=r),e.call(this,r,i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={$cursor:{configurable:!0}};return n.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},t.prototype.map=function(i,o){var s=i.resolve(o.map(this.head));if(!s.parent.inlineContent)return e.near(s);var a=i.resolve(o.map(this.anchor));return new t(a.parent.inlineContent?a:s,s)},t.prototype.replace=function(i,o){if(o===void 0&&(o=H.empty),e.prototype.replace.call(this,i,o),o==H.empty){var s=this.$from.marksAcross(this.$to);s&&i.ensureMarks(s)}},t.prototype.eq=function(i){return i instanceof t&&i.anchor==this.anchor&&i.head==this.head},t.prototype.getBookmark=function(){return new Qr(this.anchor,this.head)},t.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},t.fromJSON=function(i,o){if(typeof o.anchor!="number"||typeof o.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new t(i.resolve(o.anchor),i.resolve(o.head))},t.create=function(i,o,s){s===void 0&&(s=o);var a=i.resolve(o);return new this(a,s==o?a:i.resolve(s))},t.between=function(i,o,s){var a=i.pos-o.pos;if((!s||a)&&(s=a>=0?1:-1),!o.parent.inlineContent){var l=e.findFrom(o,s,!0)||e.findFrom(o,-s,!0);if(l)o=l.$head;else return e.near(o,s)}return i.parent.inlineContent||(a==0?i=o:(i=(e.findFrom(i,-s,!0)||e.findFrom(i,s,!0)).$anchor,i.pos<o.pos!=a<0&&(i=o))),new t(i,o)},Object.defineProperties(t.prototype,n),t}(tt);tt.jsonID("text",rt);var Qr=function(t,n){this.anchor=t,this.head=n};Qr.prototype.map=function(t){return new Qr(t.map(this.anchor),t.map(this.head))};Qr.prototype.resolve=function(t){return rt.between(t.resolve(this.anchor),t.resolve(this.head))};var et=function(e){function t(n){var r=n.nodeAfter,i=n.node(0).resolve(n.pos+r.nodeSize);e.call(this,n,i),this.node=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.map=function(r,i){var o=i.mapResult(this.anchor),s=o.deleted,a=o.pos,l=r.resolve(a);return s?e.near(l):new t(l)},t.prototype.content=function(){return new H(B.from(this.node),0,0)},t.prototype.eq=function(r){return r instanceof t&&r.anchor==this.anchor},t.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},t.prototype.getBookmark=function(){return new eo(this.anchor)},t.fromJSON=function(r,i){if(typeof i.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new t(r.resolve(i.anchor))},t.create=function(r,i){return new this(r.resolve(i))},t.isSelectable=function(r){return!r.isText&&r.type.spec.selectable!==!1},t}(tt);et.prototype.visible=!1;tt.jsonID("node",et);var eo=function(t){this.anchor=t};eo.prototype.map=function(t){var n=t.mapResult(this.anchor),r=n.deleted,i=n.pos;return r?new Qr(i,i):new eo(i)};eo.prototype.resolve=function(t){var n=t.resolve(this.anchor),r=n.nodeAfter;return r&&et.isSelectable(r)?new et(n):tt.near(n)};var rn=function(e){function t(n){e.call(this,n.resolve(0),n.resolve(n.content.size))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.replace=function(r,i){if(i===void 0&&(i=H.empty),i==H.empty){r.delete(0,r.doc.content.size);var o=e.atStart(r.doc);o.eq(r.selection)||r.setSelection(o)}else e.prototype.replace.call(this,r,i)},t.prototype.toJSON=function(){return{type:"all"}},t.fromJSON=function(r){return new t(r)},t.prototype.map=function(r){return new t(r)},t.prototype.eq=function(r){return r instanceof t},t.prototype.getBookmark=function(){return Dp},t}(tt);tt.jsonID("all",rn);var Dp={map:function(){return this},resolve:function(t){return new rn(t)}};function cr(e,t,n,r,i,o){if(t.inlineContent)return rt.create(e,n);for(var s=r-(i>0?0:1);i>0?s<t.childCount:s>=0;s+=i){var a=t.child(s);if(a.isAtom){if(!o&&et.isSelectable(a))return et.create(e,n-(i<0?a.nodeSize:0))}else{var l=cr(e,a,n+i,i<0?a.childCount:0,i,o);if(l)return l}n+=a.nodeSize*i}}function Ku(e,t,n){var r=e.steps.length-1;if(!(r<t)){var i=e.steps[r];if(i instanceof nn||i instanceof ie){var o=e.mapping.maps[r],s;o.forEach(function(a,l,c,f){s==null&&(s=f)}),e.setSelection(tt.near(e.doc.resolve(s),n))}}}var jl=1,Ri=2,Hl=4,Np=function(e){function t(r){e.call(this,r.doc),this.time=Date.now(),this.curSelection=r.selection,this.curSelectionFor=0,this.storedMarks=r.storedMarks,this.updated=0,this.meta=Object.create(null)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return n.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},t.prototype.setSelection=function(i){if(i.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=i,this.curSelectionFor=this.steps.length,this.updated=(this.updated|jl)&~Ri,this.storedMarks=null,this},n.selectionSet.get=function(){return(this.updated&jl)>0},t.prototype.setStoredMarks=function(i){return this.storedMarks=i,this.updated|=Ri,this},t.prototype.ensureMarks=function(i){return at.sameSet(this.storedMarks||this.selection.$from.marks(),i)||this.setStoredMarks(i),this},t.prototype.addStoredMark=function(i){return this.ensureMarks(i.addToSet(this.storedMarks||this.selection.$head.marks()))},t.prototype.removeStoredMark=function(i){return this.ensureMarks(i.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.storedMarksSet.get=function(){return(this.updated&Ri)>0},t.prototype.addStep=function(i,o){e.prototype.addStep.call(this,i,o),this.updated=this.updated&~Ri,this.storedMarks=null},t.prototype.setTime=function(i){return this.time=i,this},t.prototype.replaceSelection=function(i){return this.selection.replace(this,i),this},t.prototype.replaceSelectionWith=function(i,o){var s=this.selection;return o!==!1&&(i=i.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||at.none))),s.replaceWith(this,i),this},t.prototype.deleteSelection=function(){return this.selection.replace(this),this},t.prototype.insertText=function(i,o,s){s===void 0&&(s=o);var a=this.doc.type.schema;if(o==null)return i?this.replaceSelectionWith(a.text(i),!0):this.deleteSelection();if(!i)return this.deleteRange(o,s);var l=this.storedMarks;if(!l){var c=this.doc.resolve(o);l=s==o?c.marks():c.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(o,s,a.text(i,l)),this.selection.empty||this.setSelection(tt.near(this.selection.$to)),this},t.prototype.setMeta=function(i,o){return this.meta[typeof i=="string"?i:i.key]=o,this},t.prototype.getMeta=function(i){return this.meta[typeof i=="string"?i:i.key]},n.isGeneric.get=function(){for(var r in this.meta)return!1;return!0},t.prototype.scrollIntoView=function(){return this.updated|=Hl,this},n.scrolledIntoView.get=function(){return(this.updated&Hl)>0},Object.defineProperties(t.prototype,n),t}(St);function ql(e,t){return!t||!e?e:e.bind(t)}var zr=function(t,n,r){this.name=t,this.init=ql(n.init,r),this.apply=ql(n.apply,r)},Rp=[new zr("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new zr("selection",{init:function(t,n){return t.selection||tt.atStart(n.doc)},apply:function(t){return t.selection}}),new zr("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,n,r,i){return i.selection.$cursor?t.storedMarks:null}}),new zr("scrollToSelection",{init:function(){return 0},apply:function(t,n){return t.scrolledIntoView?n+1:n}})],Ta=function(t,n){var r=this;this.schema=t,this.fields=Rp.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),n&&n.forEach(function(i){if(r.pluginsByKey[i.key])throw new RangeError("Adding different instances of a keyed plugin ("+i.key+")");r.plugins.push(i),r.pluginsByKey[i.key]=i,i.spec.state&&r.fields.push(new zr(i.key,i.spec.state,i))})},Jt=function(t){this.config=t},Ao={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Ao.schema.get=function(){return this.config.schema};Ao.plugins.get=function(){return this.config.plugins};Jt.prototype.apply=function(t){return this.applyTransaction(t).state};Jt.prototype.filterTransaction=function(t,n){n===void 0&&(n=-1);for(var r=0;r<this.config.plugins.length;r++)if(r!=n){var i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,t,this))return!1}return!0};Jt.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var n=[t],r=this.applyInner(t),i=null;;){for(var o=!1,s=0;s<this.config.plugins.length;s++){var a=this.config.plugins[s];if(a.spec.appendTransaction){var l=i?i[s].n:0,c=i?i[s].state:this,f=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(f&&r.filterTransaction(f,s)){if(f.setMeta("appendedTransaction",t),!i){i=[];for(var u=0;u<this.config.plugins.length;u++)i.push(u<s?{state:r,n:n.length}:{state:this,n:0})}n.push(f),r=r.applyInner(f),o=!0}i&&(i[s]={state:r,n:n.length})}}if(!o)return{state:r,transactions:n}}};Jt.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var n=new Jt(this.config),r=this.config.fields,i=0;i<r.length;i++){var o=r[i];n[o.name]=o.apply(t,this[o.name],this,n)}for(var s=0;s<ti.length;s++)ti[s](this,t,n);return n};Ao.tr.get=function(){return new Np(this)};Jt.create=function(t){for(var n=new Ta(t.doc?t.doc.type.schema:t.schema,t.plugins),r=new Jt(n),i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(t,r);return r};Jt.prototype.reconfigure=function(t){for(var n=new Ta(this.schema,t.plugins),r=n.fields,i=new Jt(n),o=0;o<r.length;o++){var s=r[o].name;i[s]=this.hasOwnProperty(s)?this[s]:r[o].init(t,i)}return i};Jt.prototype.toJSON=function(t){var n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(function(s){return s.toJSON()})),t&&typeof t=="object")for(var r in t){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var i=t[r],o=i.spec.state;o&&o.toJSON&&(n[r]=o.toJSON.call(i,this[i.key]))}return n};Jt.fromJSON=function(t,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var i=new Ta(t.schema,t.plugins),o=new Jt(i);return i.fields.forEach(function(s){if(s.name=="doc")o.doc=lt.fromJSON(t.schema,n.doc);else if(s.name=="selection")o.selection=tt.fromJSON(o.doc,n.selection);else if(s.name=="storedMarks")n.storedMarks&&(o.storedMarks=n.storedMarks.map(t.schema.markFromJSON));else{if(r)for(var a in r){var l=r[a],c=l.spec.state;if(l.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){o[s.name]=c.fromJSON.call(l,t,n[a],o);return}}o[s.name]=s.init(t,o)}}),o};Jt.addApplyListener=function(t){ti.push(t)};Jt.removeApplyListener=function(t){var n=ti.indexOf(t);n>-1&&ti.splice(n,1)};Object.defineProperties(Jt.prototype,Ao);var ti=[];function Gu(e,t,n){for(var r in e){var i=e[r];i instanceof Function?i=i.bind(t):r=="handleDOMEvents"&&(i=Gu(i,t,{})),n[r]=i}return n}var Kt=function(t){this.props={},t.props&&Gu(t.props,this,this.props),this.spec=t,this.key=t.key?t.key.key:Yu("plugin")};Kt.prototype.getState=function(t){return t[this.key]};var is=Object.create(null);function Yu(e){return e in is?e+"$"+ ++is[e]:(is[e]=0,e+"$")}var he=function(t){t===void 0&&(t="key"),this.key=Yu(t)};he.prototype.get=function(t){return t.config.pluginsByKey[this.key]};he.prototype.getState=function(t){return t[this.key]};function Oa(e,t){return e.selection.empty?!1:(t&&t(e.tr.deleteSelection().scrollIntoView()),!0)}function Xu(e,t,n){var r=e.selection,i=r.$cursor;if(!i||(n?!n.endOfTextblock("backward",e):i.parentOffset>0))return!1;var o=Qu(i);if(!o){var s=i.blockRange(),a=s&&Or(s);return a==null?!1:(t&&t(e.tr.lift(s,a).scrollIntoView()),!0)}var l=o.nodeBefore;if(!l.type.spec.isolating&&lf(e,o,t))return!0;if(i.parent.content.size==0&&(gr(l,"end")||et.isSelectable(l))){var c=Ea(e.doc,i.before(),i.after(),H.empty);if(c.slice.size<c.to-c.from){if(t){var f=e.tr.step(c);f.setSelection(gr(l,"end")?tt.findFrom(f.doc.resolve(f.mapping.map(o.pos,-1)),-1):et.create(f.doc,o.pos-l.nodeSize)),t(f.scrollIntoView())}return!0}}return l.isAtom&&o.depth==i.depth-1?(t&&t(e.tr.delete(o.pos-l.nodeSize,o.pos).scrollIntoView()),!0):!1}function gr(e,t,n){for(;e;e=t=="start"?e.firstChild:e.lastChild){if(e.isTextblock)return!0;if(n&&e.childCount!=1)return!1}return!1}function Zu(e,t,n){var r=e.selection,i=r.$head,o=r.empty,s=i;if(!o)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):i.parentOffset>0)return!1;s=Qu(i)}var a=s&&s.nodeBefore;return!a||!et.isSelectable(a)?!1:(t&&t(e.tr.setSelection(et.create(e.doc,s.pos-a.nodeSize)).scrollIntoView()),!0)}function Qu(e){if(!e.parent.type.spec.isolating)for(var t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function tf(e,t,n){var r=e.selection,i=r.$cursor;if(!i||(n?!n.endOfTextblock("forward",e):i.parentOffset<i.parent.content.size))return!1;var o=nf(i);if(!o)return!1;var s=o.nodeAfter;if(lf(e,o,t))return!0;if(i.parent.content.size==0&&(gr(s,"start")||et.isSelectable(s))){var a=Ea(e.doc,i.before(),i.after(),H.empty);if(a.slice.size<a.to-a.from){if(t){var l=e.tr.step(a);l.setSelection(gr(s,"start")?tt.findFrom(l.doc.resolve(l.mapping.map(o.pos)),1):et.create(l.doc,l.mapping.map(o.pos))),t(l.scrollIntoView())}return!0}}return s.isAtom&&o.depth==i.depth-1?(t&&t(e.tr.delete(o.pos,o.pos+s.nodeSize).scrollIntoView()),!0):!1}function ef(e,t,n){var r=e.selection,i=r.$head,o=r.empty,s=i;if(!o)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):i.parentOffset<i.parent.content.size)return!1;s=nf(i)}var a=s&&s.nodeAfter;return!a||!et.isSelectable(a)?!1:(t&&t(e.tr.setSelection(et.create(e.doc,s.pos)).scrollIntoView()),!0)}function nf(e){if(!e.parent.type.spec.isolating)for(var t=e.depth-1;t>=0;t--){var n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}function Ip(e,t){var n=e.selection,r=n.$from,i=n.$to,o=r.blockRange(i),s=o&&Or(o);return s==null?!1:(t&&t(e.tr.lift(o,s).scrollIntoView()),!0)}function rf(e,t){var n=e.selection,r=n.$head,i=n.$anchor;return!r.parent.type.spec.code||!r.sameParent(i)?!1:(t&&t(e.tr.insertText(`
`).scrollIntoView()),!0)}function xa(e){for(var t=0;t<e.edgeCount;t++){var n=e.edge(t),r=n.type;if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function of(e,t){var n=e.selection,r=n.$head,i=n.$anchor;if(!r.parent.type.spec.code||!r.sameParent(i))return!1;var o=r.node(-1),s=r.indexAfter(-1),a=xa(o.contentMatchAt(s));if(!o.canReplaceWith(s,s,a))return!1;if(t){var l=r.after(),c=e.tr.replaceWith(l,l,a.createAndFill());c.setSelection(tt.near(c.doc.resolve(l),1)),t(c.scrollIntoView())}return!0}function sf(e,t){var n=e.selection,r=n.$from,i=n.$to;if(n instanceof rn||r.parent.inlineContent||i.parent.inlineContent)return!1;var o=xa(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){var s=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=e.tr.insert(s,o.createAndFill());a.setSelection(rt.create(a.doc,s+1)),t(a.scrollIntoView())}return!0}function af(e,t){var n=e.selection,r=n.$cursor;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){var i=r.before();if(Ye(e.doc,i))return t&&t(e.tr.split(i).scrollIntoView()),!0}var o=r.blockRange(),s=o&&Or(o);return s==null?!1:(t&&t(e.tr.lift(o,s).scrollIntoView()),!0)}function Lp(e,t){var n=e.selection,r=n.$from,i=n.$to;if(e.selection instanceof et&&e.selection.node.isBlock)return!r.parentOffset||!Ye(e.doc,r.pos)?!1:(t&&t(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.parent.isBlock)return!1;if(t){var o=i.parentOffset==i.parent.content.size,s=e.tr;(e.selection instanceof rt||e.selection instanceof rn)&&s.deleteSelection();var a=r.depth==0?null:xa(r.node(-1).contentMatchAt(r.indexAfter(-1))),l=o&&a?[{type:a}]:null,c=Ye(s.doc,s.mapping.map(r.pos),1,l);if(!l&&!c&&Ye(s.doc,s.mapping.map(r.pos),1,a&&[{type:a}])&&(l=[{type:a}],c=!0),c&&(s.split(s.mapping.map(r.pos),1,l),!o&&!r.parentOffset&&r.parent.type!=a)){var f=s.mapping.map(r.before()),u=s.doc.resolve(f);r.node(-1).canReplaceWith(u.index(),u.index()+1,a)&&s.setNodeMarkup(s.mapping.map(r.before()),a)}t(s.scrollIntoView())}return!0}function Pp(e,t){var n=e.selection,r=n.$from,i=n.to,o,s=r.sharedDepth(i);return s==0?!1:(o=r.before(s),t&&t(e.tr.setSelection(et.create(e.doc,o))),!0)}function Bp(e,t){return t&&t(e.tr.setSelection(new rn(e.doc))),!0}function Fp(e,t,n){var r=t.nodeBefore,i=t.nodeAfter,o=t.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&t.parent.canReplace(o-1,o)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(o,o+1)||!(i.isTextblock||vi(e.doc,t.pos))?!1:(n&&n(e.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),!0)}function lf(e,t,n){var r=t.nodeBefore,i=t.nodeAfter,o,s;if(r.type.spec.isolating||i.type.spec.isolating)return!1;if(Fp(e,t,n))return!0;var a=t.parent.canReplace(t.index(),t.index()+1);if(a&&(o=(s=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&s.matchType(o[0]||i.type).validEnd){if(n){for(var l=t.pos+i.nodeSize,c=B.empty,f=o.length-1;f>=0;f--)c=B.from(o[f].create(null,c));c=B.from(r.copy(c));var u=e.tr.step(new ie(t.pos-1,l,t.pos,l,new H(c,1,0),o.length,!0)),d=l+2*o.length;vi(u.doc,d)&&u.join(d),n(u.scrollIntoView())}return!0}var p=tt.findFrom(t,1),g=p&&p.$from.blockRange(p.$to),y=g&&Or(g);if(y!=null&&y>=t.depth)return n&&n(e.tr.lift(g,y).scrollIntoView()),!0;if(a&&gr(i,"start",!0)&&gr(r,"end")){for(var w=r,E=[];E.push(w),!w.isTextblock;)w=w.lastChild;for(var _=i,b=1;!_.isTextblock;_=_.firstChild)b++;if(w.canReplace(w.childCount,w.childCount,_.content)){if(n){for(var k=B.empty,S=E.length-1;S>=0;S--)k=B.from(E[S].copy(k));var x=e.tr.step(new ie(t.pos-E.length,t.pos+i.nodeSize,t.pos+b,t.pos+i.nodeSize-b,new H(k,E.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function cf(e){return function(t,n){for(var r=t.selection,i=e<0?r.$from:r.$to,o=i.depth;i.node(o).isInline;){if(!o)return!1;o--}return i.node(o).isTextblock?(n&&n(t.tr.setSelection(rt.create(t.doc,e<0?i.start(o):i.end(o)))),!0):!1}}var uf=cf(-1),ff=cf(1);function zp(e,t){return function(n,r){var i=n.selection,o=i.$from,s=i.$to,a=o.blockRange(s),l=a&&_a(a,e,t);return l?(r&&r(n.tr.wrap(a,l).scrollIntoView()),!0):!1}}function Wl(e,t){return function(n,r){var i=n.selection,o=i.from,s=i.to,a=!1;return n.doc.nodesBetween(o,s,function(l,c){if(a)return!1;if(!(!l.isTextblock||l.hasMarkup(e,t)))if(l.type==e)a=!0;else{var f=n.doc.resolve(c),u=f.index();a=f.parent.canReplaceWith(u,u+1,e)}}),a?(r&&r(n.tr.setBlockType(o,s,e,t).scrollIntoView()),!0):!1}}function Aa(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return function(n,r,i){for(var o=0;o<e.length;o++)if(e[o](n,r,i))return!0;return!1}}var ss=Aa(Oa,Xu,Zu),Jl=Aa(Oa,tf,ef),dn={Enter:Aa(rf,sf,af,Lp),"Mod-Enter":of,Backspace:ss,"Mod-Backspace":ss,"Shift-Backspace":ss,Delete:Jl,"Mod-Delete":Jl,"Mod-a":Bp},Vp={"Ctrl-h":dn.Backspace,"Alt-Backspace":dn["Mod-Backspace"],"Ctrl-d":dn.Delete,"Ctrl-Alt-Backspace":dn["Mod-Delete"],"Alt-Delete":dn["Mod-Delete"],"Alt-d":dn["Mod-Delete"],"Ctrl-a":uf,"Ctrl-e":ff};for(var $l in dn)Vp[$l]=dn[$l];typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function Up(e,t){return function(n,r){var i=n.selection,o=i.$from,s=i.$to,a=o.blockRange(s),l=!1,c=a;if(!a)return!1;if(a.depth>=2&&o.node(a.depth-1).type.compatibleContent(e)&&a.startIndex==0){if(o.index(a.depth-1)==0)return!1;var f=n.doc.resolve(a.start-2);c=new Yr(f,f,a.depth),a.endIndex<a.parent.childCount&&(a=new Yr(o,n.doc.resolve(s.end(a.depth)),a.depth)),l=!0}var u=_a(c,e,t,a);return u?(r&&r(jp(n.tr,a,u,l,e).scrollIntoView()),!0):!1}}function jp(e,t,n,r,i){for(var o=B.empty,s=n.length-1;s>=0;s--)o=B.from(n[s].type.create(n[s].attrs,o));e.step(new ie(t.start-(r?2:0),t.end,t.start,t.end,new H(o,0,0),n.length,!0));for(var a=0,l=0;l<n.length;l++)n[l].type==i&&(a=l+1);for(var c=n.length-a,f=t.start+n.length-(r?2:0),u=t.parent,d=t.startIndex,p=t.endIndex,g=!0;d<p;d++,g=!1)!g&&Ye(e.doc,f,c)&&(e.split(f,c),f+=2*c),f+=u.child(d).nodeSize;return e}function Hp(e){return function(t,n){var r=t.selection,i=r.$from,o=r.$to,s=i.blockRange(o,function(a){return a.childCount&&a.firstChild.type==e});return s?n?i.node(s.depth-1).type==e?qp(t,n,e,s):Wp(t,n,s):!0:!1}}function qp(e,t,n,r){var i=e.tr,o=r.end,s=r.$to.end(r.depth);return o<s&&(i.step(new ie(o-1,s,o,s,new H(B.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Yr(i.doc.resolve(r.$from.pos),i.doc.resolve(s),r.depth)),t(i.lift(r,Or(r)).scrollIntoView()),!0}function Wp(e,t,n){for(var r=e.tr,i=n.parent,o=n.end,s=n.endIndex-1,a=n.startIndex;s>a;s--)o-=i.child(s).nodeSize,r.delete(o-1,o+1);var l=r.doc.resolve(n.start),c=l.nodeAfter;if(r.mapping.map(n.end)!=n.start+l.nodeAfter.nodeSize)return!1;var f=n.startIndex==0,u=n.endIndex==i.childCount,d=l.node(-1),p=l.index(-1);if(!d.canReplace(p+(f?0:1),p+1,c.content.append(u?B.empty:B.from(i))))return!1;var g=l.pos,y=g+c.nodeSize;return r.step(new ie(g-(f?1:0),y+(u?1:0),g+1,y-1,new H((f?B.empty:B.from(i.copy(B.empty))).append(u?B.empty:B.from(i.copy(B.empty))),f?0:1,u?0:1),f?0:1)),t(r.scrollIntoView()),!0}function Jp(e){return function(t,n){var r=t.selection,i=r.$from,o=r.$to,s=i.blockRange(o,function(y){return y.childCount&&y.firstChild.type==e});if(!s)return!1;var a=s.startIndex;if(a==0)return!1;var l=s.parent,c=l.child(a-1);if(c.type!=e)return!1;if(n){var f=c.lastChild&&c.lastChild.type==l.type,u=B.from(f?e.create():null),d=new H(B.from(e.create(null,B.from(l.type.create(null,u)))),f?3:1,0),p=s.start,g=s.end;n(t.tr.step(new ie(p-(f?3:1),g,p,g,d,1,!0)).scrollIntoView())}return!0}}var V={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var as=/Edge\/(\d+)/.exec(navigator.userAgent),Kl=/MSIE \d/.test(navigator.userAgent),ls=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),cs=V.ie=!!(Kl||ls||as);V.ie_version=Kl?document.documentMode||6:ls?+ls[1]:as?+as[1]:null,V.gecko=!cs&&/gecko\/(\d+)/i.test(navigator.userAgent),V.gecko_version=V.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var us=!cs&&/Chrome\/(\d+)/.exec(navigator.userAgent);V.chrome=!!us,V.chrome_version=us&&+us[1],V.safari=!cs&&/Apple Computer/.test(navigator.vendor),V.ios=V.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),V.mac=V.ios||/Mac/.test(navigator.platform),V.android=/Android \d/.test(navigator.userAgent),V.webkit="webkitFontSmoothing"in document.documentElement.style,V.webkit_version=V.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var ce=function(e){for(var t=0;;t++)if(e=e.previousSibling,!e)return t},Da=function(e){var t=e.assignedSlot||e.parentNode;return t&&t.nodeType==11?t.host:t},Gl=null,Ke=function(e,t,n){var r=Gl||(Gl=document.createRange());return r.setEnd(e,n==null?e.nodeValue.length:n),r.setStart(e,t||0),r},ei=function(e,t,n,r){return n&&(Yl(e,t,n,r,-1)||Yl(e,t,n,r,1))},$p=/^(img|br|input|textarea|hr)$/i;function Yl(e,t,n,r,i){for(;;){if(e==n&&t==r)return!0;if(t==(i<0?0:Fe(e))){var o=e.parentNode;if(!o||o.nodeType!=1||Gp(e)||$p.test(e.nodeName)||e.contentEditable=="false")return!1;t=ce(e)+(i<0?0:1),e=o}else if(e.nodeType==1){if(e=e.childNodes[t+(i<0?-1:0)],e.contentEditable=="false")return!1;t=i<0?Fe(e):0}else return!1}}function Fe(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function Kp(e,t,n){for(var r=t==0,i=t==Fe(e);r||i;){if(e==n)return!0;var o=ce(e);if(e=e.parentNode,!e)return!1;r=r&&o==0,i=i&&o==Fe(e)}}function Gp(e){for(var t,n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}var Na=function(e){var t=e.isCollapsed;return t&&V.chrome&&e.rangeCount&&!e.getRangeAt(0).collapsed&&(t=!1),t};function sr(e,t){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}function Yp(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function un(e,t){return typeof e=="number"?e:e[t]}function Xp(e){var t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,r=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*r}}function Xl(e,t,n){for(var r=e.someProp("scrollThreshold")||0,i=e.someProp("scrollMargin")||5,o=e.dom.ownerDocument,s=n||e.dom;s;s=Da(s))if(s.nodeType==1){var a=s==o.body||s.nodeType!=1,l=a?Yp(o):Xp(s),c=0,f=0;if(t.top<l.top+un(r,"top")?f=-(l.top-t.top+un(i,"top")):t.bottom>l.bottom-un(r,"bottom")&&(f=t.bottom-l.bottom+un(i,"bottom")),t.left<l.left+un(r,"left")?c=-(l.left-t.left+un(i,"left")):t.right>l.right-un(r,"right")&&(c=t.right-l.right+un(i,"right")),c||f)if(a)o.defaultView.scrollBy(c,f);else{var u=s.scrollLeft,d=s.scrollTop;f&&(s.scrollTop+=f),c&&(s.scrollLeft+=c);var p=s.scrollLeft-u,g=s.scrollTop-d;t={left:t.left-p,top:t.top-g,right:t.right-p,bottom:t.bottom-g}}if(a)break}}function Zp(e){for(var t=e.dom.getBoundingClientRect(),n=Math.max(0,t.top),r,i,o=(t.left+t.right)/2,s=n+1;s<Math.min(innerHeight,t.bottom);s+=5){var a=e.root.elementFromPoint(o,s);if(!(a==e.dom||!e.dom.contains(a))){var l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}}return{refDOM:r,refTop:i,stack:hf(e.dom)}}function hf(e){for(var t=[],n=e.ownerDocument;e&&(t.push({dom:e,top:e.scrollTop,left:e.scrollLeft}),e!=n);e=Da(e));return t}function Qp(e){var t=e.refDOM,n=e.refTop,r=e.stack,i=t?t.getBoundingClientRect().top:0;df(r,i==0?0:i-n)}function df(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r.dom,o=r.top,s=r.left;i.scrollTop!=o+t&&(i.scrollTop=o+t),i.scrollLeft!=s&&(i.scrollLeft=s)}}var ir=null;function tg(e){if(e.setActive)return e.setActive();if(ir)return e.focus(ir);var t=hf(e);e.focus(ir==null?{get preventScroll(){return ir={preventScroll:!0},!0}}:void 0),ir||(ir=!1,df(t,0))}function pf(e,t){for(var n,r=2e8,i,o=0,s=t.top,a=t.top,l=e.firstChild,c=0;l;l=l.nextSibling,c++){var f=void 0;if(l.nodeType==1)f=l.getClientRects();else if(l.nodeType==3)f=Ke(l).getClientRects();else continue;for(var u=0;u<f.length;u++){var d=f[u];if(d.top<=s&&d.bottom>=a){s=Math.max(d.bottom,s),a=Math.min(d.top,a);var p=d.left>t.left?d.left-t.left:d.right<t.left?t.left-d.right:0;if(p<r){n=l,r=p,i=p&&n.nodeType==3?{left:d.right<t.left?d.right:d.left,top:t.top}:t,l.nodeType==1&&p&&(o=c+(t.left>=(d.left+d.right)/2?1:0));continue}}!n&&(t.left>=d.right&&t.top>=d.top||t.left>=d.left&&t.top>=d.bottom)&&(o=c+1)}}return n&&n.nodeType==3?eg(n,i):!n||r&&n.nodeType==1?{node:e,offset:o}:pf(n,i)}function eg(e,t){for(var n=e.nodeValue.length,r=document.createRange(),i=0;i<n;i++){r.setEnd(e,i+1),r.setStart(e,i);var o=hn(r,1);if(o.top!=o.bottom&&Ra(t,o))return{node:e,offset:i+(t.left>=(o.left+o.right)/2?1:0)}}return{node:e,offset:0}}function Ra(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function ng(e,t){var n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}function rg(e,t,n){var r=pf(t,n),i=r.node,o=r.offset,s=-1;if(i.nodeType==1&&!i.firstChild){var a=i.getBoundingClientRect();s=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return e.docView.posFromDOM(i,o,s)}function ig(e,t,n,r){for(var i=-1,o=t;o!=e.dom;){var s=e.docView.nearestDesc(o,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)i=s.posBefore;else if(a.right<r.left||a.bottom<r.top)i=s.posAfter;else break}o=s.dom.parentNode}return i>-1?i:e.docView.posFromDOM(t,n)}function gf(e,t,n){var r=e.childNodes.length;if(r&&n.top<n.bottom)for(var i=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-n.top)/(n.bottom-n.top))-2)),o=i;;){var s=e.childNodes[o];if(s.nodeType==1)for(var a=s.getClientRects(),l=0;l<a.length;l++){var c=a[l];if(Ra(t,c))return gf(s,t,c)}if((o=(o+1)%r)==i)break}return e}function og(e,t){var n,r,i=e.dom.ownerDocument,o,s;if(i.caretPositionFromPoint)try{var a=i.caretPositionFromPoint(t.left,t.top);a&&(n=a,o=n.offsetNode,s=n.offset)}catch{}if(!o&&i.caretRangeFromPoint){var l=i.caretRangeFromPoint(t.left,t.top);l&&(r=l,o=r.startContainer,s=r.startOffset)}var c=(e.root.elementFromPoint?e.root:i).elementFromPoint(t.left,t.top+1),f;if(!c||!e.dom.contains(c.nodeType!=1?c.parentNode:c)){var u=e.dom.getBoundingClientRect();if(!Ra(t,u)||(c=gf(e.dom,t,u),!c))return null}if(V.safari)for(var d=c;o&&d;d=Da(d))d.draggable&&(o=s=null);if(c=ng(c,t),o){if(V.gecko&&o.nodeType==1&&(s=Math.min(s,o.childNodes.length),s<o.childNodes.length)){var p=o.childNodes[s],g;p.nodeName=="IMG"&&(g=p.getBoundingClientRect()).right<=t.left&&g.bottom>t.top&&s++}o==e.dom&&s==o.childNodes.length-1&&o.lastChild.nodeType==1&&t.top>o.lastChild.getBoundingClientRect().bottom?f=e.state.doc.content.size:(s==0||o.nodeType!=1||o.childNodes[s-1].nodeName!="BR")&&(f=ig(e,o,s,t))}f==null&&(f=rg(e,c,t));var y=e.docView.nearestDesc(c,!0);return{pos:f,inside:y?y.posAtStart-y.border:-1}}function hn(e,t){var n=e.getClientRects();return n.length?n[t<0?0:n.length-1]:e.getBoundingClientRect()}var sg=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function mf(e,t,n){var r=e.docView.domFromPos(t,n<0?-1:1),i=r.node,o=r.offset,s=V.webkit||V.gecko;if(i.nodeType==3)if(s&&(sg.test(i.nodeValue)||(n<0?!o:o==i.nodeValue.length))){var a=hn(Ke(i,o,o),n);if(V.gecko&&o&&/\s/.test(i.nodeValue[o-1])&&o<i.nodeValue.length){var l=hn(Ke(i,o-1,o-1),-1);if(l.top==a.top){var c=hn(Ke(i,o,o+1),-1);if(c.top!=a.top)return Br(c,c.left<l.left)}}return a}else{var f=o,u=o,d=n<0?1:-1;return n<0&&!o?(u++,d=-1):n>=0&&o==i.nodeValue.length?(f--,d=1):n<0?f--:u++,Br(hn(Ke(i,f,u),d),d<0)}if(!e.state.doc.resolve(t).parent.inlineContent){if(o&&(n<0||o==Fe(i))){var p=i.childNodes[o-1];if(p.nodeType==1)return fs(p.getBoundingClientRect(),!1)}if(o<Fe(i)){var g=i.childNodes[o];if(g.nodeType==1)return fs(g.getBoundingClientRect(),!0)}return fs(i.getBoundingClientRect(),n>=0)}if(o&&(n<0||o==Fe(i))){var y=i.childNodes[o-1],w=y.nodeType==3?Ke(y,Fe(y)-(s?0:1)):y.nodeType==1&&(y.nodeName!="BR"||!y.nextSibling)?y:null;if(w)return Br(hn(w,1),!1)}if(o<Fe(i)){for(var E=i.childNodes[o];E.pmViewDesc&&E.pmViewDesc.ignoreForCoords;)E=E.nextSibling;var _=E?E.nodeType==3?Ke(E,0,s?0:1):E.nodeType==1?E:null:null;if(_)return Br(hn(_,-1),!0)}return Br(hn(i.nodeType==3?Ke(i):i,-n),n>=0)}function Br(e,t){if(e.width==0)return e;var n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function fs(e,t){if(e.height==0)return e;var n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function yf(e,t,n){var r=e.state,i=e.root.activeElement;r!=t&&e.updateState(t),i!=e.dom&&e.focus();try{return n()}finally{r!=t&&e.updateState(r),i!=e.dom&&i&&i.focus()}}function ag(e,t,n){var r=t.selection,i=n=="up"?r.$from:r.$to;return yf(e,t,function(){for(var o=e.docView.domFromPos(i.pos,n=="up"?-1:1),s=o.node;;){var a=e.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}for(var l=mf(e,i.pos,1),c=s.firstChild;c;c=c.nextSibling){var f=void 0;if(c.nodeType==1)f=c.getClientRects();else if(c.nodeType==3)f=Ke(c,0,c.nodeValue.length).getClientRects();else continue;for(var u=0;u<f.length;u++){var d=f[u];if(d.bottom>d.top+1&&(n=="up"?l.top-d.top>(d.bottom-l.top)*2:d.bottom-l.bottom>(l.bottom-d.top)*2))return!1}}return!0})}var lg=/[\u0590-\u08ac]/;function cg(e,t,n){var r=t.selection,i=r.$head;if(!i.parent.isTextblock)return!1;var o=i.parentOffset,s=!o,a=o==i.parent.content.size,l=e.root.getSelection();return!lg.test(i.parent.textContent)||!l.modify?n=="left"||n=="backward"?s:a:yf(e,t,function(){var c=l.getRangeAt(0),f=l.focusNode,u=l.focusOffset,d=l.caretBidiLevel;l.modify("move",n,"character");var p=i.depth?e.docView.domAfterPos(i.before()):e.dom,g=!p.contains(l.focusNode.nodeType==1?l.focusNode:l.focusNode.parentNode)||f==l.focusNode&&u==l.focusOffset;return l.removeAllRanges(),l.addRange(c),d!=null&&(l.caretBidiLevel=d),g})}var Zl=null,Ql=null,tc=!1;function ug(e,t,n){return Zl==t&&Ql==n?tc:(Zl=t,Ql=n,tc=n=="up"||n=="down"?ag(e,t,n):cg(e,t,n))}var xe=0,vf=1,Hr=2,Qe=3,dt=function(t,n,r,i){this.parent=t,this.children=n,this.dom=r,r.pmViewDesc=this,this.contentDOM=i,this.dirty=xe},qe={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};dt.prototype.matchesWidget=function(){return!1};dt.prototype.matchesMark=function(){return!1};dt.prototype.matchesNode=function(){return!1};dt.prototype.matchesHack=function(t){return!1};dt.prototype.parseRule=function(){return null};dt.prototype.stopEvent=function(){return!1};qe.size.get=function(){for(var e=0,t=0;t<this.children.length;t++)e+=this.children[t].size;return e};qe.border.get=function(){return 0};dt.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var t=0;t<this.children.length;t++)this.children[t].destroy()};dt.prototype.posBeforeChild=function(t){for(var n=0,r=this.posAtStart;n<this.children.length;n++){var i=this.children[n];if(i==t)return r;r+=i.size}};qe.posBefore.get=function(){return this.parent.posBeforeChild(this)};qe.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};qe.posAfter.get=function(){return this.posBefore+this.size};qe.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};dt.prototype.localPosFromDOM=function(t,n,r){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(r<0){var i,o;if(t==this.contentDOM)i=t.childNodes[n-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;i=t.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{var s,a;if(t==this.contentDOM)s=t.childNodes[n];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;s=t.nextSibling}for(;s&&!((a=s.pmViewDesc)&&a.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(a):this.posAtEnd}var l;if(t==this.dom&&this.contentDOM)l=n>ce(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))l=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(var c=t;;c=c.parentNode){if(c==this.dom){l=!1;break}if(c.parentNode.firstChild!=c)break}if(l==null&&n==t.childNodes.length)for(var f=t;;f=f.parentNode){if(f==this.dom){l=!0;break}if(f.parentNode.lastChild!=f)break}}return(l==null?r>0:l)?this.posAtEnd:this.posAtStart};dt.prototype.nearestDesc=function(t,n){for(var r=!0,i=t;i;i=i.parentNode){var o=this.getDesc(i);if(o&&(!n||o.node))if(r&&o.nodeDOM&&!(o.nodeDOM.nodeType==1?o.nodeDOM.contains(t.nodeType==1?t:t.parentNode):o.nodeDOM==t))r=!1;else return o}};dt.prototype.getDesc=function(t){for(var n=t.pmViewDesc,r=n;r;r=r.parent)if(r==this)return n};dt.prototype.posFromDOM=function(t,n,r){for(var i=t;i;i=i.parentNode){var o=this.getDesc(i);if(o)return o.localPosFromDOM(t,n,r)}return-1};dt.prototype.descAt=function(t){for(var n=0,r=0;n<this.children.length;n++){var i=this.children[n],o=r+i.size;if(r==t&&o!=r){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(t<o)return i.descAt(t-r-i.border);r=o}};dt.prototype.domFromPos=function(t,n){if(!this.contentDOM)return{node:this.dom,offset:0};for(var r=0,i=0,o=0;r<this.children.length;r++){var s=this.children[r],a=o+s.size;if(a>t||s instanceof _f){i=t-o;break}o=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(var l=void 0;r&&!(l=this.children[r-1]).size&&l instanceof bf&&l.widget.type.side>=0;r--);if(n<=0){for(var c,f=!0;c=r?this.children[r-1]:null,!(!c||c.dom.parentNode==this.contentDOM);r--,f=!1);return c&&n&&f&&!c.border&&!c.domAtom?c.domFromPos(c.size,n):{node:this.contentDOM,offset:c?ce(c.dom)+1:0}}else{for(var u,d=!0;u=r<this.children.length?this.children[r]:null,!(!u||u.dom.parentNode==this.contentDOM);r++,d=!1);return u&&d&&!u.border&&!u.domAtom?u.domFromPos(0,n):{node:this.contentDOM,offset:u?ce(u.dom):this.contentDOM.childNodes.length}}};dt.prototype.parseRange=function(t,n,r){if(r===void 0&&(r=0),this.children.length==0)return{node:this.contentDOM,from:t,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var i=-1,o=-1,s=r,a=0;;a++){var l=this.children[a],c=s+l.size;if(i==-1&&t<=c){var f=s+l.border;if(t>=f&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(t,n,f);t=s;for(var u=a;u>0;u--){var d=this.children[u-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){i=ce(d.dom)+1;break}t-=d.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(var p=a+1;p<this.children.length;p++){var g=this.children[p];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(-1)){o=ce(g.dom);break}n+=g.size}o==-1&&(o=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:t,to:n,fromOffset:i,toOffset:o}};dt.prototype.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var n=this.children[t<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(t)};dt.prototype.domAfterPos=function(t){var n=this.domFromPos(t,0),r=n.node,i=n.offset;if(r.nodeType!=1||i==r.childNodes.length)throw new RangeError("No node after pos "+t);return r.childNodes[i]};dt.prototype.setSelection=function(t,n,r,i){for(var o=Math.min(t,n),s=Math.max(t,n),a=0,l=0;a<this.children.length;a++){var c=this.children[a],f=l+c.size;if(o>l&&s<f)return c.setSelection(t-l-c.border,n-l-c.border,r,i);l=f}var u=this.domFromPos(t,t?-1:1),d=n==t?u:this.domFromPos(n,n?-1:1),p=r.getSelection(),g=!1;if((V.gecko||V.safari)&&t==n){var y=u.node,w=u.offset;if(y.nodeType==3){if(g=w&&y.nodeValue[w-1]==`
`,g&&w==y.nodeValue.length)for(var E=y,_=void 0;E;E=E.parentNode){if(_=E.nextSibling){_.nodeName=="BR"&&(u=d={node:_.parentNode,offset:ce(_)+1});break}var b=E.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{var k=y.childNodes[w-1];g=k&&(k.nodeName=="BR"||k.contentEditable=="false")}}if(V.gecko&&p.focusNode&&p.focusNode!=d.node&&p.focusNode.nodeType==1){var S=p.focusNode.childNodes[p.focusOffset];S&&S.contentEditable=="false"&&(i=!0)}if(!(!(i||g&&V.safari)&&ei(u.node,u.offset,p.anchorNode,p.anchorOffset)&&ei(d.node,d.offset,p.focusNode,p.focusOffset))){var x=!1;if((p.extend||t==n)&&!g){p.collapse(u.node,u.offset);try{t!=n&&p.extend(d.node,d.offset),x=!0}catch(P){if(!(P instanceof DOMException))throw P}}if(!x){if(t>n){var M=u;u=d,d=M}var A=document.createRange();A.setEnd(d.node,d.offset),A.setStart(u.node,u.offset),p.removeAllRanges(),p.addRange(A)}}};dt.prototype.ignoreMutation=function(t){return!this.contentDOM&&t.type!="selection"};qe.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};dt.prototype.markDirty=function(t,n){for(var r=0,i=0;i<this.children.length;i++){var o=this.children[i],s=r+o.size;if(r==s?t<=s&&n>=r:t<s&&n>r){var a=r+o.border,l=s-o.border;if(t>=a&&n<=l){this.dirty=t==r||n==s?Hr:vf,t==a&&n==l&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=Qe:o.markDirty(t-a,n-a);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?Hr:Qe}r=s}this.dirty=Hr};dt.prototype.markParentsDirty=function(){for(var t=1,n=this.parent;n;n=n.parent,t++){var r=t==1?Hr:vf;n.dirty<r&&(n.dirty=r)}};qe.domAtom.get=function(){return!1};qe.ignoreForCoords.get=function(){return!1};Object.defineProperties(dt.prototype,qe);var kn=[],bf=function(e){function t(r,i,o,s){var a,l=i.type.toDOM;if(typeof l=="function"&&(l=l(o,function(){if(!a)return s;if(a.parent)return a.parent.posBeforeChild(a)})),!i.type.spec.raw){if(l.nodeType!=1){var c=document.createElement("span");c.appendChild(l),l=c}l.contentEditable=!1,l.classList.add("ProseMirror-widget")}e.call(this,r,kn,l,null),this.widget=i,a=this}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={domAtom:{configurable:!0}};return t.prototype.matchesWidget=function(i){return this.dirty==xe&&i.type.eq(this.widget.type)},t.prototype.parseRule=function(){return{ignore:!0}},t.prototype.stopEvent=function(i){var o=this.widget.spec.stopEvent;return o?o(i):!1},t.prototype.ignoreMutation=function(i){return i.type!="selection"||this.widget.spec.ignoreSelection},t.prototype.destroy=function(){this.widget.type.destroy(this.dom),e.prototype.destroy.call(this)},n.domAtom.get=function(){return!0},Object.defineProperties(t.prototype,n),t}(dt),fg=function(e){function t(r,i,o,s){e.call(this,r,kn,i,null),this.textDOM=o,this.text=s}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={size:{configurable:!0}};return n.size.get=function(){return this.text.length},t.prototype.localPosFromDOM=function(i,o){return i!=this.textDOM?this.posAtStart+(o?this.size:0):this.posAtStart+o},t.prototype.domFromPos=function(i){return{node:this.textDOM,offset:i}},t.prototype.ignoreMutation=function(i){return i.type==="characterData"&&i.target.nodeValue==i.oldValue},Object.defineProperties(t.prototype,n),t}(dt),Do=function(e){function t(n,r,i,o){e.call(this,n,[],i,o),this.mark=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.create=function(r,i,o,s){var a=s.nodeViews[i.type.name],l=a&&a(i,s,o);return(!l||!l.dom)&&(l=zt.renderSpec(document,i.type.spec.toDOM(i,o))),new t(r,i,l.dom,l.contentDOM||l.dom)},t.prototype.parseRule=function(){return this.dirty&Qe||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},t.prototype.matchesMark=function(r){return this.dirty!=Qe&&this.mark.eq(r)},t.prototype.markDirty=function(r,i){if(e.prototype.markDirty.call(this,r,i),this.dirty!=xe){for(var o=this.parent;!o.node;)o=o.parent;o.dirty<this.dirty&&(o.dirty=this.dirty),this.dirty=xe}},t.prototype.slice=function(r,i,o){var s=t.create(this.parent,this.mark,!0,o),a=this.children,l=this.size;i<l&&(a=Ys(a,i,l,o)),r>0&&(a=Ys(a,0,r,o));for(var c=0;c<a.length;c++)a[c].parent=s;return s.children=a,s},t}(dt),ki=function(e){function t(r,i,o,s,a,l,c,f,u){e.call(this,r,i.isLeaf?kn:[],a,l),this.nodeDOM=c,this.node=i,this.outerDeco=o,this.innerDeco=s,l&&this.updateChildren(f,u)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return t.create=function(i,o,s,a,l,c){var f,u=l.nodeViews[o.type.name],d,p=u&&u(o,l,function(){if(!d)return c;if(d.parent)return d.parent.posBeforeChild(d)},s,a),g=p&&p.dom,y=p&&p.contentDOM;if(o.isText){if(!g)g=document.createTextNode(o.text);else if(g.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else g||(f=zt.renderSpec(document,o.type.spec.toDOM(o)),g=f.dom,y=f.contentDOM);!y&&!o.isText&&g.nodeName!="BR"&&(g.hasAttribute("contenteditable")||(g.contentEditable=!1),o.type.spec.draggable&&(g.draggable=!0));var w=g;return g=Ef(g,s,o),p?d=new hg(i,o,s,a,g,y,w,p,l,c+1):o.isText?new kf(i,o,s,a,g,w,l):new t(i,o,s,a,g,y,w,l,c+1)},t.prototype.parseRule=function(){var i=this;if(this.node.type.spec.reparseInView)return null;var o={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(o.preserveWhitespace="full"),!this.contentDOM)o.getContent=function(){return i.node.content};else if(!this.contentLost)o.contentElement=this.contentDOM;else{for(var s=this.children.length-1;s>=0;s--){var a=this.children[s];if(this.dom.contains(a.dom.parentNode)){o.contentElement=a.dom.parentNode;break}}o.contentElement||(o.getContent=function(){return B.empty})}return o},t.prototype.matchesNode=function(i,o,s){return this.dirty==xe&&i.eq(this.node)&&Gs(o,this.outerDeco)&&s.eq(this.innerDeco)},n.size.get=function(){return this.node.nodeSize},n.border.get=function(){return this.node.isLeaf?0:1},t.prototype.updateChildren=function(i,o){var s=this,a=this.node.inlineContent,l=o,c=i.composing&&this.localCompositionInfo(i,o),f=c&&c.pos>-1?c:null,u=c&&c.pos<0,d=new _e(this,f&&f.node);mg(this.node,this.innerDeco,function(p,g,y){p.spec.marks?d.syncToMarks(p.spec.marks,a,i):p.type.side>=0&&!y&&d.syncToMarks(g==s.node.childCount?at.none:s.node.child(g).marks,a,i),d.placeWidget(p,i,l)},function(p,g,y,w){d.syncToMarks(p.marks,a,i);var E;d.findNodeMatch(p,g,y,w)||u&&i.state.selection.from>l&&i.state.selection.to<l+p.nodeSize&&(E=d.findIndexWithChild(c.node))>-1&&d.updateNodeAt(p,g,y,E,i)||d.updateNextNode(p,g,y,i,w)||d.addNode(p,g,y,i,l),l+=p.nodeSize}),d.syncToMarks(kn,a,i),this.node.isTextblock&&d.addTextblockHacks(),d.destroyRest(),(d.changed||this.dirty==Hr)&&(f&&this.protectLocalComposition(i,f),Sf(this.contentDOM,this.children,i),V.ios&&yg(this.dom))},t.prototype.localCompositionInfo=function(i,o){var s=i.state.selection,a=s.from,l=s.to;if(!(!(i.state.selection instanceof rt)||a<o||l>o+this.node.content.size)){var c=i.root.getSelection(),f=vg(c.focusNode,c.focusOffset);if(!(!f||!this.dom.contains(f.parentNode)))if(this.node.inlineContent){var u=f.nodeValue,d=bg(this.node.content,u,a-o,l-o);return d<0?null:{node:f,pos:d,text:u}}else return{node:f,pos:-1}}},t.prototype.protectLocalComposition=function(i,o){var s=o.node,a=o.pos,l=o.text;if(!this.getDesc(s)){for(var c=s;c.parentNode!=this.contentDOM;c=c.parentNode){for(;c.previousSibling;)c.parentNode.removeChild(c.previousSibling);for(;c.nextSibling;)c.parentNode.removeChild(c.nextSibling);c.pmViewDesc&&(c.pmViewDesc=null)}var f=new fg(this,c,s,l);i.compositionNodes.push(f),this.children=Ys(this.children,a,a+l.length,i,f)}},t.prototype.update=function(i,o,s,a){return this.dirty==Qe||!i.sameMarkup(this.node)?!1:(this.updateInner(i,o,s,a),!0)},t.prototype.updateInner=function(i,o,s,a){this.updateOuterDeco(o),this.node=i,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=xe},t.prototype.updateOuterDeco=function(i){if(!Gs(i,this.outerDeco)){var o=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=Cf(this.dom,this.nodeDOM,Ks(this.outerDeco,this.node,o),Ks(i,this.node,o)),this.dom!=s&&(s.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=i}},t.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},t.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},n.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(t.prototype,n),t}(dt);function wf(e,t,n,r,i){return Ef(r,t,e),new ki(null,e,t,n,r,r,r,i,0)}var kf=function(e){function t(r,i,o,s,a,l,c){e.call(this,r,i,o,s,a,null,l,c)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={domAtom:{configurable:!0}};return t.prototype.parseRule=function(){for(var i=this.nodeDOM.parentNode;i&&i!=this.dom&&!i.pmIsDeco;)i=i.parentNode;return{skip:i||!0}},t.prototype.update=function(i,o,s,a){return this.dirty==Qe||this.dirty!=xe&&!this.inParent()||!i.sameMarkup(this.node)?!1:(this.updateOuterDeco(o),(this.dirty!=xe||i.text!=this.node.text)&&i.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=i.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=i,this.dirty=xe,!0)},t.prototype.inParent=function(){for(var i=this.parent.contentDOM,o=this.nodeDOM;o;o=o.parentNode)if(o==i)return!0;return!1},t.prototype.domFromPos=function(i){return{node:this.nodeDOM,offset:i}},t.prototype.localPosFromDOM=function(i,o,s){return i==this.nodeDOM?this.posAtStart+Math.min(o,this.node.text.length):e.prototype.localPosFromDOM.call(this,i,o,s)},t.prototype.ignoreMutation=function(i){return i.type!="characterData"&&i.type!="selection"},t.prototype.slice=function(i,o,s){var a=this.node.cut(i,o),l=document.createTextNode(a.text);return new t(this.parent,a,this.outerDeco,this.innerDeco,l,l,s)},t.prototype.markDirty=function(i,o){e.prototype.markDirty.call(this,i,o),this.dom!=this.nodeDOM&&(i==0||o==this.nodeDOM.nodeValue.length)&&(this.dirty=Qe)},n.domAtom.get=function(){return!1},Object.defineProperties(t.prototype,n),t}(ki),_f=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return t.prototype.parseRule=function(){return{ignore:!0}},t.prototype.matchesHack=function(i){return this.dirty==xe&&this.dom.nodeName==i},n.domAtom.get=function(){return!0},n.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(t.prototype,n),t}(dt),hg=function(e){function t(n,r,i,o,s,a,l,c,f,u){e.call(this,n,r,i,o,s,a,l,f,u),this.spec=c}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(r,i,o,s){if(this.dirty==Qe)return!1;if(this.spec.update){var a=this.spec.update(r,i,o);return a&&this.updateInner(r,i,o,s),a}else return!this.contentDOM&&!r.isLeaf?!1:e.prototype.update.call(this,r,i,o,s)},t.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():e.prototype.selectNode.call(this)},t.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():e.prototype.deselectNode.call(this)},t.prototype.setSelection=function(r,i,o,s){this.spec.setSelection?this.spec.setSelection(r,i,o):e.prototype.setSelection.call(this,r,i,o,s)},t.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),e.prototype.destroy.call(this)},t.prototype.stopEvent=function(r){return this.spec.stopEvent?this.spec.stopEvent(r):!1},t.prototype.ignoreMutation=function(r){return this.spec.ignoreMutation?this.spec.ignoreMutation(r):e.prototype.ignoreMutation.call(this,r)},t}(ki);function Sf(e,t,n){for(var r=e.firstChild,i=!1,o=0;o<t.length;o++){var s=t[o],a=s.dom;if(a.parentNode==e){for(;a!=r;)r=ec(r),i=!0;r=r.nextSibling}else i=!0,e.insertBefore(a,r);if(s instanceof Do){var l=r?r.previousSibling:e.lastChild;Sf(s.contentDOM,s.children,n),r=l?l.nextSibling:e.firstChild}}for(;r;)r=ec(r),i=!0;i&&n.trackWrites==e&&(n.trackWrites=null)}function qr(e){e&&(this.nodeName=e)}qr.prototype=Object.create(null);var Rn=[new qr];function Ks(e,t,n){if(e.length==0)return Rn;for(var r=n?Rn[0]:new qr,i=[r],o=0;o<e.length;o++){var s=e[o].type.attrs;if(!!s){s.nodeName&&i.push(r=new qr(s.nodeName));for(var a in s){var l=s[a];l!=null&&(n&&i.length==1&&i.push(r=new qr(t.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function Cf(e,t,n,r){if(n==Rn&&r==Rn)return t;for(var i=t,o=0;o<r.length;o++){var s=r[o],a=n[o];if(o){var l=void 0;a&&a.nodeName==s.nodeName&&i!=e&&(l=i.parentNode)&&l.tagName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Rn[0]),i=l}dg(i,a||Rn[0],s)}return i}function dg(e,t,n){for(var r in t)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&e.removeAttribute(r);for(var i in n)i!="class"&&i!="style"&&i!="nodeName"&&n[i]!=t[i]&&e.setAttribute(i,n[i]);if(t.class!=n.class){for(var o=t.class?t.class.split(" ").filter(Boolean):kn,s=n.class?n.class.split(" ").filter(Boolean):kn,a=0;a<o.length;a++)s.indexOf(o[a])==-1&&e.classList.remove(o[a]);for(var l=0;l<s.length;l++)o.indexOf(s[l])==-1&&e.classList.add(s[l]);e.classList.length==0&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style)for(var c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,f;f=c.exec(t.style);)e.style.removeProperty(f[1]);n.style&&(e.style.cssText+=n.style)}}function Ef(e,t,n){return Cf(e,e,Rn,Ks(t,n,e.nodeType!=1))}function Gs(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function ec(e){var t=e.nextSibling;return e.parentNode.removeChild(e),t}var _e=function(t,n){this.top=t,this.lock=n,this.index=0,this.stack=[],this.changed=!1,this.preMatch=pg(t.node.content,t)};_e.prototype.destroyBetween=function(t,n){if(t!=n){for(var r=t;r<n;r++)this.top.children[r].destroy();this.top.children.splice(t,n-t),this.changed=!0}};_e.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};_e.prototype.syncToMarks=function(t,n,r){for(var i=0,o=this.stack.length>>1,s=Math.min(o,t.length);i<s&&(i==o-1?this.top:this.stack[i+1<<1]).matchesMark(t[i])&&t[i].type.spec.spanning!==!1;)i++;for(;i<o;)this.destroyRest(),this.top.dirty=xe,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);for(var a=-1,l=this.index;l<Math.min(this.index+3,this.top.children.length);l++)if(this.top.children[l].matchesMark(t[o])){a=l;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{var c=Do.create(this.top,t[o],n,r);this.top.children.splice(this.index,0,c),this.top=c,this.changed=!0}this.index=0,o++}};_e.prototype.findNodeMatch=function(t,n,r,i){var o=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(t,n,r))o=this.top.children.indexOf(s,this.index);else for(var a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){var c=this.top.children[a];if(c.matchesNode(t,n,r)&&!this.preMatch.matched.has(c)){o=a;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)};_e.prototype.updateNodeAt=function(t,n,r,i,o){var s=this.top.children[i];return s.update(t,n,r,o)?(this.destroyBetween(this.index,i),this.index=i+1,!0):!1};_e.prototype.findIndexWithChild=function(t){for(;;){var n=t.parentNode;if(!n)return-1;if(n==this.top.contentDOM){var r=t.pmViewDesc;if(r){for(var i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}t=n}};_e.prototype.updateNextNode=function(t,n,r,i,o){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof ki){var l=this.preMatch.matched.get(a);if(l!=null&&l!=o)return!1;var c=a.dom,f=this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&a.dirty!=Qe&&Gs(n,a.outerDeco));if(!f&&a.update(t,n,r,i))return this.destroyBetween(this.index,s),a.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1};_e.prototype.addNode=function(t,n,r,i,o){this.top.children.splice(this.index++,0,ki.create(this.top,t,n,r,i,o)),this.changed=!0};_e.prototype.placeWidget=function(t,n,r){var i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(t)&&(t==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{var o=new bf(this.top,t,n,r);this.top.children.splice(this.index++,0,o),this.changed=!0}};_e.prototype.addTextblockHacks=function(){for(var t=this.top.children[this.index-1],n=this.top;t instanceof Do;)n=t,t=n.children[n.children.length-1];(!t||!(t instanceof kf)||/\n$/.test(t.node.text))&&((V.safari||V.chrome)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))};_e.prototype.addHackNode=function(t,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(t))this.index++;else{var r=document.createElement(t);t=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),t=="BR"&&(r.className="ProseMirror-trailingBreak");var i=new _f(this.top,kn,r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}};function pg(e,t){var n=t,r=n.children.length,i=e.childCount,o=new Map,s=[];t:for(;i>0;){for(var a=void 0;;)if(r){var l=n.children[r-1];if(l instanceof Do)n=l,r=l.children.length;else{a=l,r--;break}}else{if(n==t)break t;r=n.parent.children.indexOf(n),n=n.parent}var c=a.node;if(!!c){if(c!=e.child(i-1))break;--i,o.set(a,i),s.push(a)}}return{index:i,matched:o,matches:s.reverse()}}function gg(e,t){return e.type.side-t.type.side}function mg(e,t,n,r){var i=t.locals(e),o=0;if(i.length==0){for(var s=0;s<e.childCount;s++){var a=e.child(s);r(a,i,t.forChild(o,a),s),o+=a.nodeSize}return}for(var l=0,c=[],f=null,u=0;;){if(l<i.length&&i[l].to==o){for(var d=i[l++],p=void 0;l<i.length&&i[l].to==o;)(p||(p=[d])).push(i[l++]);if(p){p.sort(gg);for(var g=0;g<p.length;g++)n(p[g],u,!!f)}else n(d,u,!!f)}var y=void 0,w=void 0;if(f)w=-1,y=f,f=null;else if(u<e.childCount)w=u,y=e.child(u++);else break;for(var E=0;E<c.length;E++)c[E].to<=o&&c.splice(E--,1);for(;l<i.length&&i[l].from<=o&&i[l].to>o;)c.push(i[l++]);var _=o+y.nodeSize;if(y.isText){var b=_;l<i.length&&i[l].from<b&&(b=i[l].from);for(var k=0;k<c.length;k++)c[k].to<b&&(b=c[k].to);b<_&&(f=y.cut(b-o),y=y.cut(0,b-o),_=b,w=-1)}var S=c.length?y.isInline&&!y.isLeaf?c.filter(function(x){return!x.inline}):c.slice():kn;r(y,S,t.forChild(o,y),w),o=_}}function yg(e){if(e.nodeName=="UL"||e.nodeName=="OL"){var t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}function vg(e,t){for(;;){if(e.nodeType==3)return e;if(e.nodeType==1&&t>0){if(e.childNodes.length>t&&e.childNodes[t].nodeType==3)return e.childNodes[t];e=e.childNodes[t-1],t=Fe(e)}else if(e.nodeType==1&&t<e.childNodes.length)e=e.childNodes[t],t=0;else return null}}function bg(e,t,n,r){for(var i=0,o=0;i<e.childCount&&o<=r;){var s=e.child(i++),a=o;if(o+=s.nodeSize,!!s.isText){for(var l=s.text;i<e.childCount;){var c=e.child(i++);if(o+=c.nodeSize,!c.isText)break;l+=c.text}if(o>=n){var f=a<r?l.lastIndexOf(t,r-a-1):-1;if(f>=0&&f+t.length+a>=n)return a+f;if(n==r&&l.length>=r+t.length-a&&l.slice(r-a,r-a+t.length)==t)return r}}}return-1}function Ys(e,t,n,r,i){for(var o=[],s=0,a=0;s<e.length;s++){var l=e[s],c=a,f=a+=l.size;c>=n||f<=t?o.push(l):(c<t&&o.push(l.slice(0,t-c,r)),i&&(o.push(i),i=null),f>n&&o.push(l.slice(n-c,l.size,r)))}return o}function Mf(e,t){var n=e.root.getSelection(),r=e.state.doc;if(!n.focusNode)return null;var i=e.docView.nearestDesc(n.focusNode),o=i&&i.size==0,s=e.docView.posFromDOM(n.focusNode,n.focusOffset);if(s<0)return null;var a=r.resolve(s),l,c;if(Na(n)){for(l=a;i&&!i.node;)i=i.parent;if(i&&i.node.isAtom&&et.isSelectable(i.node)&&i.parent&&!(i.node.isInline&&Kp(n.focusNode,n.focusOffset,i.dom))){var f=i.posBefore;c=new et(s==f?a:r.resolve(f))}}else{var u=e.docView.posFromDOM(n.anchorNode,n.anchorOffset);if(u<0)return null;l=r.resolve(u)}if(!c){var d=t=="pointer"||e.state.selection.head<a.pos&&!o?1:-1;c=Ia(e,l,a,d)}return c}function Tf(e){return e.editable?e.hasFocus():Af(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function En(e,t){var n=e.state.selection;if(Of(e,n),!!Tf(e)){if(!t&&e.mouseDown&&e.mouseDown.allowDefault&&V.chrome){var r=e.root.getSelection(),i=e.domObserver.currentSelection;if(r.anchorNode&&ei(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){e.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)kg(e);else{var o=n.anchor,s=n.head,a,l;nc&&!(n instanceof rt)&&(n.$from.parent.inlineContent||(a=rc(e,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(l=rc(e,n.to))),e.docView.setSelection(o,s,e.root,t),nc&&(a&&ic(a),l&&ic(l)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&wg(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}var nc=V.safari||V.chrome&&V.chrome_version<63;function rc(e,t){var n=e.docView.domFromPos(t,0),r=n.node,i=n.offset,o=i<r.childNodes.length?r.childNodes[i]:null,s=i?r.childNodes[i-1]:null;if(V.safari&&o&&o.contentEditable=="false")return hs(o);if((!o||o.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(o)return hs(o);if(s)return hs(s)}}function hs(e){return e.contentEditable="true",V.safari&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function ic(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function wg(e){var t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.hideSelectionGuard);var n=e.root.getSelection(),r=n.anchorNode,i=n.anchorOffset;t.addEventListener("selectionchange",e.hideSelectionGuard=function(){(n.anchorNode!=r||n.anchorOffset!=i)&&(t.removeEventListener("selectionchange",e.hideSelectionGuard),setTimeout(function(){(!Tf(e)||e.state.selection.visible)&&e.dom.classList.remove("ProseMirror-hideselection")},20))})}function kg(e){var t=e.root.getSelection(),n=document.createRange(),r=e.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setEnd(r.parentNode,ce(r)+1):n.setEnd(r,0),n.collapse(!1),t.removeAllRanges(),t.addRange(n),!i&&!e.state.selection.visible&&V.ie&&V.ie_version<=11&&(r.disabled=!0,r.disabled=!1)}function Of(e,t){if(t instanceof et){var n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(oc(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else oc(e)}function oc(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=null)}function Ia(e,t,n,r){return e.someProp("createSelectionBetween",function(i){return i(e,t,n)})||rt.between(t,n,r)}function xf(e){return e.editable&&e.root.activeElement!=e.dom?!1:Af(e)}function Af(e){var t=e.root.getSelection();if(!t.anchorNode)return!1;try{return e.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function _g(e){var t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.root.getSelection();return ei(t.node,t.offset,n.anchorNode,n.anchorOffset)}function Xs(e,t){var n=e.selection,r=n.$anchor,i=n.$head,o=t>0?r.max(i):r.min(i),s=o.parent.inlineContent?o.depth?e.doc.resolve(t>0?o.after():o.before()):null:o;return s&&tt.findFrom(s,t)}function Nn(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function sc(e,t,n){var r=e.state.selection;if(r instanceof rt){if(!r.empty||n.indexOf("s")>-1)return!1;if(e.endOfTextblock(t>0?"right":"left")){var i=Xs(e.state,t);return i&&i instanceof et?Nn(e,i):!1}else if(!(V.mac&&n.indexOf("m")>-1)){var o=r.$head,s=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter,a;if(!s||s.isText)return!1;var l=t<0?o.pos-s.nodeSize:o.pos;return s.isAtom||(a=e.docView.descAt(l))&&!a.contentDOM?et.isSelectable(s)?Nn(e,new et(t<0?e.state.doc.resolve(o.pos-s.nodeSize):o)):V.webkit?Nn(e,new rt(e.state.doc.resolve(t<0?l:l+s.nodeSize))):!1:!1}}else{if(r instanceof et&&r.node.isInline)return Nn(e,new rt(t>0?r.$to:r.$from));var c=Xs(e.state,t);return c?Nn(e,c):!1}}function no(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function Wr(e){var t=e.pmViewDesc;return t&&t.size==0&&(e.nextSibling||e.nodeName!="BR")}function ds(e){var t=e.root.getSelection(),n=t.focusNode,r=t.focusOffset;if(!!n){var i,o,s=!1;for(V.gecko&&n.nodeType==1&&r<no(n)&&Wr(n.childNodes[r])&&(s=!0);;)if(r>0){if(n.nodeType!=1)break;var a=n.childNodes[r-1];if(Wr(a))i=n,o=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}else{if(Df(n))break;for(var l=n.previousSibling;l&&Wr(l);)i=n.parentNode,o=ce(l),l=l.previousSibling;if(l)n=l,r=no(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}s?Zs(e,t,n,r):i&&Zs(e,t,i,o)}}function ps(e){var t=e.root.getSelection(),n=t.focusNode,r=t.focusOffset;if(!!n){for(var i=no(n),o,s;;)if(r<i){if(n.nodeType!=1)break;var a=n.childNodes[r];if(Wr(a))o=n,s=++r;else break}else{if(Df(n))break;for(var l=n.nextSibling;l&&Wr(l);)o=l.parentNode,s=ce(l)+1,l=l.nextSibling;if(l)n=l,r=0,i=no(n);else{if(n=n.parentNode,n==e.dom)break;r=i=0}}o&&Zs(e,t,o,s)}}function Df(e){var t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Zs(e,t,n,r){if(Na(t)){var i=document.createRange();i.setEnd(n,r),i.setStart(n,r),t.removeAllRanges(),t.addRange(i)}else t.extend&&t.extend(n,r);e.domObserver.setCurSelection();var o=e.state;setTimeout(function(){e.state==o&&En(e)},50)}function ac(e,t,n){var r=e.state.selection;if(r instanceof rt&&!r.empty||n.indexOf("s")>-1||V.mac&&n.indexOf("m")>-1)return!1;var i=r.$from,o=r.$to;if(!i.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){var s=Xs(e.state,t);if(s&&s instanceof et)return Nn(e,s)}if(!i.parent.inlineContent){var a=t<0?i:o,l=r instanceof rn?tt.near(a,t):tt.findFrom(a,t);return l?Nn(e,l):!1}return!1}function lc(e,t){if(!(e.state.selection instanceof rt))return!0;var n=e.state.selection,r=n.$head,i=n.$anchor,o=n.empty;if(!r.sameParent(i))return!0;if(!o)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;var s=!r.textOffset&&(t<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=e.state.tr;return t<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),e.dispatch(a),!0}return!1}function cc(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function Sg(e){if(!(!V.safari||e.state.selection.$head.parentOffset>0)){var t=e.root.getSelection(),n=t.focusNode,r=t.focusOffset;if(n&&n.nodeType==1&&r==0&&n.firstChild&&n.firstChild.contentEditable=="false"){var i=n.firstChild;cc(e,i,!0),setTimeout(function(){return cc(e,i,!1)},20)}}}function Cg(e){var t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}function Eg(e,t){var n=t.keyCode,r=Cg(t);return n==8||V.mac&&n==72&&r=="c"?lc(e,-1)||ds(e):n==46||V.mac&&n==68&&r=="c"?lc(e,1)||ps(e):n==13||n==27?!0:n==37?sc(e,-1,r)||ds(e):n==39?sc(e,1,r)||ps(e):n==38?ac(e,-1,r)||ds(e):n==40?Sg(e)||ac(e,1,r)||ps(e):r==(V.mac?"m":"c")&&(n==66||n==73||n==89||n==90)}function Mg(e,t,n){var r=e.docView.parseRange(t,n),i=r.node,o=r.fromOffset,s=r.toOffset,a=r.from,l=r.to,c=e.root.getSelection(),f=null,u=c.anchorNode;if(u&&e.dom.contains(u.nodeType==1?u:u.parentNode)&&(f=[{node:u,offset:c.anchorOffset}],Na(c)||f.push({node:c.focusNode,offset:c.focusOffset})),V.chrome&&e.lastKeyCode===8)for(var d=s;d>o;d--){var p=i.childNodes[d-1],g=p.pmViewDesc;if(p.nodeName=="BR"&&!g){s=d;break}if(!g||g.size)break}var y=e.state.doc,w=e.someProp("domParser")||Oe.fromSchema(e.state.schema),E=y.resolve(a),_=null,b=w.parse(i,{topNode:E.parent,topMatch:E.parent.contentMatchAt(E.index()),topOpen:!0,from:o,to:s,preserveWhitespace:E.parent.type.whitespace=="pre"?"full":!0,editableContent:!0,findPositions:f,ruleFromNode:Tg,context:E});if(f&&f[0].pos!=null){var k=f[0].pos,S=f[1]&&f[1].pos;S==null&&(S=k),_={anchor:k+a,head:S+a}}return{doc:b,sel:_,from:a,to:l}}function Tg(e){var t=e.pmViewDesc;if(t)return t.parseRule();if(e.nodeName=="BR"&&e.parentNode){if(V.safari&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){var n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(e.parentNode.lastChild==e||V.safari&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if(e.nodeName=="IMG"&&e.getAttribute("mark-placeholder"))return{ignore:!0}}function Og(e,t,n,r,i){if(t<0){var o=e.lastSelectionTime>Date.now()-50?e.lastSelectionOrigin:null,s=Mf(e,o);if(s&&!e.state.selection.eq(s)){var a=e.state.tr.setSelection(s);o=="pointer"?a.setMeta("pointer",!0):o=="key"&&a.scrollIntoView(),e.dispatch(a)}return}var l=e.state.doc.resolve(t),c=l.sharedDepth(n);t=l.before(c+1),n=e.state.doc.resolve(n).after(c+1);var f=e.state.selection,u=Mg(e,t,n);if(V.chrome&&e.cursorWrapper&&u.sel&&u.sel.anchor==e.cursorWrapper.deco.from){var d=e.cursorWrapper.deco.type.toDOM.nextSibling,p=d&&d.nodeValue?d.nodeValue.length:1;u.sel={anchor:u.sel.anchor+p,head:u.sel.anchor+p}}var g=e.state.doc,y=g.slice(u.from,u.to),w,E;e.lastKeyCode===8&&Date.now()-100<e.lastKeyCodeTime?(w=e.state.selection.to,E="end"):(w=e.state.selection.from,E="start"),e.lastKeyCode=null;var _=Dg(y.content,u.doc.content,u.from,w,E);if((V.ios&&e.lastIOSEnter>Date.now()-225||V.android)&&i.some(function(G){return G.nodeName=="DIV"||G.nodeName=="P"})&&(!_||_.endA>=_.endB)&&e.someProp("handleKeyDown",function(G){return G(e,sr(13,"Enter"))})){e.lastIOSEnter=0;return}if(!_)if(r&&f instanceof rt&&!f.empty&&f.$head.sameParent(f.$anchor)&&!e.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))_={start:f.from,endA:f.to,endB:f.to};else{if(u.sel){var b=uc(e,e.state.doc,u.sel);b&&!b.eq(e.state.selection)&&e.dispatch(e.state.tr.setSelection(b))}return}e.domChangeCount++,e.state.selection.from<e.state.selection.to&&_.start==_.endB&&e.state.selection instanceof rt&&(_.start>e.state.selection.from&&_.start<=e.state.selection.from+2&&e.state.selection.from>=u.from?_.start=e.state.selection.from:_.endA<e.state.selection.to&&_.endA>=e.state.selection.to-2&&e.state.selection.to<=u.to&&(_.endB+=e.state.selection.to-_.endA,_.endA=e.state.selection.to)),V.ie&&V.ie_version<=11&&_.endB==_.start+1&&_.endA==_.start&&_.start>u.from&&u.doc.textBetween(_.start-u.from-1,_.start-u.from+1)==" \xA0"&&(_.start--,_.endA--,_.endB--);var k=u.doc.resolveNoCache(_.start-u.from),S=u.doc.resolveNoCache(_.endB-u.from),x=k.sameParent(S)&&k.parent.inlineContent,M;if((V.ios&&e.lastIOSEnter>Date.now()-225&&(!x||i.some(function(G){return G.nodeName=="DIV"||G.nodeName=="P"}))||!x&&k.pos<u.doc.content.size&&(M=tt.findFrom(u.doc.resolve(k.pos+1),1,!0))&&M.head==S.pos)&&e.someProp("handleKeyDown",function(G){return G(e,sr(13,"Enter"))})){e.lastIOSEnter=0;return}if(e.state.selection.anchor>_.start&&Ag(g,_.start,_.endA,k,S)&&e.someProp("handleKeyDown",function(G){return G(e,sr(8,"Backspace"))})){V.android&&V.chrome&&e.domObserver.suppressSelectionUpdates();return}V.chrome&&V.android&&_.toB==_.from&&(e.lastAndroidDelete=Date.now()),V.android&&!x&&k.start()!=S.start()&&S.parentOffset==0&&k.depth==S.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==_.endA&&(_.endB-=2,S=u.doc.resolveNoCache(_.endB-u.from),setTimeout(function(){e.someProp("handleKeyDown",function(G){return G(e,sr(13,"Enter"))})},20));var A=_.start,P=_.endA,O,D,F,j;if(x){if(k.pos==S.pos)V.ie&&V.ie_version<=11&&k.parentOffset==0&&(e.domObserver.suppressSelectionUpdates(),setTimeout(function(){return En(e)},20)),O=e.state.tr.delete(A,P),D=g.resolve(_.start).marksAcross(g.resolve(_.endA));else if(_.endA==_.endB&&(j=g.resolve(_.start))&&(F=xg(k.parent.content.cut(k.parentOffset,S.parentOffset),j.parent.content.cut(j.parentOffset,_.endA-j.start()))))O=e.state.tr,F.type=="add"?O.addMark(A,P,F.mark):O.removeMark(A,P,F.mark);else if(k.parent.child(k.index()).isText&&k.index()==S.index()-(S.textOffset?0:1)){var Y=k.parent.textBetween(k.parentOffset,S.parentOffset);if(e.someProp("handleTextInput",function(G){return G(e,A,P,Y)}))return;O=e.state.tr.insertText(Y,A,P)}}if(O||(O=e.state.tr.replace(A,P,u.doc.slice(_.start-u.from,_.endB-u.from))),u.sel){var $=uc(e,O.doc,u.sel);$&&!(V.chrome&&V.android&&e.composing&&$.empty&&(_.start!=_.endB||e.lastAndroidDelete<Date.now()-100)&&($.head==A||$.head==O.mapping.map(P)-1)||V.ie&&$.empty&&$.head==A)&&O.setSelection($)}D&&O.ensureMarks(D),e.dispatch(O.scrollIntoView())}function uc(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Ia(e,t.resolve(n.anchor),t.resolve(n.head))}function xg(e,t){for(var n=e.firstChild.marks,r=t.firstChild.marks,i=n,o=r,s,a,l,c=0;c<r.length;c++)i=r[c].removeFromSet(i);for(var f=0;f<n.length;f++)o=n[f].removeFromSet(o);if(i.length==1&&o.length==0)a=i[0],s="add",l=function(p){return p.mark(a.addToSet(p.marks))};else if(i.length==0&&o.length==1)a=o[0],s="remove",l=function(p){return p.mark(a.removeFromSet(p.marks))};else return null;for(var u=[],d=0;d<t.childCount;d++)u.push(l(t.child(d)));if(B.from(u).eq(e))return{mark:a,type:s}}function Ag(e,t,n,r,i){if(!r.parent.isTextblock||n-t<=i.pos-r.pos||gs(r,!0,!1)<i.pos)return!1;var o=e.resolve(t);if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;var s=e.resolve(gs(o,!0,!0));return!s.parent.isTextblock||s.pos>n||gs(s,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(s.parent.content)}function gs(e,t,n){for(var r=e.depth,i=t?e.end():e.pos;r>0&&(t||e.indexAfter(r)==e.node(r).childCount);)r--,i++,t=!1;if(n)for(var o=e.node(r).maybeChild(e.indexAfter(r));o&&!o.isLeaf;)o=o.firstChild,i++;return i}function Dg(e,t,n,r,i){var o=e.findDiffStart(t,n);if(o==null)return null;var s=e.findDiffEnd(t,n+e.size,n+t.size),a=s.a,l=s.b;if(i=="end"){var c=Math.max(0,o-Math.min(a,l));r-=a+c-o}if(a<o&&e.size<t.size){var f=r<=o&&r>=a?o-r:0;o-=f,l=o+(l-a),a=o}else if(l<o){var u=r<=o&&r>=l?o-r:0;o-=u,a=o+(a-l),l=o}return{start:o,endA:a,endB:l}}function Nf(e,t){for(var n=[],r=t.content,i=t.openStart,o=t.openEnd;i>1&&o>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,o--;var s=r.firstChild;n.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),r=s.content}var a=e.someProp("clipboardSerializer")||zt.fromSchema(e.state.schema),l=Ff(),c=l.createElement("div");c.appendChild(a.serializeFragment(r,{document:l}));for(var f=c.firstChild,u;f&&f.nodeType==1&&(u=Bf[f.nodeName.toLowerCase()]);){for(var d=u.length-1;d>=0;d--){for(var p=l.createElement(u[d]);c.firstChild;)p.appendChild(c.firstChild);c.appendChild(p),u[d]!="tbody"&&(i++,o++)}f=c.firstChild}f&&f.nodeType==1&&f.setAttribute("data-pm-slice",i+" "+o+" "+JSON.stringify(n));var g=e.someProp("clipboardTextSerializer",function(y){return y(t)})||t.content.textBetween(0,t.content.size,`

`);return{dom:c,text:g}}function Rf(e,t,n,r,i){var o,s=i.parent.type.spec.code,a;if(!n&&!t)return null;var l=t&&(r||s||!n);if(l){if(e.someProp("transformPastedText",function(S){t=S(t,s||r)}),s)return t?new H(B.from(e.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):H.empty;var c=e.someProp("clipboardTextParser",function(S){return S(t,i,r)});if(c)a=c;else{var f=i.marks(),u=e.state,d=u.schema,p=zt.fromSchema(d);o=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(function(S){var x=o.appendChild(document.createElement("p"));S&&x.appendChild(p.serializeNode(d.text(S,f)))})}}else e.someProp("transformPastedHTML",function(S){n=S(n)}),o=Ig(n),V.webkit&&Lg(o);var g=o&&o.querySelector("[data-pm-slice]"),y=g&&/^(\d+) (\d+) (.*)/.exec(g.getAttribute("data-pm-slice"));if(!a){var w=e.someProp("clipboardParser")||e.someProp("domParser")||Oe.fromSchema(e.state.schema);a=w.parseSlice(o,{preserveWhitespace:!!(l||y),context:i,ruleFromNode:function(x){if(x.nodeName=="BR"&&!x.nextSibling&&x.parentNode&&!Ng.test(x.parentNode.nodeName))return{ignore:!0}}})}if(y)a=Pg(fc(a,+y[1],+y[2]),y[3]);else if(a=H.maxOpen(Rg(a.content,i),!0),a.openStart||a.openEnd){for(var E=0,_=0,b=a.content.firstChild;E<a.openStart&&!b.type.spec.isolating;E++,b=b.firstChild);for(var k=a.content.lastChild;_<a.openEnd&&!k.type.spec.isolating;_++,k=k.lastChild);a=fc(a,E,_)}return e.someProp("transformPasted",function(S){a=S(a)}),a}var Ng=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Rg(e,t){if(e.childCount<2)return e;for(var n=function(o){var s=t.node(o),a=s.contentMatchAt(t.index(o)),l=void 0,c=[];if(e.forEach(function(f){if(!!c){var u=a.findWrapping(f.type),d;if(!u)return c=null;if(d=c.length&&l.length&&Lf(u,l,f,c[c.length-1],0))c[c.length-1]=d;else{c.length&&(c[c.length-1]=Pf(c[c.length-1],l.length));var p=If(f,u);c.push(p),a=a.matchType(p.type,p.attrs),l=u}}}),c)return{v:B.from(c)}},r=t.depth;r>=0;r--){var i=n(r);if(i)return i.v}return e}function If(e,t,n){n===void 0&&(n=0);for(var r=t.length-1;r>=n;r--)e=t[r].create(null,B.from(e));return e}function Lf(e,t,n,r,i){if(i<e.length&&i<t.length&&e[i]==t[i]){var o=Lf(e,t,n,r.lastChild,i+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));var s=r.contentMatchAt(r.childCount);if(s.matchType(i==e.length-1?n.type:e[i+1]))return r.copy(r.content.append(B.from(If(n,e,i+1))))}}function Pf(e,t){if(t==0)return e;var n=e.content.replaceChild(e.childCount-1,Pf(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(B.empty,!0);return e.copy(n.append(r))}function Qs(e,t,n,r,i,o){var s=t<0?e.firstChild:e.lastChild,a=s.content;return i<r-1&&(a=Qs(a,t,n,r,i+1,o)),i>=n&&(a=t<0?s.contentMatchAt(0).fillBefore(a,e.childCount>1||o<=i).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(B.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,s.copy(a))}function fc(e,t,n){return t<e.openStart&&(e=new H(Qs(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new H(Qs(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}var Bf={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},hc=null;function Ff(){return hc||(hc=document.implementation.createHTMLDocument("title"))}function Ig(e){var t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));var n=Ff().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e),i;if((i=r&&Bf[r[1].toLowerCase()])&&(e=i.map(function(s){return"<"+s+">"}).join("")+e+i.map(function(s){return"</"+s+">"}).reverse().join("")),n.innerHTML=e,i)for(var o=0;o<i.length;o++)n=n.querySelector(i[o])||n;return n}function Lg(e){for(var t=e.querySelectorAll(V.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),n=0;n<t.length;n++){var r=t[n];r.childNodes.length==1&&r.textContent=="\xA0"&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),r)}}function Pg(e,t){if(!e.size)return e;var n=e.content.firstChild.type.schema,r;try{r=JSON.parse(t)}catch{return e}for(var i=e.content,o=e.openStart,s=e.openEnd,a=r.length-2;a>=0;a-=2){var l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=B.from(l.create(r[a+1],i)),o++,s++}return new H(i,o,s)}var Bg={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},La=V.ie&&V.ie_version<=11,Pa=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};Pa.prototype.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset};Pa.prototype.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset};var de=function(t,n){var r=this;this.view=t,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(i){for(var o=0;o<i.length;o++)r.queue.push(i[o]);V.ie&&V.ie_version<=11&&i.some(function(s){return s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length})?r.flushSoon():r.flush()}),this.currentSelection=new Pa,La&&(this.onCharData=function(i){r.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),r.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};de.prototype.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))};de.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};de.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,Bg),La&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};de.prototype.stop=function(){var t=this;if(this.observer){var n=this.observer.takeRecords();if(n.length){for(var r=0;r<n.length;r++)this.queue.push(n[r]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}La&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};de.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};de.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};de.prototype.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)};de.prototype.onSelectionChange=function(){if(!!xf(this.view)){if(this.suppressingSelectionUpdates)return En(this.view);if(V.ie&&V.ie_version<=11&&!this.view.state.selection.empty){var t=this.view.root.getSelection();if(t.focusNode&&ei(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}};de.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};de.prototype.ignoreSelectionChange=function(t){if(t.rangeCount==0)return!0;var n=t.getRangeAt(0).commonAncestorContainer,r=this.view.docView.nearestDesc(n);if(r&&r.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0};de.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);var n=this.view.root.getSelection(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&xf(this.view)&&!this.ignoreSelectionChange(n),i=-1,o=-1,s=!1,a=[];if(this.view.editable)for(var l=0;l<t.length;l++){var c=this.registerMutation(t[l],a);c&&(i=i<0?c.from:Math.min(c.from,i),o=o<0?c.to:Math.max(c.to,o),c.typeOver&&(s=!0))}if(V.gecko&&a.length>1){var f=a.filter(function(p){return p.nodeName=="BR"});if(f.length==2){var u=f[0],d=f[1];u.parentNode&&u.parentNode.parentNode==d.parentNode?d.remove():u.remove()}}(i>-1||r)&&(i>-1&&(this.view.docView.markDirty(i,o),Fg(this.view)),this.handleDOMChange(i,o,s,a),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(n)||En(this.view),this.currentSelection.set(n))}};de.prototype.registerMutation=function(t,n){if(n.indexOf(t.target)>-1)return null;var r=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(r==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!r||r.ignoreMutation(t))return null;if(t.type=="childList"){for(var i=0;i<t.addedNodes.length;i++)n.push(t.addedNodes[i]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(t.target))return{from:r.posBefore,to:r.posAfter};var o=t.previousSibling,s=t.nextSibling;if(V.ie&&V.ie_version<=11&&t.addedNodes.length)for(var a=0;a<t.addedNodes.length;a++){var l=t.addedNodes[a],c=l.previousSibling,f=l.nextSibling;(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(o=c),(!f||Array.prototype.indexOf.call(t.addedNodes,f)<0)&&(s=f)}var u=o&&o.parentNode==t.target?ce(o)+1:0,d=r.localPosFromDOM(t.target,u,-1),p=s&&s.parentNode==t.target?ce(s):t.target.childNodes.length,g=r.localPosFromDOM(t.target,p,1);return{from:d,to:g}}else return t.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}};var dc=!1;function Fg(e){dc||(dc=!0,getComputedStyle(e.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var oe={},Zt={};function zg(e){e.shiftKey=!1,e.mouseDown=null,e.lastKeyCode=null,e.lastKeyCodeTime=0,e.lastClick={time:0,x:0,y:0,type:""},e.lastSelectionOrigin=null,e.lastSelectionTime=0,e.lastIOSEnter=0,e.lastIOSEnterFallbackTimeout=null,e.lastAndroidDelete=0,e.composing=!1,e.composingTimeout=null,e.compositionNodes=[],e.compositionEndedAt=-2e8,e.domObserver=new de(e,function(r,i,o,s){return Og(e,r,i,o,s)}),e.domObserver.start(),e.domChangeCount=0,e.eventHandlers=Object.create(null);var t=function(r){var i=oe[r];e.dom.addEventListener(r,e.eventHandlers[r]=function(o){Ug(e,o)&&!Fa(e,o)&&(e.editable||!(o.type in Zt))&&i(e,o)})};for(var n in oe)t(n);V.safari&&e.dom.addEventListener("input",function(){return null}),Ba(e)}function Vn(e,t){e.lastSelectionOrigin=t,e.lastSelectionTime=Date.now()}function Vg(e){e.domObserver.stop();for(var t in e.eventHandlers)e.dom.removeEventListener(t,e.eventHandlers[t]);clearTimeout(e.composingTimeout),clearTimeout(e.lastIOSEnterFallbackTimeout)}function Ba(e){e.someProp("handleDOMEvents",function(t){for(var n in t)e.eventHandlers[n]||e.dom.addEventListener(n,e.eventHandlers[n]=function(r){return Fa(e,r)})})}function Fa(e,t){return e.someProp("handleDOMEvents",function(n){var r=n[t.type];return r?r(e,t)||t.defaultPrevented:!1})}function Ug(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(var n=t.target;n!=e.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function jg(e,t){!Fa(e,t)&&oe[t.type]&&(e.editable||!(t.type in Zt))&&oe[t.type](e,t)}Zt.keydown=function(e,t){if(e.shiftKey=t.keyCode==16||t.shiftKey,!Vf(e,t)&&(e.lastKeyCode=t.keyCode,e.lastKeyCodeTime=Date.now(),!(V.android&&V.chrome&&t.keyCode==13)))if(t.keyCode!=229&&e.domObserver.forceFlush(),V.ios&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n=Date.now();e.lastIOSEnter=n,e.lastIOSEnterFallbackTimeout=setTimeout(function(){e.lastIOSEnter==n&&(e.someProp("handleKeyDown",function(r){return r(e,sr(13,"Enter"))}),e.lastIOSEnter=0)},200)}else e.someProp("handleKeyDown",function(r){return r(e,t)})||Eg(e,t)?t.preventDefault():Vn(e,"key")};Zt.keyup=function(e,t){t.keyCode==16&&(e.shiftKey=!1)};Zt.keypress=function(e,t){if(!(Vf(e,t)||!t.charCode||t.ctrlKey&&!t.altKey||V.mac&&t.metaKey)){if(e.someProp("handleKeyPress",function(i){return i(e,t)})){t.preventDefault();return}var n=e.state.selection;if(!(n instanceof rt)||!n.$from.sameParent(n.$to)){var r=String.fromCharCode(t.charCode);e.someProp("handleTextInput",function(i){return i(e,n.$from.pos,n.$to.pos,r)})||e.dispatch(e.state.tr.insertText(r).scrollIntoView()),t.preventDefault()}}};function No(e){return{left:e.clientX,top:e.clientY}}function Hg(e,t){var n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}function za(e,t,n,r,i){if(r==-1)return!1;for(var o=e.state.doc.resolve(r),s=function(c){if(e.someProp(t,function(f){return c>o.depth?f(e,n,o.nodeAfter,o.before(c),i,!0):f(e,n,o.node(c),o.before(c),i,!1)}))return{v:!0}},a=o.depth+1;a>0;a--){var l=s(a);if(l)return l.v}return!1}function ur(e,t,n){e.focused||e.focus();var r=e.state.tr.setSelection(t);n=="pointer"&&r.setMeta("pointer",!0),e.dispatch(r)}function qg(e,t){if(t==-1)return!1;var n=e.state.doc.resolve(t),r=n.nodeAfter;return r&&r.isAtom&&et.isSelectable(r)?(ur(e,new et(n),"pointer"),!0):!1}function Wg(e,t){if(t==-1)return!1;var n=e.state.selection,r,i;n instanceof et&&(r=n.node);for(var o=e.state.doc.resolve(t),s=o.depth+1;s>0;s--){var a=s>o.depth?o.nodeAfter:o.node(s);if(et.isSelectable(a)){r&&n.$from.depth>0&&s>=n.$from.depth&&o.before(n.$from.depth+1)==n.$from.pos?i=o.before(n.$from.depth):i=o.before(s);break}}return i!=null?(ur(e,et.create(e.state.doc,i),"pointer"),!0):!1}function Jg(e,t,n,r,i){return za(e,"handleClickOn",t,n,r)||e.someProp("handleClick",function(o){return o(e,t,r)})||(i?Wg(e,n):qg(e,n))}function $g(e,t,n,r){return za(e,"handleDoubleClickOn",t,n,r)||e.someProp("handleDoubleClick",function(i){return i(e,t,r)})}function Kg(e,t,n,r){return za(e,"handleTripleClickOn",t,n,r)||e.someProp("handleTripleClick",function(i){return i(e,t,r)})||Gg(e,n,r)}function Gg(e,t,n){if(n.button!=0)return!1;var r=e.state.doc;if(t==-1)return r.inlineContent?(ur(e,rt.create(r,0,r.content.size),"pointer"),!0):!1;for(var i=r.resolve(t),o=i.depth+1;o>0;o--){var s=o>i.depth?i.nodeAfter:i.node(o),a=i.before(o);if(s.inlineContent)ur(e,rt.create(r,a+1,a+1+s.content.size),"pointer");else if(et.isSelectable(s))ur(e,et.create(r,a),"pointer");else continue;return!0}}function Va(e){return ro(e)}var zf=V.mac?"metaKey":"ctrlKey";oe.mousedown=function(e,t){e.shiftKey=t.shiftKey;var n=Va(e),r=Date.now(),i="singleClick";r-e.lastClick.time<500&&Hg(t,e.lastClick)&&!t[zf]&&(e.lastClick.type=="singleClick"?i="doubleClick":e.lastClick.type=="doubleClick"&&(i="tripleClick")),e.lastClick={time:r,x:t.clientX,y:t.clientY,type:i};var o=e.posAtCoords(No(t));!o||(i=="singleClick"?(e.mouseDown&&e.mouseDown.done(),e.mouseDown=new Ro(e,o,t,n)):(i=="doubleClick"?$g:Kg)(e,o.pos,o.inside,t)?t.preventDefault():Vn(e,"pointer"))};var Ro=function(t,n,r,i){var o=this;this.view=t,this.startDoc=t.state.doc,this.pos=n,this.event=r,this.flushed=i,this.selectNode=r[zf],this.allowDefault=r.shiftKey,this.delayedSelectionSync=!1;var s,a;if(n.inside>-1)s=t.state.doc.nodeAt(n.inside),a=n.inside;else{var l=t.state.doc.resolve(n.pos);s=l.parent,a=l.depth?l.before():0}this.mightDrag=null;var c=i?null:r.target,f=c?t.docView.nearestDesc(c,!0):null;this.target=f?f.dom:null;var u=t.state,d=u.selection;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||d instanceof et&&d.from<=a&&d.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&V.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){o.view.mouseDown==o&&o.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Vn(t,"pointer")};Ro.prototype.done=function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return En(t.view)}),this.view.mouseDown=null};Ro.prototype.up=function(t){if(this.done(),!!this.view.dom.contains(t.target.nodeType==3?t.target.parentNode:t.target)){var n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(No(t))),this.allowDefault||!n?Vn(this.view,"pointer"):Jg(this.view,n.pos,n.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||V.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||V.chrome&&!(this.view.state.selection instanceof rt)&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ur(this.view,tt.near(this.view.state.doc.resolve(n.pos)),"pointer"),t.preventDefault()):Vn(this.view,"pointer")}};Ro.prototype.move=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0),Vn(this.view,"pointer"),t.buttons==0&&this.done()};oe.touchdown=function(e){Va(e),Vn(e,"pointer")};oe.contextmenu=function(e){return Va(e)};function Vf(e,t){return e.composing?!0:V.safari&&Math.abs(t.timeStamp-e.compositionEndedAt)<500?(e.compositionEndedAt=-2e8,!0):!1}var Yg=V.android?5e3:-1;Zt.compositionstart=Zt.compositionupdate=function(e){if(!e.composing){e.domObserver.flush();var t=e.state,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(function(a){return a.type.spec.inclusive===!1})))e.markCursor=e.state.storedMarks||n.marks(),ro(e,!0),e.markCursor=null;else if(ro(e),V.gecko&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length)for(var r=e.root.getSelection(),i=r.focusNode,o=r.focusOffset;i&&i.nodeType==1&&o!=0;){var s=o<0?i.lastChild:i.childNodes[o-1];if(!s)break;if(s.nodeType==3){r.collapse(s,s.nodeValue.length);break}else i=s,o=-1}e.composing=!0}Uf(e,Yg)};Zt.compositionend=function(e,t){e.composing&&(e.composing=!1,e.compositionEndedAt=t.timeStamp,Uf(e,20))};function Uf(e,t){clearTimeout(e.composingTimeout),t>-1&&(e.composingTimeout=setTimeout(function(){return ro(e)},t))}function jf(e){for(e.composing&&(e.composing=!1,e.compositionEndedAt=Xg());e.compositionNodes.length>0;)e.compositionNodes.pop().markParentsDirty()}function Xg(){var e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function ro(e,t){if(!(V.android&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),jf(e),t||e.docView&&e.docView.dirty){var n=Mf(e);return n&&!n.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(n)):e.updateState(e.state),!0}return!1}}function Zg(e,t){if(!!e.dom.parentNode){var n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),i=document.createRange();i.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}}var mr=V.ie&&V.ie_version<15||V.ios&&V.webkit_version<604;oe.copy=Zt.cut=function(e,t){var n=e.state.selection,r=t.type=="cut";if(!n.empty){var i=mr?null:t.clipboardData,o=n.content(),s=Nf(e,o),a=s.dom,l=s.text;i?(t.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):Zg(e,a),r&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function Qg(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function tm(e,t){if(!!e.dom.parentNode){var n=e.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(function(){e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?ta(e,r.value,null,t):ta(e,r.textContent,r.innerHTML,t)},50)}}function ta(e,t,n,r){var i=Rf(e,t,n,e.shiftKey,e.state.selection.$from);if(e.someProp("handlePaste",function(a){return a(e,r,i||H.empty)}))return!0;if(!i)return!1;var o=Qg(i),s=o?e.state.tr.replaceSelectionWith(o,e.shiftKey):e.state.tr.replaceSelection(i);return e.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Zt.paste=function(e,t){if(!(e.composing&&!V.android)){var n=mr?null:t.clipboardData;n&&ta(e,n.getData("text/plain"),n.getData("text/html"),t)?t.preventDefault():tm(e,t)}};var em=function(t,n){this.slice=t,this.move=n},Hf=V.mac?"altKey":"ctrlKey";oe.dragstart=function(e,t){var n=e.mouseDown;if(n&&n.done(),!!t.dataTransfer){var r=e.state.selection,i=r.empty?null:e.posAtCoords(No(t));if(!(i&&i.pos>=r.from&&i.pos<=(r instanceof et?r.to-1:r.to))){if(n&&n.mightDrag)e.dispatch(e.state.tr.setSelection(et.create(e.state.doc,n.mightDrag.pos)));else if(t.target&&t.target.nodeType==1){var o=e.docView.nearestDesc(t.target,!0);o&&o.node.type.spec.draggable&&o!=e.docView&&e.dispatch(e.state.tr.setSelection(et.create(e.state.doc,o.posBefore)))}}var s=e.state.selection.content(),a=Nf(e,s),l=a.dom,c=a.text;t.dataTransfer.clearData(),t.dataTransfer.setData(mr?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",mr||t.dataTransfer.setData("text/plain",c),e.dragging=new em(s,!t[Hf])}};oe.dragend=function(e){var t=e.dragging;window.setTimeout(function(){e.dragging==t&&(e.dragging=null)},50)};Zt.dragover=Zt.dragenter=function(e,t){return t.preventDefault()};Zt.drop=function(e,t){var n=e.dragging;if(e.dragging=null,!!t.dataTransfer){var r=e.posAtCoords(No(t));if(!!r){var i=e.state.doc.resolve(r.pos);if(!!i){var o=n&&n.slice;o?e.someProp("transformPasted",function(g){o=g(o)}):o=Rf(e,t.dataTransfer.getData(mr?"Text":"text/plain"),mr?null:t.dataTransfer.getData("text/html"),!1,i);var s=n&&!t[Hf];if(e.someProp("handleDrop",function(g){return g(e,t,o||H.empty,s)})){t.preventDefault();return}if(!!o){t.preventDefault();var a=o?ju(e.state.doc,i.pos,o):i.pos;a==null&&(a=i.pos);var l=e.state.tr;s&&l.deleteSelection();var c=l.mapping.map(a),f=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,u=l.doc;if(f?l.replaceRangeWith(c,c,o.content.firstChild):l.replaceRange(c,c,o),!l.doc.eq(u)){var d=l.doc.resolve(c);if(f&&et.isSelectable(o.content.firstChild)&&d.nodeAfter&&d.nodeAfter.sameMarkup(o.content.firstChild))l.setSelection(new et(d));else{var p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach(function(g,y,w,E){return p=E}),l.setSelection(Ia(e,d,l.doc.resolve(p)))}e.focus(),e.dispatch(l.setMeta("uiEvent","drop"))}}}}}};oe.focus=function(e){e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(function(){e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.root.getSelection())&&En(e)},20))};oe.blur=function(e,t){e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),t.relatedTarget&&e.dom.contains(t.relatedTarget)&&e.domObserver.currentSelection.set({}),e.focused=!1)};oe.beforeinput=function(e,t){if(V.chrome&&V.android&&t.inputType=="deleteContentBackward"){e.domObserver.flushSoon();var n=e.domChangeCount;setTimeout(function(){if(e.domChangeCount==n&&(e.dom.blur(),e.focus(),!e.someProp("handleKeyDown",function(o){return o(e,sr(8,"Backspace"))}))){var r=e.state.selection,i=r.$cursor;i&&i.pos>0&&e.dispatch(e.state.tr.delete(i.pos-1,i.pos).scrollIntoView())}},50)}};for(var pc in Zt)oe[pc]=Zt[pc];function ni(e,t){if(e==t)return!0;for(var n in e)if(e[n]!==t[n])return!1;for(var r in t)if(!(r in e))return!1;return!0}var yr=function(t,n){this.spec=n||Gn,this.side=this.spec.side||0,this.toDOM=t};yr.prototype.map=function(t,n,r,i){var o=t.mapResult(n.from+i,this.side<0?-1:1),s=o.pos,a=o.deleted;return a?null:new Et(s-r,s-r,this)};yr.prototype.valid=function(){return!0};yr.prototype.eq=function(t){return this==t||t instanceof yr&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&ni(this.spec,t.spec))};yr.prototype.destroy=function(t){this.spec.destroy&&this.spec.destroy(t)};var Ne=function(t,n){this.spec=n||Gn,this.attrs=t};Ne.prototype.map=function(t,n,r,i){var o=t.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,s=t.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return o>=s?null:new Et(o,s,this)};Ne.prototype.valid=function(t,n){return n.from<n.to};Ne.prototype.eq=function(t){return this==t||t instanceof Ne&&ni(this.attrs,t.attrs)&&ni(this.spec,t.spec)};Ne.is=function(t){return t.type instanceof Ne};var ri=function(t,n){this.spec=n||Gn,this.attrs=t};ri.prototype.map=function(t,n,r,i){var o=t.mapResult(n.from+i,1);if(o.deleted)return null;var s=t.mapResult(n.to+i,-1);return s.deleted||s.pos<=o.pos?null:new Et(o.pos-r,s.pos-r,this)};ri.prototype.valid=function(t,n){var r=t.content.findIndex(n.from),i=r.index,o=r.offset,s;return o==n.from&&!(s=t.child(i)).isText&&o+s.nodeSize==n.to};ri.prototype.eq=function(t){return this==t||t instanceof ri&&ni(this.attrs,t.attrs)&&ni(this.spec,t.spec)};var Et=function(t,n,r){this.from=t,this.to=n,this.type=r},Ua={spec:{configurable:!0},inline:{configurable:!0}};Et.prototype.copy=function(t,n){return new Et(t,n,this.type)};Et.prototype.eq=function(t,n){return n===void 0&&(n=0),this.type.eq(t.type)&&this.from+n==t.from&&this.to+n==t.to};Et.prototype.map=function(t,n,r){return this.type.map(t,this,n,r)};Et.widget=function(t,n,r){return new Et(t,t,new yr(n,r))};Et.inline=function(t,n,r,i){return new Et(t,n,new Ne(r,i))};Et.node=function(t,n,r,i){return new Et(t,n,new ri(r,i))};Ua.spec.get=function(){return this.type.spec};Ua.inline.get=function(){return this.type instanceof Ne};Object.defineProperties(Et.prototype,Ua);var io=[],Gn={},ct=function(t,n){this.local=t&&t.length?t:io,this.children=n&&n.length?n:io};ct.create=function(t,n){return n.length?Io(n,t,0,Gn):Vt};ct.prototype.find=function(t,n,r){var i=[];return this.findInner(t==null?0:t,n==null?1e9:n,i,0,r),i};ct.prototype.findInner=function(t,n,r,i,o){for(var s=0;s<this.local.length;s++){var a=this.local[s];a.from<=n&&a.to>=t&&(!o||o(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(var l=0;l<this.children.length;l+=3)if(this.children[l]<n&&this.children[l+1]>t){var c=this.children[l]+1;this.children[l+2].findInner(t-c,n-c,r,i+c,o)}};ct.prototype.map=function(t,n,r){return this==Vt||t.maps.length==0?this:this.mapInner(t,n,0,0,r||Gn)};ct.prototype.mapInner=function(t,n,r,i,o){for(var s,a=0;a<this.local.length;a++){var l=this.local[a].map(t,r,i);l&&l.type.valid(n,l)?(s||(s=[])).push(l):o.onRemove&&o.onRemove(this.local[a].spec)}return this.children.length?nm(this.children,s,t,n,r,i,o):s?new ct(s.sort(Yn)):Vt};ct.prototype.add=function(t,n){return n.length?this==Vt?ct.create(t,n):this.addInner(t,n,0):this};ct.prototype.addInner=function(t,n,r){var i=this,o,s=0;t.forEach(function(c,f){var u=f+r,d;if(!!(d=Wf(n,c,u))){for(o||(o=i.children.slice());s<o.length&&o[s]<f;)s+=3;o[s]==f?o[s+2]=o[s+2].addInner(c,d,u+1):o.splice(s,0,f,f+c.nodeSize,Io(d,c,u+1,Gn)),s+=3}});for(var a=qf(s?Jf(n):n,-r),l=0;l<a.length;l++)a[l].type.valid(t,a[l])||a.splice(l--,1);return new ct(a.length?this.local.concat(a).sort(Yn):this.local,o||this.children)};ct.prototype.remove=function(t){return t.length==0||this==Vt?this:this.removeInner(t,0)};ct.prototype.removeInner=function(t,n){for(var r=this.children,i=this.local,o=0;o<r.length;o+=3){for(var s=void 0,a=r[o]+n,l=r[o+1]+n,c=0,f=void 0;c<t.length;c++)(f=t[c])&&f.from>a&&f.to<l&&(t[c]=null,(s||(s=[])).push(f));if(!!s){r==this.children&&(r=this.children.slice());var u=r[o+2].removeInner(s,a+1);u!=Vt?r[o+2]=u:(r.splice(o,3),o-=3)}}if(i.length){for(var d=0,p=void 0;d<t.length;d++)if(p=t[d])for(var g=0;g<i.length;g++)i[g].eq(p,n)&&(i==this.local&&(i=this.local.slice()),i.splice(g--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new ct(i,r):Vt};ct.prototype.forChild=function(t,n){if(this==Vt)return this;if(n.isLeaf)return ct.empty;for(var r,i,o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(r=this.children[o+2]);break}for(var s=t+1,a=s+n.content.size,l=0;l<this.local.length;l++){var c=this.local[l];if(c.from<a&&c.to>s&&c.type instanceof Ne){var f=Math.max(s,c.from)-s,u=Math.min(a,c.to)-s;f<u&&(i||(i=[])).push(c.copy(f,u))}}if(i){var d=new ct(i.sort(Yn));return r?new ye([d,r]):d}return r||Vt};ct.prototype.eq=function(t){if(this==t)return!0;if(!(t instanceof ct)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var n=0;n<this.local.length;n++)if(!this.local[n].eq(t.local[n]))return!1;for(var r=0;r<this.children.length;r+=3)if(this.children[r]!=t.children[r]||this.children[r+1]!=t.children[r+1]||!this.children[r+2].eq(t.children[r+2]))return!1;return!0};ct.prototype.locals=function(t){return ja(this.localsInner(t))};ct.prototype.localsInner=function(t){if(this==Vt)return io;if(t.inlineContent||!this.local.some(Ne.is))return this.local;for(var n=[],r=0;r<this.local.length;r++)this.local[r].type instanceof Ne||n.push(this.local[r]);return n};var Vt=new ct;ct.empty=Vt;ct.removeOverlap=ja;var ye=function(t){this.members=t};ye.prototype.map=function(t,n){var r=this.members.map(function(i){return i.map(t,n,Gn)});return ye.from(r)};ye.prototype.forChild=function(t,n){if(n.isLeaf)return ct.empty;for(var r=[],i=0;i<this.members.length;i++){var o=this.members[i].forChild(t,n);o!=Vt&&(o instanceof ye?r=r.concat(o.members):r.push(o))}return ye.from(r)};ye.prototype.eq=function(t){if(!(t instanceof ye)||t.members.length!=this.members.length)return!1;for(var n=0;n<this.members.length;n++)if(!this.members[n].eq(t.members[n]))return!1;return!0};ye.prototype.locals=function(t){for(var n,r=!0,i=0;i<this.members.length;i++){var o=this.members[i].localsInner(t);if(!!o.length)if(!n)n=o;else{r&&(n=n.slice(),r=!1);for(var s=0;s<o.length;s++)n.push(o[s])}}return n?ja(r?n:n.sort(Yn)):io};ye.from=function(t){switch(t.length){case 0:return Vt;case 1:return t[0];default:return new ye(t)}};function nm(e,t,n,r,i,o,s){for(var a=e.slice(),l=function(D,F,j,Y){for(var $=0;$<a.length;$+=3){var G=a[$+1],yt=void 0;if(!(G<0||D>G+o)){var xt=a[$]+o;F>=xt?a[$+1]=D<=xt?-2:-1:j>=i&&(yt=Y-j-(F-D))&&(a[$]+=yt,a[$+1]+=yt)}}},c=0;c<n.maps.length;c++)n.maps[c].forEach(l);for(var f=!1,u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){f=!0,a[u+1]=-1;continue}var d=n.map(e[u]+o),p=d-i;if(p<0||p>=r.content.size){f=!0;continue}var g=n.map(e[u+1]+o,-1),y=g-i,w=r.content.findIndex(p),E=w.index,_=w.offset,b=r.maybeChild(E);if(b&&_==p&&_+b.nodeSize==y){var k=a[u+2].mapInner(n,b,d+1,e[u]+o+1,s);k!=Vt?(a[u]=p,a[u+1]=y,a[u+2]=k):(a[u+1]=-2,f=!0)}else f=!0}if(f){var S=rm(a,e,t||[],n,i,o,s),x=Io(S,r,0,s);t=x.local;for(var M=0;M<a.length;M+=3)a[M+1]<0&&(a.splice(M,3),M-=3);for(var A=0,P=0;A<x.children.length;A+=3){for(var O=x.children[A];P<a.length&&a[P]<O;)P+=3;a.splice(P,0,x.children[A],x.children[A+1],x.children[A+2])}}return new ct(t&&t.sort(Yn),a)}function qf(e,t){if(!t||!e.length)return e;for(var n=[],r=0;r<e.length;r++){var i=e[r];n.push(new Et(i.from+t,i.to+t,i.type))}return n}function rm(e,t,n,r,i,o,s){function a(c,f){for(var u=0;u<c.local.length;u++){var d=c.local[u].map(r,i,f);d?n.push(d):s.onRemove&&s.onRemove(c.local[u].spec)}for(var p=0;p<c.children.length;p+=3)a(c.children[p+2],c.children[p]+f+1)}for(var l=0;l<e.length;l+=3)e[l+1]==-1&&a(e[l+2],t[l]+o+1);return n}function Wf(e,t,n){if(t.isLeaf)return null;for(var r=n+t.nodeSize,i=null,o=0,s=void 0;o<e.length;o++)(s=e[o])&&s.from>n&&s.to<r&&((i||(i=[])).push(s),e[o]=null);return i}function Jf(e){for(var t=[],n=0;n<e.length;n++)e[n]!=null&&t.push(e[n]);return t}function Io(e,t,n,r){var i=[],o=!1;t.forEach(function(l,c){var f=Wf(e,l,c+n);if(f){o=!0;var u=Io(f,l,n+c+1,r);u!=Vt&&i.push(c,c+l.nodeSize,u)}});for(var s=qf(o?Jf(e):e,-n).sort(Yn),a=0;a<s.length;a++)s[a].type.valid(t,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||i.length?new ct(s,i):Vt}function Yn(e,t){return e.from-t.from||e.to-t.to}function ja(e){for(var t=e,n=0;n<t.length-1;n++){var r=t[n];if(r.from!=r.to)for(var i=n+1;i<t.length;i++){var o=t[i];if(o.from==r.from){o.to!=r.to&&(t==e&&(t=e.slice()),t[i]=o.copy(o.from,r.to),gc(t,i+1,o.copy(r.to,o.to)));continue}else{o.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,o.from),gc(t,i,r.copy(o.from,r.to)));break}}}return t}function gc(e,t,n){for(;t<e.length&&Yn(n,e[t])>0;)t++;e.splice(t,0,n)}function Ha(e){var t=[];return e.someProp("decorations",function(n){var r=n(e.state);r&&r!=Vt&&t.push(r)}),e.cursorWrapper&&t.push(ct.create(e.state.doc,[e.cursorWrapper.deco])),ye.from(t)}var Mt=function(t,n){this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Xf),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):t.apply?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=Gf(this),this.markCursor=null,this.cursorWrapper=null,Kf(this),this.nodeViews=Yf(this),this.docView=wf(this.state.doc,$f(this),Ha(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,zg(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Lo={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};Lo.props.get=function(){if(this._props.state!=this.state){var e=this._props;this._props={};for(var t in e)this._props[t]=e[t];this._props.state=this.state}return this._props};Mt.prototype.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Ba(this),this._props=t,t.plugins&&(t.plugins.forEach(Xf),this.directPlugins=t.plugins),this.updateStateInner(t.state,!0)};Mt.prototype.setProps=function(t){var n={};for(var r in this._props)n[r]=this._props[r];n.state=this.state;for(var i in t)n[i]=t[i];this.update(n)};Mt.prototype.updateState=function(t){this.updateStateInner(t,this.state.plugins!=t.plugins)};Mt.prototype.updateStateInner=function(t,n){var r=this,i=this.state,o=!1,s=!1;if(t.storedMarks&&this.composing&&(jf(this),s=!0),this.state=t,n){var a=Yf(this);om(a,this.nodeViews)&&(this.nodeViews=a,o=!0),Ba(this)}this.editable=Gf(this),Kf(this);var l=Ha(this),c=$f(this),f=n?"reset":t.scrollToSelection>i.scrollToSelection?"to selection":"preserve",u=o||!this.docView.matchesNode(t.doc,c,l);(u||!t.selection.eq(i.selection))&&(s=!0);var d=f=="preserve"&&s&&this.dom.style.overflowAnchor==null&&Zp(this);if(s){this.domObserver.stop();var p=u&&(V.ie||V.chrome)&&!this.composing&&!i.selection.empty&&!t.selection.empty&&im(i.selection,t.selection);if(u){var g=V.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(o||!this.docView.update(t.doc,c,l,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=wf(t.doc,c,l,this.dom,this)),g&&!this.trackWrites&&(p=!0)}p||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&_g(this))?En(this,p):(Of(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(i),f=="reset")this.dom.scrollTop=0;else if(f=="to selection"){var y=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(w){return w(r)})||(t.selection instanceof et?Xl(this,this.docView.domAfterPos(t.selection.from).getBoundingClientRect(),y):Xl(this,this.coordsAtPos(t.selection.head,1),y))}else d&&Qp(d)};Mt.prototype.destroyPluginViews=function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()};Mt.prototype.updatePluginViews=function(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var n=0;n<this.directPlugins.length;n++){var r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(var i=0;i<this.state.plugins.length;i++){var o=this.state.plugins[i];o.spec.view&&this.pluginViews.push(o.spec.view(this))}}else for(var s=0;s<this.pluginViews.length;s++){var a=this.pluginViews[s];a.update&&a.update(this,t)}};Mt.prototype.someProp=function(t,n){var r=this._props&&this._props[t],i;if(r!=null&&(i=n?n(r):r))return i;for(var o=0;o<this.directPlugins.length;o++){var s=this.directPlugins[o].props[t];if(s!=null&&(i=n?n(s):s))return i}var a=this.state.plugins;if(a)for(var l=0;l<a.length;l++){var c=a[l].props[t];if(c!=null&&(i=n?n(c):c))return i}};Mt.prototype.hasFocus=function(){return this.root.activeElement==this.dom};Mt.prototype.focus=function(){this.domObserver.stop(),this.editable&&tg(this.dom),En(this),this.domObserver.start()};Lo.root.get=function(){var e=this._root;if(e==null){for(var t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=function(){return document.getSelection()}),this._root=t}return e||document};Mt.prototype.posAtCoords=function(t){return og(this,t)};Mt.prototype.coordsAtPos=function(t,n){return n===void 0&&(n=1),mf(this,t,n)};Mt.prototype.domAtPos=function(t,n){return n===void 0&&(n=0),this.docView.domFromPos(t,n)};Mt.prototype.nodeDOM=function(t){var n=this.docView.descAt(t);return n?n.nodeDOM:null};Mt.prototype.posAtDOM=function(t,n,r){r===void 0&&(r=-1);var i=this.docView.posFromDOM(t,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i};Mt.prototype.endOfTextblock=function(t,n){return ug(this,n||this.state,t)};Mt.prototype.destroy=function(){!this.docView||(Vg(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Ha(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};Lo.isDestroyed.get=function(){return this.docView==null};Mt.prototype.dispatchEvent=function(t){return jg(this,t)};Mt.prototype.dispatch=function(t){var n=this._props.dispatchTransaction;n?n.call(this,t):this.updateState(this.state.apply(t))};Object.defineProperties(Mt.prototype,Lo);function $f(e){var t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),t.translate="no",e.someProp("attributes",function(n){if(typeof n=="function"&&(n=n(e.state)),n)for(var r in n)r=="class"&&(t.class+=" "+n[r]),r=="style"?t.style=(t.style?t.style+";":"")+n[r]:!t[r]&&r!="contenteditable"&&r!="nodeName"&&(t[r]=String(n[r]))}),[Et.node(0,e.state.doc.content.size,t)]}function Kf(e){if(e.markCursor){var t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Et.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function Gf(e){return!e.someProp("editable",function(t){return t(e.state)===!1})}function im(e,t){var n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}function Yf(e){var t={};return e.someProp("nodeViews",function(n){for(var r in n)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=n[r])}),t}function om(e,t){var n=0,r=0;for(var i in e){if(e[i]!=t[i])return!0;n++}for(var o in t)r++;return n!=r}function Xf(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var _n={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},oo={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},mc=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),sm=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),am=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),yc=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),lm=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),cm=mc&&(yc||+mc[1]<57)||am&&yc;for(var Lt=0;Lt<10;Lt++)_n[48+Lt]=_n[96+Lt]=String(Lt);for(var Lt=1;Lt<=24;Lt++)_n[Lt+111]="F"+Lt;for(var Lt=65;Lt<=90;Lt++)_n[Lt]=String.fromCharCode(Lt+32),oo[Lt]=String.fromCharCode(Lt);for(var ms in _n)oo.hasOwnProperty(ms)||(oo[ms]=_n[ms]);function um(e){var t=cm&&(e.ctrlKey||e.altKey||e.metaKey)||(sm||lm)&&e.shiftKey&&e.key&&e.key.length==1,n=!t&&e.key||(e.shiftKey?oo:_n)[e.keyCode]||e.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}var fm=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function hm(e){var t=e.split(/-(?!$)/),n=t[t.length-1];n=="Space"&&(n=" ");for(var r,i,o,s,a=0;a<t.length-1;a++){var l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))fm?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),s&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function dm(e){var t=Object.create(null);for(var n in e)t[hm(n)]=e[n];return t}function ys(e,t,n){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n!==!1&&t.shiftKey&&(e="Shift-"+e),e}function pm(e){return new Kt({props:{handleKeyDown:Zf(e)}})}function Zf(e){var t=dm(e);return function(n,r){var i=um(r),o=i.length==1&&i!=" ",s,a=t[ys(i,r,!o)];if(a&&a(n.state,n.dispatch,n))return!0;if(o&&(r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(s=_n[r.keyCode])&&s!=i){var l=t[ys(s,r,!0)];if(l&&l(n.state,n.dispatch,n))return!0}else if(o&&r.shiftKey){var c=t[ys(i,r,!0)];if(c&&c(n.state,n.dispatch,n))return!0}return!1}}function gm(e){return Object.prototype.toString.call(e).slice(8,-1)}function vs(e){return gm(e)!=="Object"?!1:e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Po(e,t){const n=z({},e);return vs(e)&&vs(t)&&Object.keys(t).forEach(r=>{vs(t[r])?r in e?n[r]=Po(e[r],t[r]):Object.assign(n,{[r]:t[r]}):Object.assign(n,{[r]:t[r]})}),n}function Qf(e){return typeof e=="function"}function nt(e,t=void 0,...n){return Qf(e)?t?e.bind(t)(...n):e(...n):e}function q(e,t,n){return e.config[t]===void 0&&e.parent?q(e.parent,t,n):typeof e.config[t]=="function"?e.config[t].bind(Dt(z({},n),{parent:e.parent?q(e.parent,t,n):null})):e.config[t]}class Qt{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=z(z({},this.config),t),this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=nt(q(this,"addOptions",{name:this.name}))),this.storage=nt(q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Qt(t)}configure(t={}){const n=this.extend();return n.options=Po(this.options,t),n.storage=nt(q(n,"addStorage",{name:n.name,options:n.options})),n}extend(t={}){const n=new Qt(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=nt(q(n,"addOptions",{name:n.name})),n.storage=nt(q(n,"addStorage",{name:n.name,options:n.options})),n}}function th(e,t,n){const{from:r,to:i}=t,{blockSeparator:o=`

`,textSerializers:s={}}=n||{};let a="",l=!0;return e.nodesBetween(r,i,(c,f,u,d)=>{var p;const g=s==null?void 0:s[c.type.name];g?(c.isBlock&&!l&&(a+=o,l=!0),a+=g({node:c,pos:f,parent:u,index:d})):c.isText?(a+=(p=c==null?void 0:c.text)===null||p===void 0?void 0:p.slice(Math.max(r,f)-f,i-f),l=!1):c.isBlock&&!l&&(a+=o,l=!0)}),a}function eh(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,t])=>t.spec.toText).map(([t,n])=>[t,n.spec.toText]))}const mm=Qt.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new Kt({key:new he("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:r,selection:i}=t,{ranges:o}=i,s=Math.min(...o.map(f=>f.$from.pos)),a=Math.max(...o.map(f=>f.$to.pos)),l=eh(n);return th(r,{from:s,to:a},{textSerializers:l})}}})]}}),ym=()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0);var vm=Object.freeze({__proto__:null,blur:ym});const bm=(e=!1)=>({commands:t})=>t.setContent("",e);var wm=Object.freeze({__proto__:null,clearContent:bm});const km=()=>({state:e,tr:t,dispatch:n})=>{const{selection:r}=t,{ranges:i}=r;return n&&i.forEach(({$from:o,$to:s})=>{e.doc.nodesBetween(o.pos,s.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:f}=t,u=c.resolve(f.map(l)),d=c.resolve(f.map(l+a.nodeSize)),p=u.blockRange(d);if(!p)return;const g=Or(p);if(a.type.isTextblock){const{defaultType:y}=u.parent.contentMatchAt(u.index());t.setNodeMarkup(p.start,y)}(g||g===0)&&t.lift(p,g)})}),!0};var _m=Object.freeze({__proto__:null,clearNodes:km});const Sm=e=>t=>e(t);var Cm=Object.freeze({__proto__:null,command:Sm});const Em=()=>({state:e,dispatch:t})=>sf(e,t);var Mm=Object.freeze({__proto__:null,createParagraphNear:Em});function Ot(e,t){if(typeof e=="string"){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}const Tm=e=>({tr:t,state:n,dispatch:r})=>{const i=Ot(e,n.schema),o=t.selection.$anchor;for(let s=o.depth;s>0;s-=1)if(o.node(s).type===i){if(r){const l=o.before(s),c=o.after(s);t.delete(l,c).scrollIntoView()}return!0}return!1};var Om=Object.freeze({__proto__:null,deleteNode:Tm});const xm=e=>({tr:t,dispatch:n})=>{const{from:r,to:i}=e;return n&&t.delete(r,i),!0};var Am=Object.freeze({__proto__:null,deleteRange:xm});const Dm=()=>({state:e,dispatch:t})=>Oa(e,t);var Nm=Object.freeze({__proto__:null,deleteSelection:Dm});const Rm=()=>({commands:e})=>e.keyboardShortcut("Enter");var Im=Object.freeze({__proto__:null,enter:Rm});const Lm=()=>({state:e,dispatch:t})=>of(e,t);var Pm=Object.freeze({__proto__:null,exitCode:Lm});function Mn(e,t){if(typeof e=="string"){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function qa(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function so(e,t,n={strict:!0}){const r=Object.keys(t);return r.length?r.every(i=>n.strict?t[i]===e[i]:qa(t[i])?t[i].test(e[i]):t[i]===e[i]):!0}function ea(e,t,n={}){return e.find(r=>r.type===t&&so(r.attrs,n))}function Bm(e,t,n={}){return!!ea(e,t,n)}function Wa(e,t,n={}){if(!e||!t)return;const r=e.parent.childAfter(e.parentOffset);if(!r.node)return;const i=ea(r.node.marks,t,n);if(!i)return;let o=e.index(),s=e.start()+r.offset,a=o+1,l=s+r.node.nodeSize;for(ea(r.node.marks,t,n);o>0&&i.isInSet(e.parent.child(o-1).marks);)o-=1,s-=e.parent.child(o).nodeSize;for(;a<e.parent.childCount&&Bm(e.parent.child(a).marks,t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:s,to:l}}const Fm=(e,t={})=>({tr:n,state:r,dispatch:i})=>{const o=Mn(e,r.schema),{doc:s,selection:a}=n,{$from:l,from:c,to:f}=a;if(i){const u=Wa(l,o,t);if(u&&u.from<=c&&u.to>=f){const d=rt.create(s,u.from,u.to);n.setSelection(d)}}return!0};var zm=Object.freeze({__proto__:null,extendMarkRange:Fm});const Vm=e=>t=>{const n=typeof e=="function"?e(t):e;for(let r=0;r<n.length;r+=1)if(n[r](t))return!0;return!1};var Um=Object.freeze({__proto__:null,first:Vm});function jm(e){var t;return((t=e.constructor)===null||t===void 0?void 0:t.toString().substring(0,5))==="class"}function Hm(e){return e&&typeof e=="object"&&!Array.isArray(e)&&!jm(e)}function qm(e){return Hm(e)&&e instanceof rt}function Ja(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function In(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function nh(e,t=null){if(!t)return null;const n=tt.atStart(e),r=tt.atEnd(e);if(t==="start"||t===!0)return n;if(t==="end")return r;const i=n.from,o=r.to;return t==="all"?rt.create(e,In(0,i,o),In(e.content.size,i,o)):rt.create(e,In(t,i,o),In(t,i,o))}const Wm=(e=null,t)=>({editor:n,view:r,tr:i,dispatch:o})=>{t=z({scrollIntoView:!0},t);const s=()=>{Ja()&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),t!=null&&t.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&e===null||e===!1)return!0;if(o&&e===null&&!qm(n.state.selection))return s(),!0;const a=nh(n.state.doc,e)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0};var Jm=Object.freeze({__proto__:null,focus:Wm});const $m=(e,t)=>n=>e.every((r,i)=>t(r,Dt(z({},n),{index:i})));var Km=Object.freeze({__proto__:null,forEach:$m});const Gm=(e,t)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},e,t);var Ym=Object.freeze({__proto__:null,insertContent:Gm});function vc(e){const t=`<body>${e}</body>`;return new window.DOMParser().parseFromString(t,"text/html").body}function ao(e,t,n){if(n=z({slice:!0,parseOptions:{}},n),typeof e=="object"&&e!==null)try{return Array.isArray(e)?B.fromArray(e.map(r=>t.nodeFromJSON(r))):t.nodeFromJSON(e)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",r),ao("",t,n)}if(typeof e=="string"){const r=Oe.fromSchema(t);return n.slice?r.parseSlice(vc(e),n.parseOptions).content:r.parse(vc(e),n.parseOptions)}return ao("",t,n)}function Xm(e,t,n){const r=e.steps.length-1;if(r<t)return;const i=e.steps[r];if(!(i instanceof nn||i instanceof ie))return;const o=e.mapping.maps[r];let s=0;o.forEach((a,l,c,f)=>{s===0&&(s=f)}),e.setSelection(tt.near(e.doc.resolve(s),n))}const Zm=e=>e.toString().startsWith("<"),Qm=(e,t,n)=>({tr:r,dispatch:i,editor:o})=>{if(i){n=z({parseOptions:{},updateSelection:!0},n);const s=ao(t,o.schema,{parseOptions:z({preserveWhitespace:"full"},n.parseOptions)});if(s.toString()==="<>")return!0;let{from:a,to:l}=typeof e=="number"?{from:e,to:e}:e,c=!0,f=!0;if((Zm(s)?s:[s]).forEach(d=>{d.check(),c=c?d.isText&&d.marks.length===0:!1,f=f?d.isBlock:!1}),a===l&&f){const{parent:d}=r.doc.resolve(a);d.isTextblock&&!d.type.spec.code&&!d.childCount&&(a-=1,l+=1)}c?r.insertText(t,a,l):r.replaceWith(a,l,s),n.updateSelection&&Xm(r,r.steps.length-1,-1)}return!0};var ty=Object.freeze({__proto__:null,insertContentAt:Qm});const ey=()=>({state:e,dispatch:t})=>Xu(e,t);var ny=Object.freeze({__proto__:null,joinBackward:ey});const ry=()=>({state:e,dispatch:t})=>tf(e,t);var iy=Object.freeze({__proto__:null,joinForward:ry});function rh(){return typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1}function oy(e){const t=e.split(/-(?!$)/);let n=t[t.length-1];n==="Space"&&(n=" ");let r,i,o,s;for(let a=0;a<t.length-1;a+=1){const l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))Ja()||rh()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),s&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const sy=e=>({editor:t,view:n,tr:r,dispatch:i})=>{const o=oy(e).split(/-(?!$)/),s=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const f=c.map(r.mapping);f&&i&&r.maybeStep(f)}),!0};var ay=Object.freeze({__proto__:null,keyboardShortcut:sy});function ii(e,t,n={}){const{from:r,to:i,empty:o}=e.selection,s=t?Ot(t,e.schema):null,a=[];e.doc.nodesBetween(r,i,(u,d)=>{if(u.isText)return;const p=Math.max(r,d),g=Math.min(i,d+u.nodeSize);a.push({node:u,from:p,to:g})});const l=i-r,c=a.filter(u=>s?s.name===u.node.type.name:!0).filter(u=>so(u.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((u,d)=>u+d.to-d.from,0)>=l}const ly=(e,t={})=>({state:n,dispatch:r})=>{const i=Ot(e,n.schema);return ii(n,i,t)?Ip(n,r):!1};var cy=Object.freeze({__proto__:null,lift:ly});const uy=()=>({state:e,dispatch:t})=>af(e,t);var fy=Object.freeze({__proto__:null,liftEmptyBlock:uy});const hy=e=>({state:t,dispatch:n})=>{const r=Ot(e,t.schema);return Hp(r)(t,n)};var dy=Object.freeze({__proto__:null,liftListItem:hy});const py=()=>({state:e,dispatch:t})=>rf(e,t);var gy=Object.freeze({__proto__:null,newlineInCode:py});function Bo(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function bc(e,t){const n=typeof t=="string"?[t]:t;return Object.keys(e).reduce((r,i)=>(n.includes(i)||(r[i]=e[i]),r),{})}const my=(e,t)=>({tr:n,state:r,dispatch:i})=>{let o=null,s=null;const a=Bo(typeof e=="string"?e:e.name,r.schema);return a?(a==="node"&&(o=Ot(e,r.schema)),a==="mark"&&(s=Mn(e,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,f)=>{o&&o===c.type&&n.setNodeMarkup(f,void 0,bc(c.attrs,t)),s&&c.marks.length&&c.marks.forEach(u=>{s===u.type&&n.addMark(f,f+c.nodeSize,s.create(bc(u.attrs,t)))})})}),!0):!1};var yy=Object.freeze({__proto__:null,resetAttributes:my});const vy=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0);var by=Object.freeze({__proto__:null,scrollIntoView:vy});const wy=()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size});var ky=Object.freeze({__proto__:null,selectAll:wy});const _y=()=>({state:e,dispatch:t})=>Zu(e,t);var Sy=Object.freeze({__proto__:null,selectNodeBackward:_y});const Cy=()=>({state:e,dispatch:t})=>ef(e,t);var Ey=Object.freeze({__proto__:null,selectNodeForward:Cy});const My=()=>({state:e,dispatch:t})=>Pp(e,t);var Ty=Object.freeze({__proto__:null,selectParentNode:My});const Oy=()=>({state:e,dispatch:t})=>ff(e,t);var xy=Object.freeze({__proto__:null,selectTextblockEnd:Oy});const Ay=()=>({state:e,dispatch:t})=>uf(e,t);var Dy=Object.freeze({__proto__:null,selectTextblockStart:Ay});function ih(e,t,n={}){return ao(e,t,{slice:!1,parseOptions:n})}const Ny=(e,t=!1,n={})=>({tr:r,editor:i,dispatch:o})=>{const{doc:s}=r,a=ih(e,i.schema,n),l=rt.create(s,0,s.content.size);return o&&r.setSelection(l).replaceSelectionWith(a,!1).setMeta("preventUpdate",!t),!0};var Ry=Object.freeze({__proto__:null,setContent:Ny});function oh(e,t){const n=Mn(t,e.schema),{from:r,to:i,empty:o}=e.selection,s=[];o?(e.storedMarks&&s.push(...e.storedMarks),s.push(...e.selection.$head.marks())):e.doc.nodesBetween(r,i,l=>{s.push(...l.marks)});const a=s.find(l=>l.type.name===n.name);return a?z({},a.attrs):{}}const Iy=(e,t={})=>({tr:n,state:r,dispatch:i})=>{const{selection:o}=n,{empty:s,ranges:a}=o,l=Mn(e,r.schema);if(i)if(s){const c=oh(r,l);n.addStoredMark(l.create(z(z({},c),t)))}else a.forEach(c=>{const f=c.$from.pos,u=c.$to.pos;r.doc.nodesBetween(f,u,(d,p)=>{const g=Math.max(p,f),y=Math.min(p+d.nodeSize,u);d.marks.find(E=>E.type===l)?d.marks.forEach(E=>{l===E.type&&n.addMark(g,y,l.create(z(z({},E.attrs),t)))}):n.addMark(g,y,l.create(t))})});return!0};var Ly=Object.freeze({__proto__:null,setMark:Iy});const Py=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0);var By=Object.freeze({__proto__:null,setMeta:Py});const Fy=(e,t={})=>({state:n,dispatch:r,chain:i})=>{const o=Ot(e,n.schema);return o.isTextblock?i().command(({commands:s})=>Wl(o,t)(n)?!0:s.clearNodes()).command(({state:s})=>Wl(o,t)(s,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)};var zy=Object.freeze({__proto__:null,setNode:Fy});const Vy=e=>({tr:t,dispatch:n})=>{if(n){const{doc:r}=t,i=tt.atStart(r).from,o=tt.atEnd(r).to,s=In(e,i,o),a=et.create(r,s);t.setSelection(a)}return!0};var Uy=Object.freeze({__proto__:null,setNodeSelection:Vy});const jy=e=>({tr:t,dispatch:n})=>{if(n){const{doc:r}=t,{from:i,to:o}=typeof e=="number"?{from:e,to:e}:e,s=rt.atStart(r).from,a=rt.atEnd(r).to,l=In(i,s,a),c=In(o,s,a),f=rt.create(r,l,c);t.setSelection(f)}return!0};var Hy=Object.freeze({__proto__:null,setTextSelection:jy});const qy=e=>({state:t,dispatch:n})=>{const r=Ot(e,t.schema);return Jp(r)(t,n)};var Wy=Object.freeze({__proto__:null,sinkListItem:qy});function Ui(e,t,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=e.find(o=>o.type===t&&o.name===r);return i?i.attribute.keepOnSplit:!1}))}function Jy(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function wc(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const r=n.filter(i=>t==null?void 0:t.includes(i.type.name));e.tr.ensureMarks(r)}}const $y=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:r,editor:i})=>{const{selection:o,doc:s}=t,{$from:a,$to:l}=o,c=i.extensionManager.attributes,f=Ui(c,a.node().type.name,a.node().attrs);if(o instanceof et&&o.node.isBlock)return!a.parentOffset||!Ye(s,a.pos)?!1:(r&&(e&&wc(n,i.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){const u=l.parentOffset===l.parent.content.size;o instanceof rt&&t.deleteSelection();const d=a.depth===0?void 0:Jy(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=u&&d?[{type:d,attrs:f}]:void 0,g=Ye(t.doc,t.mapping.map(a.pos),1,p);if(!p&&!g&&Ye(t.doc,t.mapping.map(a.pos),1,d?[{type:d}]:void 0)&&(g=!0,p=d?[{type:d,attrs:f}]:void 0),g&&(t.split(t.mapping.map(a.pos),1,p),d&&!u&&!a.parentOffset&&a.parent.type!==d)){const y=t.mapping.map(a.before()),w=t.doc.resolve(y);a.node(-1).canReplaceWith(w.index(),w.index()+1,d)&&t.setNodeMarkup(t.mapping.map(a.before()),d)}e&&wc(n,i.extensionManager.splittableMarks),t.scrollIntoView()}return!0};var Ky=Object.freeze({__proto__:null,splitBlock:$y});const Gy=e=>({tr:t,state:n,dispatch:r,editor:i})=>{var o;const s=Ot(e,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const f=a.node(-1);if(f.type!==s)return!1;const u=i.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==s||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let w=B.empty;const E=a.index(-1)?1:a.index(-2)?2:3;for(let M=a.depth-E;M>=a.depth-3;M-=1)w=B.from(a.node(M).copy(w));const _=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,b=Ui(u,a.node().type.name,a.node().attrs),k=((o=s.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(b))||void 0;w=w.append(B.from(s.createAndFill(null,k)||void 0));const S=a.before(a.depth-(E-1));t.replace(S,a.after(-_),new H(w,4-E,0));let x=-1;t.doc.nodesBetween(S,t.doc.content.size,(M,A)=>{if(x>-1)return!1;M.isTextblock&&M.content.size===0&&(x=A+1)}),x>-1&&t.setSelection(rt.near(t.doc.resolve(x))),t.scrollIntoView()}return!0}const d=l.pos===a.end()?f.contentMatchAt(0).defaultType:null,p=Ui(u,f.type.name,f.attrs),g=Ui(u,a.node().type.name,a.node().attrs);t.delete(a.pos,l.pos);const y=d?[{type:s,attrs:p},{type:d,attrs:g}]:[{type:s,attrs:p}];return Ye(t.doc,a.pos,2)?(r&&t.split(a.pos,2,y).scrollIntoView(),!0):!1};var Yy=Object.freeze({__proto__:null,splitListItem:Gy});function Xy(e,t){for(let n=e.depth;n>0;n-=1){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}function $a(e){return t=>Xy(t.$from,e)}function Fo(e){const t=e.filter(i=>i.type==="extension"),n=e.filter(i=>i.type==="node"),r=e.filter(i=>i.type==="mark");return{baseExtensions:t,nodeExtensions:n,markExtensions:r}}function kc(e,t){const{nodeExtensions:n}=Fo(t),r=n.find(s=>s.name===e);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},o=nt(q(r,"group",i));return typeof o!="string"?!1:o.split(" ").includes("list")}const _c=(e,t)=>{const n=$a(s=>s.type===t)(e.selection);if(!n)return!0;const r=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=e.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&vi(e.doc,n.pos)&&e.join(n.pos),!0},Sc=(e,t)=>{const n=$a(s=>s.type===t)(e.selection);if(!n)return!0;const r=e.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=e.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&vi(e.doc,r)&&e.join(r),!0},Zy=(e,t)=>({editor:n,tr:r,state:i,dispatch:o,chain:s,commands:a,can:l})=>{const{extensions:c}=n.extensionManager,f=Ot(e,i.schema),u=Ot(t,i.schema),{selection:d}=i,{$from:p,$to:g}=d,y=p.blockRange(g);if(!y)return!1;const w=$a(E=>kc(E.type.name,c))(d);if(y.depth>=1&&w&&y.depth-w.depth<=1){if(w.node.type===f)return a.liftListItem(u);if(kc(w.node.type.name,c)&&f.validContent(w.node.content)&&o)return s().command(()=>(r.setNodeMarkup(w.pos,f),!0)).command(()=>_c(r,f)).command(()=>Sc(r,f)).run()}return s().command(()=>l().wrapInList(f)?!0:a.clearNodes()).wrapInList(f).command(()=>_c(r,f)).command(()=>Sc(r,f)).run()};var Qy=Object.freeze({__proto__:null,toggleList:Zy});function na(e,t,n={}){const{empty:r,ranges:i}=e.selection,o=t?Mn(t,e.schema):null;if(r)return!!(e.storedMarks||e.selection.$from.marks()).filter(u=>o?o.name===u.type.name:!0).find(u=>so(u.attrs,n,{strict:!1}));let s=0;const a=[];if(i.forEach(({$from:u,$to:d})=>{const p=u.pos,g=d.pos;e.doc.nodesBetween(p,g,(y,w)=>{if(!y.isText&&!y.marks.length)return;const E=Math.max(p,w),_=Math.min(g,w+y.nodeSize);s+=_-E,a.push(...y.marks.map(k=>({mark:k,from:E,to:_})))})}),s===0)return!1;const l=a.filter(u=>o?o.name===u.mark.type.name:!0).filter(u=>so(u.mark.attrs,n,{strict:!1})).reduce((u,d)=>u+d.to-d.from,0),c=a.filter(u=>o?u.mark.type!==o&&u.mark.type.excludes(o):!0).reduce((u,d)=>u+d.to-d.from,0);return(l>0?l+c:l)>=s}const tv=(e,t={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:o=!1}=n,s=Mn(e,r.schema);return na(r,s,t)?i.unsetMark(s,{extendEmptyMarkRange:o}):i.setMark(s,t)};var ev=Object.freeze({__proto__:null,toggleMark:tv});const nv=(e,t,n={})=>({state:r,commands:i})=>{const o=Ot(e,r.schema),s=Ot(t,r.schema);return ii(r,o,n)?i.setNode(s):i.setNode(o,n)};var rv=Object.freeze({__proto__:null,toggleNode:nv});const iv=(e,t={})=>({state:n,commands:r})=>{const i=Ot(e,n.schema);return ii(n,i,t)?r.lift(i):r.wrapIn(i,t)};var ov=Object.freeze({__proto__:null,toggleWrap:iv});const sv=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let o;if(i.spec.isInputRules&&(o=i.getState(e))){if(t){const s=e.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)s.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=s.doc.resolve(o.from).marks();s.replaceWith(o.from,o.to,e.schema.text(o.text,l))}else s.delete(o.from,o.to)}return!0}}return!1};var av=Object.freeze({__proto__:null,undoInputRule:sv});const lv=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:r,ranges:i}=n;return r||t&&i.forEach(o=>{e.removeMark(o.$from.pos,o.$to.pos)}),!0};var cv=Object.freeze({__proto__:null,unsetAllMarks:lv});const uv=(e,t={})=>({tr:n,state:r,dispatch:i})=>{var o;const{extendEmptyMarkRange:s=!1}=t,{selection:a}=n,l=Mn(e,r.schema),{$from:c,empty:f,ranges:u}=a;if(!i)return!0;if(f&&s){let{from:d,to:p}=a;const g=(o=c.marks().find(w=>w.type===l))===null||o===void 0?void 0:o.attrs,y=Wa(c,l,g);y&&(d=y.from,p=y.to),n.removeMark(d,p,l)}else u.forEach(d=>{n.removeMark(d.$from.pos,d.$to.pos,l)});return n.removeStoredMark(l),!0};var fv=Object.freeze({__proto__:null,unsetMark:uv});const hv=(e,t={})=>({tr:n,state:r,dispatch:i})=>{let o=null,s=null;const a=Bo(typeof e=="string"?e:e.name,r.schema);return a?(a==="node"&&(o=Ot(e,r.schema)),a==="mark"&&(s=Mn(e,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,f=l.$to.pos;r.doc.nodesBetween(c,f,(u,d)=>{o&&o===u.type&&n.setNodeMarkup(d,void 0,z(z({},u.attrs),t)),s&&u.marks.length&&u.marks.forEach(p=>{if(s===p.type){const g=Math.max(d,c),y=Math.min(d+u.nodeSize,f);n.addMark(g,y,s.create(z(z({},p.attrs),t)))}})})}),!0):!1};var dv=Object.freeze({__proto__:null,updateAttributes:hv});const pv=(e,t={})=>({state:n,dispatch:r})=>{const i=Ot(e,n.schema);return zp(i,t)(n,r)};var gv=Object.freeze({__proto__:null,wrapIn:pv});const mv=(e,t={})=>({state:n,dispatch:r})=>{const i=Ot(e,n.schema);return Up(i,t)(n,r)};var yv=Object.freeze({__proto__:null,wrapInList:mv});const vv=Qt.create({name:"commands",addCommands(){return z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z(z({},vm),wm),_m),Cm),Mm),Om),Am),Nm),Im),Pm),zm),Um),Jm),Km),Ym),ty),ny),iy),ay),cy),fy),dy),gy),yy),by),ky),Sy),Ey),Ty),xy),Dy),Ry),Ly),By),zy),Uy),Hy),Wy),Ky),Yy),Qy),ev),rv),ov),av),cv),fv),dv),gv),yv)}}),bv=Qt.create({name:"editable",addProseMirrorPlugins(){return[new Kt({key:new he("editable"),props:{editable:()=>this.editor.options.editable}})]}}),wv=Qt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new Kt({key:new he("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const r=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,n)=>{e.isFocused=!1;const r=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}});function zo(e){const{state:t,transaction:n}=e;let{selection:r}=n,{doc:i}=n,{storedMarks:o}=n;return Dt(z({},t),{schema:t.schema,plugins:t.plugins,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,o=n.storedMarks,n}})}class Vo{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:n,state:r}=this,{view:i}=n,{tr:o}=r,s=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...f)=>{const u=l(...f)(s);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(o),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,n=!0){const{rawCommands:r,editor:i,state:o}=this,{view:s}=i,a=[],l=!!t,c=t||o.tr,f=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(c),a.every(d=>d===!0)),u=Dt(z({},Object.fromEntries(Object.entries(r).map(([d,p])=>[d,(...y)=>{const w=this.buildProps(c,n),E=p(...y)(w);return a.push(E),u}]))),{run:f});return u}createCan(t){const{rawCommands:n,state:r}=this,i=void 0,o=t||r.tr,s=this.buildProps(o,i),a=Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...f)=>c(...f)(Dt(z({},s),{dispatch:i}))]));return Dt(z({},a),{chain:()=>this.createChain(o,i)})}buildProps(t,n=!0){const{rawCommands:r,editor:i,state:o}=this,{view:s}=i;o.storedMarks&&t.setStoredMarks(o.storedMarks);const a={tr:t,editor:i,view:s,state:zo({state:o,transaction:t}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(t),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...f)=>c(...f)(a)]))}};return a}}const kv=Qt.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:f,$anchor:u}=l,{pos:d,parent:p}=u,g=tt.atStart(c).from===d;return!f||!g||!p.type.isTextblock||p.textContent.length?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.joinForward(),()=>s.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},i=z({},r),o=Dt(z({},r),{"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()});return Ja()||rh()?o:i},addProseMirrorPlugins(){return[new Kt({key:new he("clearDocument"),appendTransaction:(e,t,n)=>{if(!(e.some(g=>g.docChanged)&&!t.doc.eq(n.doc)))return;const{empty:i,from:o,to:s}=t.selection,a=tt.atStart(t.doc).from,l=tt.atEnd(t.doc).to,c=o===a&&s===l,f=n.doc.textBetween(0,n.doc.content.size," "," ").length===0;if(i||!c||!f)return;const u=n.tr,d=zo({state:n,transaction:u}),{commands:p}=new Vo({editor:this.editor,state:d});if(p.clearNodes(),!!u.steps.length)return u}})]}}),_v=Qt.create({name:"tabindex",addProseMirrorPlugins(){return[new Kt({key:new he("tabindex"),props:{attributes:()=>{if(this.editor.isEditable)return{tabindex:"0"}}}})]}});var Sv=Object.freeze({__proto__:null,ClipboardTextSerializer:mm,Commands:vv,Editable:bv,FocusEvents:wv,Keymap:kv,Tabindex:_v});function Cv(e,t){const n=Ot(t,e.schema),{from:r,to:i}=e.selection,o=[];e.doc.nodesBetween(r,i,a=>{o.push(a)});const s=o.reverse().find(a=>a.type.name===n.name);return s?z({},s.attrs):{}}function Ev(e,t){const n=Bo(typeof t=="string"?t:t.name,e.schema);return n==="node"?Cv(e,t):n==="mark"?oh(e,t):{}}function Mv(e,t,n={}){if(!t)return ii(e,null,n)||na(e,null,n);const r=Bo(t,e.schema);return r==="node"?ii(e,t,n):r==="mark"?na(e,t,n):!1}function Tv(e,t){const n=zt.fromSchema(t).serializeFragment(e),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function Ov(e,t){const n={from:0,to:e.content.size};return th(e,n,t)}function xv(e){var t;const n=(t=e.type.createAndFill())===null||t===void 0?void 0:t.toJSON(),r=e.toJSON();return JSON.stringify(n)===JSON.stringify(r)}function Av(e){const t=document.querySelector("style[data-tiptap-style]");if(t!==null)return t;const n=document.createElement("style");return n.setAttribute("data-tiptap-style",""),n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n),n}class Uo{constructor(t){this.find=t.find,this.handler=t.handler}}const Dv=(e,t)=>{if(qa(t))return t.exec(e);const n=t(e);if(!n)return null;const r=[];return r.push(n.text),r.index=n.index,r.input=e,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function bs(e){var t;const{editor:n,from:r,to:i,text:o,rules:s,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!!(!((t=c.nodeBefore||c.nodeAfter)===null||t===void 0)&&t.marks.find(p=>p.type.spec.code)))return!1;let f=!1;const u=500,d=c.parent.textBetween(Math.max(0,c.parentOffset-u),c.parentOffset,void 0," ")+o;return s.forEach(p=>{if(f)return;const g=Dv(d,p.find);if(!g)return;const y=l.state.tr,w=zo({state:l.state,transaction:y}),E={from:r-(g[0].length-o.length),to:i},{commands:_,chain:b,can:k}=new Vo({editor:n,state:w});p.handler({state:w,range:E,match:g,commands:_,chain:b,can:k})===null||!y.steps.length||(y.setMeta(a,{transform:y,from:r,to:i,text:o}),l.dispatch(y),f=!0)}),f}function Nv(e){const{editor:t,rules:n}=e,r=new Kt({state:{init(){return null},apply(i,o){const s=i.getMeta(this);return s||(i.selectionSet||i.docChanged?null:o)}},props:{handleTextInput(i,o,s,a){return bs({editor:t,from:o,to:s,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:o}=i.state.selection;o&&bs({editor:t,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,o){if(o.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?bs({editor:t,from:s.pos,to:s.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function Rv(e){return typeof e=="number"}class Iv{constructor(t){this.find=t.find,this.handler=t.handler}}const Lv=(e,t)=>{if(qa(t))return[...e.matchAll(t)];const n=t(e);return n?n.map(r=>{const i=[];return i.push(r.text),i.index=r.index,i.input=e,i.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(r.replaceWith)),i}):[]};function Pv(e){const{editor:t,state:n,from:r,to:i,rule:o}=e,{commands:s,chain:a,can:l}=new Vo({editor:t,state:n}),c=[];return n.doc.nodesBetween(r,i,(u,d)=>{if(!u.isTextblock||u.type.spec.code)return;const p=Math.max(r,d),g=Math.min(i,d+u.content.size),y=u.textBetween(p-d,g-d,void 0,"\uFFFC");Lv(y,o.find).forEach(E=>{if(E.index===void 0)return;const _=p+E.index+1,b=_+E[0].length,k={from:n.tr.mapping.map(_),to:n.tr.mapping.map(b)},S=o.handler({state:n,range:k,match:E,commands:s,chain:a,can:l});c.push(S)})}),c.every(u=>u!==null)}function Bv(e){const{editor:t,rules:n}=e;let r=null,i=!1,o=!1;return n.map(a=>new Kt({view(l){const c=f=>{var u;r=!((u=l.dom.parentElement)===null||u===void 0)&&u.contains(f.target)?l.dom.parentElement:null};return window.addEventListener("dragstart",c),{destroy(){window.removeEventListener("dragstart",c)}}},props:{handleDOMEvents:{drop:l=>(o=r===l.dom.parentElement,!1),paste:(l,c)=>{var f;const u=(f=c.clipboardData)===null||f===void 0?void 0:f.getData("text/html");return i=!!(u!=null&&u.includes("data-pm-slice")),!1}}},appendTransaction:(l,c,f)=>{const u=l[0],d=u.getMeta("uiEvent")==="paste"&&!i,p=u.getMeta("uiEvent")==="drop"&&!o;if(!d&&!p)return;const g=c.doc.content.findDiffStart(f.doc.content),y=c.doc.content.findDiffEnd(f.doc.content);if(!Rv(g)||!y||g===y.b)return;const w=f.tr,E=zo({state:f,transaction:w});if(!(!Pv({editor:t,state:E,from:Math.max(g-1,0),to:y.b,rule:a})||!w.steps.length))return w}}))}function sh(e){const t=[],{nodeExtensions:n,markExtensions:r}=Fo(e),i=[...n,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return e.forEach(s=>{const a={name:s.name,options:s.options,storage:s.storage},l=q(s,"addGlobalAttributes",a);if(!l)return;l().forEach(f=>{f.types.forEach(u=>{Object.entries(f.attributes).forEach(([d,p])=>{t.push({type:u,name:d,attribute:z(z({},o),p)})})})})}),i.forEach(s=>{const a={name:s.name,options:s.options,storage:s.storage},l=q(s,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([f,u])=>{t.push({type:s.name,name:f,attribute:z(z({},o),u)})})}),t}function te(...e){return e.filter(t=>!!t).reduce((t,n)=>{const r=z({},t);return Object.entries(n).forEach(([i,o])=>{if(!r[i]){r[i]=o;return}i==="class"?r[i]=[r[i],o].join(" "):i==="style"?r[i]=[r[i],o].join("; "):r[i]=o}),r},{})}function ra(e,t){return t.filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(e.attrs)||{}:{[n.name]:e.attrs[n.name]}).reduce((n,r)=>te(n,r),{})}function Fv(e={}){return Object.keys(e).length===0&&e.constructor===Object}function zv(e){return typeof e!="string"?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):e==="true"?!0:e==="false"?!1:e}function Cc(e,t){return e.style?e:Dt(z({},e),{getAttrs:n=>{const r=e.getAttrs?e.getAttrs(n):e.attrs;if(r===!1)return!1;const i=t.reduce((o,s)=>{const a=s.attribute.parseHTML?s.attribute.parseHTML(n):zv(n.getAttribute(s.name));return a==null?o:Dt(z({},o),{[s.name]:a})},{});return z(z({},r),i)}})}function Ec(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>t==="attrs"&&Fv(n)?!1:n!=null))}function Vv(e){var t;const n=sh(e),{nodeExtensions:r,markExtensions:i}=Fo(e),o=(t=r.find(l=>q(l,"topNode")))===null||t===void 0?void 0:t.name,s=Object.fromEntries(r.map(l=>{const c=n.filter(w=>w.type===l.name),f={name:l.name,options:l.options,storage:l.storage},u=e.reduce((w,E)=>{const _=q(E,"extendNodeSchema",f);return z(z({},w),_?_(l):{})},{}),d=Ec(Dt(z({},u),{content:nt(q(l,"content",f)),marks:nt(q(l,"marks",f)),group:nt(q(l,"group",f)),inline:nt(q(l,"inline",f)),atom:nt(q(l,"atom",f)),selectable:nt(q(l,"selectable",f)),draggable:nt(q(l,"draggable",f)),code:nt(q(l,"code",f)),defining:nt(q(l,"defining",f)),isolating:nt(q(l,"isolating",f)),attrs:Object.fromEntries(c.map(w=>{var E;return[w.name,{default:(E=w==null?void 0:w.attribute)===null||E===void 0?void 0:E.default}]}))})),p=nt(q(l,"parseHTML",f));p&&(d.parseDOM=p.map(w=>Cc(w,c)));const g=q(l,"renderHTML",f);g&&(d.toDOM=w=>g({node:w,HTMLAttributes:ra(w,c)}));const y=q(l,"renderText",f);return y&&(d.toText=y),[l.name,d]})),a=Object.fromEntries(i.map(l=>{const c=n.filter(y=>y.type===l.name),f={name:l.name,options:l.options,storage:l.storage},u=e.reduce((y,w)=>{const E=q(w,"extendMarkSchema",f);return z(z({},y),E?E(l):{})},{}),d=Ec(Dt(z({},u),{inclusive:nt(q(l,"inclusive",f)),excludes:nt(q(l,"excludes",f)),group:nt(q(l,"group",f)),spanning:nt(q(l,"spanning",f)),code:nt(q(l,"code",f)),attrs:Object.fromEntries(c.map(y=>{var w;return[y.name,{default:(w=y==null?void 0:y.attribute)===null||w===void 0?void 0:w.default}]}))})),p=nt(q(l,"parseHTML",f));p&&(d.parseDOM=p.map(y=>Cc(y,c)));const g=q(l,"renderHTML",f);return g&&(d.toDOM=y=>g({mark:y,HTMLAttributes:ra(y,c)})),[l.name,d]}));return new Kn({topNode:o,nodes:s,marks:a})}function ws(e,t){return t.nodes[e]||t.marks[e]||null}function Mc(e,t){return Array.isArray(t)?t.some(n=>(typeof n=="string"?n:n.name)===e.name):t}function Uv(e){const t=e.filter((n,r)=>e.indexOf(n)!==r);return[...new Set(t)]}class ar{constructor(t,n){this.splittableMarks=[],this.editor=n,this.extensions=ar.resolve(t),this.schema=Vv(this.extensions),this.extensions.forEach(r=>{var i;this.editor.extensionStorage[r.name]=r.storage;const o={name:r.name,options:r.options,storage:r.storage,editor:this.editor,type:ws(r.name,this.schema)};r.type==="mark"&&((i=nt(q(r,"keepOnSplit",o)))!==null&&i!==void 0?i:!0)&&this.splittableMarks.push(r.name);const s=q(r,"onBeforeCreate",o);s&&this.editor.on("beforeCreate",s);const a=q(r,"onCreate",o);a&&this.editor.on("create",a);const l=q(r,"onUpdate",o);l&&this.editor.on("update",l);const c=q(r,"onSelectionUpdate",o);c&&this.editor.on("selectionUpdate",c);const f=q(r,"onTransaction",o);f&&this.editor.on("transaction",f);const u=q(r,"onFocus",o);u&&this.editor.on("focus",u);const d=q(r,"onBlur",o);d&&this.editor.on("blur",d);const p=q(r,"onDestroy",o);p&&this.editor.on("destroy",p)})}static resolve(t){const n=ar.sort(ar.flatten(t)),r=Uv(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(t){return t.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=q(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(t){return t.sort((r,i)=>{const o=q(r,"priority")||100,s=q(i,"priority")||100;return o>s?-1:o<s?1:0})}get commands(){return this.extensions.reduce((t,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:ws(n.name,this.schema)},i=q(n,"addCommands",r);return i?z(z({},t),i()):t},{})}get plugins(){const{editor:t}=this,n=ar.sort([...this.extensions].reverse()),r=[],i=[],o=n.map(s=>{const a={name:s.name,options:s.options,storage:s.storage,editor:t,type:ws(s.name,this.schema)},l=[],c=q(s,"addKeyboardShortcuts",a);if(c){const p=Object.fromEntries(Object.entries(c()).map(([y,w])=>[y,()=>w({editor:t})])),g=pm(p);l.push(g)}const f=q(s,"addInputRules",a);Mc(s,t.options.enableInputRules)&&f&&r.push(...f());const u=q(s,"addPasteRules",a);Mc(s,t.options.enablePasteRules)&&u&&i.push(...u());const d=q(s,"addProseMirrorPlugins",a);if(d){const p=d();l.push(...p)}return l}).flat();return[Nv({editor:t,rules:r}),...Bv({editor:t,rules:i}),...o]}get attributes(){return sh(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:n}=Fo(this.extensions);return Object.fromEntries(n.filter(r=>!!q(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),o={name:r.name,options:r.options,storage:r.storage,editor:t,type:Ot(r.name,this.schema)},s=q(r,"addNodeView",o);if(!s)return[];const a=(l,c,f,u)=>{const d=ra(l,i);return s()({editor:t,node:l,getPos:f,decorations:u,HTMLAttributes:d,extension:r})};return[r.name,a]}))}}class jv{constructor(){this.callbacks={}}on(t,n){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(n),this}emit(t,...n){const r=this.callbacks[t];return r&&r.forEach(i=>i.apply(this,n)),this}off(t,n){const r=this.callbacks[t];return r&&(n?this.callbacks[t]=r.filter(i=>i!==n):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}const Hv=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class qv extends jv{constructor(t={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Av(Hv))}setOptions(t={}){this.options=z(z({},this.options),t),!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t){this.setOptions({editable:t})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,n){const r=Qf(n)?n(t,this.state.plugins):[...this.state.plugins,t],i=this.state.reconfigure({plugins:r});this.view.updateState(i)}unregisterPlugin(t){if(this.isDestroyed)return;const n=typeof t=="string"?`${t}$`:t.key,r=this.state.reconfigure({plugins:this.state.plugins.filter(i=>!i.key.startsWith(n))});this.view.updateState(r)}createExtensionManager(){const n=[...this.options.enableCoreExtensions?Object.values(Sv):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new ar(n,this)}createCommandManager(){this.commandManager=new Vo({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const t=ih(this.options.content,this.schema,this.options.parseOptions),n=nh(t,this.options.autofocus);this.view=new Mt(this.options.element,Dt(z({},this.options.editorProps),{dispatchTransaction:this.dispatchTransaction.bind(this),state:Jt.create({doc:t,selection:n})}));const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(t){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(s=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(s)});return}const n=this.state.apply(t),r=!this.state.selection.eq(n.selection);this.view.updateState(n),this.emit("transaction",{editor:this,transaction:t}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const i=t.getMeta("focus"),o=t.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:t}),o&&this.emit("blur",{editor:this,event:o.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return Ev(this.state,t)}isActive(t,n){const r=typeof t=="string"?t:null,i=typeof t=="string"?n:t;return Mv(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Tv(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:n=`

`,textSerializers:r={}}=t||{};return Ov(this.state.doc,{blockSeparator:n,textSerializers:z(z({},r),eh(this.schema))})}get isEmpty(){return xv(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}}class se{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=z(z({},this.config),t),this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=nt(q(this,"addOptions",{name:this.name}))),this.storage=nt(q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new se(t)}configure(t={}){const n=this.extend();return n.options=Po(this.options,t),n.storage=nt(q(n,"addStorage",{name:n.name,options:n.options})),n}extend(t={}){const n=new se(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=nt(q(n,"addOptions",{name:n.name})),n.storage=nt(q(n,"addStorage",{name:n.name,options:n.options})),n}}class Un{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=z(z({},this.config),t),this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=nt(q(this,"addOptions",{name:this.name}))),this.storage=nt(q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Un(t)}configure(t={}){const n=this.extend();return n.options=Po(this.options,t),n.storage=nt(q(n,"addStorage",{name:n.name,options:n.options})),n}extend(t={}){const n=new Un(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=nt(q(n,"addOptions",{name:n.name})),n.storage=nt(q(n,"addStorage",{name:n.name,options:n.options})),n}}function Wv(e){return new Uo({find:e.find,handler:({state:t,range:n,match:r})=>{const i=nt(e.getAttributes,void 0,r)||{},{tr:o}=t,s=n.from;let a=n.to;if(r[1]){const l=r[0].lastIndexOf(r[1]);let c=s+l;c>a?c=a:a=c+r[1].length;const f=r[0][r[0].length-1];o.insertText(f,s+r[0].length-1),o.replaceWith(c,a,e.type.create(i))}else r[0]&&o.replaceWith(s,a,e.type.create(i))}})}function ah(e,t,n){const r=[];return e===t?n.resolve(e).marks().forEach(i=>{const o=n.resolve(e-1),s=Wa(o,i.type);!s||r.push(z({mark:i},s))}):n.nodesBetween(e,t,(i,o)=>{r.push(...i.marks.map(s=>({from:o,to:o+i.nodeSize,mark:s})))}),r}function vr(e){return new Uo({find:e.find,handler:({state:t,range:n,match:r})=>{const i=nt(e.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:o}=t,s=r[r.length-1],a=r[0];let l=n.to;if(s){const c=a.search(/\S/),f=n.from+a.indexOf(s),u=f+s.length;if(ah(n.from,n.to,t.doc).filter(p=>p.mark.type.excluded.find(y=>y===e.type&&y!==p.mark.type)).filter(p=>p.to>f).length)return null;u<n.to&&o.delete(u,n.to),f>n.from&&o.delete(n.from+c,f),l=n.from+c+s.length,o.addMark(n.from+c,l,e.type.create(i||{})),o.removeStoredMark(e.type)}}})}function ia(e){return new Uo({find:e.find,handler:({state:t,range:n,match:r})=>{const i=t.doc.resolve(n.from),o=nt(e.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,o)}})}function Ka(e){return new Uo({find:e.find,handler:({state:t,range:n,match:r})=>{const i=nt(e.getAttributes,void 0,r)||{},o=t.tr.delete(n.from,n.to),a=o.doc.resolve(n.from).blockRange(),l=a&&_a(a,e.type,i);if(!l)return null;o.wrap(a,l);const c=o.doc.resolve(n.from-1).nodeBefore;c&&c.type===e.type&&vi(o.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(r,c))&&o.join(n.from-1)}})}function br(e){return new Iv({find:e.find,handler:({state:t,range:n,match:r})=>{const i=nt(e.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:o}=t,s=r[r.length-1],a=r[0];let l=n.to;if(s){const c=a.search(/\S/),f=n.from+a.indexOf(s),u=f+s.length;if(ah(n.from,n.to,t.doc).filter(p=>p.mark.type.excluded.find(y=>y===e.type&&y!==p.mark.type)).filter(p=>p.to>f).length)return null;u<n.to&&o.delete(u,n.to),f>n.from&&o.delete(n.from+c,f),l=n.from+c+s.length,o.addMark(n.from+c,l,e.type.create(i||{})),o.removeStoredMark(e.type)}}})}const Jv=/^\s*>\s$/,$v=se.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:e}){return["blockquote",te(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Ka({find:Jv,type:this.type})]}}),Kv=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,Gv=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,Yv=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,Xv=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,Zv=Un.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",te(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[vr({find:Kv,type:this.type}),vr({find:Yv,type:this.type})]},addPasteRules(){return[br({find:Gv,type:this.type}),br({find:Xv,type:this.type})]}}),Qv=/^\s*([-+*])\s$/,t0=se.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:e}){return["ul",te(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Ka({find:Qv,type:this.type})]}}),e0=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,n0=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,r0=Un.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",te(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[vr({find:e0,type:this.type})]},addPasteRules(){return[br({find:n0,type:this.type})]}}),i0=/^```([a-z]+)?[\s\n]$/,o0=/^~~~([a-z]+)?[\s\n]$/,s0=se.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,o=[...((t=e.firstElementChild)===null||t===void 0?void 0:t.classList)||[]].filter(s=>s.startsWith(n)).map(s=>s.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",te(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=t.pos===1;return!e||t.parent.type.name!==this.name?!1:n||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const o=r.parentOffset===r.parent.nodeSize-2,s=r.parent.textContent.endsWith(`

`);return!o||!s?!1:e.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:r}=t,{$from:i,empty:o}=n;if(!o||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0||r.nodeAt(a)?!1:e.commands.exitCode()}}},addInputRules(){return[ia({find:i0,type:this.type,getAttributes:e=>({language:e[1]})}),ia({find:o0,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new Kt({key:new he("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,o=i==null?void 0:i.mode;if(!n||!o)return!1;const{tr:s}=e.state;return s.replaceSelectionWith(this.type.create({language:o})),s.setSelection(rt.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.insertText(n.replace(/\r\n?/g,`
`)),s.setMeta("paste",!0),e.dispatch(s),!0}}})]}}),a0=se.create({name:"doc",topNode:!0,content:"block+"});function l0(e){return e===void 0&&(e={}),new Kt({view:function(n){return new We(n,e)}})}var We=function(t,n){var r=this;this.editorView=t,this.width=n.width||1,this.color=n.color||"black",this.class=n.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(i){var o=function(s){return r[i](s)};return t.dom.addEventListener(i,o),{name:i,handler:o}})};We.prototype.destroy=function(){var t=this;this.handlers.forEach(function(n){var r=n.name,i=n.handler;return t.editorView.dom.removeEventListener(r,i)})};We.prototype.update=function(t,n){this.cursorPos!=null&&n.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())};We.prototype.setCursor=function(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};We.prototype.updateOverlay=function(){var t=this.editorView.state.doc.resolve(this.cursorPos),n;if(!t.parent.inlineContent){var r=t.nodeBefore,i=t.nodeAfter;if(r||i){var o=this.editorView.nodeDOM(this.cursorPos-(r?r.nodeSize:0)).getBoundingClientRect(),s=r?o.bottom:o.top;r&&i&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:o.left,right:o.right,top:s-this.width/2,bottom:s+this.width/2}}}if(!n){var a=this.editorView.coordsAtPos(this.cursorPos);n={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}var l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var c,f;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,f=-pageYOffset;else{var u=l.getBoundingClientRect();c=u.left-l.scrollLeft,f=u.top-l.scrollTop}this.element.style.left=n.left-c+"px",this.element.style.top=n.top-f+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"};We.prototype.scheduleRemoval=function(t){var n=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return n.setCursor(null)},t)};We.prototype.dragover=function(t){if(!!this.editorView.editable){var n=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,o=typeof i=="function"?i(this.editorView,n):i;if(n&&!o){var s=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(s=ju(this.editorView.state.doc,s,this.editorView.dragging.slice),s==null))return this.setCursor(null);this.setCursor(s),this.scheduleRemoval(5e3)}}};We.prototype.dragend=function(){this.scheduleRemoval(20)};We.prototype.drop=function(){this.scheduleRemoval(20)};We.prototype.dragleave=function(t){(t.target==this.editorView.dom||!this.editorView.dom.contains(t.relatedTarget))&&this.setCursor(null)};const c0=Qt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[l0(this.options)]}});var be=function(e){function t(n){e.call(this,n,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.map=function(r,i){var o=r.resolve(i.map(this.head));return t.valid(o)?new t(o):e.near(o)},t.prototype.content=function(){return H.empty},t.prototype.eq=function(r){return r instanceof t&&r.head==this.head},t.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},t.fromJSON=function(r,i){if(typeof i.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new t(r.resolve(i.pos))},t.prototype.getBookmark=function(){return new lo(this.anchor)},t.valid=function(r){var i=r.parent;if(i.isTextblock||!u0(r)||!f0(r))return!1;var o=i.type.spec.allowGapCursor;if(o!=null)return o;var s=i.contentMatchAt(r.index()).defaultType;return s&&s.isTextblock},t.findFrom=function(r,i,o){t:for(;;){if(!o&&t.valid(r))return r;for(var s=r.pos,a=null,l=r.depth;;l--){var c=r.node(l);if(i>0?r.indexAfter(l)<c.childCount:r.index(l)>0){a=c.child(i>0?r.indexAfter(l):r.index(l)-1);break}else if(l==0)return null;s+=i;var f=r.doc.resolve(s);if(t.valid(f))return f}for(;;){var u=i>0?a.firstChild:a.lastChild;if(!u){if(a.isAtom&&!a.isText&&!et.isSelectable(a)){r=r.doc.resolve(s+a.nodeSize*i),o=!1;continue t}break}a=u,s+=i;var d=r.doc.resolve(s);if(t.valid(d))return d}return null}},t}(tt);be.prototype.visible=!1;tt.jsonID("gapcursor",be);var lo=function(t){this.pos=t};lo.prototype.map=function(t){return new lo(t.map(this.pos))};lo.prototype.resolve=function(t){var n=t.resolve(this.pos);return be.valid(n)?new be(n):tt.near(n)};function u0(e){for(var t=e.depth;t>=0;t--){var n=e.index(t),r=e.node(t);if(n==0){if(r.type.spec.isolating)return!0;continue}for(var i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function f0(e){for(var t=e.depth;t>=0;t--){var n=e.indexAfter(t),r=e.node(t);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(var i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}var h0=function(){return new Kt({props:{decorations:m0,createSelectionBetween:function(t,n,r){if(n.pos==r.pos&&be.valid(r))return new be(r)},handleClick:p0,handleKeyDown:d0,handleDOMEvents:{beforeinput:g0}}})},d0=Zf({ArrowLeft:Ii("horiz",-1),ArrowRight:Ii("horiz",1),ArrowUp:Ii("vert",-1),ArrowDown:Ii("vert",1)});function Ii(e,t){var n=e=="vert"?t>0?"down":"up":t>0?"right":"left";return function(r,i,o){var s=r.selection,a=t>0?s.$to:s.$from,l=s.empty;if(s instanceof rt){if(!o.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(t>0?a.after():a.before())}var c=be.findFrom(a,t,l);return c?(i&&i(r.tr.setSelection(new be(c))),!0):!1}}function p0(e,t,n){if(!e.editable)return!1;var r=e.state.doc.resolve(t);if(!be.valid(r))return!1;var i=e.posAtCoords({left:n.clientX,top:n.clientY}),o=i.inside;return o>-1&&et.isSelectable(e.state.doc.nodeAt(o))?!1:(e.dispatch(e.state.tr.setSelection(new be(r))),!0)}function g0(e,t){if(t.inputType!="insertCompositionText"||!(e.state.selection instanceof be))return!1;var n=e.state.selection,r=n.$from,i=r.parent.contentMatchAt(r.index()).findWrapping(e.state.schema.nodes.text);if(!i)return!1;for(var o=B.empty,s=i.length-1;s>=0;s--)o=B.from(i[s].createAndFill(null,o));var a=e.state.tr.replace(r.pos,r.pos,new H(o,0,0));return a.setSelection(rt.near(a.doc.resolve(r.pos+1))),e.dispatch(a),!1}function m0(e){if(!(e.selection instanceof be))return null;var t=document.createElement("div");return t.className="ProseMirror-gapcursor",ct.create(e.doc,[Et.widget(e.selection.head,t,{key:"gapcursor"})])}const y0=Qt.create({name:"gapCursor",addProseMirrorPlugins(){return[h0()]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=nt(q(e,"allowGapCursor",n)))!==null&&t!==void 0?t:null}}}),v0=se.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",te(this.options.HTMLAttributes,e)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command(()=>{const{selection:i,storedMarks:o}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:a}=r.extensionManager,l=o||i.$to.parentOffset&&i.$from.marks();return t().insertContent({type:this.name}).command(({tr:c,dispatch:f})=>{if(f&&l&&s){const u=l.filter(d=>a.includes(d.type.name));c.ensureMarks(u)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),b0=se.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,te(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.setNode(this.name,e):!1,toggleHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.toggleNode(this.name,"paragraph",e):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>Dt(z({},e),{[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>ia({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}});var co=200,Bt=function(){};Bt.prototype.append=function(t){return t.length?(t=Bt.from(t),!this.length&&t||t.length<co&&this.leafAppend(t)||this.length<co&&t.leafPrepend(this)||this.appendInner(t)):this};Bt.prototype.prepend=function(t){return t.length?Bt.from(t).append(this):this};Bt.prototype.appendInner=function(t){return new w0(this,t)};Bt.prototype.slice=function(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.length),t>=n?Bt.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,n))};Bt.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};Bt.prototype.forEach=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(t,n,r,0):this.forEachInvertedInner(t,n,r,0)};Bt.prototype.map=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(o,s){return i.push(t(o,s))},n,r),i};Bt.from=function(t){return t instanceof Bt?t:t&&t.length?new lh(t):Bt.empty};var lh=function(e){function t(r){e.call(this),this.values=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(i,o){return i==0&&o==this.length?this:new t(this.values.slice(i,o))},t.prototype.getInner=function(i){return this.values[i]},t.prototype.forEachInner=function(i,o,s,a){for(var l=o;l<s;l++)if(i(this.values[l],a+l)===!1)return!1},t.prototype.forEachInvertedInner=function(i,o,s,a){for(var l=o-1;l>=s;l--)if(i(this.values[l],a+l)===!1)return!1},t.prototype.leafAppend=function(i){if(this.length+i.length<=co)return new t(this.values.concat(i.flatten()))},t.prototype.leafPrepend=function(i){if(this.length+i.length<=co)return new t(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(Bt);Bt.empty=new lh([]);var w0=function(e){function t(n,r){e.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,i,o,s){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(o,a),s)===!1||o>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,o)-a,s+a)===!1)return!1},t.prototype.forEachInvertedInner=function(r,i,o,s){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(o,a)-a,s+a)===!1||o<a&&this.left.forEachInvertedInner(r,Math.min(i,a),o,s)===!1)return!1},t.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var o=this.left.length;return i<=o?this.left.slice(r,i):r>=o?this.right.slice(r-o,i-o):this.left.slice(r,o).append(this.right.slice(0,i-o))},t.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new t(this.left,i)},t.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new t(i,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(Bt),ch=Bt,k0=500,Ut=function(t,n){this.items=t,this.eventCount=n};Ut.prototype.popEvent=function(t,n){var r=this;if(this.eventCount==0)return null;for(var i=this.items.length;;i--){var o=this.items.get(i-1);if(o.selection){--i;break}}var s,a;n&&(s=this.remapping(i,this.items.length),a=s.maps.length);var l=t.tr,c,f,u=[],d=[];return this.items.forEach(function(p,g){if(!p.step){s||(s=r.remapping(i,g+1),a=s.maps.length),a--,d.push(p);return}if(s){d.push(new ze(p.map));var y=p.step.map(s.slice(a)),w;y&&l.maybeStep(y).doc&&(w=l.mapping.maps[l.mapping.maps.length-1],u.push(new ze(w,null,null,u.length+d.length))),a--,w&&s.appendMap(w,a)}else l.maybeStep(p.step);if(p.selection)return c=s?p.selection.map(s.slice(a)):p.selection,f=new Ut(r.items.slice(0,i).append(d.reverse().concat(u)),r.eventCount-1),!1},this.items.length,0),{remaining:f,transform:l,selection:c}};Ut.prototype.addTransform=function(t,n,r,i){for(var o=[],s=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null,c=0;c<t.steps.length;c++){var f=t.steps[c].invert(t.docs[c]),u=new ze(t.mapping.maps[c],f,n),d=void 0;(d=l&&l.merge(u))&&(u=d,c?o.pop():a=a.slice(0,a.length-1)),o.push(u),n&&(s++,n=null),i||(l=u)}var p=s-r.depth;return p>S0&&(a=_0(a,p),s-=p),new Ut(a.append(o),s)};Ut.prototype.remapping=function(t,n){var r=new Wt;return this.items.forEach(function(i,o){var s=i.mirrorOffset!=null&&o-i.mirrorOffset>=t?r.maps.length-i.mirrorOffset:null;r.appendMap(i.map,s)},t,n),r};Ut.prototype.addMaps=function(t){return this.eventCount==0?this:new Ut(this.items.append(t.map(function(n){return new ze(n)})),this.eventCount)};Ut.prototype.rebased=function(t,n){if(!this.eventCount)return this;var r=[],i=Math.max(0,this.items.length-n),o=t.mapping,s=t.steps.length,a=this.eventCount;this.items.forEach(function(p){p.selection&&a--},i);var l=n;this.items.forEach(function(p){var g=o.getMirror(--l);if(g!=null){s=Math.min(s,g);var y=o.maps[g];if(p.step){var w=t.steps[g].invert(t.docs[g]),E=p.selection&&p.selection.map(o.slice(l+1,g));E&&a++,r.push(new ze(y,w,E))}else r.push(new ze(y))}},i);for(var c=[],f=n;f<s;f++)c.push(new ze(o.maps[f]));var u=this.items.slice(0,i).append(c).append(r),d=new Ut(u,a);return d.emptyItemCount()>k0&&(d=d.compress(this.items.length-r.length)),d};Ut.prototype.emptyItemCount=function(){var t=0;return this.items.forEach(function(n){n.step||t++}),t};Ut.prototype.compress=function(t){t===void 0&&(t=this.items.length);var n=this.remapping(0,t),r=n.maps.length,i=[],o=0;return this.items.forEach(function(s,a){if(a>=t)i.push(s),s.selection&&o++;else if(s.step){var l=s.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){var f=s.selection&&s.selection.map(n.slice(r));f&&o++;var u=new ze(c.invert(),l,f),d,p=i.length-1;(d=i.length&&i[p].merge(u))?i[p]=d:i.push(u)}}else s.map&&r--},this.items.length,0),new Ut(ch.from(i.reverse()),o)};Ut.empty=new Ut(ch.empty,0);function _0(e,t){var n;return e.forEach(function(r,i){if(r.selection&&t--==0)return n=i,!1}),e.slice(n)}var ze=function(t,n,r,i){this.map=t,this.step=n,this.selection=r,this.mirrorOffset=i};ze.prototype.merge=function(t){if(this.step&&t.step&&!t.selection){var n=t.step.merge(this.step);if(n)return new ze(n.getMap().invert(),n,this.selection)}};var pn=function(t,n,r,i){this.done=t,this.undone=n,this.prevRanges=r,this.prevTime=i},S0=20;function C0(e,t,n,r){var i=n.getMeta(vn),o;if(i)return i.historyState;n.getMeta(M0)&&(e=new pn(e.done,e.undone,null,0));var s=n.getMeta("appendedTransaction");if(n.steps.length==0)return e;if(s&&s.getMeta(vn))return s.getMeta(vn).redo?new pn(e.done.addTransform(n,null,r,ji(t)),e.undone,Tc(n.mapping.maps[n.steps.length-1]),e.prevTime):new pn(e.done,e.undone.addTransform(n,null,r,ji(t)),null,e.prevTime);if(n.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){var a=e.prevTime==0||!s&&(e.prevTime<(n.time||0)-r.newGroupDelay||!E0(n,e.prevRanges)),l=s?ks(e.prevRanges,n.mapping):Tc(n.mapping.maps[n.steps.length-1]);return new pn(e.done.addTransform(n,a?t.selection.getBookmark():null,r,ji(t)),Ut.empty,l,n.time)}else return(o=n.getMeta("rebased"))?new pn(e.done.rebased(n,o),e.undone.rebased(n,o),ks(e.prevRanges,n.mapping),e.prevTime):new pn(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),ks(e.prevRanges,n.mapping),e.prevTime)}function E0(e,t){if(!t)return!1;if(!e.docChanged)return!0;var n=!1;return e.mapping.maps[0].forEach(function(r,i){for(var o=0;o<t.length;o+=2)r<=t[o+1]&&i>=t[o]&&(n=!0)}),n}function Tc(e){var t=[];return e.forEach(function(n,r,i,o){return t.push(i,o)}),t}function ks(e,t){if(!e)return null;for(var n=[],r=0;r<e.length;r+=2){var i=t.map(e[r],1),o=t.map(e[r+1],-1);i<=o&&n.push(i,o)}return n}function uh(e,t,n,r){var i=ji(t),o=vn.get(t).spec.config,s=(r?e.undone:e.done).popEvent(t,i);if(!!s){var a=s.selection.resolve(s.transform.doc),l=(r?e.done:e.undone).addTransform(s.transform,t.selection.getBookmark(),o,i),c=new pn(r?l:s.remaining,r?s.remaining:l,null,0);n(s.transform.setSelection(a).setMeta(vn,{redo:r,historyState:c}).scrollIntoView())}}var _s=!1,Oc=null;function ji(e){var t=e.plugins;if(Oc!=t){_s=!1,Oc=t;for(var n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){_s=!0;break}}return _s}var vn=new he("history"),M0=new he("closeHistory");function T0(e){return e={depth:e&&e.depth||100,newGroupDelay:e&&e.newGroupDelay||500},new Kt({key:vn,state:{init:function(){return new pn(Ut.empty,Ut.empty,null,0)},apply:function(n,r,i){return C0(r,i,n,e)}},config:e,props:{handleDOMEvents:{beforeinput:function(n,r){var i=r.inputType=="historyUndo"?fh(n.state,n.dispatch):r.inputType=="historyRedo"?hh(n.state,n.dispatch):!1;return i&&r.preventDefault(),i}}}})}function fh(e,t){var n=vn.getState(e);return!n||n.done.eventCount==0?!1:(t&&uh(n,e,t,!1),!0)}function hh(e,t){var n=vn.getState(e);return!n||n.undone.eventCount==0?!1:(t&&uh(n,e,t,!0),!0)}const O0=Qt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>fh(e,t),redo:()=>({state:e,dispatch:t})=>hh(e,t)}},addProseMirrorPlugins(){return[T0(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),x0=se.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:e}){return["hr",te(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e})=>e().insertContent({type:this.name}).command(({tr:t,dispatch:n})=>{var r;if(n){const{$to:i}=t.selection,o=i.end();if(i.nodeAfter)t.setSelection(rt.create(t.doc,i.pos));else{const s=(r=i.parent.type.contentMatch.defaultType)===null||r===void 0?void 0:r.create();s&&(t.insert(o,s),t.setSelection(rt.create(t.doc,o)))}t.scrollIntoView()}return!0}).run()}},addInputRules(){return[Wv({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),A0=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,D0=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,N0=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,R0=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,I0=Un.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>e.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",te(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[vr({find:A0,type:this.type}),vr({find:N0,type:this.type})]},addPasteRules(){return[br({find:D0,type:this.type}),br({find:R0,type:this.type})]}}),L0=se.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",te(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),P0=/^(\d+)\.\s$/,B0=se.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:e}){const r=e,{start:t}=r,n=Rl(r,["start"]);return t===1?["ol",te(this.options.HTMLAttributes,n),0]:["ol",te(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Ka({find:P0,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]})]}}),F0=se.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:e}){return["p",te(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),z0=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,V0=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,U0=Un.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["s",te(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[vr({find:z0,type:this.type})]},addPasteRules(){return[br({find:V0,type:this.type})]}}),j0=se.create({name:"text",group:"inline"}),H0=Qt.create({name:"starterKit",addExtensions(){var e,t,n,r,i,o,s,a,l,c,f,u,d,p,g,y,w,E;const _=[];return this.options.blockquote!==!1&&_.push($v.configure((e=this.options)===null||e===void 0?void 0:e.blockquote)),this.options.bold!==!1&&_.push(Zv.configure((t=this.options)===null||t===void 0?void 0:t.bold)),this.options.bulletList!==!1&&_.push(t0.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&_.push(r0.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&_.push(s0.configure((i=this.options)===null||i===void 0?void 0:i.codeBlock)),this.options.document!==!1&&_.push(a0.configure((o=this.options)===null||o===void 0?void 0:o.document)),this.options.dropcursor!==!1&&_.push(c0.configure((s=this.options)===null||s===void 0?void 0:s.dropcursor)),this.options.gapcursor!==!1&&_.push(y0.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&_.push(v0.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&_.push(b0.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&_.push(O0.configure((f=this.options)===null||f===void 0?void 0:f.history)),this.options.horizontalRule!==!1&&_.push(x0.configure((u=this.options)===null||u===void 0?void 0:u.horizontalRule)),this.options.italic!==!1&&_.push(I0.configure((d=this.options)===null||d===void 0?void 0:d.italic)),this.options.listItem!==!1&&_.push(L0.configure((p=this.options)===null||p===void 0?void 0:p.listItem)),this.options.orderedList!==!1&&_.push(B0.configure((g=this.options)===null||g===void 0?void 0:g.orderedList)),this.options.paragraph!==!1&&_.push(F0.configure((y=this.options)===null||y===void 0?void 0:y.paragraph)),this.options.strike!==!1&&_.push(U0.configure((w=this.options)===null||w===void 0?void 0:w.strike)),this.options.text!==!1&&_.push(j0.configure((E=this.options)===null||E===void 0?void 0:E.text)),_}}),Ae=()=>new Map,uo=e=>{const t=Ae();return e.forEach((n,r)=>{t.set(r,n)}),t},ue=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},q0=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},W0=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},wr=()=>new Set,Ss=e=>e[e.length-1],J0=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},dh=Array.from,$0=Array.isArray;class xr{constructor(){this._observers=Ae()}on(t,n){ue(this._observers,t,wr).add(n)}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return dh((this._observers.get(t)||Ae()).values()).forEach(r=>r(...n))}destroy(){this._observers=Ae()}}const jn=Math.floor,Hi=Math.abs,K0=Math.log10,bn=(e,t)=>e<t?e:t,tn=(e,t)=>e>t?e:t,ph=e=>e!==0?e<0:1/e<0,G0=String.fromCharCode,Y0=e=>e.toLowerCase(),X0=/^\s*/g,Z0=e=>e.replace(X0,""),Q0=/([A-Z])/g,xc=(e,t)=>Z0(e.replace(Q0,n=>`${t}${Y0(n)}`)),tb=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},gh=typeof TextEncoder!="undefined"?new TextEncoder:null,eb=e=>gh.encode(e),Ac=gh?eb:tb;let Cs=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Cs&&Cs.decode(new Uint8Array).length===1&&(Cs=null);const Dc=e=>e===void 0?null:e;class nb{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let mh=new nb,yh=!0;try{typeof localStorage!="undefined"&&(mh=localStorage,yh=!1)}catch{}const vh=mh,rb=e=>yh||addEventListener("storage",e),jo=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Ga=typeof window!="undefined"&&!jo;typeof navigator!="undefined"&&/Mac/.test(navigator.platform);let Le;const ib=()=>{if(Le===void 0)if(jo){Le=Ae();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Le.set(t,""),t=r):t!==null&&(Le.set(t,r),t=null)}t!==null&&Le.set(t,"")}else typeof location=="object"?(Le=Ae(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Le.set(`--${xc(t,"-")}`,n),Le.set(`-${xc(t,"-")}`,n)}})):Le=Ae();return Le},ob=e=>ib().has(e),bh=e=>Dc(jo?process.env[e.toUpperCase()]:vh.getItem(e)),sb=e=>ob("--"+e)||bh(e)!==null;sb("production");const Nc=1,Rc=2,Es=4,Ms=8,oi=32,Xe=64,le=128,Ho=31,oa=63,Bn=127,ab=2147483647;class qo{constructor(t){this.arr=t,this.pos=0}}const Je=e=>new qo(e),lb=e=>e.pos!==e.arr.length,cb=(e,t)=>{const n=Za(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},It=e=>cb(e,Z(e)),Hn=e=>e.arr[e.pos++],Z=e=>{let t=0,n=0;for(;;){const r=e.arr[e.pos++];if(t=t|(r&Bn)<<n,n+=7,r<le)return t>>>0;if(n>53)throw new Error("Integer out of range!")}},Ya=e=>{let t=e.arr[e.pos++],n=t&oa,r=6;const i=(t&Xe)>0?-1:1;if((t&le)===0)return i*n;for(;;){if(t=e.arr[e.pos++],n=n|(t&Bn)<<r,r+=7,t<le)return i*(n>>>0);if(r>53)throw new Error("Integer out of range!")}},Ze=e=>{let t=Z(e);if(t===0)return"";{let n=String.fromCodePoint(Hn(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Hn(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Xa=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},ub=e=>Xa(e,4).getFloat32(0,!1),fb=e=>Xa(e,8).getFloat64(0,!1),hb=e=>Xa(e,8).getBigInt64(0,!1),db=[e=>{},e=>null,Ya,ub,fb,hb,e=>!1,e=>!0,Ze,e=>{const t=Z(e),n={};for(let r=0;r<t;r++){const i=Ze(e);n[i]=kr(e)}return n},e=>{const t=Z(e),n=[];for(let r=0;r<t;r++)n.push(kr(e));return n},It],kr=e=>db[127-Hn(e)](e);class Ic extends qo{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),lb(this)?this.count=Z(this)+1:this.count=-1),this.count--,this.s}}class qi extends qo{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ya(this);const t=ph(this.s);this.count=1,t&&(this.s=-this.s,this.count=Z(this)+2)}return this.count--,this.s}}class Ts extends qo{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Ya(this),n=t&1;this.diff=t>>1,this.count=1,n&&(this.count=Z(this)+2)}return this.s+=this.diff,this.count--,this.s}}class pb{constructor(t){this.decoder=new qi(t),this.str=Ze(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const wh=e=>new Uint8Array(e),Za=(e,t,n)=>new Uint8Array(e,t,n),gb=e=>new Uint8Array(e),mb=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=G0(e[n]);return btoa(t)},yb=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),vb=e=>{const t=atob(e),n=wh(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},bb=e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},kh=Ga?mb:yb,_h=Ga?vb:bb,wb=e=>{const t=wh(e.byteLength);return t.set(e),t},kb=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&jn(e)===e);class _i{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Tt=()=>new _i,_b=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},vt=e=>{const t=new Uint8Array(_b(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(Za(e.cbuf.buffer,0,e.cpos),n),t},Sb=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(Za(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(tn(n,t)*2),e.cpos=0)},Rt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},si=Rt,K=(e,t)=>{for(;t>Bn;)Rt(e,le|Bn&t),t>>>=7;Rt(e,Bn&t)},Qa=(e,t)=>{const n=ph(t);for(n&&(t=-t),Rt(e,(t>oa?le:0)|(n?Xe:0)|oa&t),t>>>=6;t>0;)Rt(e,(t>Bn?le:0)|Bn&t),t>>>=7},Ve=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;K(e,r);for(let i=0;i<r;i++)Rt(e,n.codePointAt(i))},Wo=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=bn(n-r,t.length),o=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(tn(n*2,o)),e.cbuf.set(t.subarray(i)),e.cpos=o)},kt=(e,t)=>{K(e,t.byteLength),Wo(e,t)},tl=(e,t)=>{Sb(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Cb=(e,t)=>tl(e,4).setFloat32(0,t,!1),Eb=(e,t)=>tl(e,8).setFloat64(0,t,!1),Mb=(e,t)=>tl(e,8).setBigInt64(0,t,!1),Lc=new DataView(new ArrayBuffer(4)),Tb=e=>(Lc.setFloat32(0,e),Lc.getFloat32(0)===e),_r=(e,t)=>{switch(typeof t){case"string":Rt(e,119),Ve(e,t);break;case"number":kb(t)&&Hi(t)<=ab?(Rt(e,125),Qa(e,t)):Tb(t)?(Rt(e,124),Cb(e,t)):(Rt(e,123),Eb(e,t));break;case"bigint":Rt(e,122),Mb(e,t);break;case"object":if(t===null)Rt(e,126);else if(t instanceof Array){Rt(e,117),K(e,t.length);for(let n=0;n<t.length;n++)_r(e,t[n])}else if(t instanceof Uint8Array)Rt(e,116),kt(e,t);else{Rt(e,118);const n=Object.keys(t);K(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ve(e,i),_r(e,t[i])}}break;case"boolean":Rt(e,t?120:121);break;default:Rt(e,127)}};class Pc extends _i{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&K(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Bc=e=>{e.count>0&&(Qa(e.encoder,e.count===1?e.s:-e.s),e.count>1&&K(e.encoder,e.count-2))};class Wi{constructor(){this.encoder=new _i,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Bc(this),this.count=1,this.s=t)}toUint8Array(){return Bc(this),vt(this.encoder)}}const Fc=e=>{if(e.count>0){const t=e.diff<<1|(e.count===1?0:1);Qa(e.encoder,t),e.count>1&&K(e.encoder,e.count-2)}};class Os{constructor(){this.encoder=new _i,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Fc(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Fc(this),vt(this.encoder)}}class Ob{constructor(){this.sarr=[],this.s="",this.lensE=new Wi}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new _i;return this.sarr.push(this.s),this.s="",Ve(t,this.sarr.join("")),Wo(t,this.lensE.toUint8Array()),vt(t)}}const zc=typeof crypto=="undefined"?null:crypto,xb=zc!==null?e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);return zc.getRandomValues(n),t}:e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);for(let r=0;r<e;r++)n[r]=Math.ceil(Math.random()*4294967295>>>0);return t},Sh=Math.random,Ch=()=>new Uint32Array(xb(4))[0],Ab=e=>e[jn(Sh()*e.length)],Db=[1e7]+-1e3+-4e3+-8e3+-1e11,Eh=()=>Db.replace(/[018]/g,e=>(e^Ch()&15>>e/4).toString(16)),je=Date.now,Jo=e=>new Promise(e),Nb=e=>Promise.reject(e),el=e=>Promise.resolve(e),Xn=e=>new Error(e),De=()=>{throw Xn("Method unimplemented")},we=()=>{throw Xn("Unexpected case")},Mh=Object.keys,fo=e=>Mh(e).length,Rb=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Th=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ib=(e,t)=>e===t||fo(e)===fo(t)&&Rb(e,(n,r)=>(n!==void 0||Th(t,r))&&t[r]===n),nl=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&nl(e,t,n+1)}},Lb=()=>{},Pb=(e,t)=>e===t,Jr=(e,t)=>{if(e==null||t==null)return Pb(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Jr(e.get(n),t.get(n)))return!1;break}case Object:if(fo(e)!==fo(t))return!1;for(const n in e)if(!Th(e,n)||!Jr(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Jr(e[n],t[n]))return!1;break;default:return!1}return!0},on=Symbol;class Bb{constructor(t,n){this.left=t,this.right=n}}const $e=(e,t)=>new Bb(e,t),Tn=typeof document!="undefined"?document:{};typeof DOMParser!="undefined"&&new DOMParser;const Fb=e=>q0(e,(t,n)=>`${n}:${t};`).join("");Tn.ELEMENT_NODE;Tn.TEXT_NODE;Tn.CDATA_SECTION_NODE;Tn.COMMENT_NODE;Tn.DOCUMENT_NODE;Tn.DOCUMENT_TYPE_NODE;Tn.DOCUMENT_FRAGMENT_NODE;const zb=e=>class{constructor(n){this._=n}destroy(){e(this._)}},Vb=zb(clearTimeout),ho=(e,t)=>new Vb(setTimeout(t,e)),ae=on(),Sn=on(),rl=on(),$o=on(),il=on(),ol=on(),sl=on(),Ko=on(),Si=on(),Ub={[ae]:$e("font-weight","bold"),[Sn]:$e("font-weight","normal"),[rl]:$e("color","blue"),[il]:$e("color","green"),[$o]:$e("color","grey"),[ol]:$e("color","red"),[sl]:$e("color","purple"),[Ko]:$e("color","orange"),[Si]:$e("color","black")},jb={[ae]:"\x1B[1m",[Sn]:"\x1B[2m",[rl]:"\x1B[34m",[il]:"\x1B[32m",[$o]:"\x1B[37m",[ol]:"\x1B[31m",[sl]:"\x1B[35m",[Ko]:"\x1B[38;5;208m",[Si]:"\x1B[0m"},Hb=e=>{const t=[],n=[],r=Ae();let i=[],o=0;for(;o<e.length;o++){const s=e[o],a=Ub[s];if(a!==void 0)r.set(a.left,a.right);else if(s.constructor===String||s.constructor===Number){const l=Fb(r);o>0||l.length>0?(t.push("%c"+s),n.push(l)):t.push(s)}else break}for(o>0&&(i=n,i.unshift(t.join("")));o<e.length;o++){const s=e[o];s instanceof Symbol||i.push(s)}return i},qb=e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const i=e[r],o=jb[i];if(o!==void 0)t.push(o);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(r>0&&(t.push("\x1B[0m"),n.push(t.join("")));r<e.length;r++){const i=e[r];i instanceof Symbol||n.push(i)}return n},Wb=jo?qb:Hb,Oh=(...e)=>{console.log(...Wb(e)),Jb.forEach(t=>t.print(e))},Jb=new Set,Vc=[il,sl,Ko,rl];let xs=0,Uc=je();const $b=e=>{const t=Vc[xs],n=bh("log"),r=n!==null&&(n==="*"||n==="true"||new RegExp(n,"gi").test(e));return xs=(xs+1)%Vc.length,e+=": ",r?(...i)=>{const o=je(),s=o-Uc;Uc=o,Oh(t,e,Si,...i.map(a=>typeof a=="string"||typeof a=="symbol"?a:JSON.stringify(a)),t," +"+s+"ms")}:Lb},xh=e=>({[Symbol.iterator](){return this},next:e}),Kb=(e,t)=>xh(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),As=(e,t)=>xh(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class al{constructor(t,n){this.clock=t,this.len=n}}class Ar{constructor(){this.clients=new Map}}const en=(e,t,n)=>t.clients.forEach((r,i)=>{const o=e.doc.store.clients.get(i);for(let s=0;s<r.length;s++){const a=r[s];Hh(e,o,a.clock,a.len,n)}}),Gb=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=jn((n+r)/2),o=e[i],s=o.clock;if(s<=t){if(t<s+o.len)return i;n=i+1}else r=i-1}return null},Ci=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Gb(n,t.clock)!==null},ll=e=>{e.clients.forEach(t=>{t.sort((i,o)=>i.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],o=t[n];i.clock+i.len>=o.clock?i.len=tn(i.len,o.clock+o.len-i.clock):(r<n&&(t[r]=o),r++)}t.length=r})},sa=e=>{const t=new Ar;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const o=r.slice();for(let s=n+1;s<e.length;s++)J0(o,e[s].clients.get(i)||[]);t.clients.set(i,o)}});return ll(t),t},ai=(e,t,n,r)=>{ue(e.clients,t,()=>[]).push(new al(n,r))},cl=()=>new Ar,Ah=e=>{const t=cl();return e.clients.forEach((n,r)=>{const i=[];for(let o=0;o<n.length;o++){const s=n[o];if(s.deleted){const a=s.id.clock;let l=s.length;if(o+1<n.length)for(let c=n[o+1];o+1<n.length&&c.deleted;c=n[++o+1])l+=c.length;i.push(new al(a,l))}}i.length>0&&t.clients.set(r,i)}),t},Dr=(e,t)=>{K(e.restEncoder,t.clients.size),t.clients.forEach((n,r)=>{e.resetDsCurVal(),K(e.restEncoder,r);const i=n.length;K(e.restEncoder,i);for(let o=0;o<i;o++){const s=n[o];e.writeDsClock(s.clock),e.writeDsLen(s.len)}})},ul=e=>{const t=new Ar,n=Z(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Z(e.restDecoder),o=Z(e.restDecoder);if(o>0){const s=ue(t.clients,i,()=>[]);for(let a=0;a<o;a++)s.push(new al(e.readDsClock(),e.readDsLen()))}}return t},jc=(e,t,n)=>{const r=new Ar,i=Z(e.restDecoder);for(let o=0;o<i;o++){e.resetDsCurVal();const s=Z(e.restDecoder),a=Z(e.restDecoder),l=n.clients.get(s)||[],c=_t(n,s);for(let f=0;f<a;f++){const u=e.readDsClock(),d=u+e.readDsLen();if(u<c){c<d&&ai(r,s,c,d-c);let p=He(l,u),g=l[p];for(!g.deleted&&g.id.clock<u&&(l.splice(p+1,0,bo(t,g,u-g.id.clock)),p++);p<l.length&&(g=l[p++],g.id.clock<d);)g.deleted||(d<g.id.clock+g.length&&l.splice(p,0,bo(t,g,d-g.id.clock)),g.delete(t))}else ai(r,s,u,d-u)}}if(r.clients.size>0){const o=new qn;return K(o.restEncoder,0),Dr(o,r),o.toUint8Array()}return null},Dh=Ch;class Nr extends xr{constructor({guid:t=Eh(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:s=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Dh(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Uh,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=s,this.meta=o,this.isLoaded=!1,this.whenLoaded=Jo(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})})}load(){const t=this._item;t!==null&&!this.shouldLoad&&ft(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,n=null){ft(this,t,n)}get(t,n=Ft){const r=ue(this.share,t,()=>{const o=new n;return o._integrate(this,null),o}),i=r.constructor;if(n!==Ft&&i!==n)if(i===Ft){const o=new n;o._map=r._map,r._map.forEach(s=>{for(;s!==null;s=s.left)s.parent=o}),o._start=r._start;for(let s=o._start;s!==null;s=s.right)s.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,hr)}getText(t=""){return this.get(t,Wn)}getMap(t=""){return this.get(t,Cr)}getXmlFragment(t=""){return this.get(t,Jn)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){dh(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Nr(Dt(z({guid:this.guid},n.opts),{shouldLoad:!1})),n.doc._item=t,ft(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}}class Nh{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Z(this.restDecoder)}readDsLen(){return Z(this.restDecoder)}}class Rh extends Nh{readLeftID(){return Q(Z(this.restDecoder),Z(this.restDecoder))}readRightID(){return Q(Z(this.restDecoder),Z(this.restDecoder))}readClient(){return Z(this.restDecoder)}readInfo(){return Hn(this.restDecoder)}readString(){return Ze(this.restDecoder)}readParentInfo(){return Z(this.restDecoder)===1}readTypeRef(){return Z(this.restDecoder)}readLen(){return Z(this.restDecoder)}readAny(){return kr(this.restDecoder)}readBuf(){return wb(It(this.restDecoder))}readJSON(){return JSON.parse(Ze(this.restDecoder))}readKey(){return Ze(this.restDecoder)}}class Yb{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Z(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Z(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Sr extends Yb{constructor(t){super(t),this.keys=[],Z(t),this.keyClockDecoder=new Ts(It(t)),this.clientDecoder=new qi(It(t)),this.leftClockDecoder=new Ts(It(t)),this.rightClockDecoder=new Ts(It(t)),this.infoDecoder=new Ic(It(t),Hn),this.stringDecoder=new pb(It(t)),this.parentInfoDecoder=new Ic(It(t),Hn),this.typeRefDecoder=new qi(It(t)),this.lenDecoder=new qi(It(t))}readLeftID(){return new fr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new fr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return kr(this.restDecoder)}readBuf(){return It(this.restDecoder)}readJSON(){return kr(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Ih{constructor(){this.restEncoder=Tt()}toUint8Array(){return vt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){K(this.restEncoder,t)}writeDsLen(t){K(this.restEncoder,t)}}class Ei extends Ih{writeLeftID(t){K(this.restEncoder,t.client),K(this.restEncoder,t.clock)}writeRightID(t){K(this.restEncoder,t.client),K(this.restEncoder,t.clock)}writeClient(t){K(this.restEncoder,t)}writeInfo(t){si(this.restEncoder,t)}writeString(t){Ve(this.restEncoder,t)}writeParentInfo(t){K(this.restEncoder,t?1:0)}writeTypeRef(t){K(this.restEncoder,t)}writeLen(t){K(this.restEncoder,t)}writeAny(t){_r(this.restEncoder,t)}writeBuf(t){kt(this.restEncoder,t)}writeJSON(t){Ve(this.restEncoder,JSON.stringify(t))}writeKey(t){Ve(this.restEncoder,t)}}class Lh{constructor(){this.restEncoder=Tt(),this.dsCurrVal=0}toUint8Array(){return vt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,K(this.restEncoder,n)}writeDsLen(t){t===0&&we(),K(this.restEncoder,t-1),this.dsCurrVal+=t}}class qn extends Lh{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Os,this.clientEncoder=new Wi,this.leftClockEncoder=new Os,this.rightClockEncoder=new Os,this.infoEncoder=new Pc(si),this.stringEncoder=new Ob,this.parentInfoEncoder=new Pc(si),this.typeRefEncoder=new Wi,this.lenEncoder=new Wi}toUint8Array(){const t=Tt();return K(t,0),kt(t,this.keyClockEncoder.toUint8Array()),kt(t,this.clientEncoder.toUint8Array()),kt(t,this.leftClockEncoder.toUint8Array()),kt(t,this.rightClockEncoder.toUint8Array()),kt(t,vt(this.infoEncoder)),kt(t,this.stringEncoder.toUint8Array()),kt(t,vt(this.parentInfoEncoder)),kt(t,this.typeRefEncoder.toUint8Array()),kt(t,this.lenEncoder.toUint8Array()),Wo(t,vt(this.restEncoder)),vt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){_r(this.restEncoder,t)}writeBuf(t){kt(this.restEncoder,t)}writeJSON(t){_r(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Xb=(e,t,n,r)=>{r=tn(r,t[0].id.clock);const i=He(t,r);K(e.restEncoder,t.length-i),e.writeClient(n),K(e.restEncoder,r);const o=t[i];o.write(e,r-o.id.clock);for(let s=i+1;s<t.length;s++)t[s].write(e,0)},fl=(e,t,n)=>{const r=new Map;n.forEach((i,o)=>{_t(t,o)>i&&r.set(o,i)}),Mi(t).forEach((i,o)=>{n.has(o)||r.set(o,0)}),K(e.restEncoder,r.size),Array.from(r.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{Xb(e,t.clients.get(i),i,o)})},Zb=(e,t)=>{const n=Ae(),r=Z(e.restDecoder);for(let i=0;i<r;i++){const o=Z(e.restDecoder),s=new Array(o),a=e.readClient();let l=Z(e.restDecoder);n.set(a,{i:0,refs:s});for(let c=0;c<o;c++){const f=e.readInfo();switch(Ho&f){case 0:{const u=e.readLen();s[c]=new ge(Q(a,l),u),l+=u;break}case 10:{const u=Z(e.restDecoder);s[c]=new me(Q(a,l),u),l+=u;break}default:{const u=(f&(Xe|le))===0,d=new ut(Q(a,l),null,(f&le)===le?e.readLeftID():null,null,(f&Xe)===Xe?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(f&oi)===oi?e.readString():null,ud(e,f));s[c]=d,l+=d.length}}}}return n},Qb=(e,t,n)=>{const r=[];let i=Array.from(n.keys()).sort((p,g)=>p-g);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let p=n.get(i[i.length-1]);for(;p.refs.length===p.i;)if(i.pop(),i.length>0)p=n.get(i[i.length-1]);else return null;return p};let s=o();if(s===null&&r.length===0)return null;const a=new Uh,l=new Map,c=(p,g)=>{const y=l.get(p);(y==null||y>g)&&l.set(p,g)};let f=s.refs[s.i++];const u=new Map,d=()=>{for(const p of r){const g=p.id.client,y=n.get(g);y?(y.i--,a.clients.set(g,y.refs.slice(y.i)),n.delete(g),y.i=0,y.refs=[]):a.clients.set(g,[p]),i=i.filter(w=>w!==g)}r.length=0};for(;;){if(f.constructor!==me){const g=ue(u,f.id.client,()=>_t(t,f.id.client))-f.id.clock;if(g<0)r.push(f),c(f.id.client,f.id.clock-1),d();else{const y=f.getMissing(e,t);if(y!==null){r.push(f);const w=n.get(y)||{refs:[],i:0};if(w.refs.length===w.i)c(y,_t(t,y)),d();else{f=w.refs[w.i++];continue}}else(g===0||g<f.length)&&(f.integrate(e,g),u.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(s!==null&&s.i<s.refs.length)f=s.refs[s.i++];else{if(s=o(),s===null)break;f=s.refs[s.i++]}}if(a.clients.size>0){const p=new qn;return fl(p,a,new Map),K(p.restEncoder,0),{missing:l,update:p.toUint8Array()}}return null},tw=(e,t)=>fl(e,t.doc.store,t.beforeState),ew=(e,t,n,r=new Sr(e))=>ft(t,i=>{i.local=!1;let o=!1;const s=i.doc,a=s.store,l=Zb(r,s),c=Qb(i,a,l),f=a.pendingStructs;if(f){for(const[d,p]of f.missing)if(p<_t(a,d)){o=!0;break}if(c){for(const[d,p]of c.missing){const g=f.missing.get(d);(g==null||g>p)&&f.missing.set(d,p)}f.update=po([f.update,c.update])}}else a.pendingStructs=c;const u=jc(r,i,a);if(a.pendingDs){const d=new Sr(Je(a.pendingDs));Z(d.restDecoder);const p=jc(d,i,a);u&&p?a.pendingDs=po([u,p]):a.pendingDs=u||p}else a.pendingDs=u;if(o){const d=a.pendingStructs.update;a.pendingStructs=null,Ph(i.doc,d)}},n,!1),Ph=(e,t,n,r=Sr)=>{const i=Je(t);ew(i,e,n,new r(i))},Bh=(e,t,n)=>Ph(e,t,n,Rh),nw=(e,t,n=new Map)=>{fl(e,t.store,n),Dr(e,Ah(t.store))},rw=(e,t=new Uint8Array([0]),n=new qn)=>{const r=Fh(t);nw(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Sw(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Ei)return kw(i.map((o,s)=>s===0?o:Ew(o)));if(n.constructor===qn)return po(i)}return i[0]},hl=(e,t)=>rw(e,t,new Ei),iw=e=>{const t=new Map,n=Z(e.restDecoder);for(let r=0;r<n;r++){const i=Z(e.restDecoder),o=Z(e.restDecoder);t.set(i,o)}return t},Fh=e=>iw(new Nh(Je(e))),zh=(e,t)=>(K(e.restEncoder,t.size),Array.from(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{K(e.restEncoder,n),K(e.restEncoder,r)}),e),ow=(e,t)=>zh(e,Mi(t.store)),sw=(e,t=new Lh)=>(e instanceof Map?zh(t,e):ow(t,e),t.toUint8Array()),aw=e=>sw(e,new Ih);class lw{constructor(){this.l=[]}}const Hc=()=>new lw,qc=(e,t)=>e.l.push(t),Wc=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Vh=(e,t,n)=>nl(e.l,[t,n]);class fr{constructor(t,n){this.client=t,this.clock=n}}const lr=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Q=(e,t)=>new fr(e,t),li=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw we()},ci=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1};class ui{constructor(t,n,r,i=0){this.type=t,this.tname=n,this.item=r,this.assoc=i}}const $r=e=>new ui(e.type==null?null:Q(e.type.client,e.type.clock),e.tname||null,e.item==null?null:Q(e.item.client,e.item.clock),e.assoc==null?0:e.assoc);class cw{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}}const uw=(e,t,n=0)=>new cw(e,t,n),Li=(e,t,n)=>{let r=null,i=null;return e._item===null?i=li(e):r=Q(e._item.id.client,e._item.id.clock),new ui(r,i,t,n)},Ds=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return Li(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return Li(e,Q(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return Li(e,r.lastId,n);r=r.right}return Li(e,null,n)},fw=(e,t)=>{const n=t.store,r=e.item,i=e.type,o=e.tname,s=e.assoc;let a=null,l=0;if(r!==null){if(_t(n,r.client)<=r.clock)return null;const c=ca(n,r),f=c.item;if(!(f instanceof ut))return null;if(a=f.parent,a._item===null||!a._item.deleted){l=f.deleted||!f.countable?0:c.diff+(s>=0?0:1);let u=f.left;for(;u!==null;)!u.deleted&&u.countable&&(l+=u.length),u=u.left}}else{if(o!==null)a=t.get(o);else if(i!==null){if(_t(n,i.client)<=i.clock)return null;const{item:c}=ca(n,i);if(c instanceof ut&&c.content instanceof Ie)a=c.content.type;else return null}else throw we();s>=0?l=a._length:l=0}return uw(a,l,e.assoc)},Jc=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&lr(e.item,t.item)&&lr(e.type,t.type)&&e.assoc===t.assoc;class dl{constructor(t,n){this.ds=t,this.sv=n}}const pl=(e,t)=>new dl(e,t);pl(cl(),new Map);const hw=e=>pl(Ah(e.store),Mi(e.store)),or=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Ci(t.ds,e.id),Ji=(e,t)=>{const n=ue(e.meta,Ji,wr),r=e.doc.store;n.has(t)||(t.sv.forEach((i,o)=>{i<_t(r,o)&&ne(e,Q(o,i))}),en(e,t.ds,i=>{}),n.add(t))};class Uh{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Mi=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},_t=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},jh=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw we()}n.push(t)},He=(e,t)=>{let n=0,r=e.length-1,i=e[r],o=i.id.clock;if(o===t)return r;let s=jn(t/(o+i.length-1)*r);for(;n<=r;){if(i=e[s],o=i.id.clock,o<=t){if(t<o+i.length)return s;n=s+1}else r=s-1;s=jn((n+r)/2)}throw we()},dw=(e,t)=>{const n=e.clients.get(t.client);return n[He(n,t.clock)]},$i=dw,aa=(e,t,n)=>{const r=He(t,n),i=t[r];return i.id.clock<n&&i instanceof ut?(t.splice(r+1,0,bo(e,i,n-i.id.clock)),r+1):r},ne=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[aa(e,n,t.clock)]},$c=(e,t,n)=>{const r=t.clients.get(n.client),i=He(r,n.clock),o=r[i];return n.clock!==o.id.clock+o.length-1&&o.constructor!==ge&&r.splice(i+1,0,bo(e,o,n.clock-o.id.clock+1)),o},pw=(e,t,n)=>{const r=e.clients.get(t.id.client);r[He(r,t.id.clock)]=n},Hh=(e,t,n,r,i)=>{if(r===0)return;const o=n+r;let s=aa(e,t,n),a;do a=t[s++],o<a.id.clock+a.length&&aa(e,t,o),i(a);while(s<t.length&&t[s].id.clock<o)};class gw{constructor(t,n,r){this.doc=t,this.deleteSet=new Ar,this.beforeState=Mi(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const Kc=(e,t)=>t.deleteSet.clients.size===0&&!W0(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(ll(t.deleteSet),tw(e,t),Dr(e,t.deleteSet),!0),Gc=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&ue(e.changed,t,wr).add(n)},Ki=(e,t)=>{const n=e[t-1],r=e[t];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(e.splice(t,1),r instanceof ut&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},mw=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const o=t.clients.get(r);for(let s=i.length-1;s>=0;s--){const a=i[s],l=a.clock+a.len;for(let c=He(o,a.clock),f=o[c];c<o.length&&f.id.clock<l;f=o[++c]){const u=o[c];if(a.clock+a.len<=u.id.clock)break;u instanceof ut&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},yw=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let o=n.length-1;o>=0;o--){const s=n[o],a=bn(i.length-1,1+He(i,s.clock+s.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=s.clock;c=i[--l])Ki(i,l)}})},qh=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,o=n.deleteSet,s=n._mergeStructs;try{ll(o),n.afterState=Mi(n.doc.store),r._transaction=null,r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(n,l)})),a.push(()=>{n.changedParentTypes.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&(l=l.filter(f=>f.target._item===null||!f.target._item.deleted),l.forEach(f=>{f.currentTarget=c}),l.sort((f,u)=>f.path.length-u.path.length),Vh(c._dEH,l,n))})),a.push(()=>r.emit("afterTransaction",[n,r]))}),nl(a,[])}finally{r.gc&&mw(o,i,r.gcFilter),yw(o,i),n.afterState.forEach((f,u)=>{const d=n.beforeState.get(u)||0;if(d!==f){const p=i.clients.get(u),g=tn(He(p,d),1);for(let y=p.length-1;y>=g;y--)Ki(p,y)}});for(let f=0;f<s.length;f++){const{client:u,clock:d}=s[f].id,p=i.clients.get(u),g=He(p,d);g+1<p.length&&Ki(p,g+1),g>0&&Ki(p,g)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Oh(Ko,ae,"[yjs] ",Sn,ol,"Changed the client-id because another client seems to be using it."),r.clientID=Dh()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const f=new Ei;Kc(f,n)&&r.emit("update",[f.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const f=new qn;Kc(f,n)&&r.emit("updateV2",[f.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=n;(a.size>0||c.size>0||l.size>0)&&(a.forEach(f=>{f.clientID=r.clientID,f.collectionid==null&&(f.collectionid=r.collectionid),r.subdocs.add(f)}),c.forEach(f=>r.subdocs.delete(f)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,n]),c.forEach(f=>f.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):qh(e,t+1)}}},ft=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let o=!1;e._transaction===null&&(o=!0,e._transaction=new gw(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{o&&i[0]===e._transaction&&qh(i,0)}};class vw{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const Yc=(e,t,n)=>{en(e,n.deletions,r=>{r instanceof ut&&t.scope.some(i=>ci(i,r))&&_l(r,!1)})},Xc=(e,t,n)=>{let r=null,i=null;const o=e.doc,s=e.scope;if(ft(o,a=>{for(;t.length>0&&r===null;){const l=o.store,c=t.pop(),f=new Set,u=[];let d=!1;en(a,c.insertions,p=>{if(p instanceof ut){if(p.redone!==null){let{item:g,diff:y}=ca(l,p.id);y>0&&(g=ne(a,Q(g.id.client,g.id.clock+y))),p=g}!p.deleted&&s.some(g=>ci(g,p))&&u.push(p)}}),en(a,c.deletions,p=>{p instanceof ut&&s.some(g=>ci(g,p))&&!Ci(c.insertions,p.id)&&f.add(p)}),f.forEach(p=>{d=cd(a,p,f,c.insertions,e.ignoreRemoteMapChanges)!==null||d});for(let p=u.length-1;p>=0;p--){const g=u[p];e.deleteFilter(g)&&(g.delete(a),d=!0)}r=d?c:null}a.changed.forEach((l,c)=>{l.has(null)&&c._searchMarker&&(c._searchMarker.length=0)}),i=a},e),r!=null){const a=i.changedParentTypes;e.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:a},e])}return r};class bw extends xr{constructor(t,{captureTimeout:n=500,deleteFilter:r=()=>!0,trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:o=!1}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=r,i.add(this),this.trackedOrigins=i,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=this.scope[0].doc,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.afterTransactionHandler=s=>{if(!this.scope.some(g=>s.changedParentTypes.has(g))||!this.trackedOrigins.has(s.origin)&&(!s.origin||!this.trackedOrigins.has(s.origin.constructor)))return;const a=this.undoing,l=this.redoing,c=a?this.redoStack:this.undoStack;a?this.stopCapturing():l||this.clear(!1,!0);const f=new Ar;s.afterState.forEach((g,y)=>{const w=s.beforeState.get(y)||0,E=g-w;E>0&&ai(f,y,w,E)});const u=je();let d=!1;if(u-this.lastChange<n&&c.length>0&&!a&&!l){const g=c[c.length-1];g.deletions=sa([g.deletions,s.deleteSet]),g.insertions=sa([g.insertions,f])}else c.push(new vw(s.deleteSet,f)),d=!0;!a&&!l&&(this.lastChange=u),en(s,s.deleteSet,g=>{g instanceof ut&&this.scope.some(y=>ci(y,g))&&_l(g,!0)});const p=[{stackItem:c[c.length-1],origin:s.origin,type:a?"redo":"undo",changedParentTypes:s.changedParentTypes},this];d?this.emit("stack-item-added",p):this.emit("stack-item-updated",p)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=$0(t)?t:[t],t.forEach(n=>{this.scope.every(r=>r!==n)&&this.scope.push(n)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(i=>Yc(r,this,i)),this.undoStack=[]),n&&(this.redoStack.forEach(i=>Yc(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=Xc(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=Xc(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*ww(e){const t=Z(e.restDecoder);for(let n=0;n<t;n++){const r=Z(e.restDecoder),i=e.readClient();let o=Z(e.restDecoder);for(let s=0;s<r;s++){const a=e.readInfo();if(a===10){const l=Z(e.restDecoder);yield new me(Q(i,o),l),o+=l}else if((Ho&a)!==0){const l=(a&(Xe|le))===0,c=new ut(Q(i,o),null,(a&le)===le?e.readLeftID():null,null,(a&Xe)===Xe?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(a&oi)===oi?e.readString():null,ud(e,a));yield c,o+=c.length}else{const l=e.readLen();yield new ge(Q(i,o),l),o+=l}}}}class gl{constructor(t,n){this.gen=ww(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===me);return this.curr}}class ml{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const kw=e=>po(e,Rh,Ei),_w=(e,t)=>{if(e.constructor===ge){const{client:n,clock:r}=e.id;return new ge(Q(n,r+t),e.length-t)}else if(e.constructor===me){const{client:n,clock:r}=e.id;return new me(Q(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ut(Q(r,i+t),null,Q(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},po=(e,t=Sr,n=qn)=>{if(e.length===1)return e[0];const r=e.map(f=>new t(Je(f)));let i=r.map(f=>new gl(f,!0)),o=null;const s=new n,a=new ml(s);for(;i=i.filter(d=>d.curr!==null),i.sort((d,p)=>{if(d.curr.id.client===p.curr.id.client){const g=d.curr.id.clock-p.curr.id.clock;return g===0?d.curr.constructor===p.curr.constructor?0:d.curr.constructor===me?1:-1:g}else return p.curr.id.client-d.curr.id.client}),i.length!==0;){const f=i[0],u=f.curr.id.client;if(o!==null){let d=f.curr,p=!1;for(;d!==null&&d.id.clock+d.length<=o.struct.id.clock+o.struct.length&&d.id.client>=o.struct.id.client;)d=f.next(),p=!0;if(d===null||d.id.client!==u||p&&d.id.clock>o.struct.id.clock+o.struct.length)continue;if(u!==o.struct.id.client)mn(a,o.struct,o.offset),o={struct:d,offset:0},f.next();else if(o.struct.id.clock+o.struct.length<d.id.clock)if(o.struct.constructor===me)o.struct.length=d.id.clock+d.length-o.struct.id.clock;else{mn(a,o.struct,o.offset);const g=d.id.clock-o.struct.id.clock-o.struct.length;o={struct:new me(Q(u,o.struct.id.clock+o.struct.length),g),offset:0}}else{const g=o.struct.id.clock+o.struct.length-d.id.clock;g>0&&(o.struct.constructor===me?o.struct.length-=g:d=_w(d,g)),o.struct.mergeWith(d)||(mn(a,o.struct,o.offset),o={struct:d,offset:0},f.next())}}else o={struct:f.curr,offset:0},f.next();for(let d=f.curr;d!==null&&d.id.client===u&&d.id.clock===o.struct.id.clock+o.struct.length&&d.constructor!==me;d=f.next())mn(a,o.struct,o.offset),o={struct:d,offset:0}}o!==null&&(mn(a,o.struct,o.offset),o=null),yl(a);const l=r.map(f=>ul(f)),c=sa(l);return Dr(s,c),s.toUint8Array()},Sw=(e,t,n=Sr,r=qn)=>{const i=Fh(t),o=new r,s=new ml(o),a=new n(Je(e)),l=new gl(a,!1);for(;l.curr;){const f=l.curr,u=f.id.client,d=i.get(u)||0;if(l.curr.constructor===me){l.next();continue}if(f.id.clock+f.length>d)for(mn(s,f,tn(d-f.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)mn(s,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}yl(s);const c=ul(a);return Dr(o,c),o.toUint8Array()},Wh=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:vt(e.encoder.restEncoder)}),e.encoder.restEncoder=Tt(),e.written=0)},mn=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Wh(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),K(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},yl=e=>{Wh(e);const t=e.encoder.restEncoder;K(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];K(t,r.written),Wo(t,r.restEncoder)}},Cw=(e,t,n)=>{const r=new t(Je(e)),i=new gl(r,!1),o=new n,s=new ml(o);for(let l=i.curr;l!==null;l=i.next())mn(s,l,0);yl(s);const a=ul(r);return Dr(o,a),o.toUint8Array()},Ew=e=>Cw(e,Sr,Ei);class Go{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return Mw(this.currentTarget,this.target)}deletes(t){return Ci(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const o=n._map.get(i);let s,a;if(this.adds(o)){let l=o.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(o))if(l!==null&&this.deletes(l))s="delete",a=Ss(l.content.getContent());else return;else l!==null&&this.deletes(l)?(s="update",a=Ss(l.content.getContent())):(s="add",a=void 0)}else if(this.deletes(o))s="delete",a=Ss(o.content.getContent());else return;t.set(i,{action:s,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const n=this.target,r=wr(),i=wr(),o=[];if(t={added:r,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const l=()=>{a&&o.push(a)};for(let c=n._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=t}return t}}const Mw=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||r++,i=i.right;n.unshift(r)}t=t._item.parent}return n},Jh=80;let vl=0;class Tw{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=vl++}}const Ow=e=>{e.timestamp=vl++},$h=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=vl++},xw=(e,t,n)=>{if(e.length>=Jh){const r=e.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return $h(r,t,n),r}else{const r=new Tw(t,n);return e.push(r),r}},Yo=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,s)=>Hi(t-o.index)<Hi(t-s.index)?o:s);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ow(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Hi(n.index-i)<r.parent.length/Jh?($h(n,r,i),n):xw(e._searchMarker,r,i)},fi=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}i.p=o,o.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=tn(t,i.index+n))}},Xo=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;ue(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Vh(r._eH,n,t)};class Ft{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Hc(),this._dEH=Hc(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw De()}clone(){throw De()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){qc(this._eH,t)}observeDeep(t){qc(this._dEH,t)}unobserve(t){Wc(this._eH,t)}unobserveDeep(t){Wc(this._dEH,t)}toJSON(){}}const Kh=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const s=o.content.getContent();if(s.length<=t)t-=s.length;else{for(let a=t;a<s.length&&r>0;a++)i.push(s[a]),r--;t=0}}o=o.right}return i},Gh=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Yh=(e,t)=>{const n=[];let r=e._start;for(;r!==null;){if(r.countable&&or(r,t)){const i=r.content.getContent();for(let o=0;o<i.length;o++)n.push(i[o])}r=r.right}return n},hi=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let o=0;o<i.length;o++)t(i[o],n++,e)}r=r.right}},Xh=(e,t)=>{const n=[];return hi(e,(r,i)=>{n.push(t(r,i,e))}),n},Aw=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Zh=(e,t)=>{const n=Yo(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},go=(e,t,n,r)=>{let i=n;const o=e.doc,s=o.clientID,a=o.store,l=n===null?t._start:n.right;let c=[];const f=()=>{c.length>0&&(i=new ut(Q(s,_t(a,s)),i,i&&i.lastId,l,l&&l.id,t,null,new $n(c)),i.integrate(e,0),c=[])};r.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(f(),u.constructor){case Uint8Array:case ArrayBuffer:i=new ut(Q(s,_t(a,s)),i,i&&i.lastId,l,l&&l.id,t,null,new Ti(new Uint8Array(u))),i.integrate(e,0);break;case Nr:i=new ut(Q(s,_t(a,s)),i,i&&i.lastId,l,l&&l.id,t,null,new Oi(u)),i.integrate(e,0);break;default:if(u instanceof Ft)i=new ut(Q(s,_t(a,s)),i,i&&i.lastId,l,l&&l.id,t,null,new Ie(u)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),f()},Qh=Xn("Length exceeded!"),td=(e,t,n,r)=>{if(n>t._length)throw Qh;if(n===0)return t._searchMarker&&fi(t._searchMarker,n,r.length),go(e,t,null,r);const i=n,o=Yo(t,n);let s=t._start;for(o!==null&&(s=o.p,n-=o.index,n===0&&(s=s.prev,n+=s&&s.countable&&!s.deleted?s.length:0));s!==null;s=s.right)if(!s.deleted&&s.countable){if(n<=s.length){n<s.length&&ne(e,Q(s.id.client,s.id.clock+n));break}n-=s.length}return t._searchMarker&&fi(t._searchMarker,i,r.length),go(e,t,s,r)},Dw=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((o,s)=>s.index>o.index?s:o,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return go(e,t,i,n)},ed=(e,t,n,r)=>{if(r===0)return;const i=n,o=r,s=Yo(t,n);let a=t._start;for(s!==null&&(a=s.p,n-=s.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&ne(e,Q(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&ne(e,Q(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Qh;t._searchMarker&&fi(t._searchMarker,i,-o+r)},mo=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},bl=(e,t,n,r)=>{const i=t._map.get(n)||null,o=e.doc,s=o.clientID;let a;if(r==null)a=new $n([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new $n([r]);break;case Uint8Array:a=new Ti(r);break;case Nr:a=new Oi(r);break;default:if(r instanceof Ft)a=new Ie(r);else throw new Error("Unexpected content type")}new ut(Q(s,_t(o.store,s)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},wl=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},nd=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},rd=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},Pi=e=>Kb(e.entries(),t=>!t[1].deleted);class Nw extends Go{constructor(t,n){super(t,n),this._transaction=n}}class hr extends Ft{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new hr;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hr}clone(){const t=new hr;return t.insert(0,this.toArray().map(n=>n instanceof Ft?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),Xo(this,t,new Nw(this,t))}insert(t,n){this.doc!==null?ft(this.doc,r=>{td(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?ft(this.doc,n=>{Dw(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?ft(this.doc,r=>{ed(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Zh(this,t)}toArray(){return Gh(this)}slice(t=0,n=this.length){return Kh(this,t,n)}toJSON(){return this.map(t=>t instanceof Ft?t.toJSON():t)}map(t){return Xh(this,t)}forEach(t){hi(this,t)}[Symbol.iterator](){return Aw(this)}_write(t){t.writeTypeRef(ek)}}const Rw=e=>new hr;class Iw extends Go{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Cr extends Ft{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Cr}clone(){const t=new Cr;return this.forEach((n,r)=>{t.set(r,n instanceof Ft?n.clone():n)}),t}_callObserver(t,n){Xo(this,t,new Iw(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof Ft?i.toJSON():i}}),t}get size(){return[...Pi(this._map)].length}keys(){return As(Pi(this._map),t=>t[0])}values(){return As(Pi(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return As(Pi(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){const n={};return this._map.forEach((r,i)=>{r.deleted||t(r.content.getContent()[r.length-1],i,this)}),n}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?ft(this.doc,n=>{mo(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?ft(this.doc,r=>{bl(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return wl(this,t)}has(t){return rd(this,t)}clear(){this.doc!==null?ft(this.doc,t=>{this.forEach(function(n,r,i){mo(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(nk)}}const Lw=e=>new Cr,yn=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Ib(e,t);class la{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&we(),this.right.content.constructor){case Ct:this.right.deleted||Rr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Zc=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Ct:t.right.deleted||Rr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&ne(e,Q(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Bi=(e,t,n)=>{const r=new Map,i=Yo(t,n);if(i){const o=new la(i.p.left,i.p,i.index,r);return Zc(e,o,n-i.index)}else{const o=new la(null,t._start,0,r);return Zc(e,o,n)}},id=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ct&&yn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,o=i.clientID;r.forEach((s,a)=>{const l=n.left,c=n.right,f=new ut(Q(o,_t(i.store,o)),l,l&&l.lastId,c,c&&c.id,t,null,new Ct(a,s));f.integrate(e,0),n.right=f,n.forward()})},Rr=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},od=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Ct&&yn(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},sd=(e,t,n,r)=>{const i=e.doc,o=i.clientID,s=new Map;for(const a in r){const l=r[a],c=n.currentAttributes.get(a)||null;if(!yn(c,l)){s.set(a,c);const{left:f,right:u}=n;n.right=new ut(Q(o,_t(i.store,o)),f,f&&f.lastId,u,u&&u.id,t,null,new Ct(a,l)),n.right.integrate(e,0),n.forward()}}return s},Ns=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,p)=>{i[p]===void 0&&(i[p]=null)});const o=e.doc,s=o.clientID;od(n,i);const a=sd(e,t,n,i),l=r.constructor===String?new Re(r):r instanceof Ft?new Ie(r):new Zn(r);let{left:c,right:f,index:u}=n;t._searchMarker&&fi(t._searchMarker,n.index,l.getLength()),f=new ut(Q(s,_t(o.store,s)),c,c&&c.lastId,f,f&&f.id,t,null,l),f.integrate(e,0),n.right=f,n.index=u,n.forward(),id(e,t,n,a)},Qc=(e,t,n,r,i)=>{const o=e.doc,s=o.clientID;od(n,i);const a=sd(e,t,n,i);for(;n.right!==null&&(r>0||n.right.content.constructor===Ct);){if(!n.right.deleted)switch(n.right.content.constructor){case Ct:{const{key:l,value:c}=n.right.content,f=i[l];f!==void 0&&(yn(f,c)?a.delete(l):a.set(l,c),n.right.delete(e));break}default:r<n.right.length&&ne(e,Q(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new ut(Q(s,_t(o.store,s)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Re(l)),n.right.integrate(e,0),n.forward()}id(e,t,n,a)},ad=(e,t,n,r,i)=>{let o=n;const s=uo(i);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===Ct&&Rr(s,o.content),o=o.right;let a=0,l=!1;for(;t!==o;){if(n===t&&(l=!0),!t.deleted){const c=t.content;switch(c.constructor){case Ct:{const{key:f,value:u}=c;((s.get(f)||null)!==u||(r.get(f)||null)===u)&&(t.delete(e),a++,!l&&(i.get(f)||null)===u&&(r.get(f)||null)!==u&&i.delete(f));break}}}t=t.right}return a},Pw=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Ct){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Bw=e=>{let t=0;return ft(e.doc,n=>{let r=e._start,i=e._start,o=Ae();const s=uo(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ct:Rr(s,i.content);break;default:t+=ad(n,r,i,o,s),o=uo(s),r=i;break}i=i.right}}),t},tu=(e,t,n)=>{const r=n,i=uo(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ie:case Zn:case Re:n<t.right.length&&ne(e,Q(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&ad(e,o,t.right,i,t.currentAttributes);const s=(t.left||t.right).parent;return s._searchMarker&&fi(s._searchMarker,t.index,-r+n),t};class Fw extends Go{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];ft(t,r=>{const i=new Map,o=new Map;let s=this.target._start,a=null;const l={};let c="",f=0,u=0;const d=()=>{if(a!==null){let p;switch(a){case"delete":p={delete:u},u=0;break;case"insert":p={insert:c},i.size>0&&(p.attributes={},i.forEach((g,y)=>{g!==null&&(p.attributes[y]=g)})),c="";break;case"retain":if(p={retain:f},Object.keys(l).length>0){p.attributes={};for(const g in l)p.attributes[g]=l[g]}f=0;break}n.push(p),a=null}};for(;s!==null;){switch(s.content.constructor){case Ie:case Zn:this.adds(s)?this.deletes(s)||(d(),a="insert",c=s.content.getContent()[0],d()):this.deletes(s)?(a!=="delete"&&(d(),a="delete"),u+=1):s.deleted||(a!=="retain"&&(d(),a="retain"),f+=1);break;case Re:this.adds(s)?this.deletes(s)||(a!=="insert"&&(d(),a="insert"),c+=s.content.str):this.deletes(s)?(a!=="delete"&&(d(),a="delete"),u+=s.length):s.deleted||(a!=="retain"&&(d(),a="retain"),f+=s.length);break;case Ct:{const{key:p,value:g}=s.content;if(this.adds(s)){if(!this.deletes(s)){const y=i.get(p)||null;yn(y,g)?g!==null&&s.delete(r):(a==="retain"&&d(),yn(g,o.get(p)||null)?delete l[p]:l[p]=g)}}else if(this.deletes(s)){o.set(p,g);const y=i.get(p)||null;yn(y,g)||(a==="retain"&&d(),l[p]=y)}else if(!s.deleted){o.set(p,g);const y=l[p];y!==void 0&&(yn(y,g)?y!==null&&s.delete(r):(a==="retain"&&d(),g===null?delete l[p]:l[p]=g))}s.deleted||(a==="insert"&&d(),Rr(i,s.content));break}}s=s.right}for(d();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Wn extends Ft{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Wn}clone(){const t=new Wn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Fw(this,t,n),i=t.doc;if(Xo(this,t,r),!t.local){let o=!1;for(const[s,a]of t.afterState.entries()){const l=t.beforeState.get(s)||0;if(a!==l&&(Hh(t,i.store.clients.get(s),l,a,c=>{!c.deleted&&c.content.constructor===Ct&&(o=!0)}),o))break}o||en(t,t.deleteSet,s=>{s instanceof ge||o||s.parent===this&&s.content.constructor===Ct&&(o=!0)}),ft(i,s=>{o?Bw(this):en(s,s.deleteSet,a=>{a instanceof ge||a.parent===this&&Pw(s,a)})})}}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Re&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?ft(this.doc,r=>{const i=new la(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const s=t[o];if(s.insert!==void 0){const a=!n&&typeof s.insert=="string"&&o===t.length-1&&i.right===null&&s.insert.slice(-1)===`
`?s.insert.slice(0,-1):s.insert;(typeof a!="string"||a.length>0)&&Ns(r,this,i,a,s.attributes||{})}else s.retain!==void 0?Qc(r,this,i,s.retain,s.attributes||{}):s.delete!==void 0&&tu(r,i,s.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const i=[],o=new Map,s=this.doc;let a="",l=this._start;function c(){if(a.length>0){const f={};let u=!1;o.forEach((p,g)=>{u=!0,f[g]=p});const d={insert:a};u&&(d.attributes=f),i.push(d),a=""}}return ft(s,f=>{for(t&&Ji(f,t),n&&Ji(f,n);l!==null;){if(or(l,t)||n!==void 0&&or(l,n))switch(l.content.constructor){case Re:{const u=o.get("ychange");t!==void 0&&!or(l,t)?(u===void 0||u.user!==l.id.client||u.state!=="removed")&&(c(),o.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!or(l,n)?(u===void 0||u.user!==l.id.client||u.state!=="added")&&(c(),o.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(c(),o.delete("ychange")),a+=l.content.str;break}case Ie:case Zn:{c();const u={insert:l.content.getContent()[0]};if(o.size>0){const d={};u.attributes=d,o.forEach((p,g)=>{d[g]=p})}i.push(u);break}case Ct:or(l,t)&&(c(),Rr(o,l.content));break}l=l.right}c()},Ji),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ft(i,o=>{const s=Bi(o,this,t);r||(r={},s.currentAttributes.forEach((a,l)=>{r[l]=a})),Ns(o,this,s,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r={}){const i=this.doc;i!==null?ft(i,o=>{const s=Bi(o,this,t);Ns(o,this,s,n,r)}):this._pending.push(()=>this.insertEmbed(t,n,r))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?ft(r,i=>{tu(i,Bi(i,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?ft(i,o=>{const s=Bi(o,this,t);s.right!==null&&Qc(o,this,s,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?ft(this.doc,n=>{mo(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?ft(this.doc,r=>{bl(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return wl(this,t)}getAttributes(t){return nd(this)}_write(t){t.writeTypeRef(rk)}}const zw=e=>new Wn;class Rs{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===re||n.constructor===Jn)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Jn extends Ft{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Jn}clone(){const t=new Jn;return t.insert(0,this.toArray().map(n=>n instanceof Ft?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Rs(this,t)}querySelector(t){t=t.toUpperCase();const r=new Rs(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Rs(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Xo(this,t,new jw(this,n,t))}toString(){return Xh(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),hi(this,o=>{i.insertBefore(o.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?ft(this.doc,r=>{td(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)ft(this.doc,r=>{const i=t&&t instanceof Ft?t._item:t;go(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(o=>o===t)+1;if(i===0&&t!==null)throw Xn("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?ft(this.doc,r=>{ed(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Gh(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Zh(this,t)}slice(t=0,n=this.length){return Kh(this,t,n)}forEach(t){hi(this,t)}_write(t){t.writeTypeRef(ok)}}const Vw=e=>new Jn;class re extends Jn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new re(this.nodeName)}clone(){const t=new re(this.nodeName),n=this.getAttributes();for(const r in n)t.setAttribute(r,n[r]);return t.insert(0,this.toArray().map(r=>r instanceof Ft?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];n.push(l+'="'+t[l]+'"')}const o=this.nodeName.toLocaleLowerCase(),s=n.length>0?" "+n.join(" "):"";return`<${o}${s}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?ft(this.doc,n=>{mo(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?ft(this.doc,r=>{bl(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return wl(this,t)}hasAttribute(t){return rd(this,t)}getAttributes(t){return nd(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),o=this.getAttributes();for(const s in o)i.setAttribute(s,o[s]);return hi(this,s=>{i.appendChild(s.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(ik),t.writeKey(this.nodeName)}}const Uw=e=>new re(e.readKey());class jw extends Go{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class yo extends Cr{constructor(t){super(),this.hookName=t}_copy(){return new yo(this.hookName)}clone(){const t=new yo(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(sk),t.writeKey(this.hookName)}}const Hw=e=>new yo(e.readKey());class ve extends Wn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ve}clone(){const t=new ve;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const o=[];for(const s in t.attributes[i])o.push({key:s,value:t.attributes[i][s]});o.sort((s,a)=>s.key<a.key?-1:1),n.push({nodeName:i,attrs:o})}n.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const o=n[i];r+=`<${o.nodeName}`;for(let s=0;s<o.attrs.length;s++){const a=o.attrs[s];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(ak)}}const qw=e=>new ve;class kl{constructor(t,n){this.id=t,this.length=n}get deleted(){throw De()}mergeWith(t){return!1}write(t,n,r){throw De()}integrate(t,n){throw De()}}const Ww=0;class ge extends kl{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),jh(t.doc.store,this)}write(t,n){t.writeInfo(Ww),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ti{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ti(this.content)}splice(t){throw De()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Jw=e=>new Ti(e.readBuf());class di{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new di(this.len)}splice(t){const n=new di(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){ai(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const $w=e=>new di(e.readLen()),ld=(e,t)=>new Nr(Dt(z({guid:e},t),{shouldLoad:t.shouldLoad||t.autoLoad||!1}));class Oi{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Oi(ld(this.doc.guid,this.opts))}splice(t){throw De()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Kw=e=>new Oi(ld(e.readString(),e.readAny()));class Zn{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Zn(this.embed)}splice(t){throw De()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Gw=e=>new Zn(e.readJSON());class Ct{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ct(this.key,this.value)}splice(t){throw De()}mergeWith(t){return!1}integrate(t,n){n.parent._searchMarker=null}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Yw=e=>new Ct(e.readKey(),e.readJSON());class vo{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new vo(this.arr)}splice(t){const n=new vo(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Xw=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new vo(n)};class $n{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $n(this.arr)}splice(t){const n=new $n(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];t.writeAny(o)}}getRef(){return 8}}const Zw=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new $n(n)};class Re{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Re(this.str)}splice(t){const n=new Re(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Qw=e=>new Re(e.readString()),tk=[Rw,Lw,zw,Uw,Vw,Hw,qw],ek=0,nk=1,rk=2,ik=3,ok=4,sk=5,ak=6;class Ie{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ie(this.type._copy())}splice(t){throw De()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const lk=e=>new Ie(tk[e.readTypeRef()](e)),ca=(e,t)=>{let n=t,r=0,i;do r>0&&(n=Q(n.client,n.clock+r)),i=$i(e,n),r=n.clock-i.id.clock,n=i.redone;while(n!==null&&i instanceof ut);return{item:i,diff:r}},_l=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},bo=(e,t,n)=>{const{client:r,clock:i}=t.id,o=new ut(Q(r,i+n),t,Q(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=Q(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o},cd=(e,t,n,r,i)=>{const o=e.doc,s=o.store,a=o.clientID,l=t.redone;if(l!==null)return ne(e,l);let c=t.parent._item,f=null,u;if(c!==null&&c.deleted===!0){if(c.redone===null&&(!n.has(c)||cd(e,c,n,r,i)===null))return null;for(;c.redone!==null;)c=ne(e,c.redone)}const d=c===null?t.parent:c.content.type;if(t.parentSub===null){for(f=t.left,u=t;f!==null;){let w=f;for(;w!==null&&w.parent._item!==c;)w=w.redone===null?null:ne(e,w.redone);if(w!==null&&w.parent._item===c){f=w;break}f=f.left}for(;u!==null;){let w=u;for(;w!==null&&w.parent._item!==c;)w=w.redone===null?null:ne(e,w.redone);if(w!==null&&w.parent._item===c){u=w;break}u=u.right}}else if(u=null,t.right&&!i){for(f=t;f!==null&&f.right!==null&&Ci(r,f.right.id);)f=f.right;for(;f!==null&&f.redone!==null;)f=ne(e,f.redone);if(f===null||f.parent._item!==c||f&&f.right!==null)return null}else f=d._map.get(t.parentSub)||null;const p=_t(s,a),g=Q(a,p),y=new ut(g,f,f&&f.lastId,u,u&&u.id,d,t.parentSub,t.content.copy());return t.redone=g,_l(y,!0),y.integrate(e,0),y};class ut extends kl{constructor(t,n,r,i,o,s,a,l){super(t,l.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=o,this.parent=s,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?Rc:0}set marker(t){(this.info&Ms)>0!==t&&(this.info^=Ms)}get marker(){return(this.info&Ms)>0}get keep(){return(this.info&Nc)>0}set keep(t){this.keep!==t&&(this.info^=Nc)}get countable(){return(this.info&Rc)>0}get deleted(){return(this.info&Es)>0}set deleted(t){this.deleted!==t&&(this.info^=Es)}markDeleted(){this.info|=Es}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=_t(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=_t(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===fr&&this.id.client!==this.parent.client&&this.parent.clock>=_t(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=$c(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ne(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===ge||this.right&&this.right.constructor===ge)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===ut&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===fr){const r=$i(n,this.parent);r.constructor===ge?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=$c(t,t.doc.store,Q(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,s=new Set;for(;i!==null&&i!==this.right;){if(s.add(i),o.add(i),lr(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,o.clear();else if(lr(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&s.has($i(t.doc.store,i.origin)))o.has($i(t.doc.store,i.origin))||(r=i,o.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),jh(t.doc.store,this),this.content.integrate(t,this),Gc(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ge(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Q(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&lr(t.origin,this.lastId)&&this.right===t&&lr(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ai(t.deleteSet,this.id.client,this.id.clock,this.length),Gc(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw we();this.content.gc(t),n?pw(t,this,new ge(this.id,this.length)):this.content=new di(this.length)}write(t,n){const r=n>0?Q(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,o=this.parentSub,s=this.content.getRef()&Ho|(r===null?0:le)|(i===null?0:Xe)|(o===null?0:oi);if(t.writeInfo(s),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=li(a);t.writeParentInfo(!0),t.writeString(c)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===fr?(t.writeParentInfo(!1),t.writeLeftID(a)):we();o!==null&&t.writeString(o)}this.content.write(t,n)}}const ud=(e,t)=>ck[t&Ho](e),ck=[()=>{we()},$w,Xw,Jw,Qw,Gw,Yw,lk,Zw,Kw,()=>{we()}],uk=10;class me extends kl{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){we()}write(t,n){t.writeInfo(uk),K(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const fd=typeof window!="undefined"?window:typeof global!="undefined"?global:{},hd="__ $YJS$ __";fd[hd]===!0&&console.warn("Yjs was already imported. Importing different versions of Yjs often leads to issues.");fd[hd]=!0;const Is=3e4;class fk extends xr{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=je();this.getLocalState()!==null&&Is/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,o)=>{o!==this.clientID&&Is<=n-i.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&ua(this,r,"timeout")},jn(Is/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:i,lastUpdated:je()});const s=[],a=[],l=[],c=[];t===null?c.push(n):o==null?t!=null&&s.push(n):(a.push(n),Jr(o,t)||l.push(n)),(s.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:s,updated:l,removed:c},"local"]),this.emit("update",[{added:s,updated:a,removed:c},"local"])}setLocalStateField(t,n){const r=this.getLocalState();r!==null&&this.setLocalState(Dt(z({},r),{[t]:n}))}getStates(){return this.states}}const ua=(e,t,n)=>{const r=[];for(let i=0;i<t.length;i++){const o=t[i];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const s=e.meta.get(o);e.meta.set(o,{clock:s.clock+1,lastUpdated:je()})}r.push(o)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},wo=(e,t,n=e.states)=>{const r=t.length,i=Tt();K(i,r);for(let o=0;o<r;o++){const s=t[o],a=n.get(s)||null,l=e.meta.get(s).clock;K(i,s),K(i,l),Ve(i,JSON.stringify(a))}return vt(i)},hk=(e,t,n)=>{const r=Je(t),i=je(),o=[],s=[],a=[],l=[],c=Z(r);for(let f=0;f<c;f++){const u=Z(r);let d=Z(r);const p=JSON.parse(Ze(r)),g=e.meta.get(u),y=e.states.get(u),w=g===void 0?0:g.clock;(w<d||w===d&&p===null&&e.states.has(u))&&(p===null?u===e.clientID&&e.getLocalState()!=null?d++:e.states.delete(u):e.states.set(u,p),e.meta.set(u,{clock:d,lastUpdated:i}),g===void 0&&p!==null?o.push(u):g!==void 0&&p===null?l.push(u):p!==null&&(Jr(p,y)||a.push(u),s.push(u)))}(o.length>0||a.length>0||l.length>0)&&e.emit("change",[{added:o,updated:a,removed:l},n]),(o.length>0||s.length>0||l.length>0)&&e.emit("update",[{added:o,updated:s,removed:l},n])},Sl=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}},dk=(e,t)=>{let n=0,r=0;for(;n<e.length&&n<t.length&&e[n]===t[n];)n++;for(;r+n<e.length&&r+n<t.length&&e[e.length-r-1]===t[t.length-r-1];)r++;return{index:n,remove:e.length-n-r,insert:t.slice(n,t.length-r)}},pk=dk,bt=new he("y-sync"),Fn=new he("y-undo"),Fi=new he("yjs-cursor"),ko=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&t.sv.get(e.id.client)>e.id.clock&&!Ci(t.ds,e.id),gk=[{light:"#ecd44433",dark:"#ecd444"}],mk=(e,t,n)=>{if(!e.has(n)){if(e.size<t.length){const r=wr();e.forEach(i=>r.add(i)),t=t.filter(i=>!r.has(i))}e.set(n,Ab(t))}return e.get(n)},yk=(e,{colors:t=gk,colorMapping:n=new Map,permanentUserData:r=null}={})=>{let i=!1,o;const s=new Kt({props:{editable:a=>{const l=bt.getState(a);return l.snapshot==null&&l.prevSnapshot==null}},key:bt,state:{init:(a,l)=>({type:e,doc:e.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:t,colorMapping:n,permanentUserData:r}),apply:(a,l)=>{const c=a.getMeta(bt);if(c!==void 0){l=Object.assign({},l);for(const f in c)l[f]=c[f]}return l.isChangeOrigin=c!==void 0&&!!c.isChangeOrigin,l.binding!==null&&c!==void 0&&(c.snapshot!=null||c.prevSnapshot!=null)&&ho(0,()=>{l.binding==null||l.binding.isDestroyed||(c.restore==null?l.binding._renderSnapshot(c.snapshot,c.prevSnapshot,l):(l.binding._renderSnapshot(c.snapshot,c.snapshot,l),delete l.restore,delete l.snapshot,delete l.prevSnapshot,l.binding._prosemirrorChanged(l.binding.prosemirrorView.state.doc)))}),l}},view:a=>{const l=new bk(e,a);return o!=null&&clearTimeout(o),o=ho(0,()=>{l._forceRerender(),a.dispatch(a.state.tr.setMeta(bt,{binding:l}))}),{update:()=>{const c=s.getState(a.state);c.snapshot==null&&c.prevSnapshot==null&&(i||a.state.doc.content.findDiffStart(a.state.doc.type.createAndFill().content)!==null)&&(i=!0,l._prosemirrorChanged(a.state.doc))},destroy:()=>{clearTimeout(o),l.destroy()}}}});return s},vk=(e,t,n)=>{if(t!==null&&t.anchor!==null&&t.head!==null){const r=gi(n.doc,n.type,t.anchor,n.mapping),i=gi(n.doc,n.type,t.head,n.mapping);r!==null&&i!==null&&(e=e.setSelection(rt.create(e.doc,r,i)))}},fa=(e,t)=>({anchor:So(t.selection.anchor,e.type,e.mapping),head:So(t.selection.head,e.type,e.mapping)});class bk{constructor(t,n){this.type=t,this.prosemirrorView=n,this.mux=Sl(),this.isDestroyed=!1,this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=t.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=fa(this,n.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),t.observeDeep(this._observeFunction),this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(Ga&&this._domSelectionInView===null&&(ho(0,()=>{this._domSelectionInView=null}),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const t=this.prosemirrorView._root.getSelection(),n=this.prosemirrorView._root.createRange();n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.getClientRects().length===0&&n.startContainer&&n.collapsed&&n.selectNodeContents(n.startContainer);const i=n.getBoundingClientRect(),o=Tn.documentElement;return i.bottom>=0&&i.right>=0&&i.left<=(window.innerWidth||o.clientWidth||0)&&i.top<=(window.innerHeight||o.clientHeight||0)}renderSnapshot(t,n){n||(n=pl(cl(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(bt,{snapshot:t,prevSnapshot:n}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const t=this.type.toArray().map(r=>Gi(r,this.prosemirrorView.state.schema,this.mapping)).filter(r=>r!==null),n=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new H(new B(t),0,0));n.setMeta(bt,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(n)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const t=this.type.toArray().map(r=>Gi(r,this.prosemirrorView.state.schema,this.mapping)).filter(r=>r!==null),n=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new H(new B(t),0,0));this.prosemirrorView.dispatch(n.setMeta(bt,{isChangeOrigin:!0}))})}_renderSnapshot(t,n,r){t||(t=hw(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(i=>{const o=r.permanentUserData;o&&o.dss.forEach(c=>{en(i,c,f=>{})});const s=(c,f)=>{const u=c==="added"?o.getUserByClientId(f.client):o.getUserByDeletedId(f);return{user:u,type:c,color:mk(r.colorMapping,r.colors,u)}},a=Yh(this.type,new dl(n.ds,t.sv)).map(c=>!c._item.deleted||ko(c._item,t)||ko(c._item,n)?Gi(c,this.prosemirrorView.state.schema,new Map,t,n,s):null).filter(c=>c!==null),l=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new H(new B(a),0,0));this.prosemirrorView.dispatch(l.setMeta(bt,{isChangeOrigin:!0}))},bt)})}_typeChanged(t,n){const r=bt.getState(this.prosemirrorView.state);if(t.length===0||r.snapshot!=null||r.prevSnapshot!=null){this.renderSnapshot(r.snapshot,r.prevSnapshot);return}this.mux(()=>{const i=(a,l)=>this.mapping.delete(l);en(n,n.deleteSet,a=>a.constructor===ut&&this.mapping.delete(a.content.type)),n.changed.forEach(i),n.changedParentTypes.forEach(i);const o=this.type.toArray().map(a=>dd(a,this.prosemirrorView.state.schema,this.mapping)).filter(a=>a!==null);let s=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new H(new B(o),0,0));vk(s,this.beforeTransactionSelection,this),s=s.setMeta(bt,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&s.scrollIntoView(),this.prosemirrorView.dispatch(s)})}_prosemirrorChanged(t){this.mux(()=>{this.doc.transact(()=>{da(this.doc,this.type,t,this.mapping),this.beforeTransactionSelection=fa(this,this.prosemirrorView.state)},bt)})}destroy(){this.isDestroyed=!0,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const dd=(e,t,n,r,i,o)=>{const s=n.get(e);if(s===void 0){if(e instanceof re)return Gi(e,t,n,r,i,o);throw De()}return s},Gi=(e,t,n,r,i,o)=>{const s=[],a=l=>{if(l.constructor===re){const c=dd(l,t,n,r,i,o);c!==null&&s.push(c)}else{const c=wk(l,t,n,r,i,o);c!==null&&c.forEach(f=>{f!==null&&s.push(f)})}};r===void 0||i===void 0?e.toArray().forEach(a):Yh(e,new dl(i.ds,r.sv)).forEach(a);try{const l=e.getAttributes(r);r!==void 0&&(ko(e._item,r)?ko(e._item,i)||(l.ychange=o?o("added",e._item.id):{type:"added"}):l.ychange=o?o("removed",e._item.id):{type:"removed"});const c=t.node(e.nodeName,l,s);return n.set(e,c),c}catch{return e.doc.transact(c=>{e._item.delete(c)},bt),n.delete(e),null}},wk=(e,t,n,r,i,o)=>{const s=[],a=e.toDelta(r,i,o);try{for(let l=0;l<a.length;l++){const c=a[l],f=[];for(const u in c.attributes)f.push(t.mark(u,c.attributes[u]));s.push(t.text(c.insert,f))}}catch{return e.doc.transact(c=>{e._item.delete(c)},bt),null}return s},kk=(e,t)=>{const n=new ve,r=e.map(i=>({insert:i.text,attributes:gd(i.marks)}));return n.applyDelta(r),t.set(n,e),n},_k=(e,t)=>{const n=new re(e.type.name);for(const r in e.attrs){const i=e.attrs[r];i!==null&&r!=="ychange"&&n.setAttribute(r,i)}return n.insert(0,Zo(e).map(r=>ha(r,t))),t.set(n,e),n},ha=(e,t)=>e instanceof Array?kk(e,t):_k(e,t),eu=e=>typeof e=="object"&&e!==null,Cl=(e,t)=>{const n=Object.keys(e).filter(i=>e[i]!==null);let r=n.length===Object.keys(t).filter(i=>t[i]!==null).length;for(let i=0;i<n.length&&r;i++){const o=n[i],s=e[o],a=t[o];r=o==="ychange"||s===a||eu(s)&&eu(a)&&Cl(s,a)}return r},Zo=e=>{const t=e.content.content,n=[];for(let r=0;r<t.length;r++){const i=t[r];if(i.isText){const o=[];for(let s=t[r];r<t.length&&s.isText;s=t[++r])o.push(s);r--,n.push(o)}else n.push(i)}return n},pd=(e,t)=>{const n=e.toDelta();return n.length===t.length&&n.every((r,i)=>r.insert===t[i].text&&Mh(r.attributes||{}).length===t[i].marks.length&&t[i].marks.every(o=>Cl(r.attributes[o.type.name]||{},o.attrs)))},pi=(e,t)=>{if(e instanceof re&&!(t instanceof Array)&&pa(e,t)){const n=Zo(t);return e._length===n.length&&Cl(e.getAttributes(),t.attrs)&&e.toArray().every((r,i)=>pi(r,n[i]))}return e instanceof ve&&t instanceof Array&&pd(e,t)},_o=(e,t)=>e===t||e instanceof Array&&t instanceof Array&&e.length===t.length&&e.every((n,r)=>t[r]===n),nu=(e,t,n)=>{const r=e.toArray(),i=Zo(t),o=i.length,s=r.length,a=bn(s,o);let l=0,c=0,f=!1;for(;l<a;l++){const u=r[l],d=i[l];if(_o(n.get(u),d))f=!0;else if(!pi(u,d))break}for(;l+c<a;c++){const u=r[s-c-1],d=i[o-c-1];if(_o(n.get(u),d))f=!0;else if(!pi(u,d))break}return{equalityFactor:l+c,foundMappedChild:f}},Sk=e=>{let t="",n=e._start;const r={};for(;n!==null;)n.deleted||(n.countable&&n.content instanceof Re?t+=n.content.str:n.content instanceof Ct&&(r[n.content.key]=null)),n=n.right;return{str:t,nAttrs:r}},Ck=(e,t,n)=>{n.set(e,t);const{nAttrs:r,str:i}=Sk(e),o=t.map(c=>({insert:c.text,attributes:Object.assign({},r,gd(c.marks))})),{insert:s,remove:a,index:l}=pk(i,o.map(c=>c.insert).join(""));e.delete(l,a),e.insert(l,s),e.applyDelta(o.map(c=>({retain:c.insert.length,attributes:c.attributes})))},gd=e=>{const t={};return e.forEach(n=>{n.type.name!=="ychange"&&(t[n.type.name]=n.attrs)}),t},da=(e,t,n,r)=>{if(t instanceof re&&t.nodeName!==n.type.name)throw new Error("node name mismatch!");if(r.set(t,n),t instanceof re){const u=t.getAttributes(),d=n.attrs;for(const p in d)d[p]!==null?u[p]!==d[p]&&p!=="ychange"&&t.setAttribute(p,d[p]):t.removeAttribute(p);for(const p in u)d[p]===void 0&&t.removeAttribute(p)}const i=Zo(n),o=i.length,s=t.toArray(),a=s.length,l=bn(o,a);let c=0,f=0;for(;c<l;c++){const u=s[c],d=i[c];if(!_o(r.get(u),d))if(pi(u,d))r.set(u,d);else break}for(;f+c+1<l;f++){const u=s[a-f-1],d=i[o-f-1];if(!_o(r.get(u),d))if(pi(u,d))r.set(u,d);else break}e.transact(()=>{for(;a-c-f>0&&o-c-f>0;){const d=s[c],p=i[c],g=s[a-f-1],y=i[o-f-1];if(d instanceof ve&&p instanceof Array)pd(d,p)||Ck(d,p,r),c+=1;else{let w=d instanceof re&&pa(d,p),E=g instanceof re&&pa(g,y);if(w&&E){const _=nu(d,p,r),b=nu(g,y,r);_.foundMappedChild&&!b.foundMappedChild?E=!1:!_.foundMappedChild&&b.foundMappedChild||_.equalityFactor<b.equalityFactor?w=!1:E=!1}w?(da(e,d,p,r),c+=1):E?(da(e,g,y,r),f+=1):(t.delete(c,1),t.insert(c,[ha(p,r)]),c+=1)}}const u=a-c-f;if(u>0&&t.delete(c,u),c+f<o){const d=[];for(let p=c;p<o-f;p++)d.push(ha(i[p],r));t.insert(c,d)}},bt)},pa=(e,t)=>!(t instanceof Array)&&e.nodeName===t.type.name;let Kr=null;const Ek=()=>{const e=Kr;Kr=null,e.forEach((t,n)=>{const r=n.state.tr,i=bt.getState(n.state);i&&i.binding&&!i.binding.isDestroyed&&(t.forEach((o,s)=>{r.setMeta(s,o)}),n.dispatch(r))})},Mk=(e,t,n)=>{Kr||(Kr=new Map,ho(0,Ek)),ue(Kr,e,Ae).set(t,n)},So=(e,t,n)=>{if(e===0)return Ds(t,0);let r=t._first===null?null:t._first.content.type;for(;r!==null&&t!==r;){if(r instanceof ve){if(r._length>=e)return Ds(r,e);if(e-=r._length,r._item!==null&&r._item.next!==null)r=r._item.next.content.type;else{do r=r._item===null?null:r._item.parent,e--;while(r!==t&&r!==null&&r._item!==null&&r._item.next===null);r!==null&&r!==t&&(r=r._item===null?null:r._item.next.content.type)}}else{const i=(n.get(r)||{nodeSize:0}).nodeSize;if(r._first!==null&&e<i)r=r._first.content.type,e--;else{if(e===1&&r._length===0&&i>1)return new ui(r._item===null?null:r._item.id,r._item===null?li(r):null,null);if(e-=i,r._item!==null&&r._item.next!==null)r=r._item.next.content.type;else{if(e===0)return r=r._item===null?r:r._item.parent,new ui(r._item===null?null:r._item.id,r._item===null?li(r):null,null);do r=r._item.parent,e--;while(r!==t&&r._item.next===null);r!==t&&(r=r._item.next.content.type)}}}if(r===null)throw we();if(e===0&&r.constructor!==ve&&r!==t)return Tk(r._item.parent,r._item)}return Ds(t,t._length)},Tk=(e,t)=>{let n=null,r=null;return e._item===null?r=li(e):n=Q(e._item.id.client,e._item.id.clock),new ui(n,r,t.id)},gi=(e,t,n,r)=>{const i=fw(n,e);if(i===null||i.type!==t&&!ci(t,i.type._item))return null;let o=i.type,s=0;if(o.constructor===ve)s=i.index;else if(o._item===null||!o._item.deleted){let a=o._first,l=0;for(;l<o._length&&l<i.index&&a!==null;){if(!a.deleted){const c=a.content.type;l++,c instanceof ve?s+=c._length:s+=r.get(c).nodeSize}a=a.right}s+=1}for(;o!==t&&o._item!==null;){const a=o._item.parent;if(a._item===null||!a._item.deleted){s+=1;let l=a._first;for(;l!==null;){const c=l.content.type;if(c===o)break;l.deleted||(c instanceof ve?s+=c._length:s+=r.get(c).nodeSize),l=l.right}}o=a}return s-1},Ok=e=>{const t=document.createElement("span");t.classList.add("ProseMirror-yjs-cursor"),t.setAttribute("style",`border-color: ${e.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${e.color}`),n.insertBefore(document.createTextNode(e.name),null);const r=document.createTextNode("\u2060"),i=document.createTextNode("\u2060");return t.insertBefore(r,null),t.insertBefore(n,null),t.insertBefore(i,null),t},xk=e=>({style:`background-color: ${e.color}70`,class:"ProseMirror-yjs-selection"}),Ak=/^#[0-9a-fA-F]{6}$/,ru=(e,t,n,r)=>{const i=bt.getState(e),o=i.doc,s=[];return i.snapshot!=null||i.prevSnapshot!=null||i.binding===null?ct.create(e.doc,[]):(t.getStates().forEach((a,l)=>{if(l!==o.clientID&&a.cursor!=null){const c=a.user||{};c.color==null?c.color="#ffa500":Ak.test(c.color)||console.warn("A user uses an unsupported color format",c),c.name==null&&(c.name=`User: ${l}`);let f=gi(o,i.type,$r(a.cursor.anchor),i.binding.mapping),u=gi(o,i.type,$r(a.cursor.head),i.binding.mapping);if(f!==null&&u!==null){const d=tn(e.doc.content.size-1,0);f=bn(f,d),u=bn(u,d),s.push(Et.widget(u,()=>n(c),{key:l+"",side:10}));const p=bn(f,u),g=tn(f,u);s.push(Et.inline(p,g,r(c),{inclusiveEnd:!0,inclusiveStart:!1}))}}}),ct.create(e.doc,s))},Dk=(e,{cursorBuilder:t=Ok,selectionBuilder:n=xk,getSelection:r=o=>o.selection}={},i="cursor")=>new Kt({key:Fi,state:{init(o,s){return ru(s,e,t,n)},apply(o,s,a,l){const c=bt.getState(l),f=o.getMeta(Fi);return c&&c.isChangeOrigin||f&&f.awarenessUpdated?ru(l,e,t,n):s.map(o.mapping,o.doc)}},props:{decorations:o=>Fi.getState(o)},view:o=>{const s=()=>{o.docView&&Mk(o,Fi,{awarenessUpdated:!0})},a=()=>{const l=bt.getState(o.state),c=e.getLocalState()||{};if(l.binding!=null)if(o.hasFocus()){const f=r(o.state),u=So(f.anchor,l.type,l.binding.mapping),d=So(f.head,l.type,l.binding.mapping);(c.cursor==null||!Jc($r(c.cursor.anchor),u)||!Jc($r(c.cursor.head),d))&&e.setLocalStateField(i,{anchor:u,head:d})}else c.cursor!=null&&gi(l.doc,l.type,$r(c.cursor.anchor),l.binding.mapping)!==null&&e.setLocalStateField(i,null)};return e.on("change",s),o.dom.addEventListener("focusin",a),o.dom.addEventListener("focusout",a),{update:a,destroy:()=>{o.dom.removeEventListener("focusin",a),o.dom.removeEventListener("focusout",a),e.off("change",s),e.setLocalStateField(i,null)}}}}),Nk=e=>{const t=Fn.getState(e).undoManager;if(t!=null)return t.undo(),!0},Rk=e=>{const t=Fn.getState(e).undoManager;if(t!=null)return t.redo(),!0},Ik=new Set(["paragraph"]),Lk=(e,t)=>!(e instanceof ut)||!(e.content instanceof Ie)||!(e.content.type instanceof Wn||e.content.type instanceof re&&t.has(e.content.type.nodeName))||e.content.type._length===0,Pk=({protectedNodes:e=Ik,trackedOrigins:t=[],undoManager:n=null}={})=>new Kt({key:Fn,state:{init:(r,i)=>{const o=bt.getState(i),s=n||new bw(o.type,{trackedOrigins:new Set([bt].concat(t)),deleteFilter:a=>Lk(a,e)});return{undoManager:s,prevSel:null,hasUndoOps:s.undoStack.length>0,hasRedoOps:s.redoStack.length>0}},apply:(r,i,o,s)=>{const a=bt.getState(s).binding,l=i.undoManager,c=l.undoStack.length>0,f=l.redoStack.length>0;return a?{undoManager:l,prevSel:fa(a,o),hasUndoOps:c,hasRedoOps:f}:c!==i.hasUndoOps||f!==i.hasRedoOps?Object.assign({},i,{hasUndoOps:l.undoStack.length>0,hasRedoOps:l.redoStack.length>0}):i}},view:r=>{const i=bt.getState(r.state),o=Fn.getState(r.state).undoManager;return o.on("stack-item-added",({stackItem:s})=>{const a=i.binding;a&&s.meta.set(a,Fn.getState(r.state).prevSel)}),o.on("stack-item-popped",({stackItem:s})=>{const a=i.binding;a&&(a.beforeTransactionSelection=s.meta.get(a)||a.beforeTransactionSelection)}),{destroy:()=>{o.destroy()}}}}),Bk=Qt.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(e=>e.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:e,state:t,dispatch:n})=>(e.setMeta("preventDispatch",!0),Fn.getState(t).undoManager.undoStack.length===0?!1:n?Nk(t):!0),redo:()=>({tr:e,state:t,dispatch:n})=>(e.setMeta("preventDispatch",!0),Fn.getState(t).undoManager.redoStack.length===0?!1:n?Rk(t):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[yk(e),Pk()]}}),iu=e=>Array.from(e.entries()).map(([t,n])=>z({clientId:t},n.user)),ou=()=>null,Fk=Qt.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:e=>{const t=document.createElement("span");t.classList.add("collaboration-cursor__caret"),t.setAttribute("style",`border-color: ${e.color}`);const n=document.createElement("div");return n.classList.add("collaboration-cursor__label"),n.setAttribute("style",`background-color: ${e.color}`),n.insertBefore(document.createTextNode(e.name),null),t.insertBefore(n,null),t},onUpdate:ou}},onCreate(){this.options.onUpdate!==ou&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:e=>()=>(this.options.user=e,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:e=>({editor:t})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),t.commands.updateUser(e))}},addProseMirrorPlugins(){return[Dk((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=iu(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=iu(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}});var su;(function(e){e[e.Token=0]="Token",e[e.PermissionDenied=1]="PermissionDenied",e[e.Authenticated=2]="Authenticated"})(su||(su={}));var au;(function(e){e[e.Connecting=0]="Connecting",e[e.Open=1]="Open",e[e.Closing=2]="Closing",e[e.Closed=3]="Closed"})(au||(au={}));const Ls=()=>new Map,zk=e=>e.toLowerCase(),Vk=/^\s*/g,Uk=e=>e.replace(Vk,""),jk=/([A-Z])/g,lu=(e,t)=>Uk(e.replace(jk,n=>`${t}${zk(n)}`));typeof TextEncoder!="undefined"&&new TextEncoder;let Ps=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ps&&Ps.decode(new Uint8Array).length===1&&(Ps=null);const cu=e=>e===void 0?null:e;class Hk{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let md=new Hk,qk=!0;try{typeof localStorage!="undefined"&&(md=localStorage,qk=!1)}catch{}const Wk=md,yd=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name);typeof navigator!="undefined"&&/Mac/.test(navigator.platform);let Pe;const Jk=()=>{if(Pe===void 0)if(yd){Pe=Ls();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Pe.set(t,""),t=r):t!==null&&(Pe.set(t,r),t=null)}t!==null&&Pe.set(t,"")}else typeof location=="object"?(Pe=Ls(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Pe.set(`--${lu(t,"-")}`,n),Pe.set(`-${lu(t,"-")}`,n)}})):Pe=Ls();return Pe},$k=e=>Jk().has(e),Kk=e=>cu(yd?process.env[e.toUpperCase()]:Wk.getItem(e)),Gk=e=>$k("--"+e)||Kk(e)!==null;Gk("production");var uu;(function(e){e[e.Sync=0]="Sync",e[e.Awareness=1]="Awareness",e[e.Auth=2]="Auth",e[e.QueryAwareness=3]="QueryAwareness"})(uu||(uu={}));var fu;(function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnected="disconnected"})(fu||(fu={}));const Yk=1200,Xk=2500,Co=3e4,ga=e=>{if(e.shouldConnect&&e.ws===null){const t=new WebSocket(e.url),n=e.binaryType;let r=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=s=>{e.lastMessageReceived=je();const a=s.data,l=typeof a=="string"?JSON.parse(a):a;l&&l.type==="pong"&&(clearTimeout(r),r=setTimeout(o,Co/2)),e.emit("message",[l,e])};const i=s=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:s},e])):e.unsuccessfulReconnects++,setTimeout(ga,bn(K0(e.unsuccessfulReconnects+1)*Yk,Xk),e)),clearTimeout(r)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>i(null),t.onerror=s=>i(s),t.onopen=()=>{e.lastMessageReceived=je(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),r=setTimeout(o,Co/2)}}};class Zk extends xr{constructor(t,{binaryType:n}={}){super(),this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Co<je()-this.lastMessageReceived&&this.ws.close()},Co/2),ga(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&ga(this)}}const Qk=new Map;class t_{constructor(t){this.room=t,this.onmessage=null,rb(n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:_h(n.newValue||"")}))}postMessage(t){vh.setItem(this.room,kh(gb(t)))}}const e_=typeof BroadcastChannel=="undefined"?t_:BroadcastChannel,El=e=>ue(Qk,e,()=>{const t=new Set,n=new e_(e);return n.onmessage=r=>t.forEach(i=>i(r.data,"broadcastchannel")),{bc:n,subs:t}}),n_=(e,t)=>El(e).subs.add(t),r_=(e,t)=>El(e).subs.delete(t),i_=(e,t,n=null)=>{const r=El(e);r.bc.postMessage(t),r.subs.forEach(i=>i(t,n))};var Be=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function zi(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vd={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){var n=Math.floor,r=Math.abs,i=Math.pow;return function(){function o(s,a,l){function c(d,p){if(!a[d]){if(!s[d]){var g=typeof zi=="function"&&zi;if(!p&&g)return g(d,!0);if(f)return f(d,!0);var y=new Error("Cannot find module '"+d+"'");throw y.code="MODULE_NOT_FOUND",y}var w=a[d]={exports:{}};s[d][0].call(w.exports,function(E){var _=s[d][1][E];return c(_||E)},w,w.exports,o,s,a,l)}return a[d].exports}for(var f=typeof zi=="function"&&zi,u=0;u<l.length;u++)c(l[u]);return c}return o}()({1:[function(o,s,a){function l(k){var S=k.length;if(0<S%4)throw new Error("Invalid string. Length must be a multiple of 4");var x=k.indexOf("=");x===-1&&(x=S);var M=x===S?0:4-x%4;return[x,M]}function c(k,S,x){return 3*(S+x)/4-x}function f(k){var S,x,M=l(k),A=M[0],P=M[1],O=new w(c(k,A,P)),D=0,F=0<P?A-4:A;for(x=0;x<F;x+=4)S=y[k.charCodeAt(x)]<<18|y[k.charCodeAt(x+1)]<<12|y[k.charCodeAt(x+2)]<<6|y[k.charCodeAt(x+3)],O[D++]=255&S>>16,O[D++]=255&S>>8,O[D++]=255&S;return P===2&&(S=y[k.charCodeAt(x)]<<2|y[k.charCodeAt(x+1)]>>4,O[D++]=255&S),P===1&&(S=y[k.charCodeAt(x)]<<10|y[k.charCodeAt(x+1)]<<4|y[k.charCodeAt(x+2)]>>2,O[D++]=255&S>>8,O[D++]=255&S),O}function u(k){return g[63&k>>18]+g[63&k>>12]+g[63&k>>6]+g[63&k]}function d(k,S,x){for(var M,A=[],P=S;P<x;P+=3)M=(16711680&k[P]<<16)+(65280&k[P+1]<<8)+(255&k[P+2]),A.push(u(M));return A.join("")}function p(k){for(var S,x=k.length,M=x%3,A=[],P=16383,O=0,D=x-M;O<D;O+=P)A.push(d(k,O,O+P>D?D:O+P));return M===1?(S=k[x-1],A.push(g[S>>2]+g[63&S<<4]+"==")):M===2&&(S=(k[x-2]<<8)+k[x-1],A.push(g[S>>10]+g[63&S>>4]+g[63&S<<2]+"=")),A.join("")}a.byteLength=function(k){var S=l(k),x=S[0],M=S[1];return 3*(x+M)/4-M},a.toByteArray=f,a.fromByteArray=p;for(var g=[],y=[],w=typeof Uint8Array=="undefined"?Array:Uint8Array,E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=0,b=E.length;_<b;++_)g[_]=E[_],y[E.charCodeAt(_)]=_;y[45]=62,y[95]=63},{}],2:[function(){},{}],3:[function(o,s,a){(function(){(function(){var l=String.fromCharCode,c=Math.min;function f(h){if(2147483647<h)throw new RangeError('The value "'+h+'" is invalid for option "size"');var m=new Uint8Array(h);return m.__proto__=u.prototype,m}function u(h,m,v){if(typeof h=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(h)}return d(h,m,v)}function d(h,m,v){if(typeof h=="string")return w(h,m);if(ArrayBuffer.isView(h))return E(h);if(h==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h);if(R(h,ArrayBuffer)||h&&R(h.buffer,ArrayBuffer))return _(h,m,v);if(typeof h=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var T=h.valueOf&&h.valueOf();if(T!=null&&T!==h)return u.from(T,m,v);var N=b(h);if(N)return N;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof h[Symbol.toPrimitive]=="function")return u.from(h[Symbol.toPrimitive]("string"),m,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof h)}function p(h){if(typeof h!="number")throw new TypeError('"size" argument must be of type number');if(0>h)throw new RangeError('The value "'+h+'" is invalid for option "size"')}function g(h,m,v){return p(h),0>=h||m===void 0?f(h):typeof v=="string"?f(h).fill(m,v):f(h).fill(m)}function y(h){return p(h),f(0>h?0:0|k(h))}function w(h,m){if((typeof m!="string"||m==="")&&(m="utf8"),!u.isEncoding(m))throw new TypeError("Unknown encoding: "+m);var v=0|S(h,m),T=f(v),N=T.write(h,m);return N!==v&&(T=T.slice(0,N)),T}function E(h){for(var m=0>h.length?0:0|k(h.length),v=f(m),T=0;T<m;T+=1)v[T]=255&h[T];return v}function _(h,m,v){if(0>m||h.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(h.byteLength<m+(v||0))throw new RangeError('"length" is outside of buffer bounds');var T;return T=m===void 0&&v===void 0?new Uint8Array(h):v===void 0?new Uint8Array(h,m):new Uint8Array(h,m,v),T.__proto__=u.prototype,T}function b(h){if(u.isBuffer(h)){var m=0|k(h.length),v=f(m);return v.length===0||h.copy(v,0,0,m),v}return h.length===void 0?h.type==="Buffer"&&Array.isArray(h.data)?E(h.data):void 0:typeof h.length!="number"||I(h.length)?f(0):E(h)}function k(h){if(h>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|h}function S(h,m){if(u.isBuffer(h))return h.length;if(ArrayBuffer.isView(h)||R(h,ArrayBuffer))return h.byteLength;if(typeof h!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof h);var v=h.length,T=2<arguments.length&&arguments[2]===!0;if(!T&&v===0)return 0;for(var N=!1;;)switch(m){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return xn(h).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*v;case"hex":return v>>>1;case"base64":return Ee(h).length;default:if(N)return T?-1:xn(h).length;m=(""+m).toLowerCase(),N=!0}}function x(h,m,v){var T=!1;if((m===void 0||0>m)&&(m=0),m>this.length||((v===void 0||v>this.length)&&(v=this.length),0>=v)||(v>>>=0,m>>>=0,v<=m))return"";for(h||(h="utf8");;)switch(h){case"hex":return Se(this,m,v);case"utf8":case"utf-8":return yt(this,m,v);case"ascii":return X(this,m,v);case"latin1":case"binary":return tr(this,m,v);case"base64":return G(this,m,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return sn(this,m,v);default:if(T)throw new TypeError("Unknown encoding: "+h);h=(h+"").toLowerCase(),T=!0}}function M(h,m,v){var T=h[m];h[m]=h[v],h[v]=T}function A(h,m,v,T,N){if(h.length===0)return-1;if(typeof v=="string"?(T=v,v=0):2147483647<v?v=2147483647:-2147483648>v&&(v=-2147483648),v=+v,I(v)&&(v=N?0:h.length-1),0>v&&(v=h.length+v),v>=h.length){if(N)return-1;v=h.length-1}else if(0>v)if(N)v=0;else return-1;if(typeof m=="string"&&(m=u.from(m,T)),u.isBuffer(m))return m.length===0?-1:P(h,m,v,T,N);if(typeof m=="number")return m&=255,typeof Uint8Array.prototype.indexOf=="function"?N?Uint8Array.prototype.indexOf.call(h,m,v):Uint8Array.prototype.lastIndexOf.call(h,m,v):P(h,[m],v,T,N);throw new TypeError("val must be string, number or Buffer")}function P(h,m,v,T,N){function L(er,Pr){return W===1?er[Pr]:er.readUInt16BE(Pr*W)}var W=1,ot=h.length,gt=m.length;if(T!==void 0&&(T=(T+"").toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(2>h.length||2>m.length)return-1;W=2,ot/=2,gt/=2,v/=2}var st;if(N){var it=-1;for(st=v;st<ot;st++)if(L(h,st)!==L(m,it===-1?0:st-it))it!==-1&&(st-=st-it),it=-1;else if(it===-1&&(it=st),st-it+1===gt)return it*W}else for(v+gt>ot&&(v=ot-gt),st=v;0<=st;st--){for(var At=!0,An=0;An<gt;An++)if(L(h,st+An)!==L(m,An)){At=!1;break}if(At)return st}return-1}function O(h,m,v,T){v=+v||0;var N=h.length-v;T?(T=+T,T>N&&(T=N)):T=N;var L=m.length;T>L/2&&(T=L/2);for(var W,ot=0;ot<T;++ot){if(W=parseInt(m.substr(2*ot,2),16),I(W))return ot;h[v+ot]=W}return ot}function D(h,m,v,T){return Me(xn(m,h.length-v),h,v,T)}function F(h,m,v,T){return Me(Lr(m),h,v,T)}function j(h,m,v,T){return F(h,m,v,T)}function Y(h,m,v,T){return Me(Ee(m),h,v,T)}function $(h,m,v,T){return Me(cn(m,h.length-v),h,v,T)}function G(h,m,v){return m===0&&v===h.length?U.fromByteArray(h):U.fromByteArray(h.slice(m,v))}function yt(h,m,v){v=c(h.length,v);for(var T=[],N=m;N<v;){var L=h[N],W=null,ot=239<L?4:223<L?3:191<L?2:1;if(N+ot<=v){var gt,st,it,At;ot===1?128>L&&(W=L):ot===2?(gt=h[N+1],(192&gt)==128&&(At=(31&L)<<6|63&gt,127<At&&(W=At))):ot===3?(gt=h[N+1],st=h[N+2],(192&gt)==128&&(192&st)==128&&(At=(15&L)<<12|(63&gt)<<6|63&st,2047<At&&(55296>At||57343<At)&&(W=At))):ot===4&&(gt=h[N+1],st=h[N+2],it=h[N+3],(192&gt)==128&&(192&st)==128&&(192&it)==128&&(At=(15&L)<<18|(63&gt)<<12|(63&st)<<6|63&it,65535<At&&1114112>At&&(W=At)))}W===null?(W=65533,ot=1):65535<W&&(W-=65536,T.push(55296|1023&W>>>10),W=56320|1023&W),T.push(W),N+=ot}return xt(T)}function xt(h){var m=h.length;if(m<=4096)return l.apply(String,h);for(var v="",T=0;T<m;)v+=l.apply(String,h.slice(T,T+=4096));return v}function X(h,m,v){var T="";v=c(h.length,v);for(var N=m;N<v;++N)T+=l(127&h[N]);return T}function tr(h,m,v){var T="";v=c(h.length,v);for(var N=m;N<v;++N)T+=l(h[N]);return T}function Se(h,m,v){var T=h.length;(!m||0>m)&&(m=0),(!v||0>v||v>T)&&(v=T);for(var N="",L=m;L<v;++L)N+=On(h[L]);return N}function sn(h,m,v){for(var T=h.slice(m,v),N="",L=0;L<T.length;L+=2)N+=l(T[L]+256*T[L+1]);return N}function wt(h,m,v){if(h%1!=0||0>h)throw new RangeError("offset is not uint");if(h+m>v)throw new RangeError("Trying to access beyond buffer length")}function ht(h,m,v,T,N,L){if(!u.isBuffer(h))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>N||m<L)throw new RangeError('"value" argument is out of bounds');if(v+T>h.length)throw new RangeError("Index out of range")}function Ce(h,m,v,T){if(v+T>h.length)throw new RangeError("Index out of range");if(0>v)throw new RangeError("Index out of range")}function an(h,m,v,T,N){return m=+m,v>>>=0,N||Ce(h,m,v,4),J.write(h,m,v,T,23,4),v+4}function ln(h,m,v,T,N){return m=+m,v>>>=0,N||Ce(h,m,v,8),J.write(h,m,v,T,52,8),v+8}function Ir(h){if(h=h.split("=")[0],h=h.trim().replace(C,""),2>h.length)return"";for(;h.length%4!=0;)h+="=";return h}function On(h){return 16>h?"0"+h.toString(16):h.toString(16)}function xn(h,m){m=m||1/0;for(var v,T=h.length,N=null,L=[],W=0;W<T;++W){if(v=h.charCodeAt(W),55295<v&&57344>v){if(!N){if(56319<v){-1<(m-=3)&&L.push(239,191,189);continue}else if(W+1===T){-1<(m-=3)&&L.push(239,191,189);continue}N=v;continue}if(56320>v){-1<(m-=3)&&L.push(239,191,189),N=v;continue}v=(N-55296<<10|v-56320)+65536}else N&&-1<(m-=3)&&L.push(239,191,189);if(N=null,128>v){if(0>(m-=1))break;L.push(v)}else if(2048>v){if(0>(m-=2))break;L.push(192|v>>6,128|63&v)}else if(65536>v){if(0>(m-=3))break;L.push(224|v>>12,128|63&v>>6,128|63&v)}else if(1114112>v){if(0>(m-=4))break;L.push(240|v>>18,128|63&v>>12,128|63&v>>6,128|63&v)}else throw new Error("Invalid code point")}return L}function Lr(h){for(var m=[],v=0;v<h.length;++v)m.push(255&h.charCodeAt(v));return m}function cn(h,m){for(var v,T,N,L=[],W=0;W<h.length&&!(0>(m-=2));++W)v=h.charCodeAt(W),T=v>>8,N=v%256,L.push(N),L.push(T);return L}function Ee(h){return U.toByteArray(Ir(h))}function Me(h,m,v,T){for(var N=0;N<T&&!(N+v>=m.length||N>=h.length);++N)m[N+v]=h[N];return N}function R(h,m){return h instanceof m||h!=null&&h.constructor!=null&&h.constructor.name!=null&&h.constructor.name===m.name}function I(h){return h!==h}var U=o("base64-js"),J=o("ieee754");a.Buffer=u,a.SlowBuffer=function(h){return+h!=h&&(h=0),u.alloc(+h)},a.INSPECT_MAX_BYTES=50,a.kMaxLength=2147483647,u.TYPED_ARRAY_SUPPORT=function(){try{var h=new Uint8Array(1);return h.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},h.foo()===42}catch{return!1}}(),u.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){return u.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){return u.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol!="undefined"&&Symbol.species!=null&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(h,m,v){return d(h,m,v)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(h,m,v){return g(h,m,v)},u.allocUnsafe=function(h){return y(h)},u.allocUnsafeSlow=function(h){return y(h)},u.isBuffer=function(h){return h!=null&&h._isBuffer===!0&&h!==u.prototype},u.compare=function(h,m){if(R(h,Uint8Array)&&(h=u.from(h,h.offset,h.byteLength)),R(m,Uint8Array)&&(m=u.from(m,m.offset,m.byteLength)),!u.isBuffer(h)||!u.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(h===m)return 0;for(var v=h.length,T=m.length,N=0,L=c(v,T);N<L;++N)if(h[N]!==m[N]){v=h[N],T=m[N];break}return v<T?-1:T<v?1:0},u.isEncoding=function(h){switch((h+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(h,m){if(!Array.isArray(h))throw new TypeError('"list" argument must be an Array of Buffers');if(h.length===0)return u.alloc(0);var v;if(m===void 0)for(m=0,v=0;v<h.length;++v)m+=h[v].length;var T=u.allocUnsafe(m),N=0;for(v=0;v<h.length;++v){var L=h[v];if(R(L,Uint8Array)&&(L=u.from(L)),!u.isBuffer(L))throw new TypeError('"list" argument must be an Array of Buffers');L.copy(T,N),N+=L.length}return T},u.byteLength=S,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var h=this.length;if(h%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var m=0;m<h;m+=2)M(this,m,m+1);return this},u.prototype.swap32=function(){var h=this.length;if(h%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var m=0;m<h;m+=4)M(this,m,m+3),M(this,m+1,m+2);return this},u.prototype.swap64=function(){var h=this.length;if(h%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var m=0;m<h;m+=8)M(this,m,m+7),M(this,m+1,m+6),M(this,m+2,m+5),M(this,m+3,m+4);return this},u.prototype.toString=function(){var h=this.length;return h===0?"":arguments.length===0?yt(this,0,h):x.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(h){if(!u.isBuffer(h))throw new TypeError("Argument must be a Buffer");return this===h||u.compare(this,h)===0},u.prototype.inspect=function(){var h="",m=a.INSPECT_MAX_BYTES;return h=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(h+=" ... "),"<Buffer "+h+">"},u.prototype.compare=function(h,m,v,T,N){if(R(h,Uint8Array)&&(h=u.from(h,h.offset,h.byteLength)),!u.isBuffer(h))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof h);if(m===void 0&&(m=0),v===void 0&&(v=h?h.length:0),T===void 0&&(T=0),N===void 0&&(N=this.length),0>m||v>h.length||0>T||N>this.length)throw new RangeError("out of range index");if(T>=N&&m>=v)return 0;if(T>=N)return-1;if(m>=v)return 1;if(m>>>=0,v>>>=0,T>>>=0,N>>>=0,this===h)return 0;for(var L=N-T,W=v-m,ot=c(L,W),gt=this.slice(T,N),st=h.slice(m,v),it=0;it<ot;++it)if(gt[it]!==st[it]){L=gt[it],W=st[it];break}return L<W?-1:W<L?1:0},u.prototype.includes=function(h,m,v){return this.indexOf(h,m,v)!==-1},u.prototype.indexOf=function(h,m,v){return A(this,h,m,v,!0)},u.prototype.lastIndexOf=function(h,m,v){return A(this,h,m,v,!1)},u.prototype.write=function(h,m,v,T){if(m===void 0)T="utf8",v=this.length,m=0;else if(v===void 0&&typeof m=="string")T=m,v=this.length,m=0;else if(isFinite(m))m>>>=0,isFinite(v)?(v>>>=0,T===void 0&&(T="utf8")):(T=v,v=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var N=this.length-m;if((v===void 0||v>N)&&(v=N),0<h.length&&(0>v||0>m)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");for(var L=!1;;)switch(T){case"hex":return O(this,h,m,v);case"utf8":case"utf-8":return D(this,h,m,v);case"ascii":return F(this,h,m,v);case"latin1":case"binary":return j(this,h,m,v);case"base64":return Y(this,h,m,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,h,m,v);default:if(L)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),L=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(h,m){var v=this.length;h=~~h,m=m===void 0?v:~~m,0>h?(h+=v,0>h&&(h=0)):h>v&&(h=v),0>m?(m+=v,0>m&&(m=0)):m>v&&(m=v),m<h&&(m=h);var T=this.subarray(h,m);return T.__proto__=u.prototype,T},u.prototype.readUIntLE=function(h,m,v){h>>>=0,m>>>=0,v||wt(h,m,this.length);for(var T=this[h],N=1,L=0;++L<m&&(N*=256);)T+=this[h+L]*N;return T},u.prototype.readUIntBE=function(h,m,v){h>>>=0,m>>>=0,v||wt(h,m,this.length);for(var T=this[h+--m],N=1;0<m&&(N*=256);)T+=this[h+--m]*N;return T},u.prototype.readUInt8=function(h,m){return h>>>=0,m||wt(h,1,this.length),this[h]},u.prototype.readUInt16LE=function(h,m){return h>>>=0,m||wt(h,2,this.length),this[h]|this[h+1]<<8},u.prototype.readUInt16BE=function(h,m){return h>>>=0,m||wt(h,2,this.length),this[h]<<8|this[h+1]},u.prototype.readUInt32LE=function(h,m){return h>>>=0,m||wt(h,4,this.length),(this[h]|this[h+1]<<8|this[h+2]<<16)+16777216*this[h+3]},u.prototype.readUInt32BE=function(h,m){return h>>>=0,m||wt(h,4,this.length),16777216*this[h]+(this[h+1]<<16|this[h+2]<<8|this[h+3])},u.prototype.readIntLE=function(h,m,v){h>>>=0,m>>>=0,v||wt(h,m,this.length);for(var T=this[h],N=1,L=0;++L<m&&(N*=256);)T+=this[h+L]*N;return N*=128,T>=N&&(T-=i(2,8*m)),T},u.prototype.readIntBE=function(h,m,v){h>>>=0,m>>>=0,v||wt(h,m,this.length);for(var T=m,N=1,L=this[h+--T];0<T&&(N*=256);)L+=this[h+--T]*N;return N*=128,L>=N&&(L-=i(2,8*m)),L},u.prototype.readInt8=function(h,m){return h>>>=0,m||wt(h,1,this.length),128&this[h]?-1*(255-this[h]+1):this[h]},u.prototype.readInt16LE=function(h,m){h>>>=0,m||wt(h,2,this.length);var v=this[h]|this[h+1]<<8;return 32768&v?4294901760|v:v},u.prototype.readInt16BE=function(h,m){h>>>=0,m||wt(h,2,this.length);var v=this[h+1]|this[h]<<8;return 32768&v?4294901760|v:v},u.prototype.readInt32LE=function(h,m){return h>>>=0,m||wt(h,4,this.length),this[h]|this[h+1]<<8|this[h+2]<<16|this[h+3]<<24},u.prototype.readInt32BE=function(h,m){return h>>>=0,m||wt(h,4,this.length),this[h]<<24|this[h+1]<<16|this[h+2]<<8|this[h+3]},u.prototype.readFloatLE=function(h,m){return h>>>=0,m||wt(h,4,this.length),J.read(this,h,!0,23,4)},u.prototype.readFloatBE=function(h,m){return h>>>=0,m||wt(h,4,this.length),J.read(this,h,!1,23,4)},u.prototype.readDoubleLE=function(h,m){return h>>>=0,m||wt(h,8,this.length),J.read(this,h,!0,52,8)},u.prototype.readDoubleBE=function(h,m){return h>>>=0,m||wt(h,8,this.length),J.read(this,h,!1,52,8)},u.prototype.writeUIntLE=function(h,m,v,T){if(h=+h,m>>>=0,v>>>=0,!T){var N=i(2,8*v)-1;ht(this,h,m,v,N,0)}var L=1,W=0;for(this[m]=255&h;++W<v&&(L*=256);)this[m+W]=255&h/L;return m+v},u.prototype.writeUIntBE=function(h,m,v,T){if(h=+h,m>>>=0,v>>>=0,!T){var N=i(2,8*v)-1;ht(this,h,m,v,N,0)}var L=v-1,W=1;for(this[m+L]=255&h;0<=--L&&(W*=256);)this[m+L]=255&h/W;return m+v},u.prototype.writeUInt8=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,1,255,0),this[m]=255&h,m+1},u.prototype.writeUInt16LE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,2,65535,0),this[m]=255&h,this[m+1]=h>>>8,m+2},u.prototype.writeUInt16BE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,2,65535,0),this[m]=h>>>8,this[m+1]=255&h,m+2},u.prototype.writeUInt32LE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,4,4294967295,0),this[m+3]=h>>>24,this[m+2]=h>>>16,this[m+1]=h>>>8,this[m]=255&h,m+4},u.prototype.writeUInt32BE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,4,4294967295,0),this[m]=h>>>24,this[m+1]=h>>>16,this[m+2]=h>>>8,this[m+3]=255&h,m+4},u.prototype.writeIntLE=function(h,m,v,T){if(h=+h,m>>>=0,!T){var N=i(2,8*v-1);ht(this,h,m,v,N-1,-N)}var L=0,W=1,ot=0;for(this[m]=255&h;++L<v&&(W*=256);)0>h&&ot===0&&this[m+L-1]!==0&&(ot=1),this[m+L]=255&(h/W>>0)-ot;return m+v},u.prototype.writeIntBE=function(h,m,v,T){if(h=+h,m>>>=0,!T){var N=i(2,8*v-1);ht(this,h,m,v,N-1,-N)}var L=v-1,W=1,ot=0;for(this[m+L]=255&h;0<=--L&&(W*=256);)0>h&&ot===0&&this[m+L+1]!==0&&(ot=1),this[m+L]=255&(h/W>>0)-ot;return m+v},u.prototype.writeInt8=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,1,127,-128),0>h&&(h=255+h+1),this[m]=255&h,m+1},u.prototype.writeInt16LE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,2,32767,-32768),this[m]=255&h,this[m+1]=h>>>8,m+2},u.prototype.writeInt16BE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,2,32767,-32768),this[m]=h>>>8,this[m+1]=255&h,m+2},u.prototype.writeInt32LE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,4,2147483647,-2147483648),this[m]=255&h,this[m+1]=h>>>8,this[m+2]=h>>>16,this[m+3]=h>>>24,m+4},u.prototype.writeInt32BE=function(h,m,v){return h=+h,m>>>=0,v||ht(this,h,m,4,2147483647,-2147483648),0>h&&(h=4294967295+h+1),this[m]=h>>>24,this[m+1]=h>>>16,this[m+2]=h>>>8,this[m+3]=255&h,m+4},u.prototype.writeFloatLE=function(h,m,v){return an(this,h,m,!0,v)},u.prototype.writeFloatBE=function(h,m,v){return an(this,h,m,!1,v)},u.prototype.writeDoubleLE=function(h,m,v){return ln(this,h,m,!0,v)},u.prototype.writeDoubleBE=function(h,m,v){return ln(this,h,m,!1,v)},u.prototype.copy=function(h,m,v,T){if(!u.isBuffer(h))throw new TypeError("argument should be a Buffer");if(v||(v=0),T||T===0||(T=this.length),m>=h.length&&(m=h.length),m||(m=0),0<T&&T<v&&(T=v),T===v||h.length===0||this.length===0)return 0;if(0>m)throw new RangeError("targetStart out of bounds");if(0>v||v>=this.length)throw new RangeError("Index out of range");if(0>T)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),h.length-m<T-v&&(T=h.length-m+v);var N=T-v;if(this===h&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(m,v,T);else if(this===h&&v<m&&m<T)for(var L=N-1;0<=L;--L)h[L+m]=this[L+v];else Uint8Array.prototype.set.call(h,this.subarray(v,T),m);return N},u.prototype.fill=function(h,m,v,T){if(typeof h=="string"){if(typeof m=="string"?(T=m,m=0,v=this.length):typeof v=="string"&&(T=v,v=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!u.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(h.length===1){var N=h.charCodeAt(0);(T==="utf8"&&128>N||T==="latin1")&&(h=N)}}else typeof h=="number"&&(h&=255);if(0>m||this.length<m||this.length<v)throw new RangeError("Out of range index");if(v<=m)return this;m>>>=0,v=v===void 0?this.length:v>>>0,h||(h=0);var L;if(typeof h=="number")for(L=m;L<v;++L)this[L]=h;else{var W=u.isBuffer(h)?h:u.from(h,T),ot=W.length;if(ot===0)throw new TypeError('The value "'+h+'" is invalid for argument "value"');for(L=0;L<v-m;++L)this[L+m]=W[L%ot]}return this};var C=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,s,a){(function(l){(function(){function c(){let u;try{u=a.storage.getItem("debug")}catch{}return!u&&typeof l!="undefined"&&"env"in l&&(u=l.env.DEBUG),u}a.formatArgs=function(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;u.splice(1,0,d,"color: inherit");let p=0,g=0;u[0].replace(/%[a-zA-Z%]/g,y=>{y==="%%"||(p++,y==="%c"&&(g=p))}),u.splice(g,0,d)},a.save=function(u){try{u?a.storage.setItem("debug",u):a.storage.removeItem("debug")}catch{}},a.load=c,a.useColors=function(){return!!(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},a.storage=function(){try{return localStorage}catch{}}(),a.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),a.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],a.log=console.debug||console.log||(()=>{}),s.exports=o("./common")(a);const{formatters:f}=s.exports;f.j=function(u){try{return JSON.stringify(u)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,s){s.exports=function(a){function l(u){function d(...y){if(!d.enabled)return;const w=d,E=+new Date,_=E-(p||E);w.diff=_,w.prev=p,w.curr=E,p=E,y[0]=l.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let b=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(S,x)=>{if(S==="%%")return"%";b++;const M=l.formatters[x];if(typeof M=="function"){const A=y[b];S=M.call(w,A),y.splice(b,1),b--}return S}),l.formatArgs.call(w,y),(w.log||l.log).apply(w,y)}let p,g=null;return d.namespace=u,d.useColors=l.useColors(),d.color=l.selectColor(u),d.extend=c,d.destroy=l.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>g===null?l.enabled(u):g,set:y=>{g=y}}),typeof l.init=="function"&&l.init(d),d}function c(u,d){const p=l(this.namespace+(typeof d=="undefined"?":":d)+u);return p.log=this.log,p}function f(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}return l.debug=l,l.default=l,l.coerce=function(u){return u instanceof Error?u.stack||u.message:u},l.disable=function(){const u=[...l.names.map(f),...l.skips.map(f).map(d=>"-"+d)].join(",");return l.enable(""),u},l.enable=function(u){l.save(u),l.names=[],l.skips=[];let d;const p=(typeof u=="string"?u:"").split(/[\s,]+/),g=p.length;for(d=0;d<g;d++)p[d]&&(u=p[d].replace(/\*/g,".*?"),u[0]==="-"?l.skips.push(new RegExp("^"+u.substr(1)+"$")):l.names.push(new RegExp("^"+u+"$")))},l.enabled=function(u){if(u[u.length-1]==="*")return!0;let d,p;for(d=0,p=l.skips.length;d<p;d++)if(l.skips[d].test(u))return!1;for(d=0,p=l.names.length;d<p;d++)if(l.names[d].test(u))return!0;return!1},l.humanize=o("ms"),l.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(a).forEach(u=>{l[u]=a[u]}),l.names=[],l.skips=[],l.formatters={},l.selectColor=function(u){let d=0;for(let p=0;p<u.length;p++)d=(d<<5)-d+u.charCodeAt(p),d|=0;return l.colors[r(d)%l.colors.length]},l.enable(l.load()),l}},{ms:11}],6:[function(o,s){function a(l,c){for(const f in c)Object.defineProperty(l,f,{value:c[f],enumerable:!0,configurable:!0});return l}s.exports=function(l,c,f){if(!l||typeof l=="string")throw new TypeError("Please pass an Error to err-code");f||(f={}),typeof c=="object"&&(f=c,c=""),c&&(f.code=c);try{return a(l,f)}catch{f.message=l.message,f.stack=l.stack;const d=function(){};return d.prototype=Object.create(Object.getPrototypeOf(l)),a(new d,f)}}},{}],7:[function(o,s){function a(O){console&&console.warn&&console.warn(O)}function l(){l.init.call(this)}function c(O){if(typeof O!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof O)}function f(O){return O._maxListeners===void 0?l.defaultMaxListeners:O._maxListeners}function u(O,D,F,j){var Y,$,G;if(c(F),$=O._events,$===void 0?($=O._events=Object.create(null),O._eventsCount=0):($.newListener!==void 0&&(O.emit("newListener",D,F.listener?F.listener:F),$=O._events),G=$[D]),G===void 0)G=$[D]=F,++O._eventsCount;else if(typeof G=="function"?G=$[D]=j?[F,G]:[G,F]:j?G.unshift(F):G.push(F),Y=f(O),0<Y&&G.length>Y&&!G.warned){G.warned=!0;var yt=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+(D+" listeners added. Use emitter.setMaxListeners() to increase limit"));yt.name="MaxListenersExceededWarning",yt.emitter=O,yt.type=D,yt.count=G.length,a(yt)}return O}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(O,D,F){var j={fired:!1,wrapFn:void 0,target:O,type:D,listener:F},Y=d.bind(j);return Y.listener=F,j.wrapFn=Y,Y}function g(O,D,F){var j=O._events;if(j===void 0)return[];var Y=j[D];return Y===void 0?[]:typeof Y=="function"?F?[Y.listener||Y]:[Y]:F?_(Y):w(Y,Y.length)}function y(O){var D=this._events;if(D!==void 0){var F=D[O];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function w(O,D){for(var F=Array(D),j=0;j<D;++j)F[j]=O[j];return F}function E(O,D){for(;D+1<O.length;D++)O[D]=O[D+1];O.pop()}function _(O){for(var D=Array(O.length),F=0;F<D.length;++F)D[F]=O[F].listener||O[F];return D}function b(O,D,F){typeof O.on=="function"&&k(O,"error",D,F)}function k(O,D,F,j){if(typeof O.on=="function")j.once?O.once(D,F):O.on(D,F);else if(typeof O.addEventListener=="function")O.addEventListener(D,function Y($){j.once&&O.removeEventListener(D,Y),F($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof O)}var S,x=typeof Reflect=="object"?Reflect:null,M=x&&typeof x.apply=="function"?x.apply:function(O,D,F){return Function.prototype.apply.call(O,D,F)};S=x&&typeof x.ownKeys=="function"?x.ownKeys:Object.getOwnPropertySymbols?function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:function(O){return Object.getOwnPropertyNames(O)};var A=Number.isNaN||function(O){return O!==O};s.exports=l,s.exports.once=function(O,D){return new Promise(function(F,j){function Y(G){O.removeListener(D,$),j(G)}function $(){typeof O.removeListener=="function"&&O.removeListener("error",Y),F([].slice.call(arguments))}k(O,D,$,{once:!0}),D!=="error"&&b(O,Y,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var P=10;Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return P},set:function(O){if(typeof O!="number"||0>O||A(O))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+O+".");P=O}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(O){if(typeof O!="number"||0>O||A(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this},l.prototype.getMaxListeners=function(){return f(this)},l.prototype.emit=function(O){for(var D=[],F=1;F<arguments.length;F++)D.push(arguments[F]);var j=O==="error",Y=this._events;if(Y!==void 0)j=j&&Y.error===void 0;else if(!j)return!1;if(j){var $;if(0<D.length&&($=D[0]),$ instanceof Error)throw $;var G=new Error("Unhandled error."+($?" ("+$.message+")":""));throw G.context=$,G}var yt=Y[O];if(yt===void 0)return!1;if(typeof yt=="function")M(yt,this,D);else for(var xt=yt.length,X=w(yt,xt),F=0;F<xt;++F)M(X[F],this,D);return!0},l.prototype.addListener=function(O,D){return u(this,O,D,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(O,D){return u(this,O,D,!0)},l.prototype.once=function(O,D){return c(D),this.on(O,p(this,O,D)),this},l.prototype.prependOnceListener=function(O,D){return c(D),this.prependListener(O,p(this,O,D)),this},l.prototype.removeListener=function(O,D){var F,j,Y,$,G;if(c(D),j=this._events,j===void 0)return this;if(F=j[O],F===void 0)return this;if(F===D||F.listener===D)--this._eventsCount==0?this._events=Object.create(null):(delete j[O],j.removeListener&&this.emit("removeListener",O,F.listener||D));else if(typeof F!="function"){for(Y=-1,$=F.length-1;0<=$;$--)if(F[$]===D||F[$].listener===D){G=F[$].listener,Y=$;break}if(0>Y)return this;Y===0?F.shift():E(F,Y),F.length===1&&(j[O]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",O,G||D)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(O){var D,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[O]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[O]),this;if(arguments.length===0){var Y,$=Object.keys(F);for(j=0;j<$.length;++j)Y=$[j],Y!=="removeListener"&&this.removeAllListeners(Y);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=F[O],typeof D=="function")this.removeListener(O,D);else if(D!==void 0)for(j=D.length-1;0<=j;j--)this.removeListener(O,D[j]);return this},l.prototype.listeners=function(O){return g(this,O,!0)},l.prototype.rawListeners=function(O){return g(this,O,!1)},l.listenerCount=function(O,D){return typeof O.listenerCount=="function"?O.listenerCount(D):y.call(O,D)},l.prototype.listenerCount=y,l.prototype.eventNames=function(){return 0<this._eventsCount?S(this._events):[]}},{}],8:[function(o,s){s.exports=function(){if(typeof globalThis=="undefined")return null;var a={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return a.RTCPeerConnection?a:null}},{}],9:[function(o,s,a){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */a.read=function(l,c,f,u,d){var p,g,y=8*d-u-1,w=(1<<y)-1,E=w>>1,_=-7,b=f?d-1:0,k=f?-1:1,S=l[c+b];for(b+=k,p=S&(1<<-_)-1,S>>=-_,_+=y;0<_;p=256*p+l[c+b],b+=k,_-=8);for(g=p&(1<<-_)-1,p>>=-_,_+=u;0<_;g=256*g+l[c+b],b+=k,_-=8);if(p===0)p=1-E;else{if(p===w)return g?NaN:(S?-1:1)*(1/0);g+=i(2,u),p-=E}return(S?-1:1)*g*i(2,p-u)},a.write=function(l,c,f,u,d,p){var g,y,w,E=Math.LN2,_=Math.log,b=8*p-d-1,k=(1<<b)-1,S=k>>1,x=d===23?i(2,-24)-i(2,-77):0,M=u?0:p-1,A=u?1:-1,P=0>c||c===0&&0>1/c?1:0;for(c=r(c),isNaN(c)||c===1/0?(y=isNaN(c)?1:0,g=k):(g=n(_(c)/E),1>c*(w=i(2,-g))&&(g--,w*=2),c+=1<=g+S?x/w:x*i(2,1-S),2<=c*w&&(g++,w/=2),g+S>=k?(y=0,g=k):1<=g+S?(y=(c*w-1)*i(2,d),g+=S):(y=c*i(2,S-1)*i(2,d),g=0));8<=d;l[f+M]=255&y,M+=A,y/=256,d-=8);for(g=g<<d|y,b+=d;0<b;l[f+M]=255&g,M+=A,g/=256,b-=8);l[f+M-A]|=128*P}},{}],10:[function(o,s){s.exports=typeof Object.create=="function"?function(a,l){l&&(a.super_=l,a.prototype=Object.create(l.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:function(a,l){if(l){a.super_=l;var c=function(){};c.prototype=l.prototype,a.prototype=new c,a.prototype.constructor=a}}},{}],11:[function(o,s){var a=Math.round;function l(d){if(d+="",!(100<d.length)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(p){var g=parseFloat(p[1]),y=(p[2]||"ms").toLowerCase();return y==="years"||y==="year"||y==="yrs"||y==="yr"||y==="y"?315576e5*g:y==="weeks"||y==="week"||y==="w"?6048e5*g:y==="days"||y==="day"||y==="d"?864e5*g:y==="hours"||y==="hour"||y==="hrs"||y==="hr"||y==="h"?36e5*g:y==="minutes"||y==="minute"||y==="mins"||y==="min"||y==="m"?6e4*g:y==="seconds"||y==="second"||y==="secs"||y==="sec"||y==="s"?1e3*g:y==="milliseconds"||y==="millisecond"||y==="msecs"||y==="msec"||y==="ms"?g:void 0}}}function c(d){var p=r(d);return 864e5<=p?a(d/864e5)+"d":36e5<=p?a(d/36e5)+"h":6e4<=p?a(d/6e4)+"m":1e3<=p?a(d/1e3)+"s":d+"ms"}function f(d){var p=r(d);return 864e5<=p?u(d,p,864e5,"day"):36e5<=p?u(d,p,36e5,"hour"):6e4<=p?u(d,p,6e4,"minute"):1e3<=p?u(d,p,1e3,"second"):d+" ms"}function u(d,p,g,y){return a(d/g)+" "+y+(p>=1.5*g?"s":"")}s.exports=function(d,p){p=p||{};var g=typeof d;if(g=="string"&&0<d.length)return l(d);if(g==="number"&&isFinite(d))return p.long?f(d):c(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],12:[function(o,s){function a(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function c(x){if(y===setTimeout)return setTimeout(x,0);if((y===a||!y)&&setTimeout)return y=setTimeout,setTimeout(x,0);try{return y(x,0)}catch{try{return y.call(null,x,0)}catch{return y.call(this,x,0)}}}function f(x){if(w===clearTimeout)return clearTimeout(x);if((w===l||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(x);try{return w(x)}catch{try{return w.call(null,x)}catch{return w.call(this,x)}}}function u(){k&&_&&(k=!1,_.length?b=_.concat(b):S=-1,b.length&&d())}function d(){if(!k){var x=c(u);k=!0;for(var M=b.length;M;){for(_=b,b=[];++S<M;)_&&_[S].run();S=-1,M=b.length}_=null,k=!1,f(x)}}function p(x,M){this.fun=x,this.array=M}function g(){}var y,w,E=s.exports={};(function(){try{y=typeof setTimeout=="function"?setTimeout:a}catch{y=a}try{w=typeof clearTimeout=="function"?clearTimeout:l}catch{w=l}})();var _,b=[],k=!1,S=-1;E.nextTick=function(x){var M=Array(arguments.length-1);if(1<arguments.length)for(var A=1;A<arguments.length;A++)M[A-1]=arguments[A];b.push(new p(x,M)),b.length!==1||k||c(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},E.title="browser",E.browser=!0,E.env={},E.argv=[],E.version="",E.versions={},E.on=g,E.addListener=g,E.once=g,E.off=g,E.removeListener=g,E.removeAllListeners=g,E.emit=g,E.prependListener=g,E.prependOnceListener=g,E.listeners=function(){return[]},E.binding=function(){throw new Error("process.binding is not supported")},E.cwd=function(){return"/"},E.chdir=function(){throw new Error("process.chdir is not supported")},E.umask=function(){return 0}},{}],13:[function(o,s){(function(a){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let l;s.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window=="undefined"?a:window):c=>(l||(l=Promise.resolve())).then(c).catch(f=>setTimeout(()=>{throw f},0))}).call(this)}).call(this,typeof Be=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Be)},{}],14:[function(o,s){(function(a,l){(function(){var c=o("safe-buffer").Buffer,f=l.crypto||l.msCrypto;s.exports=f&&f.getRandomValues?function(u,d){if(u>4294967295)throw new RangeError("requested too many random bytes");var p=c.allocUnsafe(u);if(0<u)if(65536<u)for(var g=0;g<u;g+=65536)f.getRandomValues(p.slice(g,g+65536));else f.getRandomValues(p);return typeof d=="function"?a.nextTick(function(){d(null,p)}):p}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof Be=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Be)},{_process:12,"safe-buffer":30}],15:[function(o,s){function a(g,y){g.prototype=Object.create(y.prototype),g.prototype.constructor=g,g.__proto__=y}function l(g,y,w){function E(b,k,S){return typeof y=="string"?y:y(b,k,S)}w||(w=Error);var _=function(b){function k(S,x,M){return b.call(this,E(S,x,M))||this}return a(k,b),k}(w);_.prototype.name=w.name,_.prototype.code=g,p[g]=_}function c(g,y){if(Array.isArray(g)){var w=g.length;return g=g.map(function(E){return E+""}),2<w?"one of ".concat(y," ").concat(g.slice(0,w-1).join(", "),", or ")+g[w-1]:w===2?"one of ".concat(y," ").concat(g[0]," or ").concat(g[1]):"of ".concat(y," ").concat(g[0])}return"of ".concat(y," ").concat(g+"")}function f(g,y,w){return g.substr(!w||0>w?0:+w,y.length)===y}function u(g,y,w){return(w===void 0||w>g.length)&&(w=g.length),g.substring(w-y.length,w)===y}function d(g,y,w){return typeof w!="number"&&(w=0),!(w+y.length>g.length)&&g.indexOf(y,w)!==-1}var p={};l("ERR_INVALID_OPT_VALUE",function(g,y){return'The value "'+y+'" is invalid for option "'+g+'"'},TypeError),l("ERR_INVALID_ARG_TYPE",function(g,y,w){var E;typeof y=="string"&&f(y,"not ")?(E="must not be",y=y.replace(/^not /,"")):E="must be";var _;if(u(g," argument"))_="The ".concat(g," ").concat(E," ").concat(c(y,"type"));else{var b=d(g,".")?"property":"argument";_='The "'.concat(g,'" ').concat(b," ").concat(E," ").concat(c(y,"type"))}return _+=". Received type ".concat(typeof w),_},TypeError),l("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),l("ERR_METHOD_NOT_IMPLEMENTED",function(g){return"The "+g+" method is not implemented"}),l("ERR_STREAM_PREMATURE_CLOSE","Premature close"),l("ERR_STREAM_DESTROYED",function(g){return"Cannot call "+g+" after a stream was destroyed"}),l("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),l("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),l("ERR_STREAM_WRITE_AFTER_END","write after end"),l("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),l("ERR_UNKNOWN_ENCODING",function(g){return"Unknown encoding: "+g},TypeError),l("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),s.exports.codes=p},{}],16:[function(o,s){(function(a){(function(){function l(E){return this instanceof l?(d.call(this,E),p.call(this,E),this.allowHalfOpen=!0,void(E&&(E.readable===!1&&(this.readable=!1),E.writable===!1&&(this.writable=!1),E.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",c))))):new l(E)}function c(){this._writableState.ended||a.nextTick(f,this)}function f(E){E.end()}var u=Object.keys||function(E){var _=[];for(var b in E)_.push(b);return _};s.exports=l;var d=o("./_stream_readable"),p=o("./_stream_writable");o("inherits")(l,d);for(var g,y=u(p.prototype),w=0;w<y.length;w++)g=y[w],l.prototype[g]||(l.prototype[g]=p.prototype[g]);Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(E){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=E,this._writableState.destroyed=E)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,s){function a(c){return this instanceof a?void l.call(this,c):new a(c)}s.exports=a;var l=o("./_stream_transform");o("inherits")(a,l),a.prototype._transform=function(c,f,u){u(null,c)}},{"./_stream_transform":19,inherits:10}],18:[function(o,s){(function(a,l){(function(){function c(C){return sn.from(C)}function f(C){return sn.isBuffer(C)||C instanceof wt}function u(C,h,m){return typeof C.prependListener=="function"?C.prependListener(h,m):void(C._events&&C._events[h]?Array.isArray(C._events[h])?C._events[h].unshift(m):C._events[h]=[m,C._events[h]]:C.on(h,m))}function d(C,h,m){xt=xt||o("./_stream_duplex"),C=C||{},typeof m!="boolean"&&(m=h instanceof xt),this.objectMode=!!C.objectMode,m&&(this.objectMode=this.objectMode||!!C.readableObjectMode),this.highWaterMark=Lr(this,C,"readableHighWaterMark",m),this.buffer=new Ir,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=C.emitClose!==!1,this.autoDestroy=!!C.autoDestroy,this.destroyed=!1,this.defaultEncoding=C.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,C.encoding&&(!Ce&&(Ce=o("string_decoder/").StringDecoder),this.decoder=new Ce(C.encoding),this.encoding=C.encoding)}function p(C){if(xt=xt||o("./_stream_duplex"),!(this instanceof p))return new p(C);var h=this instanceof xt;this._readableState=new d(C,this,h),this.readable=!0,C&&(typeof C.read=="function"&&(this._read=C.read),typeof C.destroy=="function"&&(this._destroy=C.destroy)),Se.call(this)}function g(C,h,m,v,T){X("readableAddChunk",h);var N=C._readableState;if(h===null)N.reading=!1,b(C,N);else{var L;if(T||(L=w(N,h)),L)U(C,L);else if(!(N.objectMode||h&&0<h.length))v||(N.reading=!1,x(C,N));else if(typeof h=="string"||N.objectMode||Object.getPrototypeOf(h)===sn.prototype||(h=c(h)),v)N.endEmitted?U(C,new I):y(C,N,h,!0);else if(N.ended)U(C,new Me);else{if(N.destroyed)return!1;N.reading=!1,N.decoder&&!m?(h=N.decoder.write(h),N.objectMode||h.length!==0?y(C,N,h,!1):x(C,N)):y(C,N,h,!1)}}return!N.ended&&(N.length<N.highWaterMark||N.length===0)}function y(C,h,m,v){h.flowing&&h.length===0&&!h.sync?(h.awaitDrain=0,C.emit("data",m)):(h.length+=h.objectMode?1:m.length,v?h.buffer.unshift(m):h.buffer.push(m),h.needReadable&&k(C)),x(C,h)}function w(C,h){var m;return f(h)||typeof h=="string"||h===void 0||C.objectMode||(m=new Ee("chunk",["string","Buffer","Uint8Array"],h)),m}function E(C){return 1073741824<=C?C=1073741824:(C--,C|=C>>>1,C|=C>>>2,C|=C>>>4,C|=C>>>8,C|=C>>>16,C++),C}function _(C,h){return 0>=C||h.length===0&&h.ended?0:h.objectMode?1:C===C?(C>h.highWaterMark&&(h.highWaterMark=E(C)),C<=h.length?C:h.ended?h.length:(h.needReadable=!0,0)):h.flowing&&h.length?h.buffer.head.data.length:h.length}function b(C,h){if(X("onEofChunk"),!h.ended){if(h.decoder){var m=h.decoder.end();m&&m.length&&(h.buffer.push(m),h.length+=h.objectMode?1:m.length)}h.ended=!0,h.sync?k(C):(h.needReadable=!1,!h.emittedReadable&&(h.emittedReadable=!0,S(C)))}}function k(C){var h=C._readableState;X("emitReadable",h.needReadable,h.emittedReadable),h.needReadable=!1,h.emittedReadable||(X("emitReadable",h.flowing),h.emittedReadable=!0,a.nextTick(S,C))}function S(C){var h=C._readableState;X("emitReadable_",h.destroyed,h.length,h.ended),!h.destroyed&&(h.length||h.ended)&&(C.emit("readable"),h.emittedReadable=!1),h.needReadable=!h.flowing&&!h.ended&&h.length<=h.highWaterMark,j(C)}function x(C,h){h.readingMore||(h.readingMore=!0,a.nextTick(M,C,h))}function M(C,h){for(;!h.reading&&!h.ended&&(h.length<h.highWaterMark||h.flowing&&h.length===0);){var m=h.length;if(X("maybeReadMore read 0"),C.read(0),m===h.length)break}h.readingMore=!1}function A(C){return function(){var h=C._readableState;X("pipeOnDrain",h.awaitDrain),h.awaitDrain&&h.awaitDrain--,h.awaitDrain===0&&tr(C,"data")&&(h.flowing=!0,j(C))}}function P(C){var h=C._readableState;h.readableListening=0<C.listenerCount("readable"),h.resumeScheduled&&!h.paused?h.flowing=!0:0<C.listenerCount("data")&&C.resume()}function O(C){X("readable nexttick read 0"),C.read(0)}function D(C,h){h.resumeScheduled||(h.resumeScheduled=!0,a.nextTick(F,C,h))}function F(C,h){X("resume",h.reading),h.reading||C.read(0),h.resumeScheduled=!1,C.emit("resume"),j(C),h.flowing&&!h.reading&&C.read(0)}function j(C){var h=C._readableState;for(X("flow",h.flowing);h.flowing&&C.read()!==null;);}function Y(C,h){if(h.length===0)return null;var m;return h.objectMode?m=h.buffer.shift():!C||C>=h.length?(m=h.decoder?h.buffer.join(""):h.buffer.length===1?h.buffer.first():h.buffer.concat(h.length),h.buffer.clear()):m=h.buffer.consume(C,h.decoder),m}function $(C){var h=C._readableState;X("endReadable",h.endEmitted),h.endEmitted||(h.ended=!0,a.nextTick(G,h,C))}function G(C,h){if(X("endReadableNT",C.endEmitted,C.length),!C.endEmitted&&C.length===0&&(C.endEmitted=!0,h.readable=!1,h.emit("end"),C.autoDestroy)){var m=h._writableState;(!m||m.autoDestroy&&m.finished)&&h.destroy()}}function yt(C,h){for(var m=0,v=C.length;m<v;m++)if(C[m]===h)return m;return-1}s.exports=p;var xt;p.ReadableState=d;var X;o("events").EventEmitter;var tr=function(C,h){return C.listeners(h).length},Se=o("./internal/streams/stream"),sn=o("buffer").Buffer,wt=l.Uint8Array||function(){},ht=o("util");X=ht&&ht.debuglog?ht.debuglog("stream"):function(){};var Ce,an,ln,Ir=o("./internal/streams/buffer_list"),On=o("./internal/streams/destroy"),xn=o("./internal/streams/state"),Lr=xn.getHighWaterMark,cn=o("../errors").codes,Ee=cn.ERR_INVALID_ARG_TYPE,Me=cn.ERR_STREAM_PUSH_AFTER_EOF,R=cn.ERR_METHOD_NOT_IMPLEMENTED,I=cn.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(p,Se);var U=On.errorOrDestroy,J=["error","close","destroy","pause","resume"];Object.defineProperty(p.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(C){this._readableState&&(this._readableState.destroyed=C)}}),p.prototype.destroy=On.destroy,p.prototype._undestroy=On.undestroy,p.prototype._destroy=function(C,h){h(C)},p.prototype.push=function(C,h){var m,v=this._readableState;return v.objectMode?m=!0:typeof C=="string"&&(h=h||v.defaultEncoding,h!==v.encoding&&(C=sn.from(C,h),h=""),m=!0),g(this,C,h,!1,m)},p.prototype.unshift=function(C){return g(this,C,null,!0,!1)},p.prototype.isPaused=function(){return this._readableState.flowing===!1},p.prototype.setEncoding=function(C){Ce||(Ce=o("string_decoder/").StringDecoder);var h=new Ce(C);this._readableState.decoder=h,this._readableState.encoding=this._readableState.decoder.encoding;for(var m=this._readableState.buffer.head,v="";m!==null;)v+=h.write(m.data),m=m.next;return this._readableState.buffer.clear(),v!==""&&this._readableState.buffer.push(v),this._readableState.length=v.length,this},p.prototype.read=function(C){X("read",C),C=parseInt(C,10);var h=this._readableState,m=C;if(C!==0&&(h.emittedReadable=!1),C===0&&h.needReadable&&((h.highWaterMark===0?0<h.length:h.length>=h.highWaterMark)||h.ended))return X("read: emitReadable",h.length,h.ended),h.length===0&&h.ended?$(this):k(this),null;if(C=_(C,h),C===0&&h.ended)return h.length===0&&$(this),null;var v=h.needReadable;X("need readable",v),(h.length===0||h.length-C<h.highWaterMark)&&(v=!0,X("length less than watermark",v)),h.ended||h.reading?(v=!1,X("reading or ended",v)):v&&(X("do read"),h.reading=!0,h.sync=!0,h.length===0&&(h.needReadable=!0),this._read(h.highWaterMark),h.sync=!1,!h.reading&&(C=_(m,h)));var T;return T=0<C?Y(C,h):null,T===null?(h.needReadable=h.length<=h.highWaterMark,C=0):(h.length-=C,h.awaitDrain=0),h.length===0&&(!h.ended&&(h.needReadable=!0),m!==C&&h.ended&&$(this)),T!==null&&this.emit("data",T),T},p.prototype._read=function(){U(this,new R("_read()"))},p.prototype.pipe=function(C,h){function m(nr,rr){X("onunpipe"),nr===st&&rr&&rr.hasUnpiped===!1&&(rr.hasUnpiped=!0,T())}function v(){X("onend"),C.end()}function T(){X("cleanup"),C.removeListener("close",W),C.removeListener("finish",ot),C.removeListener("drain",er),C.removeListener("error",L),C.removeListener("unpipe",m),st.removeListener("end",v),st.removeListener("end",gt),st.removeListener("data",N),Pr=!0,it.awaitDrain&&(!C._writableState||C._writableState.needDrain)&&er()}function N(nr){X("ondata");var rr=C.write(nr);X("dest.write",rr),rr===!1&&((it.pipesCount===1&&it.pipes===C||1<it.pipesCount&&yt(it.pipes,C)!==-1)&&!Pr&&(X("false write response, pause",it.awaitDrain),it.awaitDrain++),st.pause())}function L(nr){X("onerror",nr),gt(),C.removeListener("error",L),tr(C,"error")===0&&U(C,nr)}function W(){C.removeListener("finish",ot),gt()}function ot(){X("onfinish"),C.removeListener("close",W),gt()}function gt(){X("unpipe"),st.unpipe(C)}var st=this,it=this._readableState;switch(it.pipesCount){case 0:it.pipes=C;break;case 1:it.pipes=[it.pipes,C];break;default:it.pipes.push(C)}it.pipesCount+=1,X("pipe count=%d opts=%j",it.pipesCount,h);var At=(!h||h.end!==!1)&&C!==a.stdout&&C!==a.stderr,An=At?v:gt;it.endEmitted?a.nextTick(An):st.once("end",An),C.on("unpipe",m);var er=A(st);C.on("drain",er);var Pr=!1;return st.on("data",N),u(C,"error",L),C.once("close",W),C.once("finish",ot),C.emit("pipe",st),it.flowing||(X("pipe resume"),st.resume()),C},p.prototype.unpipe=function(C){var h=this._readableState,m={hasUnpiped:!1};if(h.pipesCount===0)return this;if(h.pipesCount===1)return C&&C!==h.pipes?this:(C||(C=h.pipes),h.pipes=null,h.pipesCount=0,h.flowing=!1,C&&C.emit("unpipe",this,m),this);if(!C){var v=h.pipes,T=h.pipesCount;h.pipes=null,h.pipesCount=0,h.flowing=!1;for(var N=0;N<T;N++)v[N].emit("unpipe",this,{hasUnpiped:!1});return this}var L=yt(h.pipes,C);return L===-1?this:(h.pipes.splice(L,1),h.pipesCount-=1,h.pipesCount===1&&(h.pipes=h.pipes[0]),C.emit("unpipe",this,m),this)},p.prototype.on=function(C,h){var m=Se.prototype.on.call(this,C,h),v=this._readableState;return C==="data"?(v.readableListening=0<this.listenerCount("readable"),v.flowing!==!1&&this.resume()):C=="readable"&&!v.endEmitted&&!v.readableListening&&(v.readableListening=v.needReadable=!0,v.flowing=!1,v.emittedReadable=!1,X("on readable",v.length,v.reading),v.length?k(this):!v.reading&&a.nextTick(O,this)),m},p.prototype.addListener=p.prototype.on,p.prototype.removeListener=function(C,h){var m=Se.prototype.removeListener.call(this,C,h);return C==="readable"&&a.nextTick(P,this),m},p.prototype.removeAllListeners=function(C){var h=Se.prototype.removeAllListeners.apply(this,arguments);return(C==="readable"||C===void 0)&&a.nextTick(P,this),h},p.prototype.resume=function(){var C=this._readableState;return C.flowing||(X("resume"),C.flowing=!C.readableListening,D(this,C)),C.paused=!1,this},p.prototype.pause=function(){return X("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(X("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},p.prototype.wrap=function(C){var h=this,m=this._readableState,v=!1;for(var T in C.on("end",function(){if(X("wrapped end"),m.decoder&&!m.ended){var L=m.decoder.end();L&&L.length&&h.push(L)}h.push(null)}),C.on("data",function(L){if(X("wrapped data"),m.decoder&&(L=m.decoder.write(L)),!(m.objectMode&&L==null)&&(m.objectMode||L&&L.length)){var W=h.push(L);W||(v=!0,C.pause())}}),C)this[T]===void 0&&typeof C[T]=="function"&&(this[T]=function(L){return function(){return C[L].apply(C,arguments)}}(T));for(var N=0;N<J.length;N++)C.on(J[N],this.emit.bind(this,J[N]));return this._read=function(L){X("wrapped _read",L),v&&(v=!1,C.resume())},this},typeof Symbol=="function"&&(p.prototype[Symbol.asyncIterator]=function(){return an===void 0&&(an=o("./internal/streams/async_iterator")),an(this)}),Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(p.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(p.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(C){this._readableState&&(this._readableState.flowing=C)}}),p._fromList=Y,Object.defineProperty(p.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(p.from=function(C,h){return ln===void 0&&(ln=o("./internal/streams/from")),ln(p,C,h)})}).call(this)}).call(this,o("_process"),typeof Be=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Be)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,s){function a(E,_){var b=this._transformState;b.transforming=!1;var k=b.writecb;if(k===null)return this.emit("error",new p);b.writechunk=null,b.writecb=null,_!=null&&this.push(_),k(E);var S=this._readableState;S.reading=!1,(S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}function l(E){return this instanceof l?(w.call(this,E),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,E&&(typeof E.transform=="function"&&(this._transform=E.transform),typeof E.flush=="function"&&(this._flush=E.flush)),void this.on("prefinish",c)):new l(E)}function c(){var E=this;typeof this._flush!="function"||this._readableState.destroyed?f(this,null,null):this._flush(function(_,b){f(E,_,b)})}function f(E,_,b){if(_)return E.emit("error",_);if(b!=null&&E.push(b),E._writableState.length)throw new y;if(E._transformState.transforming)throw new g;return E.push(null)}s.exports=l;var u=o("../errors").codes,d=u.ERR_METHOD_NOT_IMPLEMENTED,p=u.ERR_MULTIPLE_CALLBACK,g=u.ERR_TRANSFORM_ALREADY_TRANSFORMING,y=u.ERR_TRANSFORM_WITH_LENGTH_0,w=o("./_stream_duplex");o("inherits")(l,w),l.prototype.push=function(E,_){return this._transformState.needTransform=!1,w.prototype.push.call(this,E,_)},l.prototype._transform=function(E,_,b){b(new d("_transform()"))},l.prototype._write=function(E,_,b){var k=this._transformState;if(k.writecb=b,k.writechunk=E,k.writeencoding=_,!k.transforming){var S=this._readableState;(k.needTransform||S.needReadable||S.length<S.highWaterMark)&&this._read(S.highWaterMark)}},l.prototype._read=function(){var E=this._transformState;E.writechunk===null||E.transforming?E.needTransform=!0:(E.transforming=!0,this._transform(E.writechunk,E.writeencoding,E.afterTransform))},l.prototype._destroy=function(E,_){w.prototype._destroy.call(this,E,function(b){_(b)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,s){(function(a,l){(function(){function c(R){var I=this;this.next=null,this.entry=null,this.finish=function(){$(I,R)}}function f(R){return X.from(R)}function u(R){return X.isBuffer(R)||R instanceof tr}function d(){}function p(R,I,U){G=G||o("./_stream_duplex"),R=R||{},typeof U!="boolean"&&(U=I instanceof G),this.objectMode=!!R.objectMode,U&&(this.objectMode=this.objectMode||!!R.writableObjectMode),this.highWaterMark=wt(this,R,"writableHighWaterMark",U),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var J=R.decodeStrings===!1;this.decodeStrings=!J,this.defaultEncoding=R.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(C){x(I,C)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=R.emitClose!==!1,this.autoDestroy=!!R.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new c(this)}function g(R){G=G||o("./_stream_duplex");var I=this instanceof G;return I||Me.call(g,this)?(this._writableState=new p(R,this,I),this.writable=!0,R&&(typeof R.write=="function"&&(this._write=R.write),typeof R.writev=="function"&&(this._writev=R.writev),typeof R.destroy=="function"&&(this._destroy=R.destroy),typeof R.final=="function"&&(this._final=R.final)),void xt.call(this)):new g(R)}function y(R,I){var U=new Lr;Ee(R,U),a.nextTick(I,U)}function w(R,I,U,J){var C;return U===null?C=new xn:typeof U!="string"&&!I.objectMode&&(C=new Ce("chunk",["string","Buffer"],U)),!C||(Ee(R,C),a.nextTick(J,C),!1)}function E(R,I,U){return R.objectMode||R.decodeStrings===!1||typeof I!="string"||(I=X.from(I,U)),I}function _(R,I,U,J,C,h){if(!U){var m=E(I,J,C);J!==m&&(U=!0,C="buffer",J=m)}var v=I.objectMode?1:J.length;I.length+=v;var T=I.length<I.highWaterMark;if(T||(I.needDrain=!0),I.writing||I.corked){var N=I.lastBufferedRequest;I.lastBufferedRequest={chunk:J,encoding:C,isBuf:U,callback:h,next:null},N?N.next=I.lastBufferedRequest:I.bufferedRequest=I.lastBufferedRequest,I.bufferedRequestCount+=1}else b(R,I,!1,v,J,C,h);return T}function b(R,I,U,J,C,h,m){I.writelen=J,I.writecb=m,I.writing=!0,I.sync=!0,I.destroyed?I.onwrite(new On("write")):U?R._writev(C,I.onwrite):R._write(C,h,I.onwrite),I.sync=!1}function k(R,I,U,J,C){--I.pendingcb,U?(a.nextTick(C,J),a.nextTick(j,R,I),R._writableState.errorEmitted=!0,Ee(R,J)):(C(J),R._writableState.errorEmitted=!0,Ee(R,J),j(R,I))}function S(R){R.writing=!1,R.writecb=null,R.length-=R.writelen,R.writelen=0}function x(R,I){var U=R._writableState,J=U.sync,C=U.writecb;if(typeof C!="function")throw new ln;if(S(U),I)k(R,U,J,I,C);else{var h=O(U)||R.destroyed;h||U.corked||U.bufferProcessing||!U.bufferedRequest||P(R,U),J?a.nextTick(M,R,U,h,C):M(R,U,h,C)}}function M(R,I,U,J){U||A(R,I),I.pendingcb--,J(),j(R,I)}function A(R,I){I.length===0&&I.needDrain&&(I.needDrain=!1,R.emit("drain"))}function P(R,I){I.bufferProcessing=!0;var U=I.bufferedRequest;if(R._writev&&U&&U.next){var J=I.bufferedRequestCount,C=Array(J),h=I.corkedRequestsFree;h.entry=U;for(var m=0,v=!0;U;)C[m]=U,U.isBuf||(v=!1),U=U.next,m+=1;C.allBuffers=v,b(R,I,!0,I.length,C,"",h.finish),I.pendingcb++,I.lastBufferedRequest=null,h.next?(I.corkedRequestsFree=h.next,h.next=null):I.corkedRequestsFree=new c(I),I.bufferedRequestCount=0}else{for(;U;){var T=U.chunk,N=U.encoding,L=U.callback,W=I.objectMode?1:T.length;if(b(R,I,!1,W,T,N,L),U=U.next,I.bufferedRequestCount--,I.writing)break}U===null&&(I.lastBufferedRequest=null)}I.bufferedRequest=U,I.bufferProcessing=!1}function O(R){return R.ending&&R.length===0&&R.bufferedRequest===null&&!R.finished&&!R.writing}function D(R,I){R._final(function(U){I.pendingcb--,U&&Ee(R,U),I.prefinished=!0,R.emit("prefinish"),j(R,I)})}function F(R,I){I.prefinished||I.finalCalled||(typeof R._final!="function"||I.destroyed?(I.prefinished=!0,R.emit("prefinish")):(I.pendingcb++,I.finalCalled=!0,a.nextTick(D,R,I)))}function j(R,I){var U=O(I);if(U&&(F(R,I),I.pendingcb===0&&(I.finished=!0,R.emit("finish"),I.autoDestroy))){var J=R._readableState;(!J||J.autoDestroy&&J.endEmitted)&&R.destroy()}return U}function Y(R,I,U){I.ending=!0,j(R,I),U&&(I.finished?a.nextTick(U):R.once("finish",U)),I.ended=!0,R.writable=!1}function $(R,I,U){var J=R.entry;for(R.entry=null;J;){var C=J.callback;I.pendingcb--,C(U),J=J.next}I.corkedRequestsFree.next=R}s.exports=g;var G;g.WritableState=p;var yt={deprecate:o("util-deprecate")},xt=o("./internal/streams/stream"),X=o("buffer").Buffer,tr=l.Uint8Array||function(){},Se=o("./internal/streams/destroy"),sn=o("./internal/streams/state"),wt=sn.getHighWaterMark,ht=o("../errors").codes,Ce=ht.ERR_INVALID_ARG_TYPE,an=ht.ERR_METHOD_NOT_IMPLEMENTED,ln=ht.ERR_MULTIPLE_CALLBACK,Ir=ht.ERR_STREAM_CANNOT_PIPE,On=ht.ERR_STREAM_DESTROYED,xn=ht.ERR_STREAM_NULL_VALUES,Lr=ht.ERR_STREAM_WRITE_AFTER_END,cn=ht.ERR_UNKNOWN_ENCODING,Ee=Se.errorOrDestroy;o("inherits")(g,xt),p.prototype.getBuffer=function(){for(var R=this.bufferedRequest,I=[];R;)I.push(R),R=R.next;return I},function(){try{Object.defineProperty(p.prototype,"buffer",{get:yt.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Me;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Me=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(R){return!!Me.call(this,R)||this===g&&R&&R._writableState instanceof p}})):Me=function(R){return R instanceof this},g.prototype.pipe=function(){Ee(this,new Ir)},g.prototype.write=function(R,I,U){var J=this._writableState,C=!1,h=!J.objectMode&&u(R);return h&&!X.isBuffer(R)&&(R=f(R)),typeof I=="function"&&(U=I,I=null),h?I="buffer":!I&&(I=J.defaultEncoding),typeof U!="function"&&(U=d),J.ending?y(this,U):(h||w(this,J,R,U))&&(J.pendingcb++,C=_(this,J,h,R,I,U)),C},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var R=this._writableState;R.corked&&(R.corked--,!R.writing&&!R.corked&&!R.bufferProcessing&&R.bufferedRequest&&P(this,R))},g.prototype.setDefaultEncoding=function(R){if(typeof R=="string"&&(R=R.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((R+"").toLowerCase())))throw new cn(R);return this._writableState.defaultEncoding=R,this},Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(R,I,U){U(new an("_write()"))},g.prototype._writev=null,g.prototype.end=function(R,I,U){var J=this._writableState;return typeof R=="function"?(U=R,R=null,I=null):typeof I=="function"&&(U=I,I=null),R!=null&&this.write(R,I),J.corked&&(J.corked=1,this.uncork()),J.ending||Y(this,J,U),this},Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(R){this._writableState&&(this._writableState.destroyed=R)}}),g.prototype.destroy=Se.destroy,g.prototype._undestroy=Se.undestroy,g.prototype._destroy=function(R,I){I(R)}}).call(this)}).call(this,o("_process"),typeof Be=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Be)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,s){(function(a){(function(){function l(A,P,O){return P in A?Object.defineProperty(A,P,{value:O,enumerable:!0,configurable:!0,writable:!0}):A[P]=O,A}function c(A,P){return{value:A,done:P}}function f(A){var P=A[y];if(P!==null){var O=A[S].read();O!==null&&(A[b]=null,A[y]=null,A[w]=null,P(c(O,!1)))}}function u(A){a.nextTick(f,A)}function d(A,P){return function(O,D){A.then(function(){return P[_]?void O(c(void 0,!0)):void P[k](O,D)},D)}}var p,g=o("./end-of-stream"),y=Symbol("lastResolve"),w=Symbol("lastReject"),E=Symbol("error"),_=Symbol("ended"),b=Symbol("lastPromise"),k=Symbol("handlePromise"),S=Symbol("stream"),x=Object.getPrototypeOf(function(){}),M=Object.setPrototypeOf((p={get stream(){return this[S]},next:function(){var A=this,P=this[E];if(P!==null)return Promise.reject(P);if(this[_])return Promise.resolve(c(void 0,!0));if(this[S].destroyed)return new Promise(function(j,Y){a.nextTick(function(){A[E]?Y(A[E]):j(c(void 0,!0))})});var O,D=this[b];if(D)O=new Promise(d(D,this));else{var F=this[S].read();if(F!==null)return Promise.resolve(c(F,!1));O=new Promise(this[k])}return this[b]=O,O}},l(p,Symbol.asyncIterator,function(){return this}),l(p,"return",function(){var A=this;return new Promise(function(P,O){A[S].destroy(null,function(D){return D?void O(D):void P(c(void 0,!0))})})}),p),x);s.exports=function(A){var P,O=Object.create(M,(P={},l(P,S,{value:A,writable:!0}),l(P,y,{value:null,writable:!0}),l(P,w,{value:null,writable:!0}),l(P,E,{value:null,writable:!0}),l(P,_,{value:A._readableState.endEmitted,writable:!0}),l(P,k,{value:function(D,F){var j=O[S].read();j?(O[b]=null,O[y]=null,O[w]=null,D(c(j,!1))):(O[y]=D,O[w]=F)},writable:!0}),P));return O[b]=null,g(A,function(D){if(D&&D.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=O[w];return F!==null&&(O[b]=null,O[y]=null,O[w]=null,F(D)),void(O[E]=D)}var j=O[y];j!==null&&(O[b]=null,O[y]=null,O[w]=null,j(c(void 0,!0))),O[_]=!0}),A.on("readable",u.bind(null,O)),O}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,s){function a(b,k){var S=Object.keys(b);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(b);k&&(x=x.filter(function(M){return Object.getOwnPropertyDescriptor(b,M).enumerable})),S.push.apply(S,x)}return S}function l(b){for(var k,S=1;S<arguments.length;S++)k=arguments[S]==null?{}:arguments[S],S%2?a(Object(k),!0).forEach(function(x){c(b,x,k[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(k)):a(Object(k)).forEach(function(x){Object.defineProperty(b,x,Object.getOwnPropertyDescriptor(k,x))});return b}function c(b,k,S){return k in b?Object.defineProperty(b,k,{value:S,enumerable:!0,configurable:!0,writable:!0}):b[k]=S,b}function f(b,k){if(!(b instanceof k))throw new TypeError("Cannot call a class as a function")}function u(b,k){for(var S,x=0;x<k.length;x++)S=k[x],S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(b,S.key,S)}function d(b,k,S){return k&&u(b.prototype,k),S&&u(b,S),b}function p(b,k,S){y.prototype.copy.call(b,k,S)}var g=o("buffer"),y=g.Buffer,w=o("util"),E=w.inspect,_=E&&E.custom||"inspect";s.exports=function(){function b(){f(this,b),this.head=null,this.tail=null,this.length=0}return d(b,[{key:"push",value:function(k){var S={data:k,next:null};0<this.length?this.tail.next=S:this.head=S,this.tail=S,++this.length}},{key:"unshift",value:function(k){var S={data:k,next:this.head};this.length===0&&(this.tail=S),this.head=S,++this.length}},{key:"shift",value:function(){if(this.length!==0){var k=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,k}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(k){if(this.length===0)return"";for(var S=this.head,x=""+S.data;S=S.next;)x+=k+S.data;return x}},{key:"concat",value:function(k){if(this.length===0)return y.alloc(0);for(var S=y.allocUnsafe(k>>>0),x=this.head,M=0;x;)p(x.data,S,M),M+=x.data.length,x=x.next;return S}},{key:"consume",value:function(k,S){var x;return k<this.head.data.length?(x=this.head.data.slice(0,k),this.head.data=this.head.data.slice(k)):k===this.head.data.length?x=this.shift():x=S?this._getString(k):this._getBuffer(k),x}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(k){var S=this.head,x=1,M=S.data;for(k-=M.length;S=S.next;){var A=S.data,P=k>A.length?A.length:k;if(M+=P===A.length?A:A.slice(0,k),k-=P,k===0){P===A.length?(++x,this.head=S.next?S.next:this.tail=null):(this.head=S,S.data=A.slice(P));break}++x}return this.length-=x,M}},{key:"_getBuffer",value:function(k){var S=y.allocUnsafe(k),x=this.head,M=1;for(x.data.copy(S),k-=x.data.length;x=x.next;){var A=x.data,P=k>A.length?A.length:k;if(A.copy(S,S.length-k,0,P),k-=P,k===0){P===A.length?(++M,this.head=x.next?x.next:this.tail=null):(this.head=x,x.data=A.slice(P));break}++M}return this.length-=M,S}},{key:_,value:function(k,S){return E(this,l({},S,{depth:0,customInspect:!1}))}}]),b}()},{buffer:3,util:2}],23:[function(o,s){(function(a){(function(){function l(u,d){f(u,d),c(u)}function c(u){u._writableState&&!u._writableState.emitClose||u._readableState&&!u._readableState.emitClose||u.emit("close")}function f(u,d){u.emit("error",d)}s.exports={destroy:function(u,d){var p=this,g=this._readableState&&this._readableState.destroyed,y=this._writableState&&this._writableState.destroyed;return g||y?(d?d(u):u&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,a.nextTick(f,this,u)):a.nextTick(f,this,u)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(u||null,function(w){!d&&w?p._writableState?p._writableState.errorEmitted?a.nextTick(c,p):(p._writableState.errorEmitted=!0,a.nextTick(l,p,w)):a.nextTick(l,p,w):d?(a.nextTick(c,p),d(w)):a.nextTick(c,p)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(u,d){var p=u._readableState,g=u._writableState;p&&p.autoDestroy||g&&g.autoDestroy?u.destroy(d):u.emit("error",d)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,s){function a(d){var p=!1;return function(){if(!p){p=!0;for(var g=arguments.length,y=Array(g),w=0;w<g;w++)y[w]=arguments[w];d.apply(this,y)}}}function l(){}function c(d){return d.setHeader&&typeof d.abort=="function"}function f(d,p,g){if(typeof p=="function")return f(d,null,p);p||(p={}),g=a(g||l);var y=p.readable||p.readable!==!1&&d.readable,w=p.writable||p.writable!==!1&&d.writable,E=function(){d.writable||b()},_=d._writableState&&d._writableState.finished,b=function(){w=!1,_=!0,y||g.call(d)},k=d._readableState&&d._readableState.endEmitted,S=function(){y=!1,k=!0,w||g.call(d)},x=function(P){g.call(d,P)},M=function(){var P;return y&&!k?(d._readableState&&d._readableState.ended||(P=new u),g.call(d,P)):w&&!_?(d._writableState&&d._writableState.ended||(P=new u),g.call(d,P)):void 0},A=function(){d.req.on("finish",b)};return c(d)?(d.on("complete",b),d.on("abort",M),d.req?A():d.on("request",A)):w&&!d._writableState&&(d.on("end",E),d.on("close",E)),d.on("end",S),d.on("finish",b),p.error!==!1&&d.on("error",x),d.on("close",M),function(){d.removeListener("complete",b),d.removeListener("abort",M),d.removeListener("request",A),d.req&&d.req.removeListener("finish",b),d.removeListener("end",E),d.removeListener("close",E),d.removeListener("finish",b),d.removeListener("end",S),d.removeListener("error",x),d.removeListener("close",M)}}var u=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;s.exports=f},{"../../../errors":15}],25:[function(o,s){s.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,s){function a(_){var b=!1;return function(){b||(b=!0,_.apply(void 0,arguments))}}function l(_){if(_)throw _}function c(_){return _.setHeader&&typeof _.abort=="function"}function f(_,b,k,S){S=a(S);var x=!1;_.on("close",function(){x=!0}),g===void 0&&(g=o("./end-of-stream")),g(_,{readable:b,writable:k},function(A){return A?S(A):(x=!0,void S())});var M=!1;return function(A){if(!x)return M?void 0:(M=!0,c(_)?_.abort():typeof _.destroy=="function"?_.destroy():void S(A||new E("pipe")))}}function u(_){_()}function d(_,b){return _.pipe(b)}function p(_){return _.length&&typeof _[_.length-1]=="function"?_.pop():l}var g,y=o("../../../errors").codes,w=y.ERR_MISSING_ARGS,E=y.ERR_STREAM_DESTROYED;s.exports=function(){for(var _=arguments.length,b=Array(_),k=0;k<_;k++)b[k]=arguments[k];var S=p(b);if(Array.isArray(b[0])&&(b=b[0]),2>b.length)throw new w("streams");var x,M=b.map(function(A,P){var O=P<b.length-1;return f(A,O,0<P,function(D){x||(x=D),D&&M.forEach(u),O||(M.forEach(u),S(x))})});return b.reduce(d)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,s){function a(c,f,u){return c.highWaterMark==null?f?c[u]:null:c.highWaterMark}var l=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;s.exports={getHighWaterMark:function(c,f,u,d){var p=a(f,d,u);if(p!=null){if(!(isFinite(p)&&n(p)===p)||0>p){var g=d?u:"highWaterMark";throw new l(g,p)}return n(p)}return c.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,s){s.exports=o("events").EventEmitter},{events:7}],29:[function(o,s,a){a=s.exports=o("./lib/_stream_readable.js"),a.Stream=a,a.Readable=a,a.Writable=o("./lib/_stream_writable.js"),a.Duplex=o("./lib/_stream_duplex.js"),a.Transform=o("./lib/_stream_transform.js"),a.PassThrough=o("./lib/_stream_passthrough.js"),a.finished=o("./lib/internal/streams/end-of-stream.js"),a.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,s,a){function l(d,p){for(var g in d)p[g]=d[g]}function c(d,p,g){return u(d,p,g)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var f=o("buffer"),u=f.Buffer;u.from&&u.alloc&&u.allocUnsafe&&u.allocUnsafeSlow?s.exports=f:(l(f,a),a.Buffer=c),c.prototype=Object.create(u.prototype),l(u,c),c.from=function(d,p,g){if(typeof d=="number")throw new TypeError("Argument must not be a number");return u(d,p,g)},c.alloc=function(d,p,g){if(typeof d!="number")throw new TypeError("Argument must be a number");var y=u(d);return p===void 0?y.fill(0):typeof g=="string"?y.fill(p,g):y.fill(p),y},c.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return u(d)},c.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return f.SlowBuffer(d)}},{buffer:3}],31:[function(o,s,a){function l(M){if(!M)return"utf8";for(var A;;)switch(M){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return M;default:if(A)return;M=(""+M).toLowerCase(),A=!0}}function c(M){var A=l(M);if(typeof A!="string"&&(S.isEncoding===x||!x(M)))throw new Error("Unknown encoding: "+M);return A||M}function f(M){this.encoding=c(M);var A;switch(this.encoding){case"utf16le":this.text=y,this.end=w,A=4;break;case"utf8":this.fillLast=g,A=4;break;case"base64":this.text=E,this.end=_,A=3;break;default:return this.write=b,void(this.end=k)}this.lastNeed=0,this.lastTotal=0,this.lastChar=S.allocUnsafe(A)}function u(M){return 127>=M?0:M>>5==6?2:M>>4==14?3:M>>3==30?4:M>>6==2?-1:-2}function d(M,A,P){var O=A.length-1;if(O<P)return 0;var D=u(A[O]);return 0<=D?(0<D&&(M.lastNeed=D-1),D):--O<P||D===-2?0:(D=u(A[O]),0<=D?(0<D&&(M.lastNeed=D-2),D):--O<P||D===-2?0:(D=u(A[O]),0<=D?(0<D&&(D===2?D=0:M.lastNeed=D-3),D):0))}function p(M,A){if((192&A[0])!=128)return M.lastNeed=0,"\uFFFD";if(1<M.lastNeed&&1<A.length){if((192&A[1])!=128)return M.lastNeed=1,"\uFFFD";if(2<M.lastNeed&&2<A.length&&(192&A[2])!=128)return M.lastNeed=2,"\uFFFD"}}function g(M){var A=this.lastTotal-this.lastNeed,P=p(this,M);return P===void 0?this.lastNeed<=M.length?(M.copy(this.lastChar,A,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(M.copy(this.lastChar,A,0,M.length),void(this.lastNeed-=M.length)):P}function y(M,A){if((M.length-A)%2==0){var P=M.toString("utf16le",A);if(P){var O=P.charCodeAt(P.length-1);if(55296<=O&&56319>=O)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=M[M.length-2],this.lastChar[1]=M[M.length-1],P.slice(0,-1)}return P}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=M[M.length-1],M.toString("utf16le",A,M.length-1)}function w(M){var A=M&&M.length?this.write(M):"";if(this.lastNeed){var P=this.lastTotal-this.lastNeed;return A+this.lastChar.toString("utf16le",0,P)}return A}function E(M,A){var P=(M.length-A)%3;return P==0?M.toString("base64",A):(this.lastNeed=3-P,this.lastTotal=3,P==1?this.lastChar[0]=M[M.length-1]:(this.lastChar[0]=M[M.length-2],this.lastChar[1]=M[M.length-1]),M.toString("base64",A,M.length-P))}function _(M){var A=M&&M.length?this.write(M):"";return this.lastNeed?A+this.lastChar.toString("base64",0,3-this.lastNeed):A}function b(M){return M.toString(this.encoding)}function k(M){return M&&M.length?this.write(M):""}var S=o("safe-buffer").Buffer,x=S.isEncoding||function(M){switch(M=""+M,M&&M.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};a.StringDecoder=f,f.prototype.write=function(M){if(M.length===0)return"";var A,P;if(this.lastNeed){if(A=this.fillLast(M),A===void 0)return"";P=this.lastNeed,this.lastNeed=0}else P=0;return P<M.length?A?A+this.text(M,P):this.text(M,P):A||""},f.prototype.end=function(M){var A=M&&M.length?this.write(M):"";return this.lastNeed?A+"\uFFFD":A},f.prototype.text=function(M,A){var P=d(this,M,A);if(!this.lastNeed)return M.toString("utf8",A);this.lastTotal=P;var O=M.length-(P-this.lastNeed);return M.copy(this.lastChar,0,O),M.toString("utf8",A,O)},f.prototype.fillLast=function(M){return this.lastNeed<=M.length?(M.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(M.copy(this.lastChar,this.lastTotal-this.lastNeed,0,M.length),void(this.lastNeed-=M.length))}},{"safe-buffer":30}],32:[function(o,s){(function(a){(function(){function l(c){try{if(!a.localStorage)return!1}catch{return!1}var f=a.localStorage[c];return f!=null&&(f+"").toLowerCase()==="true"}s.exports=function(c,f){function u(){if(!d){if(l("throwDeprecation"))throw new Error(f);l("traceDeprecation")?console.trace(f):console.warn(f),d=!0}return c.apply(this,arguments)}if(l("noDeprecation"))return c;var d=!1;return u}}).call(this)}).call(this,typeof Be=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Be)},{}],"/":[function(o,s){function a(_){return _.replace(/a=ice-options:trickle\s\n/g,"")}function l(_){console.warn(_)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const c=o("debug")("simple-peer"),f=o("get-browser-rtc"),u=o("randombytes"),d=o("readable-stream"),p=o("queue-microtask"),g=o("err-code"),{Buffer:y}=o("buffer"),w=65536;class E extends d.Duplex{constructor(b){if(b=Object.assign({allowHalfOpen:!1},b),super(b),this._id=u(4).toString("hex").slice(0,7),this._debug("new peer %o",b),this.channelName=b.initiator?b.channelName||u(20).toString("hex"):null,this.initiator=b.initiator||!1,this.channelConfig=b.channelConfig||E.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},E.config,b.config),this.offerOptions=b.offerOptions||{},this.answerOptions=b.answerOptions||{},this.sdpTransform=b.sdpTransform||(k=>k),this.streams=b.streams||(b.stream?[b.stream]:[]),this.trickle=b.trickle===void 0||b.trickle,this.allowHalfTrickle=b.allowHalfTrickle!==void 0&&b.allowHalfTrickle,this.iceCompleteTimeout=b.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=b.wrtc&&typeof b.wrtc=="object"?b.wrtc:f(),!this._wrtc)throw g(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(k){return void this.destroy(g(k,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=k=>{this._onIceCandidate(k)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(k=>{this.destroy(g(k,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=k=>{this._setupData(k)},this.streams&&this.streams.forEach(k=>{this.addStream(k)}),this._pc.ontrack=k=>{this._onTrack(k)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof b=="string")try{b=JSON.parse(b)}catch{b={}}this._debug("signal()"),b.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),b.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(b.transceiverRequest.kind,b.transceiverRequest.init)),b.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(b.candidate):this._pendingCandidates.push(b.candidate)),b.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(b)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(k=>{this._addIceCandidate(k)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(k=>{this.destroy(g(k,"ERR_SET_REMOTE_DESCRIPTION"))}),b.sdp||b.candidate||b.renegotiate||b.transceiverRequest||this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(b){const k=new this._wrtc.RTCIceCandidate(b);this._pc.addIceCandidate(k).catch(S=>{!k.address||k.address.endsWith(".local")?l("Ignoring unsupported ICE candidate."):this.destroy(g(S,"ERR_ADD_ICE_CANDIDATE"))})}send(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(b)}}addTransceiver(b,k){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(b,k),this._needsNegotiation()}catch(S){this.destroy(g(S,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:b,init:k}})}}addStream(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),b.getTracks().forEach(k=>{this.addTrack(k,b)})}}addTrack(b,k){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const S=this._senderMap.get(b)||new Map;let x=S.get(k);if(!x)x=this._pc.addTrack(b,k),S.set(k,x),this._senderMap.set(b,S),this._needsNegotiation();else throw x.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(b,k,S){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const x=this._senderMap.get(b),M=x?x.get(S):null;if(!M)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");k&&this._senderMap.set(k,x),M.replaceTrack==null?this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):M.replaceTrack(k)}removeTrack(b,k){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const S=this._senderMap.get(b),x=S?S.get(k):null;if(!x)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{x.removed=!0,this._pc.removeTrack(x)}catch(M){M.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(x):this.destroy(g(M,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),b.getTracks().forEach(k=>{this.removeTrack(k,b)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,p(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(b){this._destroy(b,()=>{})}_destroy(b,k){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",b&&(b.message||b)),p(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",b&&(b.message||b)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,b&&this.emit("error",b),this.emit("close"),k()}))}_setupData(b){if(!b.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=b.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=w),this.channelName=this._channel.label,this._channel.onmessage=S=>{this._onChannelMessage(S)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=S=>{const x=S.error instanceof Error?S.error:new Error(`Datachannel error: ${S.message} ${S.filename}:${S.lineno}:${S.colno}`);this.destroy(g(x,"ERR_DATA_CHANNEL"))};let k=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(k&&this._onChannelClose(),k=!0):k=!1},5e3)}_read(){}_write(b,k,S){if(this.destroyed)return S(g(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(b)}catch(x){return this.destroy(g(x,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>w?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=S):S(null)}else this._debug("write before connect"),this._chunk=b,this._cb=S}_onFinish(){if(!this.destroyed){const b=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?b():this.once("connect",b)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(b=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(b.sdp=a(b.sdp)),b.sdp=this.sdpTransform(b.sdp);const k=()=>{if(!this.destroyed){const S=this._pc.localDescription||b;this._debug("signal"),this.emit("signal",{type:S.type,sdp:S.sdp})}};this._pc.setLocalDescription(b).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?k():this.once("_iceComplete",k))}).catch(S=>{this.destroy(g(S,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(b=>{this.destroy(g(b,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(b=>{b.mid||!b.sender.track||b.requested||(b.requested=!0,this.addTransceiver(b.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(b=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(b.sdp=a(b.sdp)),b.sdp=this.sdpTransform(b.sdp);const k=()=>{if(!this.destroyed){const S=this._pc.localDescription||b;this._debug("signal"),this.emit("signal",{type:S.type,sdp:S.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(b).then(()=>{this.destroyed||(this.trickle||this._iceComplete?k():this.once("_iceComplete",k))}).catch(S=>{this.destroy(g(S,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(b=>{this.destroy(g(b,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const b=this._pc.iceConnectionState,k=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",b,k),this.emit("iceStateChange",b,k),(b==="connected"||b==="completed")&&(this._pcReady=!0,this._maybeReady()),b==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),b==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(b){const k=S=>(Object.prototype.toString.call(S.values)==="[object Array]"&&S.values.forEach(x=>{Object.assign(S,x)}),S);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(S=>{const x=[];S.forEach(M=>{x.push(k(M))}),b(null,x)},S=>b(S)):0<this._pc.getStats.length?this._pc.getStats(S=>{if(this.destroyed)return;const x=[];S.result().forEach(M=>{const A={};M.names().forEach(P=>{A[P]=M.stat(P)}),A.id=M.id,A.type=M.type,A.timestamp=M.timestamp,x.push(k(A))}),b(null,x)},S=>b(S)):b(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const b=()=>{this.destroyed||this.getStats((k,S)=>{if(this.destroyed)return;k&&(S=[]);const x={},M={},A={};let P=!1;S.forEach(D=>{(D.type==="remotecandidate"||D.type==="remote-candidate")&&(x[D.id]=D),(D.type==="localcandidate"||D.type==="local-candidate")&&(M[D.id]=D),(D.type==="candidatepair"||D.type==="candidate-pair")&&(A[D.id]=D)});const O=D=>{P=!0;let F=M[D.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof D.googLocalAddress=="string"&&(F=D.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=x[D.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof D.googRemoteAddress=="string"&&(j=D.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(S.forEach(D=>{D.type==="transport"&&D.selectedCandidatePairId&&O(A[D.selectedCandidatePairId]),(D.type==="googCandidatePair"&&D.googActiveConnection==="true"||(D.type==="candidatepair"||D.type==="candidate-pair")&&D.selected)&&O(D)}),!P&&(!Object.keys(A).length||Object.keys(M).length))return void setTimeout(b,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(g(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const D=this._cb;this._cb=null,D(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};b()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>w)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(b=>{this._pc.removeTrack(b),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(b){this.destroyed||(b.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:b.candidate.candidate,sdpMLineIndex:b.candidate.sdpMLineIndex,sdpMid:b.candidate.sdpMid}}):!b.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),b.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(b){if(this.destroyed)return;let k=b.data;k instanceof ArrayBuffer&&(k=y.from(k)),this.push(k)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const b=this._cb;this._cb=null,b(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(b){this.destroyed||b.streams.forEach(k=>{this._debug("on track"),this.emit("track",b.track,k),this._remoteTracks.push({track:b.track,stream:k}),this._remoteStreams.some(S=>S.id===k.id)||(this._remoteStreams.push(k),p(()=>{this._debug("on stream"),this.emit("stream",k)}))})}_debug(){const b=[].slice.call(arguments);b[0]="["+this._id+"] "+b[0],c.apply(null,b)}}E.WEBRTC_SUPPORT=!!f(),E.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},E.channelConfig={},s.exports=E},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(vd);var o_=vd.exports;const Ml=0,Tl=1,bd=2,wd=(e,t)=>{K(e,Ml);const n=aw(t);kt(e,n)},kd=(e,t,n)=>{K(e,Tl),kt(e,hl(t,n))},s_=(e,t,n)=>kd(t,n,It(e)),_d=(e,t,n)=>{try{Bh(t,It(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},a_=(e,t)=>{K(e,bd),kt(e,t)},l_=_d,c_=(e,t,n,r)=>{const i=Z(e);switch(i){case Ml:s_(e,t,n);break;case Tl:_d(e,n,r);break;case bd:l_(e,n,r);break;default:throw new Error("Unknown message type")}return i},u_=(e,t)=>{const n=Ac(e).buffer,r=Ac(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(i=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},Sd=(e,t)=>{if(!t)return el(e);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(r=>{const i=Tt();return Ve(i,"AES-GCM"),kt(i,n),kt(i,new Uint8Array(r)),vt(i)})},f_=(e,t)=>{const n=Tt();return _r(n,e),Sd(vt(n),t)},Cd=(e,t)=>{if(!t)return el(e);const n=Je(e);Ze(n)!=="AES-GCM"&&Nb(Xn("Unknown encryption algorithm"));const i=It(n),o=It(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,o).then(s=>new Uint8Array(s))},h_=(e,t)=>Cd(e,t).then(n=>kr(Je(new Uint8Array(n)))),Te=$b("y-webrtc"),dr=0,Ed=3,mi=1,Ol=4,Eo=new Map,zn=new Map,Md=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),Te("synced ",ae,e.name,Sn," with all peers"))},Td=(e,t,n)=>{const r=Je(t),i=Tt(),o=Z(r);if(e===void 0)return null;const s=e.awareness,a=e.doc;let l=!1;switch(o){case dr:{K(i,dr);const c=c_(r,i,a,e);c===Tl&&!e.synced&&n(),c===Ml&&(l=!0);break}case Ed:K(i,mi),kt(i,wo(s,Array.from(s.getStates().keys()))),l=!0;break;case mi:hk(s,It(r),e);break;case Ol:{const c=Hn(r)===1,f=Ze(r);if(f!==e.peerId&&(e.bcConns.has(f)&&!c||!e.bcConns.has(f)&&c)){const u=[],d=[];c?(e.bcConns.add(f),d.push(f)):(e.bcConns.delete(f),u.push(f)),e.provider.emit("peers",[{added:d,removed:u,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),Od(e)}break}default:return console.error("Unable to compute message"),i}return l?i:null},d_=(e,t)=>{const n=e.room;return Te("received message from ",ae,e.remotePeerId,$o," (",n.name,")",Sn,Si),Td(n,t,()=>{e.synced=!0,Te("synced ",ae,n.name,Sn," with ",ae,e.remotePeerId),Md(n)})},Bs=(e,t)=>{Te("send message to ",ae,e.remotePeerId,Sn,$o," (",e.room.name,")",Si);try{e.peer.send(vt(t))}catch{}},p_=(e,t)=>{Te("broadcast message in ",ae,e.name,Sn),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})};class hu{constructor(t,n,r,i){Te("establishing connection to ",ae,r),this.room=i,this.remotePeerId=r,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new o_(z({initiator:n},i.provider.peerOpts)),this.peer.on("signal",o=>{xl(t,i,{to:r,from:i.peerId,type:"signal",signal:o})}),this.peer.on("connect",()=>{Te("connected to ",ae,r),this.connected=!0;const s=i.provider.doc,a=i.awareness,l=Tt();K(l,dr),wd(l,s),Bs(this,l);const c=a.getStates();if(c.size>0){const f=Tt();K(f,mi),kt(f,wo(a,Array.from(c.keys()))),Bs(this,f)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,i.webrtcConns.has(this.remotePeerId)&&(i.webrtcConns.delete(this.remotePeerId),i.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}])),Md(i),this.peer.destroy(),Te("closed connection to ",ae,r),ma(i)}),this.peer.on("error",o=>{Te("Error in connection to ",ae,r,": ",o),ma(i)}),this.peer.on("data",o=>{const s=d_(this,o);s!==null&&Bs(this,s)})}destroy(){this.peer.destroy()}}const gn=(e,t)=>Sd(t,e.key).then(n=>e.mux(()=>i_(e.name,n))),du=(e,t)=>{e.bcconnected&&gn(e,t),p_(e,t)},ma=e=>{Eo.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&xl(t,e,{type:"announce",from:e.peerId}))})},Od=e=>{if(e.provider.filterBcConns){const t=Tt();K(t,Ol),si(t,1),Ve(t,e.peerId),gn(e,vt(t))}};class g_{constructor(t,n,r,i){this.peerId=Eh(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=r,this.key=i,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Sl(),this.bcconnected=!1,this._bcSubscriber=o=>Cd(new Uint8Array(o),i).then(s=>this.mux(()=>{const a=Td(this,s,()=>{});a&&gn(this,vt(a))})),this._docUpdateHandler=(o,s)=>{const a=Tt();K(a,dr),a_(a,o),du(this,vt(a))},this._awarenessUpdateHandler=({added:o,updated:s,removed:a},l)=>{const c=o.concat(s).concat(a),f=Tt();K(f,mi),kt(f,wo(this.awareness,c)),du(this,vt(f))},this._beforeUnloadHandler=()=>{ua(this.awareness,[t.clientID],"window unload"),zn.forEach(o=>{o.disconnect()})},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),ma(this);const t=this.name;n_(t,this._bcSubscriber),this.bcconnected=!0,Od(this);const n=Tt();K(n,dr),wd(n,this.doc),gn(this,vt(n));const r=Tt();K(r,dr),kd(r,this.doc),gn(this,vt(r));const i=Tt();K(i,Ed),gn(this,vt(i));const o=Tt();K(o,mi),kt(o,wo(this.awareness,[this.doc.clientID])),gn(this,vt(o))}disconnect(){Eo.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),ua(this.awareness,[this.doc.clientID],"disconnect");const t=Tt();K(t,Ol),si(t,0),Ve(t,this.peerId),gn(this,vt(t)),r_(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.off("exit",this._beforeUnloadHandler)}}const m_=(e,t,n,r)=>{if(zn.has(n))throw Xn(`A Yjs Doc connected to room "${n}" already exists!`);const i=new g_(e,t,n,r);return zn.set(n,i),i},xl=(e,t,n)=>{t.key?f_(n,t.key).then(r=>{e.send({type:"publish",topic:t.name,data:kh(r)})}):e.send({type:"publish",topic:t.name,data:n})};class y_ extends Zk{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{Te(`connected (${t})`);const n=Array.from(zn.keys());this.send({type:"subscribe",topics:n}),zn.forEach(r=>xl(this,r,{type:"announce",from:r.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const r=n.topic,i=zn.get(r);if(i==null||typeof r!="string")return;const o=s=>{const a=i.webrtcConns,l=i.peerId;if(s==null||s.from===l||s.to!==void 0&&s.to!==l||i.bcConns.has(s.from))return;const c=a.has(s.from)?()=>{}:()=>i.provider.emit("peers",[{removed:[],added:[s.from],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}]);switch(s.type){case"announce":a.size<i.provider.maxConns&&(ue(a,s.from,()=>new hu(this,!0,s.from,i)),c());break;case"signal":s.to===l&&(ue(a,s.from,()=>new hu(this,!1,s.from,i)).peer.signal(s.signal),c());break}};i.key?typeof n.data=="string"&&h_(_h(n.data),i.key).then(o):o(n.data)}}}),this.on("disconnect",()=>Te(`disconnect (${t})`))}}class v_ extends xr{constructor(t,n,{signaling:r=["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"],password:i=null,awareness:o=new fk(n),maxConns:s=20+jn(Sh()*15),filterBcConns:a=!0,peerOpts:l={}}={}){super(),this.roomName=t,this.doc=n,this.filterBcConns=a,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=s,this.peerOpts=l,this.key=i?u_(i,t):el(null),this.room=null,this.key.then(c=>{this.room=m_(n,this,t,c),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const n=ue(Eo,t,()=>new y_(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),Eo.delete(t.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),zn.delete(this.roomName)}),super.destroy()}}const Qn=e=>Jo((t,n)=>{e.onerror=r=>n(new Error(r.target.error)),e.onblocked=()=>location.reload(),e.onsuccess=r=>t(r.target.result)}),b_=(e,t)=>Jo((n,r)=>{const i=indexedDB.open(e);i.onupgradeneeded=o=>t(o.target.result),i.onerror=o=>r(Xn(o.target.error)),i.onblocked=()=>location.reload(),i.onsuccess=o=>{const s=o.target.result;s.onversionchange=()=>{s.close()},typeof addEventListener!="undefined"&&addEventListener("unload",()=>s.close()),n(s)}}),w_=e=>Qn(indexedDB.deleteDatabase(e)),k_=(e,t)=>t.forEach(n=>e.createObjectStore.apply(e,n)),Vr=(e,t,n="readwrite")=>{const r=e.transaction(t,n);return t.map(i=>x_(r,i))},xd=(e,t)=>Qn(e.count(t)),__=(e,t)=>Qn(e.get(t)),Ad=(e,t)=>Qn(e.delete(t)),S_=(e,t,n)=>Qn(e.put(t,n)),ya=(e,t)=>Qn(e.add(t)),C_=(e,t)=>Qn(e.getAll(t)),E_=(e,t,n)=>{let r=null;return O_(e,t,i=>(r=i,!1),n).then(()=>r)},M_=(e,t=null)=>E_(e,t,"prev"),T_=(e,t)=>Jo((n,r)=>{e.onerror=r,e.onsuccess=i=>{const o=i.target.result;if(o===null||t(o)===!1)return n();o.continue()}}),O_=(e,t,n,r="next")=>T_(e.openKeyCursor(t,r),i=>n(i.key)),x_=(e,t)=>e.objectStore(t),A_=(e,t)=>IDBKeyRange.upperBound(e,t),D_=(e,t)=>IDBKeyRange.lowerBound(e,t),Fs="custom",Dd="updates",Nd=500,Rd=e=>{const[t]=Vr(e.db,[Dd]);return C_(t,D_(e._dbref,!1)).then(n=>e._mux(()=>ft(e.doc,()=>{n.forEach(r=>Bh(e.doc,r))},e,!1))).then(()=>M_(t).then(n=>{e._dbref=n+1})).then(()=>xd(t).then(n=>{e._dbsize=n})).then(()=>t)},N_=(e,t=!0)=>Rd(e).then(n=>{(t||e._dbsize>=Nd)&&ya(n,hl(e.doc)).then(()=>Ad(n,A_(e._dbref,!0))).then(()=>xd(n).then(r=>{e._dbsize=r}))});class R_ extends xr{constructor(t,n){super(),this.doc=n,this.name=t,this._mux=Sl(),this._dbref=0,this._dbsize=0,this.db=null,this.synced=!1,this._db=b_(t,r=>k_(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=this._db.then(r=>{this.db=r;const i=hl(n);return Rd(this).then(o=>ya(o,i)).then(()=>(this.emit("synced",[this]),this.synced=!0,this))}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=r=>this._mux(()=>{if(this.db){const[i]=Vr(this.db,[Dd]);ya(i,r),++this._dbsize>=Nd&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{N_(this,!1),this._storeTimeoutId=null},this._storeTimeout))}}),n.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._db.then(t=>{t.close()})}clearData(){return this.destroy().then(()=>{w_(this.name)})}get(t){return this._db.then(n=>{const[r]=Vr(n,[Fs],"readonly");return __(r,t)})}set(t,n){return this._db.then(r=>{const[i]=Vr(r,[Fs]);return S_(i,n,t)})}del(t){return this._db.then(n=>{const[r]=Vr(n,[Fs]);return Ad(r,t)})}}function pu(e){let t,n,r,i,o,s,a,l,c,f,u,d,p,g,y,w,E;return{c(){t=pe("button"),t.textContent="H1",n=fn(),r=pe("button"),r.textContent="H2",i=fn(),o=pe("button"),o.textContent="H3",s=fn(),a=pe("button"),a.textContent="H4",l=fn(),c=pe("button"),c.textContent="P",f=fn(),u=pe("div"),d=fn(),p=pe("button"),p.textContent="B",g=fn(),y=pe("button"),y.textContent="I",Gt(t,"class","svelte-uj88k0"),ee(t,"active",e[1].isActive("heading",{level:1})),Gt(r,"class","svelte-uj88k0"),ee(r,"active",e[1].isActive("heading",{level:2})),Gt(o,"class","svelte-uj88k0"),ee(o,"active",e[1].isActive("heading",{level:3})),Gt(a,"class","svelte-uj88k0"),ee(a,"active",e[1].isActive("heading",{level:4})),Gt(c,"class","svelte-uj88k0"),ee(c,"active",e[1].isActive("paragraph")),Qo(u,"padding-right","10px"),Qo(u,"border-right","1px solid grey"),Qo(u,"margin-right","10px"),Gt(p,"class","svelte-uj88k0"),ee(p,"active",e[1].isActive("bold")),Gt(y,"class","svelte-uj88k0"),ee(y,"active",e[1].isActive("italic"))},m(_,b){jt(_,t,b),jt(_,n,b),jt(_,r,b),jt(_,i,b),jt(_,o,b),jt(_,s,b),jt(_,a,b),jt(_,l,b),jt(_,c,b),jt(_,f,b),jt(_,u,b),jt(_,d,b),jt(_,p,b),jt(_,g,b),jt(_,y,b),w||(E=[Dn(t,"click",e[2]),Dn(r,"click",e[3]),Dn(o,"click",e[4]),Dn(a,"click",e[5]),Dn(c,"click",e[6]),Dn(p,"click",e[7]),Dn(y,"click",e[8])],w=!0)},p(_,b){b&2&&ee(t,"active",_[1].isActive("heading",{level:1})),b&2&&ee(r,"active",_[1].isActive("heading",{level:2})),b&2&&ee(o,"active",_[1].isActive("heading",{level:3})),b&2&&ee(a,"active",_[1].isActive("heading",{level:4})),b&2&&ee(c,"active",_[1].isActive("paragraph")),b&2&&ee(p,"active",_[1].isActive("bold")),b&2&&ee(y,"active",_[1].isActive("italic"))},d(_){_&&Nt(t),_&&Nt(n),_&&Nt(r),_&&Nt(i),_&&Nt(o),_&&Nt(s),_&&Nt(a),_&&Nt(l),_&&Nt(c),_&&Nt(f),_&&Nt(u),_&&Nt(d),_&&Nt(p),_&&Nt(g),_&&Nt(y),w=!1,yi(E)}}}function I_(e){let t,n,r,i,o,s=e[1]!==void 0&&pu(e);return{c(){t=pe("div"),n=pe("div"),r=pe("div"),s&&s.c(),i=fn(),o=pe("div"),Gt(r,"id","menu"),Gt(r,"class","svelte-uj88k0"),Gt(o,"id","document"),Gt(o,"class","svelte-uj88k0"),Gt(n,"id","editor"),Gt(n,"class","svelte-uj88k0"),Gt(t,"id","wrapper"),Gt(t,"class","svelte-uj88k0")},m(a,l){jt(a,t,l),Ai(t,n),Ai(n,r),s&&s.m(r,null),Ai(n,i),Ai(n,o),e[9](o)},p(a,[l]){a[1]!==void 0?s?s.p(a,l):(s=pu(a),s.c(),s.m(r,null)):s&&(s.d(1),s=null)},i:Yi,o:Yi,d(a){a&&Nt(t),s&&s.d(),e[9](null)}}}const gu="tobloef";function L_(e,t,n){const r=new Nr,i=new v_(gu,r);new R_(gu,r);let o,s;Hd(()=>{n(1,s=new qv({element:o,content:"",autofocus:!0,onTransaction:()=>{n(1,s)},extensions:[H0.configure({history:!1}),Bk.configure({document:r}),Fk.configure({provider:i})]}))}),qd(()=>{s!=null&&s.destroy()});const a=()=>s.chain().focus().toggleHeading({level:1}).run(),l=()=>s.chain().focus().toggleHeading({level:2}).run(),c=()=>s.chain().focus().toggleHeading({level:3}).run(),f=()=>s.chain().focus().toggleHeading({level:4}).run(),u=()=>s.chain().focus().setParagraph().run(),d=()=>s.chain().focus().toggleBold().run(),p=()=>s.chain().focus().toggleItalic().run();function g(y){zs[y?"unshift":"push"](()=>{o=y,n(0,o)})}return[o,s,a,l,c,f,u,d,p,g]}class P_ extends tp{constructor(t){super(),Qd(this,t,L_,I_,zd,{})}}new P_({target:document.getElementById("app")});
